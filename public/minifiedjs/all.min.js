function config(e){e.translations("en",{DASHBOARD:"Dashboard",GRAPHS:"Graphs",MAILBOX:"Mailbox",WIDGETS:"Widgets",METRICS:"Metrics",FORMS:"Forms",APPVIEWS:"App views",OTHERPAGES:"Other pages",UIELEMENTS:"UI elements",MISCELLANEOUS:"Miscellaneous",GRIDOPTIONS:"Grid options",TABLES:"Tables",COMMERCE:"E-commerce",GALLERY:"Gallery",MENULEVELS:"Menu levels",ANIMATIONS:"Animations",LANDING:"Landing page",LAYOUTS:"Layouts",WELCOME:"Welcome Amelia",MESSAGEINFO:"You have 42 messages and 6 notifications.",SEARCH:"Search for something..."}).translations("es",{DASHBOARD:"Salpicadero",GRAPHS:"Gráficos",MAILBOX:"El correo",WIDGETS:"Widgets",METRICS:"Métrica",FORMS:"Formas",APPVIEWS:"Vistas app",OTHERPAGES:"Otras páginas",UIELEMENTS:"UI elements",MISCELLANEOUS:"Misceláneo",GRIDOPTIONS:"Cuadrícula",TABLES:"Tablas",COMMERCE:"E-comercio",GALLERY:"Galería",MENULEVELS:"Niveles de menú",ANIMATIONS:"Animaciones",LANDING:"Página de destino",LAYOUTS:"Esquemas",WELCOME:"Bienvenido Amelia",MESSAGEINFO:"Usted tiene 42 mensajes y 6 notificaciones.",SEARCH:"Busca algo ..."}),e.preferredLanguage("en")}function pageTitle(e,t){return{link:function(a,r){var o=function(e,a,o,s,i){var n="Datapoolt";a.data&&a.data.pageTitle&&(n="Datapoolt | "+a.data.pageTitle),t(function(){r.text(n)})};e.$on("$stateChangeStart",o)}}}function sideNavigation(e){return{restrict:"A",link:function(t,a){e(function(){a.metisMenu()})}}}function hcChart(e){return{restrict:"E",template:"<div></div>",scope:{options:"="},link:function(t,a){function r(){Highcharts.chart(a[0],t.options)}e(r,200)}}}function responsiveVideo(){return{restrict:"A",link:function(e,t){var a=t,r=t.children();r.attr("data-aspectRatio",r.height()/r.width()).removeAttr("height").removeAttr("width"),$(window).resize(function(){var e=a.width();r.width(e).height(e*r.attr("data-aspectRatio"))}).resize()}}}function iboxTools(e){return{restrict:"A",scope:!0,templateUrl:"common/ibox_tools.ejs",controller:["$scope","$element",function(t,a){t.showhide=function(){var t=a.closest("div.ibox"),r=a.find("i:first"),o=t.find("div.ibox-content");o.slideToggle(200),r.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),t.toggleClass("").toggleClass("border-bottom"),e(function(){t.resize(),t.find("[id^=map-]").resize()},50)},t.closebox=function(){var e=a.closest("div.ibox");e.remove()}}]}}function iboxToolsFullScreen(e){return{restrict:"A",scope:!0,templateUrl:"common/ibox_tools_full_screen.ejs",controller:["$scope","$element",function(t,a){t.showhide=function(){var t=a.closest("div.ibox"),r=a.find("i:first"),o=t.find("div.ibox-content");o.slideToggle(200),r.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),t.toggleClass("").toggleClass("border-bottom"),e(function(){t.resize(),t.find("[id^=map-]").resize()},50)},t.closebox=function(){var e=a.closest("div.ibox");e.remove()},t.fullscreen=function(){var e=a.closest("div.ibox"),t=a.find("i.fa-expand");$("body").toggleClass("fullscreen-ibox-mode"),t.toggleClass("fa-expand").toggleClass("fa-compress"),e.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}}]}}function minimalizaSidebar(e){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()" style="margin-top: 10px;"><i class="fa fa-bars"></i></a>',controller:["$scope","$element",function(e,t){e.minimalize=function(){$("body").toggleClass("mini-navbar");var e=$(window).width();if(768==e&&($("body").hasClass("mini-navbar")?$("#side-menu").css("display","block"):$("#side-menu").css("display","none")),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")){$(".tooltip").hide();document.getElementById("CustomTemplate").offsetWidth;$("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500),!$("body").hasClass("body-small")},100)}else $("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},300)):($(".tooltip").hide(),$("#side-menu").removeAttr("style"),$("body").hasClass("mini-navbar")&&($(".tooltip").show(),$("#dashboardTitleIcons").show()))}}]}}function closeOffCanvas(){return{restrict:"A",template:'<a class="close-canvas-menu" ng-click="closeOffCanvas()"><i class="fa fa-times"></i></a>',controller:["$scope","$element",function(e,t){e.closeOffCanvas=function(){$("body").toggleClass("mini-navbar")}}]}}function vectorMap(){return{restrict:"A",scope:{myMapData:"="},link:function(e,t,a){t.vectorMap({map:"world_mill_en",backgroundColor:"transparent",regionStyle:{initial:{fill:"#e4e4e4","fill-opacity":.9,stroke:"none","stroke-width":0,"stroke-opacity":0}},series:{regions:[{values:e.myMapData,scale:["#1ab394","#22d6b1"],normalizeFunction:"polynomial"}]}})}}}function sparkline(){return{restrict:"A",scope:{sparkData:"=",sparkOptions:"="},link:function(e,t,a){e.$watch(e.sparkData,function(){r()}),e.$watch(e.sparkOptions,function(){r()});var r=function(){$(t).sparkline(e.sparkData,e.sparkOptions)}}}}function icheck(e){return{restrict:"A",require:"ngModel",link:function(t,a,r,o){return e(function(){var e;return e=r.value,t.$watch(r.ngModel,function(e){$(a).iCheck("update")}),$(a).iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green"}).on("ifChanged",function(s){if("checkbox"===$(a).attr("type")&&r.ngModel&&t.$apply(function(){return o.$setViewValue(s.target.checked)}),"radio"===$(a).attr("type")&&r.ngModel)return t.$apply(function(){return o.$setViewValue(e)})})})}}}function ionRangeSlider(){return{restrict:"A",scope:{rangeOptions:"="},link:function(e,t,a){t.ionRangeSlider(e.rangeOptions)}}}function dropZone(){return function(e,t,a){t.dropzone({url:"/upload",maxFilesize:100,paramName:"uploadfile",maxThumbnailFilesize:5,init:function(){e.files.push({file:"added"}),this.on("success",function(e,t){}),this.on("addedfile",function(t){e.$apply(function(){alert(t),e.files.push({file:"added"})})}),this.on("drop",function(e){alert("file")})}})}}function chatSlimScroll(e){return{restrict:"A",link:function(t,a){e(function(){a.slimscroll({height:"234px",railOpacity:.4})})}}}function customValid(){return{require:"ngModel",link:function(e,t,a,r){e.$watch(a.ngModel,function(){var t="Inspinia";e.extras==t?r.$setValidity("cvalid",!0):r.$setValidity("cvalid",!1)})}}}function fullScroll(e){return{restrict:"A",link:function(t,a){e(function(){a.slimscroll({height:"100%",railOpacity:.9})})}}}function slimScroll(e){return{restrict:"A",scope:{boxHeight:"@"},link:function(t,a){e(function(){a.slimscroll({height:t.boxHeight,railOpacity:.9})})}}}function clockPicker(){return{restrict:"A",link:function(e,t){t.clockpicker()}}}function landingScrollspy(){return{restrict:"A",link:function(e,t,a){t.scrollspy({target:".navbar-fixed-top",offset:80})}}}function fitHeight(){return{restrict:"A",link:function(e,t){t.css("height",$(window).height()+"px"),t.css("min-height",$(window).height()+"px")}}}function channelDiv(){return{restrict:"E",scope:{channel:"= "},template:'<div class="col-lg-4"></div>'}}function chartHeight(){return{controller:["$scope","$element",function(e,t){this.chartHeight=t[0].offsetHeight}]}}function sizeWatcher(){return{require:"^chartHeight",scope:{sizeWatcherHeight:"=",sizeWatcherWidth:"="},link:function(e,t,a,r){var o,s=e.sizeWatcherWidth.length;o=s<=2?1:s>2&&s<=4?2:3;var i=Math.ceil(s/o);if(void 0!=r.chartHeight&&0!=r.chartHeight){if(void 0==e.sizeWatcherHeight||0==e.sizeWatcherHeight){var n=r.chartHeight;e.sizeWatcherHeight=Math.ceil(.2*n/i)}}else void 0==e.sizeWatcherHeight&&0==e.sizeWatcherHeight&&(e.sizeWatcherHeight=t.prop("offsetHeight"))}}}function expSizeWatcher(){return{scope:{expSizeWatcherHeight:"="},link:function(e,t,a,r){void 0==e.expSizeWatcherHeight&&0==e.expSizeWatcherHeight&&(e.expSizeWatcherHeight=t.prop("offsetHeight"))}}}function fileModel(e){return{restrict:"A",link:function(t,a,r){var o=e(r.fileModel),s=o.assign;a.bind("change",function(){t.$apply(function(){s(t,a[0].files[0])})})}}}function AccountManagementController(e,t,a,r){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-105,angular.element(r).on("resize",function(t){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-105}),e.getSubscriptions=function(){t({method:"POST",url:"/api/v1/updateUserSubscription"}).then(function(t){e.subscriptionType=t.data.response.code,e.validity=moment(t.data.orgDetails.subscriptionExpiresOn).format("LL"),e.getAvailableCount(e.subscriptionType)},function(e){})},e.getAvailableCount=function(a){var r=function(){t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=dashboards"}).then(function(t){e.availableDashboards=t.data.availableDashboards},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},o=function(){t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=basic"}).then(function(t){e.availableWidgets=t.data.availableWidgets},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},s=function(){t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=fusion"}).then(function(t){e.availableFusions=t.data.availableWidgets},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},i=function(){t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=alert"}).then(function(t){e.availableAlerts=t.data.availablealerts},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})};"agency"==a&&(e.availableDashboards="Unlimited",e.availableWidgets="Unlimited",e.availableFusions="Unlimited",e.availableAlerts="Unlimited"),"premium"==a&&(r(),e.availableWidgets="Unlimited",e.availableFusions="Unlimited",e.availableAlerts="Unlimited"),"starter"!=a&&"advanced"!=a&&"free"!=a||(r(),o(),s(),i())},e.transactionDetails=function(){t({method:"GET",url:"/api/v1/getPaymentDetails/"}).then(function(t){if(204==t.status)e.paymentDetails="no data";else{e.paymentDetails=t.data.paymentDetails;for(var a=0;a<e.paymentDetails.length;a++)e.paymentDetails[a].paidOn=moment(e.paymentDetails[a].paidOn).format("DD-MM-YYYY")}},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},e.transactionDetails()}function addNewUserController(e,t,a,r,o){e.userName="",e.email="",e.addNewUser=function(){var a={name:e.userName,email:e.email};t({method:"POST",url:"/api/v1/signupByAdmin",data:a}).then(function(t){"200"==t.status?(e.ok(),toastr.info(t.data.message)):$("#error").html('<div class="alert alert-danger fade in" style="width: 361px;margin-left: 26px;height: 59px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>'+t.data.message+"</div>")},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong!!!!</span> .",html:!0})})}}function AlertController(e,t,a,r,o,s,i,n){var l=0,c=!1;e.alert,e.metricName,e.currentView="step_one",e.operation,e.widgetAlerts=[],e.alertMetrics=[],e.inAlertMetric="";var d=[],h=[];e.needToChangeView=function(){t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=alert"}).then(function(t){t.data.isExpired===!1?t.data.availablealerts>0?e.changeViewsInAlertModal("step_two"):$(".alertError").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>Alert limit is reached!</div>'):$(".alertError").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>subscription is expire</div>')},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},e.changeViewsInAlertModal=function(t){e.currentView=t,"step_one"===e.currentView?(c=!1,e.name="",e.inAlertMetric="",e.metric="",e.operation="",e.threshold="",e.interval="",e.email="",e.metricDetails="",e.alertMetrics=[],e.widgetMetrics=[],e.widgetAlerts=[],d=[],e.fetchWidgetAlerts()):"step_two"===e.currentView&&(1==c?(e.name=e.alert.name,e.interval=e.alert.interval,e.email=e.alert.mailingId.email,"undefined"!=typeof e.alert.operation.gt?e.alert.operation.gt===!0&&(e.operation="gt",e.threshold=e.alert.threshold.gt):(e.operation="lt",e.threshold=e.alert.threshold.lt)):(e.metricDetails=[],e.alertMetrics=[],e.widgetMetrics=[],e.alertFunction()))},e.fetchWidgetAlerts=function(){t({method:"GET",url:"/api/v1/get/alerts/"+o.selectedWidget.id+"?buster="+new Date}).then(function(t){if(h=[],"200"==t.status){h.length=0,e.widgetAlerts=t.data;for(var r=0;r<e.widgetAlerts.length;r++)h.push(e.getMetricDetails(e.widgetAlerts[r].metricId,r));a.all(h).then(function(t){for(var a in e.widgetAlerts)for(var r in t)e.widgetAlerts[a].metricId==t[r].metrics[0]._id&&e.alertMetrics.push(t[r].metrics[0])},function(t){e.$parent.closeBasicWidgetModal(""),swal("Sorry! Something went wrong, Please try again.")})}else e.widgetAlerts=[]},function(t){e.$parent.closeBasicWidgetModal(""),swal("Sorry! Something went wrong, Please try again.")})},e.getMetricDetails=function(e,r){var o=a.defer();return t({method:"GET",url:"/api/v1/get/metricDetails/"+e+"?buster="+new Date}).then(function(e){o.resolve({index:r,metrics:e.data.metricsList})},function(e){o.reject(e)}),o.promise},angular.element(document).ready(function(){$(" .ladda-button").addClass("icon-arrow-right"),Ladda.bind(".ladda-button",{callback:function(t){$(".ladda-button").removeClass("icon-arrow-right"),e.saveAlert();var a=0,r=setInterval(function(){a=Math.min(a+.1*Math.random(),1),t.setProgress(a),1===a&&1===l&&(t.stop(),clearInterval(r),e.changeViewsInAlertModal("step_one"))},50)}})}),e.alertFunction=function(){if(1==c)var r=e.alert.widgetId;else var r=o.selectedWidget.id;t({method:"GET",url:"/api/v1/widget/"+r+"?buster="+new Date}).then(function(t){e.widgetDetails=t.data[0];for(var r=0;r<e.widgetDetails.charts.length;r++)d.push(e.getMetricDetails(e.widgetDetails.charts[r].metrics[0].metricId,r));a.all(d).then(function(t){e.widgetMetrics=[];for(var a in t)if(0!=t[a].metrics[0].objectTypes[0].meta.endpoint.length)for(var o in t[a].metrics[0].objectTypes[0].meta.endpoint)e.widgetMetrics.push({name:t[a].metrics[0].name+" - "+t[a].metrics[0].objectTypes[0].meta.endpoint[o],id:t[a].metrics[0]._id,endPoints:t[a].metrics[0].objectTypes[0].meta.endpoint[o]});else e.widgetMetrics.push({name:t[a].metrics[0].name,id:t[a].metrics[0]._id,endPoints:""});if(1==c)for(r=0;r<e.widgetMetrics.length;r++)e.alert.metricId==e.widgetMetrics[r].id&&(null!=e.alert.endPoint?e.widgetMetrics[r].endPoints==e.alert.endPoint&&(e.inAlertMetric=e.widgetMetrics[r].name):e.inAlertMetric=e.widgetMetrics[r].name)},function(t){e.$parent.closeBasicWidgetModal(""),swal("Sorry! Something went wrong, Please try again.")})},function(t){e.$parent.closeBasicWidgetModal(""),swal("Sorry! Something went wrong, Please try again.")})},e.saveAlert=function(){var a=e.widgetMetrics.map(function(e){return e.name}).indexOf(e.inAlertMetric);e.metric=[e.widgetMetrics[a].id,e.widgetMetrics[a].endPoints];for(var r,o=e.widgetDetails.charts,a=0;a<o.length;a++){var s=e.metric;o[a].metrics[0].metricId===s[0]&&(r=o[a].metrics[0].objectId)}var i={},n={};if(n[e.operation]=!0,i[e.operation]=e.threshold,1==c)var d={alertId:e.alert._id,operation:n,threshold:i,interval:e.interval,name:e.name,widgetId:e.widgetDetails._id,metricId:s[0],objectId:r,endPoint:s[1],mailingId:{email:e.email}};else var d={operation:n,threshold:i,interval:e.interval,name:e.name,widgetId:e.widgetDetails._id,metricId:s[0],objectId:r,endPoint:s[1],mailingId:{email:e.email}};var h=!1;t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=alert"}).then(function(a){h===!1?a.data.availablealerts>0?t({method:"POST",url:"/api/v1/alerts",data:d}).then(function(a){var o={objectId:r,metricId:s[0],bgFetch:!0};t({method:"POST",url:"/api/v1/bgFetchUpdate",data:o}).then(function(t){e.fetchWidgetAlerts(),l=1},function(t){e.$parent.closeBasicWidgetModal(""),swal("Sorry! Something went wrong, Please try again.")})},function(t){e.$parent.closeBasicWidgetModal(""),swal("Sorry! Something went wrong, Please try again.")}):$(".alertError").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>Alert limit is reached!</div>'):$(".alertError").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>subscription is expire</div>')},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},e.deleteAlert=function(a,r){t({method:"POST",url:"/api/v1/remove/alerts/"+a._id}).then(function(t){e.fetchWidgetAlerts()},function(t){e.$parent.closeBasicWidgetModal(""),swal("Sorry! Something went wrong, Please try again.")})},e.editAlert=function(t,a){c=!0,e.alert=t,e.metricName=a,e.alertFunction(),e.changeViewsInAlertModal("step_two")}}function AppController(e,t,a,r){r.recentDashboardList=[],a.recentDashboardList=[],a.loading=!1,a.fetchUserName=function(){e({method:"GET",url:"/api/v1/me"}).then(function(e){"free"===e.data.userDetails.subscriptionType?(a.userName=e.data.userDetails.user[0].name,a.userDetail=e.data.userDetails.user[0]):1002===e.data.userDetails.statusCode?(r.isExpired=!0,a.userName=e.data.userDetails.user[0].name,a.userDetail=e.data.userDetails.user[0],t.go("app.reporting.upgrade")):(r.isExpired=!1,a.userName=e.data.userDetails.user[0].name,a.userDetail=e.data.userDetails.user[0])},function(e){a.userName=""})},r.fetchRecentDashboards=function(){a.recentDashboardList=[],e({method:"GET",url:"/api/v1/get/dashboardList?buster="+(new Date).getTime()}).then(function(e){if(this.recentDashboardModel="",r.recentDashboards=[],a.recentDashboardList=[],"200"==e.status){var t=_.orderBy(e.data.dashboardList,["dashboard.updated"],["desc"]);if(t.length<=5)r.recentDashboards=t;else for(var o=0;o<5;o++)r.recentDashboards.push(t[o]);r.stateDashboard=a.recentDashboards[0]}else r.recentDashboards=null},function(e){r.recentDashboards=null})},a.createNewDashboard=function(){a.loading=!0;var r={startDate:moment(new Date).subtract(30,"days"),endDate:new Date};e({method:"POST",url:"/api/v1/create/dashboards",data:r}).then(function(e){t.go("app.reporting.dashboard",{id:e.data})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})}}function BasicWidgetController(e,t,a,r,o,s,n,l){e.objectList={},e.referenceWidgetsList=[],e.fbObjectTypeList={},e.tokenExpired=[],e.channelList,e.currentView="step_one",e.weburl="",e.mozObjectDetails={},e.fbSelectEnable=!1,e.googleSelectEnable=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaignChosen=!1,e.groupChosen=!1,e.adChosen=!1,e.refreshButtonLoading="",e.selectedChannelList=[],e.selectedTempChannelList=[],e.uniqueObjectCount=[],e.checkExpiresIn=[],e.hasNoAccess=[];var c="basic",d=[],h="",p=!1,g={},u="",m="",f={},b=new Array,y=[],v=[],w={},D=0,C="",x=!1,T=!1,A=!1,S=!1,L=!1,I=!1;e.profileOptionsModel={},angular.element(document).ready(function(){$(".progress-demo2 .ladda-button").addClass("icon-arrow-right"),Ladda.bind(".progress-demo2 .ladda-button",{callback:function(t){$(".progress-demo2 .ladda-button").removeClass("icon-arrow-right"),e.createAndFetchBasicWidget();var a=0,r=setInterval(function(){a=Math.min(a+.1*Math.random(),1),t.setProgress(a),1===a&&1===D&&(t.stop(),clearInterval(r),e.ok())},50)}})}),e.changeViewsInBasicWidget=function(t){if(e.currentView=t,r.currentModalView=t,"step_one"===e.currentView)e.listChannels(),e.clearReferenceWidget(),e.selectedChannelList=[],e.customMessageEnable=!1,e.metricMessage=!1,y=[],e.fbObjectTypeList={},e.canManageClients=!0,document.getElementById("basicWidgetFinishButton").disabled=!0,$("#basicWidgetNextButton1").show(),$("#basicWidgetBackButton").hide(),$("#basicWidgetBackButton2").hide(),$("#basicWidgetNextButton2").hide();else if("step_two"===e.currentView)e.customMessageEnable=!1,e.messageEnable=!1,e.clearReferenceWidget(),e.selectedChannelList=[],"CustomData"==h?(e.storeCustomData(),$("#basicWidgetBackButton").hide(),$("#basicWidgetNextButton2").hide(),$("#basicWidgetNextButton1").hide(),$("#basicWidgetFinishButtonCustom").show()):(y=[],v=[],e.weburl="",S=!1,L=!1,I=!1,p=!1,x=!1,T=!1,A=!1,e.fbSelectEnable=!1,e.metricMessage=!1,e.googleSelectEnable=!1,e.headerHide=!1,document.getElementById("basicWidgetFinishButton").disabled=!0,e.getReferenceWidgetsForChosenChannel(),e.getProfilesForDropdown(),$("#basicWidgetNextButton2").show(),$("#basicWidgetBackButton").hide(),$("#basicWidgetFinishButtonCustom").hide(),$("#basicWidgetFinishButton").hide(),$("#basicWidgetNextButton1").hide());else if("step_three"===e.currentView){$("#basicWidgetBackButton2").hide(),$("#basicWidgetFinishButton").show(),$("#basicWidgetNextButton2").hide(),e.checkChannelList(),document.getElementById("basicWidgetFinishButton").disabled=!0,e.selectedObjectType=null,e.selectedLevel=null,e.selectedId=null,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.metricMessage=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null;var a=document.getElementById("scroller");a.scrollTop=0}},e.getSubscriptions=function(){t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=basic"}).then(function(t){e.userDetail=t.data.user,r.availableBasicWidgets=t.data.availableWidgets},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong!!!!</span> .",html:!0})})},e.dropdownWidth=function(e,t){if(1==e||1==t)return"col-sm-10 col-md-10 col-lg-10 col-xs-10"},e.mozobject=function(t){e.weburl=t,p=""!=e.weburl&&null!=e.weburl;for(var a in e.selectedChannelList)"Moz"==e.selectedChannelList[a].name&&(x=!0,y[a]={channelName:e.selectedChannelList[a].name}),"FacebookAds"==e.selectedChannelList[a].name&&(T=!0),"GoogleAdwords"==e.selectedChannelList[a].name&&(A=!0);1==e.selectedChannelList.length&&1==x&&(S=!0),e.checkComplete()},e.listChannels=function(){t({method:"GET",url:"/api/v1/get/channels"}).then(function(t){e.getSubscriptions();var a=t.data;if(e.selectedTempChannelList.length)document.getElementById("basicWidgetNextButton1").disabled=!1;else{for(i in a)a[i].isSelected=0;e.channelList=a}},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getReferenceWidgetsForChosenChannel=function(){t({method:"GET",url:"/api/v1/get/referenceWidgets/"+c+"?buster="+new Date}).then(function(t){for(var a in e.selectedTempChannelList){for(var o=[],s=0;s<t.data.referenceWidgets.length;s++)if(t.data.referenceWidgets[s].charts[0].channelId===e.selectedTempChannelList[a].id){var i=0;for(var n in b)b[n]._id==t.data.referenceWidgets[s]._id&&(m=1,f={_id:t.data.referenceWidgets[s]._id,charts:t.data.referenceWidgets[s].charts,created:t.data.referenceWidgets[s].created,description:t.data.referenceWidgets[s].description,maxSize:t.data.referenceWidgets[s].maxSize,minSize:t.data.referenceWidgets[s].minSize,name:t.data.referenceWidgets[s].name,size:t.data.referenceWidgets[s].size,updated:t.data.referenceWidgets[s].updated,widgetType:t.data.referenceWidgets[s].widgetType,isAlert:t.data.referenceWidgets[s].isAlert,level:void 0!=t.data.referenceWidgets[s].level?t.data.referenceWidgets[s].level:"low",isFusion:void 0==t.data.referenceWidgets[s].isFusion||t.data.referenceWidgets[s].isFusion,isSelectedMetric:m,border:"2px solid #04509B"},i=1);1!=i&&(m=0,f={_id:t.data.referenceWidgets[s]._id,charts:t.data.referenceWidgets[s].charts,created:t.data.referenceWidgets[s].created,description:t.data.referenceWidgets[s].description,maxSize:t.data.referenceWidgets[s].maxSize,minSize:t.data.referenceWidgets[s].minSize,name:t.data.referenceWidgets[s].name,size:t.data.referenceWidgets[s].size,updated:t.data.referenceWidgets[s].updated,widgetType:t.data.referenceWidgets[s].widgetType,isAlert:t.data.referenceWidgets[s].isAlert,level:void 0!=t.data.referenceWidgets[s].level?t.data.referenceWidgets[s].level:"low",isFusion:void 0==t.data.referenceWidgets[s].isFusion||t.data.referenceWidgets[s].isFusion,isSelectedMetric:m,border:"2px solid #e7eaec",channelName:e.selectedTempChannelList[a].name},r.availableBasicWidgets<b.length?($("#error").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Widgets limit. Please upgrade to enjoy more Widgets</div>'),document.getElementById("basicWidgetNextButton2").disabled=!0):document.getElementById("basicWidgetNextButton2").disabled=!1),""!=b&&"[]"!=b&&null!=b||(document.getElementById("basicWidgetNextButton2").disabled=!0),o.push(f)}var l=_.findIndex(e.referenceWidgetsList,function(t){return t.channelName==e.selectedTempChannelList[a].name});if(l<0){var c=[],d=!1,h=!1;c=_.orderBy(o,["updated"],["desc"]);for(var p in c)"high"==c[p].level?d=!0:"low"==c[p].level&&(h=!0);e.referenceWidgetsList.push({widgets:c,channelName:e.selectedTempChannelList[a].name,isCxoPresent:d,isExecutivePresent:h})}}},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getProfilesForDropdown=function(){document.getElementById("basicWidgetFinishButton").disabled=!0;var t=[];for(var a in e.selectedTempChannelList)t.push(e.correspondingProfile(e.selectedTempChannelList[a].id));l.all(t).then(function(t){for(var a in e.selectedTempChannelList)e.selectedTempChannelList[a].profileList=t[a].profiles},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},e.correspondingProfile=function(e){var a=l.defer();return t({method:"GET",url:"/api/v1/get/profiles/"+e+"?buster="+(new Date).getTime()}).then(function(e){a.resolve({profiles:e.data.profileList})},function(e){a.reject(e),swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})}),a.promise},e.checkChannelList=function(){var t=_.groupBy(e.uniqueObjectCount,"channelId"),a=[];for(var r in t){var o=[];for(i=0;i<t[r].length;i++)o.push(t[r][i].objectType);var s=_.uniq(o);a.push({channelId:r,objectype:s})}for(var n in e.selectedTempChannelList){e.selectedTempChannelList[n].uniqueObjectCount=[];for(var r in a)e.selectedTempChannelList[n].id==a[r].channelId&&(e.selectedTempChannelList[n].uniqueObjectCount=a[r].objectype)}for(var n in e.selectedTempChannelList)""!=e.selectedTempChannelList[n].uniqueObjectCount&&e.selectedChannelList.push(e.selectedTempChannelList[n]);for(var n in e.selectedChannelList)e.profileOptionsModel[n]&&(e.profileOptionsModel[n].hasNoAccess=!1),e.tokenExpired[n]=!1;1==e.selectedChannelList.length&&"Moz"==e.selectedChannelList[0].name&&(e.headerHide=!0)},e.selectLevelChosen=function(t,a){if(e.messageEnable=!1,t){var r=0,o=!1,s=!1;for(var i in b)"Cost per objective"==b[i].name&&(r=1),"Fb Ads Adgroup overview (Campaign level)"==b[i].name&&(r=1),"Fb Ads campaign overview (Account level)"==b[i].name&&(o=!0),"Fb Ads Ad overview (Adgroup level)"==b[i].name&&(s=!0);this.objectTypeOptionsModel[a]?(document.getElementById("basicWidgetFinishButton").disabled=!0,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null,e.selectedObjectType=this.objectTypeOptionsModel[a],e.selectedLevel=this.objectTypeOptionsModel[a].type,e.selectedId=this.objectTypeOptionsModel[a]._id,L=!1):(document.getElementById("basicWidgetFinishButton").disabled=!0,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null,e.selectedObjectType=this.objectTypeOptionsModel[a],e.selectedLevel=null,e.selectedId=null,L=!1)}"fbadaccount"==e.selectedLevel?(r||s?(e.messageEnable=!0,L=!1):L=null!=e.profileId&&null!=e.accountId,e.checkComplete()):"fbAdcampaign"==e.selectedLevel?(o||s?(e.messageEnable=!0,L=!1):0==e.campaignChosen?(L=!1,e.campaignEnable=!0,e.getCampaigns()):L=null!=e.profileId&&null!=e.accountId&&null!=e.campaign,e.checkComplete()):"fbAdSet"==e.selectedLevel?(r||o?(e.messageEnable=!0,L=!1):1==e.campaignChosen&&1==e.adSetChosen?L=null!=e.profileId&&null!=e.accountId&&null!=e.campaign&&null!=e.adSet:0==e.campaignChosen&&0==e.adSetChosen?(e.campaignEnable=!0,e.getCampaigns()):1==e.campaignChosen&&0==e.adSetChosen?(e.campaignEnable=!0,e.adSetEnable=!0,e.getAdSet(),L=!1):L=!1,e.checkComplete()):"fbAdSetAds"==e.selectedLevel&&(r||o||s?(e.messageEnable=!0,L=!1):1==e.campaignChosen&&1==e.adSetChosen&&1==e.adSetAdsChosen?L=null!=e.profileId&&null!=e.accountId&&null!=e.campaign&&null!=e.adSet&&null!=e.adSetAds:0==e.campaignChosen&&0==e.adSetChosen&&1==e.adSetAdsChosen?(L=!1,e.campaignEnable=!0,e.getCampaigns(),e.adSetAdsChosen=!1,e.adSetAds=null):1==e.campaignChosen&&1==e.adSetChosen&&0==e.adSetAdsChosen?(L=!1,e.adSetAdsEnable=!0,e.getAdSetAds()):0==e.campaignChosen&&0==e.adSetChosen&&0==e.adSetAdsChosen?(L=!1,e.campaignEnable=!0,e.getCampaigns()):1==e.campaignChosen&&0==e.adSetChosen&&0==e.adSetAdsChosen?(L=!1,e.adSetEnable=!0,e.getAdSet()):1==e.campaignChosen&&0==e.adSetChosen&&1==e.adSetAdsChosen?(L=!1,e.adSetEnable=!0,e.getAdSet(),e.adSetAdsChosen=!1,e.adSetAds=null):0==e.campaignChosen&&1==e.adSetChosen&&1==e.adSetAdsChosen?(L=!1,e.campaignEnable=!0,e.getCampaigns(),e.adSetAdsChosen=!1,e.adSetAds=null,e.adSetChosen=!1,e.adSet=null):0==e.campaignChosen&&1==e.adSetChosen&&0==e.adSetAdsChosen&&(L=!1,e.campaignEnable=!0,e.getCampaigns(),e.adSetAdsChosen=!1,e.adSetAds=null,e.adSetChosen=!1,e.adSet=null),e.checkComplete())},e.fbAdsCheck=function(t){var a=0;document.getElementById("basicWidgetFinishButton").disabled=!0,"campaign"==t?(e.adSet=null,e.adSetChosen=!1,e.adSetAds=null,e.adSetAdsChosen=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=this.campaignOptionsModel,e.campaign?e.campaignChosen=!0:e.campaignChosen=!1,a=1):"adset"==t?(e.adSetAds=null,e.adSetAdsChosen=!1,e.adSetAdsEnable=!1,e.adSet=this.adSetOptionsModel,e.adSet?e.adSetChosen=!0:e.adSetChosen=!1,a=1):(e.adSetAds=this.adSetAdsOptionsModel,e.adSetAds?e.adSetAdsChosen=!0:e.adSetAdsChosen=!1,a=1),1==a&&e.selectLevelChosen()},e.getCampaigns=function(){var a=e.selectedId,r=e.accountId,o=e.profileId;t({method:"GET",url:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&accountId="+r+"&buster="+new Date}).then(function(t){e.campaignList=t.data.objectList,e.campaignOptionsModel=e.campaignList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getAdSet=function(){var a=e.selectedId,r=e.campaign.channelObjectId,o=e.profileId;t({method:"GET",url:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&campaignId="+r+"&buster="+new Date}).then(function(t){e.adSetList=t.data.objectList,e.adSetOptionsModel=e.adSetList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getAdSetAds=function(){var a=e.selectedId,r=e.adSet.channelObjectId,o=e.profileId;t({method:"GET",url:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&adSetId="+r+"&buster="+new Date}).then(function(t){e.adSetAdsList=t.data.objectList,e.adSetAdsOptionsModel=e.adSetAdsList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshAdCampaign=function(a){e.refreshAdCampaignLoading=!0;
var r=a,o=e.accountId,s=e.profileId;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&accountId="+o+"&buster="+new Date}).then(function(t){e.campaignList=t.data,e.campaignOptionsModel=e.campaignList,e.refreshAdCampaignLoading=!1},function(t){e.refreshAdCampaignLoading=!1,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshAdSet=function(a){e.refreshAdSetLoading=!0;var r=a,o=e.campaign.channelObjectId,s=e.profileId;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&campaignId="+o+"&buster="+new Date}).then(function(t){e.adSetList=t.data,e.adSetOptionsModel=e.adSetList,e.refreshAdSetLoading=!1},function(t){e.refreshAdSetLoading=!1,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshAdSetAds=function(a){e.refreshAdSetAdsLoading=!0;var r=a,o=e.adSet.channelObjectId,s=e.profileId;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&adSetId="+o+"&buster="+new Date}).then(function(t){e.adSetAdsList=t.data,e.adSetAdsOptionsModel=e.adSetAdsList,e.refreshAdSetAdsLoading=!1},function(t){e.refreshAdSetAdsLoading=!1,401===t.status?1003===t.data.errorstatusCode&&(swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}),e.tokenExpired=!0):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.googleSelectLevelChosen=function(t,a){if(e.messageEnable=!1,t){var r=0,o=0,s=0,i=0,n=!1,l=!1,c=!1;for(var d in b)"Adwords campaigns overview (Account level)"==b[d].name&&(c=!0),"Adgroups overview (Campaign level)"!=b[d].name&&"Age Demographics (Campaign Level)"!=b[d].name&&"Gender Demographics (Campaign Level)"!=b[d].name&&"Device Demographics (Campaign Level)"!=b[d].name||(n=!0),"Ads overview (Adgroup level)"!=b[d].name&&"Age Demographics (Adgroup Level)"!=b[d].name&&"Gender Demographics (Adgroup Level)"!=b[d].name&&"Device Demographics (Adgroup Level)"!=b[d].name||(l=!0);0==n&&0==l&&0==c&&(r=0,o=0,s=0,i=0),0==n&&1==l&&0==c&&(r=1,o=1,s=0,i=1),1==n&&0==l&&0==c&&(r=1,o=0,s=1,i=1),0==n&&0==l&&1==c&&(r=0,o=1,s=1,i=1),1==n&&1==l&&0==c&&(r=1,o=1,s=1,i=1),1==n&&0==l&&1==c&&(r=1,o=1,s=1,i=1),0==n&&1==l&&1==c&&(r=1,o=1,s=1,i=1),1==n&&1==l&&1==c&&(r=1,o=1,s=1,i=1),this.objectTypeOptionsModel[a]?(document.getElementById("basicWidgetFinishButton").disabled=!0,e.selectedGoogleObjectType=null,e.selectedGoogleLevel=null,e.selectedGoogleId=null,e.googleCampaignChosen=!1,e.adChosen=!1,e.groupChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleAd=null,e.googleGroup=null,e.selectedGoogleObjectType=this.objectTypeOptionsModel[a],e.selectedGoogleLevel=this.objectTypeOptionsModel[a].type,e.selectedGoogleId=this.objectTypeOptionsModel[a]._id,I=!1):(document.getElementById("basicWidgetFinishButton").disabled=!0,e.selectedGoogleObjectType=null,e.selectedGoogleLevel=null,e.selectedGoogleId=null,e.googleCampaignChosen=!1,e.adChosen=!1,e.groupChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleAd=null,e.googleGroup=null,e.selectedGoogleObjectType=this.objectTypeOptionsModel[a],e.selectedGoogleLevel=null,e.selectedGoogleId=null,I=!1)}"adwordaccount"==e.selectedGoogleLevel?(r?(e.messageEnable=!0,I=!1):I=null!=e.profileOptionsModel&&null!=e.googleAccountId,e.checkComplete()):"adwordCampaign"==e.selectedGoogleLevel?(o?(e.messageEnable=!0,I=!1):0==e.googleCampaignChosen?(I=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns()):I=null!=e.googleProfileId&&null!=e.googleAccountId&&null!=e.googleCampaign,e.checkComplete()):"adwordAdgroup"==e.selectedGoogleLevel?(s?(e.messageEnable=!0,I=!1):1==e.googleCampaignChosen&&1==e.groupChosen?I=null!=e.profileOptionsModel&&null!=e.googleAccountId&&null!=e.googleCampaign&&null!=e.googleGroup:0==e.googleCampaignChosen&&0==e.groupChosen?(e.googleCampaignEnable=!0,e.getGoogleCampaigns()):1==e.googleCampaignChosen&&0==e.groupChosen?(e.googleCampaignEnable=!0,e.groupEnable=!0,e.getGoogleGroup(),I=!1):I=!1,e.checkComplete()):"adwordsAd"==e.selectedGoogleLevel&&(i?(e.messageEnable=!0,I=!1):1==e.googleCampaignChosen&&1==e.groupChosen&&1==e.adChosen?I=null!=e.profileOptionsModel&&null!=e.googleAccountId&&null!=e.googleCampaign&&null!=e.googleGroup&&null!=e.googleAd:0==e.googleCampaignChosen&&0==e.groupChosen&&1==e.adChosen?(I=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns(),e.adChosen=!1,e.googleAd=null):1==e.googleCampaignChosen&&1==e.groupChosen&&0==e.adChosen?(I=!1,e.adEnable=!0,e.getGoogleAd()):0==e.googleCampaignChosen&&0==e.groupChosen&&0==e.adChosen?(I=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns()):1==e.googleCampaignChosen&&0==e.groupChosen&&0==e.adChosen?(I=!1,e.groupEnable=!0,e.getGoogleGroup()):1==e.googleCampaignChosen&&0==e.groupChosen&&1==e.adChosen?(I=!1,e.groupEnable=!0,e.getGoogleGroup(),e.adChosen=!1,e.googleAd=null):0==e.googleCampaignChosen&&1==e.groupChosen&&1==e.adChosen?(I=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns(),e.adChosen=!1,e.googleAd=null,e.groupChosen=!1,e.googleGroup=null):0==e.googleCampaignChosen&&1==e.groupChosen&&0==e.adChosen&&(I=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns(),e.adChosen=!1,e.googleAds=null,e.groupChosen=!1,e.googleGroup=null),e.checkComplete())},e.googleAdsCheck=function(t){var a=0;document.getElementById("basicWidgetFinishButton").disabled=!0,"campaign"==t?(e.googleGroup=null,e.groupChosen=!1,e.googleAd=null,e.adChosen=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=this.googleCampaignOptionsModel,e.googleCampaign?e.googleCampaignChosen=!0:e.googleCampaignChosen=!1,a=1):"group"==t?(e.googleAd=null,e.adChosen=!1,e.adEnable=!1,e.googleGroup=this.groupOptionsModel,e.googleGroup?e.groupChosen=!0:e.groupChosen=!1,a=1):(e.googleAd=this.adOptionsModel,e.googleAd?e.adChosen=!0:e.adChosen=!1,a=1),1==a&&e.googleSelectLevelChosen()},e.getGoogleCampaigns=function(){var a=e.selectedGoogleId,r=e.googleAccountId,o=e.googleProfileId;t({method:"GET",url:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&accountId="+r+"&buster="+new Date}).then(function(t){e.googleCampaignList=t.data.objectList,e.googleCampaignOptionsModel=e.googleCampaignList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getGoogleGroup=function(){var a=e.selectedGoogleId,r=e.googleCampaign.channelObjectId,o=e.googleProfileId,s=e.googleAccountId,i="";i=1==e.canManageClients?"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&campaignId="+r+"&accountId="+s+"&buster="+new Date:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&campaignId="+r+"&accountId="+s+"&buster="+new Date,t({method:"GET",url:i}).then(function(t){e.groupList=t.data.objectList,e.groupOptionsModel=e.groupList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getGoogleAd=function(){var a=e.selectedGoogleId,r=e.googleGroup.channelObjectId,o=e.googleProfileId,s=e.googleAccountId,i="";i=1==e.canManageClients?"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&adSetId="+r+"&accountId="+s+"&buster="+new Date:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&adSetId="+r+"&accountId="+s+"&buster="+new Date,t({method:"GET",url:i}).then(function(t){e.adList=t.data.objectList,e.adOptionsModel=e.adList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshGoogleCampaign=function(a){e.refreshGoogleCampaignLoading=!0;var r=a,o=e.googleAccountId,s=e.googleProfileId;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&accountId="+o+"&buster="+new Date}).then(function(t){e.googleCampaignList=t.data,e.googleCampaignOptionsModel=e.googleCampaignList,e.refreshGoogleCampaignLoading=!1},function(t){e.refreshGoogleCampaignLoading=!1,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshGroup=function(a){e.refreshGroupLoading=!0;var r=a,o=e.googleCampaign.channelObjectId,s=e.googleProfileId,i=e.googleAccountId,n="";n=1==e.canManageClients?"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&campaignId="+o+"&accountId="+i+"&buster="+new Date:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&campaignId="+o+"&buster="+new Date,t({method:"GET",url:n}).then(function(t){e.groupList=t.data,e.groupOptionsModel=e.groupList,e.refreshGroupLoading=!1},function(t){e.refreshGroupLoading=!1,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},e.refreshAd=function(a){e.refreshAdLoading=!0;var r=a,o=e.googleGroup.channelObjectId,s=e.googleProfileId,i=e.googleAccountId,n="";n=1==e.canManageClients?"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&adSetId="+o+"&accountId="+i+"&buster="+new Date:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&adSetId="+o+"&buster="+new Date,t({method:"GET",url:n}).then(function(t){e.adList=t.data,e.adOptionsModel=e.adList,e.refreshAdLoading=!1},function(t){e.refreshAdLoading=!0,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},e.getObjectsForChosenProfile=function(a,r,o,s){if(document.getElementById("basicWidgetFinishButton").disabled=!0,e.checkExpiresIn[a]=null,y[a]=[],e.tokenExpired[a]=!1,r)if(e.hasNoAccess[a]=r.hasNoAccess,d[a]=r,"GoogleAdwords"==o&&(r.canManageClients===!1?e.canManageClients=!1:e.canManageClients=!0),"FacebookAds"==o){if(document.getElementById("basicWidgetFinishButton").disabled=!0,r){e.selectedLevel=null,document.getElementById("basicWidgetFinishButton").disabled=!0,e.campaignEnable=!1,e.adSetAdsEnable=!1,e.adSetEnable=!1,e.campaign=null,e.adSetAds=null,e.adSet=null,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.fbSelectEnable=!1,e.profileId=d[a]._id,void 0!=r.expiresIn&&(e.checkExpiresIn[a]=new Date(r.expiresIn)),e.tokenExpired[a]=!1;var i=r._id,n=r.expiresIn,l=new Date,c=new Date(n);l<=c&&null!=n?e.tokenExpired[a]=!1:void 0===n||null===n?e.tokenExpired[a]=!1:e.tokenExpired[a]=!0,t({method:"GET",url:"/api/v1/get/objects/"+i+"?buster="+new Date}).then(function(t){var a,r=0,o={};a=_.groupBy(t.data.objectList,"objectTypeId");var i={};for(var n in s)for(var l in a)s[n]==l&&(i[l]=a[l]);for(var c in i){var d=[];for(var h in i[c])d.push(i[c][h]);var p={};p[r]=d,o[r]=p,r++}e.facebookAdsObjectList=o},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})}}else if("GoogleAdwords"==o){if(document.getElementById("basicWidgetFinishButton").disabled=!0,r)if(e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleGroup=null,e.googleAd=null,e.googleCampaignChosen=!1,e.groupChosen=!1,e.adChosen=!1,e.googleSelectEnable=!1,document.getElementById("basicWidgetFinishButton").disabled=!0,0==e.canManageClients){e.googleProfileId=d[a]._id,void 0!=r.expiresIn&&(e.checkExpiresIn[a]=new Date(r.expiresIn)),e.tokenExpired[a]=!1;var i=r._id,n=r.expiresIn,l=new Date,c=new Date(n);l<=c&&null!=n?e.tokenExpired[a]=!1:void 0===n||null===n?e.tokenExpired[a]=!1:e.tokenExpired[a]=!0,t({method:"GET",url:"/api/v1/get/objects/"+i+"?buster="+new Date}).then(function(t){var r,i=0,n={};r=_.groupBy(t.data.objectList,"objectTypeId");var l={};for(var c in s)for(var d in r)s[c]==d&&(l[d]=r[d]);for(var h in l){var p=[];for(var g in l[h])p.push(l[h][g]);var u={};u[i]=p,n[i]=u,i++}e.googleAdwordsObjectList=n;var m=e.googleAdwordsObjectList;for(var h in s)e.objectForWidgetChosen([m[0][0][0].name,m[0][0][0]._id,m[0][0][0].objectTypeId,h,a,m[0][0][0].channelObjectId],o,s)},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})}else{e.googleProfileId=d[a]._id,void 0!=r.expiresIn&&(e.checkExpiresIn[a]=new Date(r.expiresIn)),e.tokenExpired[a]=!1;var i=r._id,n=r.expiresIn,l=new Date,c=new Date(n);l<=c&&null!=n?e.tokenExpired[a]=!1:void 0===n||null===n?e.tokenExpired[a]=!1:e.tokenExpired[a]=!0,t({method:"GET",url:"/api/v1/get/objects/"+i+"?buster="+new Date}).then(function(t){var a,r=0,o={};a=_.groupBy(t.data.objectList,"objectTypeId");var i={};for(var n in s)for(var l in a)s[n]==l&&(i[l]=a[l]);for(var c in i){var d=[];for(var h in i[c])d.push(i[c][h]);var p={};p[r]=d,o[r]=p,r++}e.googleAdwordsObjectList=o},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})}}else{void 0!=r.expiresIn&&(e.checkExpiresIn[a]=new Date(e.profileOptionsModel.expiresIn)),e.tokenExpired[a]=!1;var i=r._id,n=r.expiresIn,l=new Date,c=new Date(n);l<=c&&null!=n?e.tokenExpired[a]=!1:void 0===n||null===n?e.tokenExpired[a]=!1:e.tokenExpired[a]=!0,t({method:"GET",url:"/api/v1/get/objects/"+i+"?buster="+new Date}).then(function(t){var r,i=0,n={};if("Google Analytics"!=o){r=_.groupBy(t.data.objectList,"objectTypeId");var l={};for(var c in s)for(var d in r)s[c]==d&&(l[d]=r[d]);for(var h in l){var p=[];for(var g in l[h])p.push(l[h][g]);var u={};u[i]=p,n[i]=u,i++}"Facebook"==o?e.facebookObjectList=n:"Mailchimp"==o?e.mailchimpObjectList=n:"Aweber"==o?e.aweberObjectList=n:"linkedin"==o?e.linkedInObjectList=n:"YouTube"==o?e.youtubeObjectList=n:"Vimeo"==o?e.vimeoObjectList=n:"Twitter"==o?e.twitterObjectList=n:"Pinterest"==o?e.pinterestObjectList=n:"Instagram"==o&&(e.instagramObjectList=n)}else{document.getElementById("basicWidgetFinishButton").disabled=!0;var m=[];m[i]=t.data.objectList,e.googleAnalyticsObjectList=m}if("Twitter"===o||"Pinterest"===o||"Instagram"===o){document.getElementById("basicWidgetFinishButton").disabled=!0;var f;switch(o){case"Twitter":f=e.twitterObjectList;break;case"Instagram":f=e.instagramObjectList;break;case"Pinterest":f=e.pinterestObjectList;break;default:f=null}for(var h in s)e.objectForWidgetChosen([f[0][0][0].name,f[0][0][0]._id,f[0][0][0].objectTypeId,Number(h),a],o,s)}},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})}else{if("Facebook"==o?e.facebookObjectList=null:"Mailchimp"==o?e.mailchimpObjectList=null:"Aweber"==o?e.aweberObjectList=null:"linkedin"==o?e.linkedInObjectList=null:"YouTube"==o?e.youtubeObjectList=null:"Vimeo"==o?e.vimeoObjectList=null:"Twitter"==o?e.twitterObjectList=null:"Pinterest"==o?e.pinterestObjectList=null:"Instagram"==o?e.instagramObjectList=null:"FacebookAds"==o?e.facebookAdsObjectList=null:"GoogleAdwords"==o?e.googleAdwordsObjectList=null:"Google Analytics"==o&&(e.googleAnalyticsObjectList=null),y[a]=[],"Twitter"===o||"Instagram"===o||"GoogleAdwords"===o)for(var h in s)e.objectForWidgetChosen([null,null,null,h,a],o,s);"FacebookAds"==o&&(e.selectedLevel=null,document.getElementById("basicWidgetFinishButton").disabled=!0,e.campaignEnable=!1,e.adSetAdsEnable=!1,e.adSetEnable=!1,e.campaign=null,e.adSetAds=null,e.adSet=null,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.fbSelectEnable=!1),"GoogleAdwords"==o&&(e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleGroup=null,e.googleAd=null,e.googleCampaignChosen=!1,e.groupChosen=!1,e.adChosen=!1,e.googleSelectEnable=!1,document.getElementById("basicWidgetFinishButton").disabled=!0)}},e.refreshObjectsForChosenProfile=function(a,r,o,s,i){if(o){C=i,e.refreshButtonLoading=a;var o=o;t({method:"GET",url:"/api/v1/get/objectTypeDetail/"+a+"?buster="+new Date}).then(function(i){var n=i.data.objectType.type;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+o+"?objectType="+n+"&buster="+new Date}).then(function(t){var o,i=[],n=0,l={};if(n=s.indexOf(a),"Google Analytics"!=r){o=_.groupBy(t.data,"objectTypeId");for(var c in o){var d=[];if(c==a){for(var h in o[c])d.push(o[c][h]);var p={};p[n]=d,l=p}}"Facebook"==r?e.facebookObjectList[n]=l:"Mailchimp"==r?e.mailchimpObjectList[n]=l:"Aweber"==r?e.aweberObjectList[n]=l:"linkedin"==r?e.linkedInObjectList[n]=l:"YouTube"==r?e.youtubeObjectList[n]=l:"Vimeo"==r?e.vimeoObjectList[n]=l:"FacebookAds"==r?e.facebookAdsObjectList[n]=l:"GoogleAdwords"==r&&(e.googleAdwordsObjectList[n]=l)}else i[n]=t.data,e.googleAnalyticsObjectList=i;e.refreshButtonLoading=""},function(t){e.refreshButtonLoading="",401===t.status?(1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}),e.getProfileAfterLink()):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},function(t){e.refreshButtonLoading=!1,swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})}},e.addNewProfile=function(e,t,a){function r(e,a,r,o){switch(t){case"Facebook":e="/api/v1/auth/facebook",a=t;break;case"Google Analytics":e="/api/v1/auth/google",a=t;break;case"FacebookAds":e="/api/auth/facebookads",a=t;break;case"Twitter":e="/api/auth/twitter",a=t;break;case"Instagram":e="/api/auth/instagram",a=t;break;case"GoogleAdwords":e="/api/auth/adwords",a=t;break;case"YouTube":e="/api/v1/auth/youTube",a=t;break;case"Mailchimp":e="/api/auth/mailchimp",a=t;break;case"linkedin":e="/api/auth/linkedIn",a=t;break;case"Aweber":e="/api/auth/aweber",a=t;break;case"Vimeo":e="/api/auth/vimeo",a=t;break;case"Pinterest":e="/api/auth/pinterest",a=t}var s=screen.width/2-r/2,i=screen.height/2-o/2;return window.open(e,a,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+o+", top="+i+", left="+s)}var o,s;w=e,C=a,r(o,s,1e3,500)},o.afterAuthentication=function(){e.getProfileAfterLink()},e.getProfileAfterLink=function(){t({method:"GET",url:"/api/v1/get/profiles/"+C+"?buster="+(new Date).getTime()}).then(function(t){for(var a in e.selectedChannelList)e.selectedChannelList[a].id==C&&(e.selectedChannelList[a].profileList=t.data.profileList)},function(e){deferred.reject(e),swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},e.removeExistingProfile=function(a,r){var o=a;C=r,swal({title:"Confirm Profile Delink?",text:"All data, widgets associated with this profile will be deleted! Confirm?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!0},function(){o&&t({method:"POST",url:"/api/v1/post/removeProfiles/"+o._id}).then(function(t){e.getProfileAfterLink()},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong with Profile delink.Please try again</span>",html:!0})})})},e.createAndFetchBasicWidget=function(){var o,s="",i="",p=[],m=[],f="",v=[];$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=basic"}).then(function(w){if(r.availableBasicWidgets=w.data.availableWidgets,b.length<=r.availableBasicWidgets){"CustomData"==h&&(g={_id:u,widgetType:"custom",channelName:"custom"},r.$broadcast("populateWidget",g));for(var C=function(r,h){var g=l.defer();if("Moz"==r.name?(s=r.name,i=r.id,p=r.uniqueObjectCount):r.name==y[h].channelName&&(s=y[h].channelName,i=r.id,p=r.uniqueObjectCount,m=y[h].objectDetails,f=d[h].name),"Moz"==s){var u={channelId:i,mozObject:e.weburl,mozObjectTypeId:p[0]},v=t({method:"POST",url:"/api/v1/objects",data:u}).then(function(t){return e.mozObjectdetails=t.data.objectList,e.mozObjectdetails},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})});v.then(function(e){var t=[];for(var r in b)if(b[r].channelName==s){for(var i=[],l="",d=n.fetchWidgetColor(s),h=0;h<b[r].charts.length;h++){i=[],l="";for(var p=0;p<b[r].charts[h].metrics.length;p++)i.push(b[r].charts[h].metrics[p]),i[0].objectId=e[0]._id,l=e[0].name;b[r].charts[h].metrics=i,b[r].charts[h].objectName=l}o=b[r].name+" - "+l;var u={dashboardId:a.params.id,widgetType:c,name:o,description:b[r].description,charts:b[r].charts,order:b[r].order,offset:b[r].offset,size:b[r].size,minSize:b[r].minSize,maxSize:b[r].maxSize,color:d,visibility:!0,isAlert:b[r].isAlert,isFusion:void 0==b[r].isFusion||b[r].isFusion,channelName:s};t.push(u)}g.resolve(t)},function(){g.reject(error),$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#somethingWentWrongModalContent").addClass("md-show"),$("#somethingWentWrongText").text("Something went wrong! Please try again")})}else if("FacebookAds"==s){var w=[];for(var D in b)if(b[D].channelName==s){for(var C=[],x="",T=n.fetchWidgetColor(s),A=0;A<b[D].charts.length;A++){C=[],x="";for(var S=0;S<b[D].charts[A].metrics.length;S++)C.push(b[D].charts[A].metrics[S]),"fbadaccount"==e.selectedLevel?(C[0].objectTypeId=e.selectedObjectType._id,C[0].objectId=m[0]._id,x=m[0].name):"fbAdcampaign"==e.selectedLevel?(C[0].objectTypeId=e.selectedObjectType._id,C[0].objectId=e.campaign._id,x=e.campaign.name):"fbAdSet"==e.selectedLevel?(C[0].objectTypeId=e.selectedObjectType._id,C[0].objectId=e.adSet._id,x=e.adSet.name):"fbAdSetAds"==e.selectedLevel&&(C[0].objectTypeId=e.selectedObjectType._id,C[0].objectId=e.adSetAds._id,x=e.adSetAds.name);b[D].charts[A].metrics=C,b[D].charts[A].objectName=x}o=b[D].name+" - "+x;var L={dashboardId:a.params.id,widgetType:c,name:o,description:b[D].description,charts:b[D].charts,order:b[D].order,offset:b[D].offset,size:b[D].size,minSize:b[D].minSize,maxSize:b[D].maxSize,color:T,visibility:!0,isAlert:b[D].isAlert,isFusion:void 0==b[D].isFusion||b[D].isFusion,channelName:s};w.push(L)}g.resolve(w)}else if("GoogleAdwords"==s){var w=[];for(var D in b)if(b[D].channelName==s){for(var C=[],x="",T=n.fetchWidgetColor(s),A=0;A<b[D].charts.length;A++){C=[],x="";for(var S=0;S<b[D].charts[A].metrics.length;S++)C.push(b[D].charts[A].metrics[S]),"adwordaccount"==e.selectedGoogleLevel?(C[0].objectTypeId=e.selectedGoogleObjectType._id,C[0].objectId=m[0]._id,x=m[0].name):"adwordCampaign"==e.selectedGoogleLevel?(C[0].objectTypeId=e.selectedGoogleObjectType._id,C[0].objectId=e.googleCampaign._id,x=e.googleCampaign.name):"adwordAdgroup"==e.selectedGoogleLevel?(C[0].objectTypeId=e.selectedGoogleObjectType._id,C[0].objectId=e.googleGroup._id,x=e.googleGroup.name):"adwordsAd"==e.selectedGoogleLevel&&(C[0].objectTypeId=e.selectedGoogleObjectType._id,C[0].objectId=e.googleAd._id,x=e.googleAd.name);b[D].charts[A].metrics=C,b[D].charts[A].objectName=x}o=b[D].name+" - "+x;var L={dashboardId:a.params.id,widgetType:c,name:o,description:b[D].description,charts:b[D].charts,order:b[D].order,offset:b[D].offset,size:b[D].size,minSize:b[D].minSize,maxSize:b[D].maxSize,color:T,visibility:!0,isAlert:b[D].isAlert,isFusion:void 0==b[D].isFusion||b[D].isFusion,channelName:s};w.push(L)}g.resolve(w)}else{var w=[];for(var D in b)if(b[D].channelName==s){for(var C=[],x="",T=n.fetchWidgetColor(s),A=0;A<b[D].charts.length;A++){C=[],x="";for(var S=0;S<b[D].charts[A].metrics.length;S++)for(var I=0;I<m.length;I++)b[D].charts[A].metrics[S].objectTypeId===m[I].objectTypeId&&(C.push(b[D].charts[A].metrics[S]),C[0].objectId=m[I]._id,x=m[I].name);b[D].charts[A].metrics=C,b[D].charts[A].objectName=x}o="Twitter"===s||"Instagram"===s||"Google Analytics"===s||"Pinterest"===s?b[D].name+" - "+f:b[D].name+" - "+x;var L={dashboardId:a.params.id,widgetType:c,name:o,description:b[D].description,charts:b[D].charts,order:b[D].order,offset:b[D].offset,size:b[D].size,minSize:b[D].minSize,maxSize:b[D].maxSize,color:T,visibility:!0,isAlert:b[D].isAlert,isFusion:void 0==b[D].isFusion||b[D].isFusion,channelName:s};w.push(L)}g.resolve(w)}return g.promise},x=0;x<e.selectedChannelList.length;x++)v.push(C(e.selectedChannelList[x],x));l.all(v).then(function(e){for(var a=[],o=0;o<e.length;o++)for(var s=0;s<e[o].length;s++)a.push(e[o][s]);t({method:"POST",url:"/api/v1/widgets",data:a}).then(function(e){D=1;var t=0;for(var a in e.data.widgetsList){var o="undefined"!=typeof e.data.widgetsList[a].size?e.data.widgetsList[a].size.h:2;"undefined"!=typeof e.data.widgetsList[a].size?e.data.widgetsList[a].size.w:2;e.data.widgetsList[a].row=t,t+=o}for(var a in e.data.widgetsList)r.$broadcast("populateWidget",e.data.widgetsList[a])},function(e){D=1,$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#somethingWentWrongModalContent").addClass("md-show"),$("#somethingWentWrongText").text("Something went wrong! Please try again"),swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span>",html:!0})}),b=[]})}else{var T=document.getElementById("scroller");T.scrollTop=0,$("#error").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Widgets limit. Please upgrade to enjoy more Widgets</div>'),document.getElementById("basicWidgetFinishButton").disabled=!0}},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong!!!!</span> .",html:!0})})},e.storeChannel=function(t){if(e.selectedTempChannelList.length)if(0==e.showCustomContent)if("CustomData"==t.name){for(var a in e.channelList)t._id==e.channelList[a]._id&&(e.channelList[a].isSelected=0);k(e.selectedTempChannelList,"id",t._id),e.customMessageEnable=!1,document.getElementById("basicWidgetNextButton1").disabled=!0}else e.customMessageEnable=!0;else if("CustomData"==t.name)e.customMessageEnable=!0;else{e.customMessageEnable=!1;var o=1;for(var s in e.selectedTempChannelList)if(e.selectedTempChannelList[s].id==t._id){var o=0;k(e.selectedTempChannelList,"id",t._id)}if(1==o){e.selectedTempChannelList.push({name:t.name,id:t._id});for(var a in e.channelList)t._id==e.channelList[a]._id&&(e.channelList[a].isSelected=1)}else for(var a in e.channelList)t._id==e.channelList[a]._id&&($(".alert-danger").remove(),e.channelList[a].isSelected=0);if(e.selectedTempChannelList.length<=r.availableBasicWidgets)0===e.selectedTempChannelList.length?document.getElementById("basicWidgetNextButton1").disabled=!0:document.getElementById("basicWidgetNextButton1").disabled=!1;else{var i=document.getElementById("scroller");i.scrollTop=0,$("#error").html('<div class="alert alert-danger fade in"   style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Widgets limit. Please upgrade to enjoy more Widgets</div>'),document.getElementById("basicWidgetNextButton1").disabled=!0}}else{h=t.name,e.selectedTempChannelList.push({name:t.name,id:t._id});for(var a in e.channelList)t._id==e.channelList[a]._id&&(e.channelList[a].isSelected=1);if("CustomData"==t.name?(e.metricContent=!0,e.showCustomContent=!1,e.selectCustomLinkHead="Step 2 : Custom Data URL"):(e.metricContent=!1,e.showCustomContent=!0,e.selectCustomLinkHead="Step 2 : Choose your Metrics"),e.selectedTempChannelList.length<=r.availableBasicWidgets)e.selectedTempChannelList.length>0&&(document.getElementById("basicWidgetNextButton1").disabled=!1);else{var i=document.getElementById("scroller");i.scrollTop=0,$("#error").html('<div class="alert alert-danger fade in"  style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Widgets limit. Please upgrade to enjoy more Widgets</div>'),document.getElementById("basicWidgetNextButton1").disabled=!0}}};var k=function(e,t,a){for(var r=e.length;r--;)e[r]&&e[r].hasOwnProperty(t)&&arguments.length>2&&e[r][t]===a&&e.splice(r,1);return e};e.storeReferenceWidget=function(){e.storedReferenceWidget=this.referenceWidgets,e.uniqueObjectCount=[],e.metricMessage=!1;var t=0,a=0,o=!1,s=!1,i=!1;if("GoogleAdwords"==e.storedReferenceWidget.channelName||"FacebookAds"==e.storedReferenceWidget.channelName)if(b.length)if("GoogleAdwords"==e.storedReferenceWidget.channelName){for(var n in b)"Adwords campaigns overview (Account level)"==b[n].name?o=!0:"Adgroups overview (Campaign level)"==b[n].name||"Age Demographics (Campaign Level)"==b[n].name||"Gender Demographics (Campaign Level)"==b[n].name||"Device Demographics (Campaign Level)"==b[n].name?s=!0:"Ads overview (Adgroup level)"!=b[n].name&&"Age Demographics (Adgroup Level)"!=b[n].name&&"Gender Demographics (Adgroup Level)"!=b[n].name&&"Device Demographics (Adgroup Level)"!=b[n].name||(i=!0);(1!=o||"Adgroups overview (Campaign level)"!=e.storedReferenceWidget.name&&"Age Demographics (Campaign Level)"!=e.storedReferenceWidget.name&&"Gender Demographics (Campaign Level)"!=e.storedReferenceWidget.name&&"Device Demographics (Campaign Level)"!=e.storedReferenceWidget.name&&"Ads overview (Adgroup level)"!=e.storedReferenceWidget.name&&"Age Demographics (Adgroup Level)"!=e.storedReferenceWidget.name&&"Gender Demographics (Adgroup Level)"!=e.storedReferenceWidget.name&&"Device Demographics (Adgroup Level)"!=e.storedReferenceWidget.name)&&(1!=s||"Adwords campaigns overview (Account level)"!=e.storedReferenceWidget.name&&"Ads overview (Adgroup level)"!=e.storedReferenceWidget.name&&"Age Demographics (Adgroup Level)"!=e.storedReferenceWidget.name&&"Gender Demographics (Adgroup Level)"!=e.storedReferenceWidget.name&&"Device Demographics (Adgroup Level)"!=e.storedReferenceWidget.name)&&(1!=i||"Adwords campaigns overview (Account level)"!=e.storedReferenceWidget.name&&"Adgroups overview (Campaign level)"!=e.storedReferenceWidget.name&&"Age Demographics (Campaign Level)"!=e.storedReferenceWidget.name&&"Gender Demographics (Campaign Level)"!=e.storedReferenceWidget.name&&"Device Demographics (Campaign Level)"!=e.storedReferenceWidget.name)?a=1:(a=0,e.metricMessage=!0)}else{for(var n in b)"Fb Ads campaign overview (Account level)"==b[n].name?o=!0:"Fb Ads Adgroup overview (Campaign level)"==b[n].name?s=!0:"Fb Ads Ad overview (Adgroup level)"==b[n].name&&(i=!0);(1!=o||"Fb Ads Adgroup overview (Campaign level)"!=e.storedReferenceWidget.name&&"Fb Ads Ad overview (Adgroup level)"!=e.storedReferenceWidget.name)&&(1!=s||"Fb Ads campaign overview (Account level)"!=e.storedReferenceWidget.name&&"Fb Ads Ad overview (Adgroup level)"!=e.storedReferenceWidget.name)&&(1!=i||"Fb Ads campaign overview (Account level)"!=e.storedReferenceWidget.name&&"Fb Ads Adgroup overview (Campaign level)"!=e.storedReferenceWidget.name)?a=1:(a=0,e.metricMessage=!0)}else a=1;else a=1;if(a){for(var n in b)b[n]._id==this.referenceWidgets._id&&(k(b,"_id",b[n]._id),$("#referenceWidgets-"+this.referenceWidgets._id).css("border","2px solid #e7eaec"),$("#triangle-topright-"+this.referenceWidgets._id).removeClass("triangle-topright"),$("#metricNames-"+this.referenceWidgets._id).removeClass("getMetricName"),$("#getCheck-"+this.referenceWidgets._id).hide(),t=1,$(".alert-danger").remove());1!=t&&(b.push(this.referenceWidgets),$("#referenceWidgets-"+this.referenceWidgets._id).css("border","2px solid #04509B"),$("#triangle-topright-"+this.referenceWidgets._id).addClass("triangle-topright"),$("#metricNames-"+this.referenceWidgets._id).addClass("getMetricName"),$("#getCheck-"+this.referenceWidgets._id).show(),
document.getElementById("basicWidgetNextButton2").disabled=!1)}if(""!=b&&"[]"!=b&&null!=b||(document.getElementById("basicWidgetNextButton2").disabled=!0),b.length){var l=b.length;if(l<=r.availableBasicWidgets){for(var c=0;c<l;c++)for(var d=0;d<b[c].charts.length;d++)for(var h=0;h<b[c].charts[d].metrics.length;h++)e.uniqueObjectCount.push({objectType:b[c].charts[d].metrics[h].objectTypeId,channelId:b[c].charts[d].channelId});document.getElementById("basicWidgetNextButton2").disabled=!1}else{var p=document.getElementById("scroller");p.scrollTop=0,$("#error").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Widgets limit. Please upgrade to enjoy more Widgets</div>'),document.getElementById("basicWidgetNextButton2").disabled=!0}}},e.clearReferenceWidget=function(){e.referenceWidgetsList=[],e.tokenExpired=[];var a=r.customWidgetId;void 0!=a&&""!=a&&t({method:"POST",url:"/api/v1/delete/widgets/"+a}).then(function(e){r.customWidgetId=""},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},e.objectForWidgetChosen=function(a,r,o){if(document.getElementById("basicWidgetFinishButton").disabled=!0,"Google Analytics"===r&&a)if(""!=a[0]){var s=JSON.parse(a[0]);a=[s[0],s[1],s[2],a[1],a[2]]}else a=[null,null,null,a[1],a[2]];if(v[a[4]]||(v[a[4]]=[]),void 0!=a&&void 0!=a[1]){if(v[a[4]][a[3]]={name:a[0],_id:a[1],objectTypeId:a[2]},v[a[4]].length==o.length)for(var i=0,n=0;n<v[a[4]].length;n++)null!=v[a[4]][n]&&i++;else var i=0;if(i==v[a[4]].length)var l=!0;else var l=!1;y[a[4]]={channelName:r,objectDetails:v[a[4]],channelStatus:l}}else v[a[4]][a[3]]=null,y[a[4]]={channelName:r,objectDetails:v[a[4]],channelStatus:!1};for(var c in e.selectedChannelList)"Moz"==e.selectedChannelList[c].name&&(x=!0,y[c]={channelName:e.selectedChannelList[c].name}),"FacebookAds"==e.selectedChannelList[c].name&&(T=!0),"GoogleAdwords"==e.selectedChannelList[c].name&&(A=!0);var d=0;for(var h in y)1==y[h].channelStatus&&d++;S=e.selectedChannelList.length==d||e.selectedChannelList.length-d==1&&1==x,document.getElementById("basicWidgetFinishButton").disabled=!0,"FacebookAds"==r&&(a[0]?(e.selectedObjectType=null,e.selectedLevel=null,e.selectedId=null,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null,e.accountId=a[5],e.fbSelectEnable=!0,t({method:"GET",url:"/api/v1/get/objectType/"+e.selectedChannelList[a[4]].id+"?buster="+new Date}).then(function(t){e.fbObjectTypeList=t.data.objectType},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})):(e.selectedObjectType=null,e.selectedLevel=null,e.selectedId=null,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null,e.fbSelectEnable=!1,document.getElementById("basicWidgetFinishButton").disabled=!0)),"GoogleAdwords"==r&&(a[0]?(e.googleCampaignChosen=!1,e.adChosen=!1,e.groupChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleAd=null,e.googleGroup=null,e.selectedGoogleObjectType=null,e.selectedGoogleLevel=null,e.selectedGoogleId=null,e.googleAccountId=a[5],e.googleSelectEnable=!0,t({method:"GET",url:"/api/v1/get/objectType/"+e.selectedChannelList[a[4]].id+"?buster="+new Date}).then(function(t){e.googleObjectTypeList=t.data.objectType},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})):(e.googleCampaignChosen=!1,e.adChosen=!1,e.groupChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleAd=null,e.googleGroup=null,e.selectedGoogleObjectType=null,e.selectedGoogleLevel=null,e.selectedGoogleId=null,e.googleSelectEnable=!1,document.getElementById("basicWidgetFinishButton").disabled=!0)),e.checkComplete()},e.checkComplete=function(){0==x&&0==T&&0==A?1==S?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:1==x&&0==T&&0==A?1==S&&1==p?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:0==x&&1==T&&0==A?1==S&&1==L?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:0==x&&0==T&&1==A?1==S&&1==I?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:1==x&&0==T&&1==A?1==S&&1==I&&1==p?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:0==x&&1==T&&1==A?1==S&&1==I&&1==L?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:1==x&&1==T&&0==A?1==S&&1==L&&1==p?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:1==x&&1==T&&1==A&&(1==S&&1==L&&1==p&&1==I?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0)},e.errorMessage=!0,e.storeCustomData=function(){var o={dashboardId:a.params.id,widgetType:"custom",channelId:e.selectedTempChannelList[0].id,visibility:!0,channelName:"custom"};t({method:"POST",url:"/api/v1/create/customwidgets",data:o}).then(function(t){e.errorMessage=!0,e.customMessage=!1,e.customDocLinkMessage=!1,document.getElementById("basicWidgetBackButton2").disabled=!1,document.getElementById("basicWidgetNextButton2").disabled=!1,u=t.data.widgetsList.id._id,r.customWidgetId=t.data.widgetsList.id._id;var a="";a="localhost"==window.location.hostname?"http://localhost:8080":window.location.hostname,$(".customApiLink").html(a+"/api/v1/create/customdata/"+t.data.widgetsList.id._id),e.customLink=a+"/api/v1/create/customdata/"+t.data.widgetsList.id._id},function(t){e.customMessage=!0,e.errorMessage=!1,e.customDocLinkMessage=!0,swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})}),new Clipboard("#btnCopyLink")},e.copyToClipboard=function(){swal("Copied","","success")},e.ComingSoonAlert=function(){swal("Coming Soon!")}}function buildReportController(e,t,a,r){e.dashboardList=null,e.gridloading=!0,e.selectedDashboard=null,e.selectedDashboards=[],e.disableFilter=!0,e.customReportName="",$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),e.toggleDrafts=function(){e.disableFilter=$("#showDraftsBtn").prop("checked")},e.myFilter=function(e){return null!==e.pdfLink},angular.element(a).on("resize",function(t){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-105,e.dashboardHeight=window.innerHeight,e.dashboardHeight=e.dashboardHeight-300,window.innerWidth<768&&(e.disableFilter=!0,$("#showDraftsBtn").prop("checked",!0))}),e.showSettings=function(e){var t="settingsDropdown-"+e;document.getElementById(String(t)).classList.toggle("shw")},e.fetchAllDashboards=function(){e.dashboardHeight=window.innerHeight,e.dashboardHeight=e.dashboardHeight-300,e.gridloading=!0,t({method:"GET",url:"/api/v1/get/dashboardList"}).then(function(t){e.gridloading=!1,document.getElementById("reportFinishButton").disabled=!0,$("#reportFinishButton").addClass("exportDisabled"),"200"==t.status?"admin"===t.data.user.roleId?e.allDashboards=_.groupBy(t.data.dashboardList,"userId"):e.dashboardList=t.data.dashboardList:e.dashboardList=null},function(t){e.gridloading=!1,document.getElementById("reportFinishButton").disabled=!0,$("#reportFinishButton").addClass("exportDisabled"),e.dashboardList=null,$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#somethingWentWrongModalContent").addClass("md-show")})},e.fetchAllReports=function(){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-105,e.gridloading=!0,t({method:"GET",url:"/api/v1/get/reportList"}).then(function(t){e.gridloading=!1,"200"==t.status?e.reportList=t.data.reportList:e.reportList=null},function(t){e.gridloading=!1,e.reportList=null,$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#somethingWentWrongModalContent").addClass("md-show")})},e.addNewReport=function(t){e.newReportActive=t,e.selectedDashboards=[],e.gridloading=t},e.selectDashboard=function(t){if(1==t.isSelected){t.isSelected=!1;var a=_.pull(e.selectedDashboards,t.dashboard._id);e.selectedDashboards=a}else t.isSelected=!0,e.selectedDashboards.push(t.dashboard._id);e.selectedDashboards.length>0?(document.getElementById("reportFinishButton").disabled=!1,$("#reportFinishButton").removeClass("exportDisabled")):(document.getElementById("reportFinishButton").disabled=!0,$("#reportFinishButton").addClass("exportDisabled"))},e.createNewReport=function(r){var o={dashboards:_.uniq(r),name:e.customReportName||"",startDate:moment(new Date).subtract(30,"days").format("YYYY-MM-DD"),endDate:moment(new Date).format("YYYY-MM-DD")};t({method:"POST",url:"/api/v1/create/reports",data:o}).then(function(t){var r=a.open("","_blank");if(e.gridloading=!1,"200"==t.status){e.fetchAllReports();var o=t.data,s="localhost"==window.location.hostname?"localhost:8080/customReports":"https://"+window.location.hostname+"/customReports";console.log("reportDomain",s);var i=String(s+"#/"+o);console.log("Window Opens",i),e.addNewReport(!1),r.location=i}else e.dashboardList=null},function(t){e.gridloading=!1,e.dashboardList=null,e.addNewReport(!1),$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#somethingWentWrongModalContent").addClass("md-show")})},e.editReport=function(e){var t=e.customReportId,r="localhost"==window.location.hostname?"localhost:8080/customReports":"https://"+window.location.hostname+"/customReports",o=r+"#/"+t;console.log("Window Opens",o);var s=a.open("","_blank");s.location=o},e.openReportPDF=function(e){var t=a.open("","_blank"),r=e.pdfLink;console.log("pdf url",r,e.pdfLink),t.location=r},e.changeReportName=function(t){e.customReportName=t},e.deleteReport=function(a){swal({title:"Confirm Delete?",text:"Reports and all its contents will be removed",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!0},function(){e.gridloading=!0,$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),t({method:"POST",url:"/api/v1/delete/userReports/"+a._id}).then(function(t){e.fetchAllReports()},function(e){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#somethingWentWrongModalContent").addClass("md-show"),$("#somethingWentWrongText").text("Unable to delete Report.Please try again")})})}}function ChangePasswordController(e,t,a,r){function o(){var r={currentPassword:e.currentPassword,newPassword:e.newPassword};t({method:"POST",url:"/api/v1/changePassword",data:r}).then(function(e){"200"==e.status?a.path("/login"):swal("Please enter correct current password")})}e.docHeight=window.innerHeight,e.docHeight=e.docHeight-105,angular.element(r).on("resize",function(t){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-105}),e.currentPassword="",e.newPassword="",e.changePassword=function(){"Password Match"==document.getElementById("password-res").innerHTML&&swal({title:"Are you sure?",text:"You will be logged out and must login again with your new password!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, change my password!",closeOnConfirm:!0},function(){o()})}}function ChooseDashboardController(e,t,a,r,o,s){function i(){function t(){e.ok(),r.resolve("open")}var r=a.defer();return t(),r.promise}e.enabletextField=!1,e.dashboardName,e.enableTextField=function(t){e.enabletextField=!0},e.closemodal=function(){i().then(function(){t.go("app.reporting.dashboards")})},e.goRecommendedDashboard=function(){i().then(function(){t.go("app.reporting.recommendedDashboard")})},e.createDashboard=function(a){e.loading=!0;var o={name:a,startDate:moment(new Date).subtract(30,"days"),endDate:new Date};r({method:"POST",url:"/api/v1/create/dashboards",data:o}).then(function(e){t.go("app.reporting.dashboard",{id:e.data})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})}}function customReportController(e,t,a,r,o,s,i,n,l){e.customReportId,e.reportId,e.reportType=null,e.loading=!1,e.reportLoading=!1,e.exportReportLoading=!0,e.$window=o,e.autoArrangeGrid=!1,e.currentDate=moment(new Date).format("YYYY-DD-MM"),e.widgetDataLength=0,e.displayDate=moment(new Date).format("MMM Do YY"),e.displayHeader,e.reportNotSupported=!1,e.exportReportPages=[],e.stepActive="step1",e.customReport={widgets:[],widgetData:[]},e.orgLogosList=[],e.cliLogosList=[];var c=l.defer();e.orgLogoSrc="/userFiles/datapoolt.png",e.cliLogoSrc="/userFiles/plain-white.jpg",e.docHeight=window.innerHeight,e.docHeight=e.docHeight-60,e.reportNotSupported=!1,window.innerWidth>=1100?e.docWidth=window.innerWidth-1080:window.innerWidth>=992?e.docWidth=window.innerWidth-990:window.innerWidth>=767?e.docWidth=window.innerWidth-720:e.reportNotSupported=!0,e.sideSpace=Math.floor(e.docWidth/2),e.selectedIconIndicator=function(e,t){if("cli"==e){var a=$(".cliIcon");a.removeClass("selectIcon"),$("#"+t).addClass("selectIcon")}else if("org"==e){var a=$(".orgIcon");a.removeClass("selectIcon"),$("#"+t).addClass("selectIcon")}},e.fetchLogosFromDB=function(t){var a={accType:t};r({method:"post",url:"/api/v1/fetchLogoToPdf/dashboard",data:a}).then(function(a){"org"==t?e.orgLogosList=JSON.parse(JSON.stringify(a.data.logosInDB)):"cli"==t&&(e.cliLogosList=JSON.parse(JSON.stringify(a.data.logosInDB)))},function(t){e.orgLogosList=[],e.cliLogosList=[],swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please reload the dashboard</span>',html:!0})})},e.submitUpload=function(t,a){var o={file:t,accType:a},s="/api/v1/createLogoToPdf/createFolder",i=new FormData,n=t.type.split("/");if("png"==n[1]||"bmp"==n[1]||"jpg"==n[1]||"jpeg"==n[1]){for(var l in o)i.append(l,o[l]);r.post(s,i,{transformRequest:angular.indentity,headers:{"Content-Type":void 0}}).then(function(t){document.getElementById("orgUploadButton").disabled=!0,document.getElementById("clientUploadButton").disabled=!0,e.fetchLogosFromDB(a)},function(e){swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please try again later</span>',html:!0})})}else swal({title:"",text:'<span style="sweetAlertFont">Please Upload Only Image files(.jpg,.png,.jpeg,.bmp)</span>',html:!0})},e.removeLogo=function(t,a){var o={fileUrl:t.fileUrl,accType:a};r({method:"POST",url:"/api/v1/removeLogoToPdf/dashboard",data:o}).then(function(r){t.fileUrl==e.orgLogoSrc?e.orgLogoSrc="/userFiles/datapoolt.png":t.fileUrl==e.cliLogoSrc&&(e.cliLogoSrc="/userFiles/plain-white.jpg"),e.fetchLogosFromDB(a)},function(e){swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please try again later</span>',html:!0})})},e.enableUploadbutton=function(e){"org"==e?document.getElementById("orgUploadButton").disabled=!1:"cli"==e&&(document.getElementById("clientUploadButton").disabled=!1)},e.selectedOrgLogo=function(t){e.orgLogoSrc=t},e.selectedCliLogo=function(t){e.cliLogoSrc=t},e.exportReportGridsterOptions={margins:[10,20],columns:10,rows:11,minRows:11,maxRows:500,defaultSizeX:10,defaultSizeY:2,minSizeX:10,minSizeY:1,swapping:!0,floating:!1,pushing:!0,width:"auto",colWidth:"auto",draggable:{enabled:!1},outerMargin:!0,mobileBreakPoint:768,mobileModeEnabled:!0,resizable:{enabled:!1}},e.printReportInPDF=function(){var t=[];angular.copy(e.customReport.widgets,t);var a=[],r=0,o=0;do{var s=[];e:for(var i in t){if(t[i].pageNumber!=r)break e;if("pageBreakWidget"==t[i].widgetType)t[i]=null;else if("reportParaWidget"==t[i].widgetType||"reportHeadingWidget"==t[i].widgetType)s.push({pageNumber:r,row:o,col:0,sizeY:"reportHeadingWidget"!=typeof t[i].widgetType?t[i].sizeY:1,sizeX:12,widgetType:t[i].widgetType,name:"undefined"!=typeof t[i].name?t[i].name:"",id:t[i].id,textData:t[i].textData||""}),o+=t[i].sizeY,t[i]=null;else{t[i].id;s.push({pageNumber:r,row:o,col:0,sizeY:"undefined"!=typeof t[i].sizeY?t[i].sizeY:4,sizeX:12,name:"undefined"!=typeof t[i].name?t[i].name:"",widgetType:"undefined"!=typeof t[i].widgetType?t[i].widgetType:"",id:t[i].id,visibility:!1,channelName:"undefined"!=typeof t[i].channelName?t[i].channelName:"",dashboardId:"undefined"!=typeof t[i].dashboardId?t[i].dashboardId:""}),o+=t[i].sizeY,t[i]=null}}for(var n=t.length,l=[],c=0;c<n;c++)null!=t[c]&&l.push(t[c]);t=[],t=l,a[r]=s,o=0,++r}while(t.length>0);e.exportReportPages=a,e.reportLoading=!1,e.stepActive="step3";for(var d in e.customReport.widgetData)e.customReport.widgetData[d].visibility=!0},e.exportReportinPDF=function(){$("#reportDownloadButton").disabled=!0,$("#reportDownloadButton").addClass("exportDisabled"),$("#reportEditButton").disabled=!0,$("#reportEditButton").addClass("exportDisabled"),$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#reportPDFModalContent").addClass("md-show"),$(".reportPdfHeadText").hide(),$(".pdfContentText").html("<b>Please wait while the PDF file is being generated</b>"),$(".loadingStatus").show();var t=[],a=[];e.exportPromise=function(e){var t=l.defer();return domtoimage.toPng(e).then(function(e){t.resolve(e)},function(e){t.reject(e),console.log("Dom to image fails",e)}),t.promise};for(var o=0;o<e.exportReportPages.length;o++)t[o]=document.getElementById("gridsterItemsInReport-"+o),a.push(e.exportPromise(t[o]));l.all(a).then(function(t){var a={dashboardLayout:t,dashboardId:s.params.id,dashboardName:e.customReport.reportName};r({method:"POST",url:"/api/v1/createHtml5ToPdf/report",data:a}).then(function(t){$("#exportOptionPDF").prop("checked",!1);var a=(Number(new Date),"");a="localhost"==window.location.hostname?"http://localhost:8080":"";var o=String(a+t.data.Response);$("#reportPDFModalContent").removeClass("md-show"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#reportPDFModalContent").addClass("md-show"),$(".loadingStatus").hide(),$(".reportPdfHeadText").show().text("PDF has been generated successfully").css({"font-style":"normal",color:"#232c3b"}),$(".pdfContentText").html('<b><br/><a href="'+o+'" download style="color: green;"  id="yourLinkID">Click here to download your PDF</a></b>');var s={reportId:e.reportId,pdfLink:o};r({method:"POST",url:"/api/v1/create/reports",data:s}).then(function(e){"200"==e.status&&($("#reportDownloadButton").disabled=!1),$("#reportDownloadButton").removeClass("exportDisabled"),$("#reportEditButton").disabled=!1,$("#reportEditButton").removeClass("exportDisabled")},function(e){$("#reportDownloadButton").disabled=!1,$("#reportDownloadButton").removeClass("exportDisabled"),$("#reportEditButton").disabled=!1,$("#reportEditButton").removeClass("exportDisabled")})},function(e){$("#reportPDFModalContent").removeClass("md-show"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#reportPDFModalContent").addClass("md-show"),$(".loadingStatus").hide(),$(".reportPdfHeadText").show().text("Uh-Oh!!").css({"font-style":"normal",color:"red"}),$(".pdfContentText").html("<b>Something went wrong. Please try again</b>"),$("#reportDownloadButton").disabled=!1,$("#reportDownloadButton").removeClass("exportDisabled"),$("#reportEditButton").disabled=!1,$("#reportEditButton").removeClass("exportDisabled")})},function(e){swal({title:"",text:'<span style = "sweetAlertFont"> Sorry..! PDF download failed. </span>',html:!0})})},e.reportPdfPreview=function(a){if("step3"==a){e.summaryAlignLessThanThree=[],e.toDisplayAllSummary=[],e.reportLoading=!0;for(var r in e.customReport.widgetData)e.customReport.widgetData[r].visibility=!1;t(function(){e.printReportInPDF()},1500)}else if("step2"==a)e.reportLoading=!0,e.fetchLogosFromDB("org"),e.fetchLogosFromDB("cli"),e.reportLoading=!1,e.stepActive=a;else{e.stepActive=a;for(var r in e.customReport.widgetData)e.customReport.widgetData[r].visibility=!0}},e.customReportConfiguration=function(){function i(t,a,o){var i={reportId:s.params.id,startDate:t,endDate:a};r({method:"POST",url:"/api/v1/create/reports",data:i}).then(function(t){if(200==t.status)e.startDate=t.config.data.startDate,e.endDate=t.config.data.endDate,o===!0?e.userModifyDate(e.startDate,e.endDate):e.populateReportWidgets();else{this.start_date,this.end_date;e.populateReportWidgets()}},function(t){this.start_date,this.end_date;e.populateReportWidgets()})}e.reportLoading=!0,e.dashboardWidgets=[],e.reportPagesDetails=[],e.reportWidgetsListArray=[],e.customReport.reportName="",e.widgetsPresent=!1,e.loadedWidgetCount=0,e.startDate,e.endDate,e.empWidget={col:0,sizeY:1,sizeX:10,name:"Page Options"},e.setChartSize=function(e,a){function r(){if(null!=document.getElementById("chartOptions"+e)){var t=document.getElementById("chartOptions"+e).offsetWidth,r=document.getElementById("chartOptions"+e).offsetHeight;document.getElementById("chartRepeat"+e+"-"+a).style.height=r+"px",document.getElementById("chartRepeat"+e+"-"+a).style.width=t+"px"}}t(r,100)},e.setChartSizeInReport=function(e,a,r){function o(){if(null!=document.getElementById("reportChartOptions-"+e+"-"+a)){var t=document.getElementById("reportChartOptions-"+e+"-"+a).offsetWidth,o=document.getElementById("reportChartOptions-"+e+"-"+a).offsetHeight;document.getElementById("reportChartRepeat-"+e+"-"+a+"-"+r).style.height=o+"px",document.getElementById("reportChartRepeat-"+e+"-"+a+"-"+r).style.width=t+"px"}}t(o,100)},e.summaryAlignLessThanThree=[],e.toDisplayAllSummary=[],e.summaryAlignLessThanThreePdf=[],e.toDisplayAllSummaryPdf=[],e.checkAllGraphsZero=function(t,a,r){void 0==e.summaryAlignLessThanThree[a]&&(e.summaryAlignLessThanThree[a]=[]),void 0==e.toDisplayAllSummary[a]&&(e.toDisplayAllSummary[a]=[]);for(var o=0,s=0;s<t.data.length;s++)0===t.data[s].summaryDisplay&&(o+=1);e.summaryAlignLessThanThree[a][r]=t.data.length-o,o===t.data.length?e.toDisplayAllSummary[a][r]=!0:e.toDisplayAllSummary[a][r]=!1},e.checkAllGraphsZeroForReportPdf=function(t,a,r,o){void 0==e.summaryAlignLessThanThreePdf[a]?(e.summaryAlignLessThanThreePdf[a]=[],e.summaryAlignLessThanThreePdf[a][r]=[]):void 0==e.summaryAlignLessThanThreePdf[a][r]&&(e.summaryAlignLessThanThreePdf[a][r]=[]),void 0==e.toDisplayAllSummaryPdf[a]?(e.toDisplayAllSummaryPdf[a]=[],e.toDisplayAllSummaryPdf[a][r]=[]):void 0==e.toDisplayAllSummaryPdf[a][r]&&(e.toDisplayAllSummaryPdf[a][r]=[]);for(var s=0,i=0;i<t.data.length;i++)0===t.data[i].summaryDisplay&&(s+=1);e.summaryAlignLessThanThreePdf[a][r][o]=t.data.length-s,s===t.data.length?e.toDisplayAllSummaryPdf[a][r][o]=!0:e.toDisplayAllSummaryPdf[a][r][o]=!1},e.fetchReportDetails=function(){var t,a="undefined";r({method:"GET",url:"/api/v1/getSubscriptionFromDashboard/"+a}).then(function(e){t=200==e.status?e.data.response.limits.dateRange:365}),r({method:"GET",url:"/api/v1/get/report/null",params:{customReportId:s.params.id}}).then(function(a){function r(e,t){var a=new Date(e),r=new Date(t),o=Math.abs(r.getTime()-a.getTime()),s=Math.ceil(o/864e5);return s}if(200==a.status&&1!=a.data.dashboardDeleted){e.customReportId=a.data.customReportId,e.reportId=a.data._id,e.customReport.reportName=a.data.name,e.reportType=a.data.type;for(var o in a.data.widgets)e.reportWidgetsListArray.push(a.data.widgets[o]),"reportParaWidget"==a.data.widgets[o].widgetType&&"reportHeadingWidget"==a.data.widgets[o].widgetType&&"reportParaWidget"==a.data.widgets[o].widgetType&&void 0==a.data.widgets[o].widgetId&&null==a.data.widgets[o].widgetId||e.dashboardWidgets.push(a.data.widgets[o].widgetId);e.reportWidgetsListArray=_.uniq(e.reportWidgetsListArray),e.dashboardWidgets=_.uniq(e.dashboardWidgets);var s=r(a.data.startDate,new Date),n=r(a.data.endDate,new Date),l=!0;s>=365||n>=365?(e.startDate=moment(new Date).subtract(30,"days"),e.endDate=new Date,i(e.startDate,e.endDate,l)):(e.startDate=a.data.startDate,e.endDate=a.data.endDate,e.userModifyDate(e.startDate,e.endDate,t))}else e.reportLoading=!1,e.stepActive="error",isExportOptionSet=0,211==a.status?swal({title:"",text:'<span style = "sweetAlertFont">Dashboard linked with this report is missing</span>',html:!0}):swal({title:"",text:'<span style = "sweetAlertFont">Error in populating Report! Report Doesnot Exist</span>',html:!0})},function(t){e.reportLoading=!1,e.stepActive="error",401==t.status?swal({title:"",text:'<span style = "sweetAlertFont">Authentication required to perform this action</span>',html:!0}):211==t.status?swal({title:"",text:'<span style = "sweetAlertFont">Dashboard linked with this report is missing</span>',html:!0}):swal({title:"",text:'<span style = "sweetAlertFont">Error in populating Report! Report Doesnot Exist</span>',html:!0}),isExportOptionSet=0})},e.fetchReportDetails(),e.userModifyDate=function(t,a,o){e.dashboardCalendar=new Calendar({element:$(".daterange--double"),earliest_date:moment(new Date).subtract(o,"days"),latest_date:new Date,start_date:t,end_date:a,callback:function(){i(this.start_date,this.end_date),r.pendingRequests.forEach(function(e){e.cancel&&e.cancel.resolve()})}}),e.populateReportWidgets()},e.gridsterOptions={margins:[10,20],columns:10,maxRows:500,defaultSizeX:10,defaultSizeY:2,minSizeX:10,minSizeY:1,swapping:!0,floating:!0,pushing:!0,width:"auto",colWidth:"auto",draggable:{enabled:!1},outerMargin:!0,mobileBreakPoint:768,mobileModeEnabled:!0,resizable:{enabled:!1}},e.$on("gridster-mobile-changed",function(t,a){e.isMobile=a.isMobile}),e.$on("broadCastUpdateCharts",function(e,t){a.$broadcast("updateWidgetDetailsInReport",{})}),e.updateWidgetsInDb=function(){a.$broadcast("updateWidgetDetailsInReport",{})},angular.element(o).on("resize",function(t){e.reportNotSupported=!1,e.docHeight=window.innerHeight,e.docHeight=e.docHeight-60,window.innerWidth>=1100?e.docWidth=window.innerWidth>1080?window.innerWidth-1080:0:window.innerWidth>=992?e.docWidth=window.innerWidth>990?window.innerWidth-990:0:window.innerWidth>=767?e.docWidth=window.innerWidth>720?window.innerWidth-720:0:e.reportNotSupported=!0,e.sideSpace=Math.floor(e.docWidth/2),"step1"==e.stepActive?e.$broadcast("resize"):"step3"==e.stepActive&&e.$broadcast("report-resize")}),e.$on("resize",function(a){function r(e){return function(){if(null!=document.getElementById("chartOptions"+e))for(var t=document.getElementById("chartOptions"+e).offsetWidth,a=document.getElementById("chartOptions"+e).offsetHeight,r=0;r<Highcharts.charts.length;r++)Highcharts.charts[r].container.parentElement.id.includes("chartRepeat"+e)&&(Highcharts.charts[r].setSize(t,a),Highcharts.charts[r].reflow())}}for(var o=0;o<e.customReport.widgets.length;o++)"reportParaWidget"==e.customReport.widgets[o].widgetType&&"reportHeadingWidget"==e.customReport.widgets[o].widgetType||t(r(o),10)}),e.$on("report-resize",function(a){t(function(){function a(e,t){return function(){if(null!=document.getElementById("reportChartOptions-"+e+"-"+t))for(var a=document.getElementById("reportChartOptions-"+e+"-"+t).offsetWidth,r=document.getElementById("reportChartOptions-"+e+"-"+t).offsetHeight,o=0;o<Highcharts.charts.length;o++)Highcharts.charts[o].container.parentElement.id.includes("reportChartRepeat-"+e+"-"+t)&&(Highcharts.charts[o].setSize(a,r),Highcharts.charts[o].reflow())}}for(var r in e.exportReportPages)for(var o in e.exportReportPages[r])"reportParaWidget"==e.exportReportPages[r][o].widgetType&&"reportHeadingWidget"==e.exportReportPages[r][o].widgetType||t(a(r,o),800)},10)}),e.summaryAlignLessThanThree=[],e.toDisplayAllSummary=[],e.checkAllGraphsZero=function(t,a){console.log("chart",t);for(var r=0,o=0;o<t.data.length;o++)0===t.data[o].summaryDisplay&&(r+=1);e.summaryAlignLessThanThree[a]=t.data.length-r,r===t.data.length&&(e.toDisplayAllSummary[a]=!0),console.log(" $scope.summaryAlignLessThanThree[widgetId]",e.summaryAlignLessThanThree[a],e.toDisplayAllSummary[a])},e.calculateRowHeight=function(e,t,a,r){e.showComparision=!1,a<6?t>6?e.showComparision=!1:e.showComparision=!0:t>12?e.showComparision=!1:e.showComparision=!0},e.disableTextEdit=function(e,t){e.textAreaHide=t,1==t&&a.$broadcast("updateWidgetDetailsInReport",{})},e.$on("updateWidgetDetailsInReport",function(t,a){var o=[];if(e.customReport.widgets.length>0){for(var s in e.customReport.widgets)"pageBreakWidget"==e.customReport.widgets[s].widgetType?o[s]={name:e.customReport.widgets[s].name,sizeY:e.customReport.widgets[s].sizeY,widgetType:e.customReport.widgets[s].widgetType,row:e.customReport.widgets[s].row,col:e.customReport.widgets[s].col,pageNumber:e.customReport.widgets[s].pageNumber}:(o[s]={widgetId:e.customReport.widgets[s].id,name:e.customReport.widgets[s].name,sizeY:e.customReport.widgets[s].sizeY,widgetType:e.customReport.widgets[s].widgetType,row:e.customReport.widgets[s].row,col:e.customReport.widgets[s].col,pageNumber:e.customReport.widgets[s].pageNumber},"reportParaWidget"==e.customReport.widgets[s].widgetType||"reportHeadingWidget"==e.customReport.widgets[s].widgetType?o[s].textData=e.customReport.widgets[s].textData||"":o[s].dashboardId=e.customReport.widgets[s].dashboardId),"undefined"!=e.customReport.widgets[s].isLastWidgetInPage&&1==e.customReport.widgets[s].isLastWidgetInPage&&(o[s].isLastWidgetInPage=!0,o[s].sizeFilledInPage=e.customReport.widgets[s].sizeFilledInPage,o[s].sizeLeftInPage=e.customReport.widgets[s].sizeLeftInPage),"undefined"!=e.customReport.widgets[s].isFirstWidgetInPage&&1==e.customReport.widgets[s].isFirstWidgetInPage&&(o[s].isFirstWidgetInPage=!0);var i={reportId:e.reportId,widgets:o};r({method:"POST",url:"/api/v1/create/reports",data:i}).then(function(e){toastr.info("Your changes have been saved successfully..!")},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something is missing! Please refresh the dashboard</span> .",html:!0})})}}),e.toggleLegends=function(t){for(var a in e.customReport.widgetData)if(e.customReport.widgetData[a].id==t)for(var r in e.customReport.widgetData[a].chart)"undefined"!=typeof e.customReport.widgetData[a].chart[r].options.chart.showLegend&&(1==e.customReport.widgetData[a].chart[r].options.chart.showLegend?e.customReport.widgetData[a].chart[r].options.chart.showLegend=!1:e.customReport.widgetData[a].chart[r].options.chart.showLegend=!0)}},a.populateReportWidgets=function(){e.customReport.widgets=[],e.customReport.widgetData={},e.totalPagesinReport=[],e.widgetDataLength=0;var t={widgets:e.dashboardWidgets};r({method:"POST",url:"/api/v1/get/reportWidgets/",timeout:c.promise,cancel:c,data:t}).then(function(t){if($(".dr-dates").attr("contenteditable","false"),t.data)if(t.data.error)isExportOptionSet=0,swal({title:"",text:'<span style = "sweetAlertFont">The requested Report has no widgets</span>',html:!0}),e.reportLoading=!1,e.stepActive="error";else if("null"==e.reportType)swal({title:"",text:'<span style = "sweetAlertFont">Something went wrong.Please try again later.</span>',html:!0}),e.reportLoading=!1,e.stepActive="error";else if("edited"==e.reportType){var r=[];angular.copy(e.reportWidgetsListArray,r);var o=[],s=[],i=t.data;i.length>0?(e.loadedWidgetCount=0,e.widgetsPresent=!0):e.widgetsPresent=!1;var l=[],c=[];angular.copy(i,o);var d=[],h=1;for(var p in r){if(d.push(r[p].pageNumber),"reportParaWidget"==r[p].widgetType)e.customReport.widgets.push({pageNumber:r[p].pageNumber,row:h,col:0,sizeY:"undefined"!=typeof r[p].sizeY?r[p].sizeY:4,sizeX:10,name:"undefined"!=typeof r[p].name?r[p].name:"Paragraph Widget",widgetType:"undefined"!=typeof r[p].widgetType?r[p].widgetType:"reportParaWidget",id:r[p].widgetId,textData:r[p].textData||"",textAreaHide:!0}),h+=r[p].sizeY;else if("reportHeadingWidget"==r[p].widgetType)e.customReport.widgets.push({pageNumber:r[p].pageNumber,row:h,col:0,sizeY:1,sizeX:10,name:"undefined"!=typeof r[p].name?r[p].name:"Heading Widget",
widgetType:"undefined"!=typeof r[p].widgetType?r[p].widgetType:"reportHeadingWidget",id:r[p].widgetId,textData:r[p].textData||"",textAreaHide:!0}),h+=1;else if("pageBreakWidget"==r[p].widgetType)e.customReport.widgets.push({pageNumber:r[p].pageNumber,row:h,col:0,sizeY:1,sizeX:10,widgetType:"pageBreakWidget",name:"undefined"!=typeof r[p].row?r[p].name:"Page break"}),h+=1;else{var g=o.map(function(e){return e._id}).indexOf(r[p].widgetId);if(g!=-1){var u=r[p].widgetId;l[u]=n.widgetHandler(o[g],{startDate:moment(e.dashboardCalendar.start_date).format("YYYY-MM-DD"),endDate:moment(e.dashboardCalendar.end_date).format("YYYY-MM-DD")},"public"),e.customReport.widgets.push({pageNumber:r[p].pageNumber,row:h,col:0,sizeY:"undefined"!=typeof r[p].sizeY?r[p].sizeY:8,sizeX:10,name:"undefined"!=typeof r[p].name?r[p].name:"",widgetType:"undefined"!=typeof r[p].widgetType?r[p].widgetType:"",id:r[p].widgetId,visibility:!1,channelName:"undefined"!=typeof o[g].channelName?o[g].channelName:"",dashboardId:"undefined"!=typeof r[p].dashboardId?r[p].dashboardId:""}),h+=r[p].sizeY,e.customReport.widgetData[u]={pageNumber:r[p].pageNumber,id:r[p].widgetId,chart:[],visibility:!1,name:"undefined"!=typeof r[p].name?r[p].name:"",color:"undefined"!=typeof o[g].color?o[g].color:""},e.widgetDataLength+=1,l[u].then(function(t){for(var a in e.customReport.widgetData)e.customReport.widgetData[a].id==t.id&&(e.customReport.widgetData[a]=t,isExportOptionSet=1,e.loadedWidgetCount++)},function(t){401===t.status?($("#widgetData-"+t.data.id).hide(),1003===t.data.errorstatusCode&&($("#widgetData-"+t.data.id).hide(),$("#errorWidgetData-"+t.data.id).hide(),$("#errorWidgetTokenexpire-"+t.data.id).show(),e.widgetErrorCode=1,e.loadedWidgetCount++,isExportOptionSet=0)):(e.loadedWidgetCount++,"undefined"!=typeof t.data.id&&($("#widgetData-"+t.data.id).hide(),$("#errorWidgetData-"+t.data.id).show(),$("#errorWidgetTokenexpire-"+t.data.id).hide(),isExportOptionSet=0))})}}if("undefined"!=r[p].isFirstWidgetInPage&&1==r[p].isFirstWidgetInPage){var m=e.customReport.widgets.length-1;e.customReport.widgets[m].isFirstWidgetInPage=!0,e.reportPagesDetails[r[p].pageNumber]={firstWidgetIndex:m}}if("undefined"!=r[p].isLastWidgetInPage&&1==r[p].isLastWidgetInPage){var m=e.customReport.widgets.length-1;e.reportPagesDetails[r[p].pageNumber]=e.reportPagesDetails[r[p].pageNumber]||{},e.reportPagesDetails[r[p].pageNumber].sizeFilled=r[p].sizeFilledInPage,e.reportPagesDetails[r[p].pageNumber].sizeLeft=r[p].sizeLeftInPage,e.reportPagesDetails[r[p].pageNumber].lastWidgetIndex=m,e.customReport.widgets[m].isLastWidgetInPage=!0,e.customReport.widgets[m].sizeFilledInPage=r[p].sizeFilledInPage,e.customReport.widgets[m].sizeLeftInPage=r[p].sizeLeftInPage}}e.reportLoading=!1}else{var o=[],s=[],i=t.data;for(p in i)1==i[p].visibility&&s.push(i[p]);s.length>0?(e.loadedWidgetCount=0,e.widgetsPresent=!0):e.widgetsPresent=!1;var l=[],c=[];angular.copy(s,o);var f=0,h=1;do{var b={sizeFilled:0,sizeLeft:5,widgetsCount:0};for(var p in o)if((o[p].size.h<2||"undefined"==typeof o[p].size)&&(o[p].size.h=2),o[p].size.h<=b.sizeLeft){var u=o[p]._id;if(l[u]=n.widgetHandler(o[p],{startDate:moment(e.dashboardCalendar.start_date).format("YYYY-MM-DD"),endDate:moment(e.dashboardCalendar.end_date).format("YYYY-MM-DD")},"public"),e.customReport.widgets.push({pageNumber:f,row:h,col:0,sizeY:"undefined"!=typeof o[p].size?2*o[p].size.h:4,sizeX:10,name:"undefined"!=typeof o[p].name?o[p].name:"",widgetType:"undefined"!=typeof o[p].widgetType?o[p].widgetType:"",id:o[p]._id,visibility:!1,channelName:"undefined"!=typeof o[p].channelName?o[p].channelName:"",dashboardId:"undefined"!=typeof o[p].dashboardId?o[p].dashboardId:""}),e.customReport.widgetData[u]={pageNumber:f,id:o[p]._id,chart:[],visibility:!1,name:"undefined"!=typeof o[p].name?o[p].name:"",color:"undefined"!=typeof o[p].color?o[p].color:""},e.widgetDataLength+=1,l[u].then(function(t){for(var a in e.customReport.widgetData)e.customReport.widgetData[a].id==t.id&&(e.customReport.widgetData[a]=t,isExportOptionSet=1,e.loadedWidgetCount++)},function(t){401===t.status?($("#widgetData-"+t.data.id).hide(),1003===t.data.errorstatusCode&&($("#widgetData-"+t.data.id).hide(),$("#errorWidgetData-"+t.data.id).hide(),$("#errorWidgetTokenexpire-"+t.data.id).show(),e.widgetErrorCode=1,e.loadedWidgetCount++,isExportOptionSet=0)):(e.loadedWidgetCount++,"undefined"!=typeof t.data.id&&($("#widgetData-"+t.data.id).hide(),$("#errorWidgetData-"+t.data.id).show(),$("#errorWidgetTokenexpire-"+t.data.id).hide(),isExportOptionSet=0))}),5==b.sizeLeft){var m=e.customReport.widgets.length-1;e.customReport.widgets[m].isFirstWidgetInPage=!0,e.reportPagesDetails[f]={firstWidgetIndex:m}}h+=2*o[p].size.h,b.sizeLeft-=o[p].size.h,b.sizeFilled+=o[p].size.h,++b.widgetsCount,o[p]=null}if(b.widgetsCount>0){var m=e.customReport.widgets.length-1;e.reportPagesDetails[f]=e.reportPagesDetails[f]||{},e.reportPagesDetails[f].sizeFilled=2*b.sizeFilled,e.reportPagesDetails[f].sizeLeft=2*b.sizeLeft,e.reportPagesDetails[f].lastWidgetIndex=m,e.customReport.widgets[m].isLastWidgetInPage=!0,e.customReport.widgets[m].sizeFilledInPage=2*b.sizeFilled,e.customReport.widgets[m].sizeLeftInPage=2*b.sizeLeft,e.customReport.widgets.push({pageNumber:f,row:h,col:0,sizeY:1,sizeX:10,widgetType:"pageBreakWidget",name:"Page Break"})}++h;for(var y=o.length,v=[],w=0;w<y;w++)null!=o[w]&&v.push(o[w]);o=[],o=v,c[f]=b,++f}while(o.length>0);e.reportLoading=!1,a.$broadcast("updateWidgetDetailsInReport",{})}else isExportOptionSet=0,swal({title:"",text:'<span style = "sweetAlertFont">The requested Report has been deleted</span>',html:!0}),e.reportLoading=!1,e.stepActive="error"},function(t){swal({title:"",text:'<span style = "sweetAlertFont">Error in populating widgets! Please refresh the Report again</span>',html:!0}),isExportOptionSet=0,e.reportLoading=!1,e.stepActive="error"})},e.arrangingWidgetsinReport=function(t,a,r){var o,s=l.defer(),i=r;if(void 0==e.reportPagesDetails[a])e.reportPagesDetails[a]={sizeFilled:1,sizeLeft:9,firstWidgetIndex:e.customReport.widgets.length,lastWidgetIndex:e.customReport.widgets.length},e.customReport.widgets.push({pageNumber:a,row:i+1,col:0,sizeY:1,sizeX:10,widgetType:"pageBreakWidget",name:"Avaliable Options"}),t.isFirstWidgetInPage=!0,t.isLastWidgetInPage=!0,t.sizeLeftInPage=9,t.sizeFilledInPage=1,o=e.customReport.widgets.length-1,s.resolve(o);else if(t.sizeY<=e.reportPagesDetails[a].sizeLeft){o=e.reportPagesDetails[a].firstWidgetIndex;var n=e.reportPagesDetails[a].lastWidgetIndex;e.reportPagesDetails[a].sizeLeft-=t.sizeY,e.reportPagesDetails[a].sizeFilled+=t.sizeY,++e.reportPagesDetails[a].lastWidgetIndex;for(var c=o;c<=n;c++)1==e.customReport.widgets[c].isLastWidgetInPage&&(e.customReport.widgets[n].sizeFilledInPage=e.reportPagesDetails[a].sizeFilled,e.customReport.widgets[n].sizeLeftInPage=e.reportPagesDetails[a].sizeLeft);t.isFirstWidgetInPage=!0,e.customReport.widgets[o].isFirstWidgetInPage=!1;for(var d=a+1;d<e.reportPagesDetails.length;d++)++e.reportPagesDetails[d].firstWidgetIndex,++e.reportPagesDetails[d].lastWidgetIndex;s.resolve(o)}else{o=e.reportPagesDetails[a].firstWidgetIndex;var h=a;t.isFirstWidgetInPage=!0,e.customReport.widgets[o].isFirstWidgetInPage=!1;var p=e.customReport.widgets.slice(o);p[0].row+=t.sizeY;var i=p[0].row,g={sizeFilled:1,sizeLeft:9,widgetsCount:0};e:do{var u;t:for(var m in p)if("pageBreakWidget"==p[m].widgetType){var f=e.customReport.widgets.map(function(e){return e}).indexOf(p[m]);f>-1&&(e.customReport.widgets.splice(f,1),p[m]=null)}else if(u=e.customReport.widgets.map(function(e){return e.id}).indexOf(p[m].id),u!=-1){if(!(p[m].sizeY<=g.sizeLeft)){e.reportPagesDetails[h]=e.reportPagesDetails[h]||{},e.reportPagesDetails[h].sizeFilled=g.sizeFilled,e.reportPagesDetails[h].sizeLeft=g.sizeLeft,e.reportPagesDetails[h].lastWidgetIndex=u,e.customReport.widgets[u-1].isLastWidgetInPage=!0,e.customReport.widgets[u-1].sizeFilledInPage=g.sizeFilled,e.customReport.widgets[u-1].sizeLeftInPage=g.sizeLeft,e.customReport.widgets.splice(u,0,{pageNumber:h,row:i,col:0,sizeY:1,sizeX:10,widgetType:"pageBreakWidget",name:"Avaliable Options"}),i+=1,g.newPage=!0;break t}if(p[m].pageNumber>h){e.reportPagesDetails[h]=e.reportPagesDetails[h]||{},e.reportPagesDetails[h].sizeFilled=g.sizeFilled,e.reportPagesDetails[h].sizeLeft=g.sizeLeft,e.reportPagesDetails[h].lastWidgetIndex=u-1,e.customReport.widgets[u-1].isLastWidgetInPage=!0,e.customReport.widgets[u-1].sizeFilledInPage=g.sizeFilled,e.customReport.widgets[u-1].sizeLeftInPage=g.sizeLeft,e.customReport.widgets.splice(u,0,{pageNumber:h,row:i,col:0,sizeY:1,sizeX:10,widgetType:"pageBreakWidget",name:"Avaliable Options"}),i+=1;for(var d=p[m].pageNumber;d<e.reportPagesDetails.length;d++)++e.reportPagesDetails[d].firstWidgetIndex,++e.reportPagesDetails[d].lastWidgetIndex;break e}e.customReport.widgets[u].row=i,1==e.customReport.widgets[u].isLastWidgetInPage&&(e.customReport.widgets[u].isLastWidgetInPage=!1),1==e.customReport.widgets[u].isFirstWidgetInPage&&(e.customReport.widgets[u].isFirstWidgetInPage=!1),e.customReport.widgets[u].pageNumber=h,10==g.sizeLeft&&(e.customReport.widgets[u].isFirstWidgetInPage=!0,e.reportPagesDetails[h]={firstWidgetIndex:u+1}),i+=p[m].sizeY,g.sizeLeft-=p[m].sizeY,g.sizeFilled+=p[m].sizeY,g.newPage=!1,++g.widgetsCount,p[m]=null}var b=p.length,y=[];"undefined"!=g.newPage&&1!=g.newPage&&(e.reportPagesDetails[h]=e.reportPagesDetails[h]||{},e.reportPagesDetails[h].sizeFilled=g.sizeFilled,e.reportPagesDetails[h].sizeLeft=g.sizeLeft,e.reportPagesDetails[h].lastWidgetIndex=u+1,e.customReport.widgets[u].isLastWidgetInPage=!0,e.customReport.widgets[u].sizeFilledInPage=g.sizeFilled,e.customReport.widgets[u].sizeLeftInPage=g.sizeLeft,e.customReport.widgets.splice(u+1,0,{pageNumber:h,row:i,col:0,sizeY:1,sizeX:10,widgetType:"pageBreakWidget",name:"Avaliable Options"}),i+=1);for(var v=0;v<b;v++)null!=p[v]&&y.push(p[v]);p=[],p=y,++h,g={sizeFilled:0,sizeLeft:10,widgetsCount:0}}while(p.length>0);e.$broadcast("resize"),s.resolve(o)}return s.promise},e.addTextWidget=function(o,s,i,n){var c=[],d=n,h=[];angular.copy(e.customReport.widgets,h),"reportParaWidget"==o?c.push({reportId:e.reportId,row:d,col:0,sizeY:1,sizeX:10,widgetType:o,name:"Paragraph Widget",textData:""}):c.push({reportId:e.reportId,row:d,col:0,sizeY:1,sizeX:10,widgetType:o,name:"Heading Widget",textData:""}),r({method:"POST",url:"/api/v1/create/textWidgets",data:c}).then(function(r){var i,n={id:r.data.widgetsList[0]._id,pageNumber:s,row:d,col:0,sizeY:c[0].sizeY,sizeX:10,widgetType:o,name:c[0].name,textData:"",textAreaHide:!1},p=[];p.push(e.arrangingWidgetsinReport(n,s,d)),l.all(p).then(function(r){function o(){a.$broadcast("updateWidgetDetailsInReport",{widgets:e.customReport.widgets})}i=r[0],e.customReport.widgets.splice(i,0,n),t(o,2e3)},function(r){function o(){a.$broadcast("updateWidgetDetailsInReport",{widgets:e.customReport.widgets})}e.customReport.widgets=h,t(o,2e3),swal({title:"",text:"<span style='sweetAlertFont'>Cannot Insert Widget at this moment! Please refresh the report</span> .",html:!0}),e.populateReportWidgets()})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something is missing! Cannot Insert Widget at this moment!</span> .",html:!0})})},e.deleteWidgetFromReport=function(r){var o=r.pageNumber,s=e.customReport.widgets.indexOf(r);e.reportPagesDetails[o].sizeLeft+=r.sizeY,e.reportPagesDetails[o].sizeFilled-=r.sizeY,e.customReport.widgets.splice(s,1),e.reportPagesDetails[o].lastWidgetIndex>0&&--e.reportPagesDetails[o].lastWidgetIndex;var i;i=s;var n=e.reportPagesDetails[o].lastWidgetIndex;if("pageBreakWidget"!=e.customReport.widgets[n].widgetType&&(e.customReport.widgets[n].sizeFilledInPage=e.reportPagesDetails[o].sizeFilled,e.customReport.widgets[n].sizeLeftInPage=e.reportPagesDetails[o].sizeLeft),0==e.reportPagesDetails[o].sizeFilled||10==e.reportPagesDetails[o].sizeLeft){if("pageBreakWidget"==e.customReport.widgets[s].widgetType){e.customReport.widgets.splice(s,1),e.reportPagesDetails.splice(o,1);for(var l=s;l<e.customReport.widgets.length;l++)e.customReport.widgets[l].pageNumber-=1;for(var c=o;c<e.reportPagesDetails.length;c++)e.reportPagesDetails[c].firstWidgetIndex-=2,e.reportPagesDetails[c].lastWidgetIndex-=2}}else{1==r.isLastWidgetInPage&&(e.customReport.widgets[n].isLastWidgetInPage=!0),1==r.isFirstWidgetInPage&&(e.customReport.widgets[i].isFirstWidgetInPage=!0);for(var c=o+1;c<e.reportPagesDetails.length;c++)--e.reportPagesDetails[c].firstWidgetIndex,--e.reportPagesDetails[c].lastWidgetIndex}t(function(){a.$broadcast("updateWidgetDetailsInReport",{})},3e3),"reportHeadingWidget"==r.widgetType||"reportParaWidget"==r.widgetType?e.deleteWidgetInDB(r):(delete e.customReport.widgetData[r.id],e.loadedWidgetCount-=1,e.widgetDataLength-=1)},e.deleteWidgetInDB=function(e){e.widgetType,e.id;r({method:"POST",url:"/api/v1/delete/textWidgets/"+e.id}).then(function(e){},function(e){swal({title:"",text:'<span style = "sweetAlertFont">Error in deleting the widget! Please try again</span>',html:!0})})},e.changeReportName=function(){var t={reportId:e.reportId,name:e.customReport.reportName};r({method:"POST",url:"/api/v1/create/reports",data:t}).then(function(e){},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Error in changing the name! Please try again</span> .",html:!0})})},e.changeFooterText=function(t){e.displayDate=t},e.changeHeaderText=function(t){e.displayHeader=t},e.swapArrayElements=function(t,a){var r=e.customReport.widgets[t];e.customReport.widgets[t]=e.customReport.widgets[a],e.customReport.widgets[a]=r},e.pushUpWidget=function(a,r){var o={};angular.copy(a,o);var s=o.pageNumber,r=r;if(1==o.isFirstWidgetInPage){var i=e.reportPagesDetails[s-1].lastWidgetIndex;if(e.reportPagesDetails[s-1].sizeLeft>=o.sizeY){e.customReport.widgets[r].pageNumber-=1,e.customReport.widgets[r].row=e.customReport.widgets[r-1].row,e.customReport.widgets[r].isFirstWidgetInPage=!1,e.reportPagesDetails[s-1].sizeFilled+=o.sizeY,e.reportPagesDetails[s-1].sizeLeft-=o.sizeY;var n=e.reportPagesDetails[s-1].lastWidgetIndex;if(e.customReport.widgets[n].isLastWidgetInPage=!1,e.reportPagesDetails[s-1].lastWidgetIndex+=1,e.customReport.widgets[r].sizeFilledInPage=e.reportPagesDetails[s-1].sizeFilled,e.customReport.widgets[r].sizeLeftInPage=e.reportPagesDetails[s-1].sizeLeft,e.customReport.widgets[r].isLastWidgetInPage=!0,e.swapArrayElements(r,r-1),1==o.isLastWidgetInPage||e.reportPagesDetails[s].sizeFilled==o.sizeY){if("pageBreakWidget"==e.customReport.widgets[r+1].widgetType){e.customReport.widgets.splice(r+1,1),e.reportPagesDetails.splice(s,1);for(var l=r+1;l<e.customReport.widgets.length;l++)e.customReport.widgets[l].pageNumber-=1;for(var c=s;c<e.reportPagesDetails.length;c++)e.reportPagesDetails[c].firstWidgetIndex-=1,e.reportPagesDetails[c].lastWidgetIndex-=1}}else{var d=e.reportPagesDetails[s].lastWidgetIndex;e.reportPagesDetails[s].firstWidgetIndex+=1;var h=e.reportPagesDetails[s].firstWidgetIndex;e.reportPagesDetails[s].sizeLeft+=o.sizeY,e.reportPagesDetails[s].sizeFilled-=o.sizeY,e.customReport.widgets[h].isFirstWidgetInPage=!0,e.customReport.widgets[d].sizeFilledInPage=e.reportPagesDetails[s].sizeFilled,e.customReport.widgets[d].sizeLeftInPage=e.reportPagesDetails[s].sizeLeft}}else if(e.customReport.widgets[i].sizeY==o.sizeY){void 0!=e.customReport.widgets[i].isFirstWidgetInPage&&1==e.customReport.widgets[i].isFirstWidgetInPage||(e.customReport.widgets[r].isFirstWidgetInPage=!1),e.customReport.widgets[i].isFirstWidgetInPage=!0,e.customReport.widgets[i].isLastWidgetInPage=!1,1==o.isLastWidgetInPage&&(e.customReport.widgets[i].sizeFilledInPage=e.customReport.widgets[r].sizeFilledInPage||e.reportPagesDetails[s].sizeFilled,e.customReport.widgets[i].sizeLeftInPage=e.customReport.widgets[r].sizeLeftInPage||e.reportPagesDetails[s].sizeLeft,e.customReport.widgets[i].isLastWidgetInPage=!0),e.customReport.widgets[r].sizeFilledInPage=e.reportPagesDetails[s].sizeFilled,e.customReport.widgets[r].sizeLeftInPage=e.reportPagesDetails[s].sizeLeft,e.customReport.widgets[r].isLastWidgetInPage=!0,e.customReport.widgets[r].pageNumber-=1,e.customReport.widgets[i].pageNumber+=1;var p=e.customReport.widgets[r].row;e.customReport.widgets[r].row=e.customReport.widgets[i].row,e.swapArrayElements(r,i),t(function(){e.customReport.widgets[r-1].row=p-1,e.customReport.widgets[r].row=p},800)}else toastr.info("Sorry..! This widget can neither be pushed nor swapped at the moment")}else{1==o.isLastWidgetInPage&&(e.customReport.widgets[r-1].isLastWidgetInPage=!0,e.customReport.widgets[r-1].sizeFilledInPage=e.customReport.widgets[r].sizeFilledInPage||e.reportPagesDetails[s].sizeFilled,e.customReport.widgets[r-1].sizeLeftInPage=e.customReport.widgets[r].sizeLeftInPage||e.reportPagesDetails[s].sizeLeft,e.customReport.widgets[r].isLastWidgetInPage=!1),1==e.customReport.widgets[r-1].isFirstWidgetInPage&&(e.customReport.widgets[r].isFirstWidgetInPage=!0,e.customReport.widgets[r-1].isFirstWidgetInPage=!1);var p=e.customReport.widgets[r].row;e.customReport.widgets[r].sizeY==e.customReport.widgets[r-1].sizeY?(e.customReport.widgets[r].row=e.customReport.widgets[r-1].row,e.customReport.widgets[r-1].row=p):e.customReport.widgets[r].row=e.customReport.widgets[r-1].row,e.swapArrayElements(r,r-1)}},e.pullDownWidget=function(a,r){var o={};angular.copy(a,o);var r=r,s=o.pageNumber;if(1==o.isLastWidgetInPage){var i=e.reportPagesDetails[s+1].firstWidgetIndex;if(e.reportPagesDetails[s+1].sizeLeft>=o.sizeY){e.customReport.widgets[r].pageNumber+=1,e.customReport.widgets[r+1].row=e.customReport.widgets[r].row,e.customReport.widgets[r].isLastWidgetInPage=!1,e.customReport.widgets[r].isFirstWidgetInPage=!0,e.customReport.widgets[i].isFirstWidgetInPage=!1,e.reportPagesDetails[s+1].firstWidgetIndex-=1,e.swapArrayElements(r,r+1),e.reportPagesDetails[s+1].sizeLeft-=o.sizeY,e.reportPagesDetails[s+1].sizeFilled+=o.sizeY;var n=e.reportPagesDetails[s+1].lastWidgetIndex;if(e.customReport.widgets[n].sizeFilledInPage=e.reportPagesDetails[s+1].sizeFilled,e.customReport.widgets[n].sizeLeftInPage=e.reportPagesDetails[s+1].sizeLeft,1==o.isFirstWidgetInPage||e.reportPagesDetails[s].sizeFilled==o.sizeY){if("pageBreakWidget"==e.customReport.widgets[r].widgetType){e.customReport.widgets.splice(r,1),e.reportPagesDetails.splice(s,1);for(var l=r;l<e.customReport.widgets.length;l++)e.customReport.widgets[l].pageNumber-=1;for(var c=s;c<e.reportPagesDetails.length;c++)e.reportPagesDetails[c].firstWidgetIndex-=1,e.reportPagesDetails[c].lastWidgetIndex-=1}}else{e.reportPagesDetails[s].lastWidgetIndex-=1;var n=e.reportPagesDetails[s].lastWidgetIndex;e.reportPagesDetails[s].sizeLeft+=o.sizeY,e.reportPagesDetails[s].sizeFilled-=o.sizeY,e.customReport.widgets[n].isLastWidgetInPage=!0,e.customReport.widgets[n].sizeFilledInPage=e.reportPagesDetails[s].sizeFilled,e.customReport.widgets[n].sizeLeftInPage=e.reportPagesDetails[s].sizeLeft}}else if(e.customReport.widgets[i].sizeY==o.sizeY){void 0!=e.customReport.widgets[r].isFirstWidgetInPage&&1==e.customReport.widgets[r].isFirstWidgetInPage||(e.customReport.widgets[i].isFirstWidgetInPage=!1),e.customReport.widgets[r].isFirstWidgetInPage=!0,e.customReport.widgets[r].isLastWidgetInPage=!1,1==e.customReport.widgets[i].isLastWidgetInPage&&(e.customReport.widgets[r].sizeFilledInPage=e.customReport.widgets[i].sizeFilledInPage||e.reportPagesDetails[s+1].sizeFilled,e.customReport.widgets[r].sizeLeftInPage=e.customReport.widgets[i].sizeLeftInPage||e.reportPagesDetails[s+1].sizeLeft,e.customReport.widgets[r].isLastWidgetInPage=!0),e.customReport.widgets[i].sizeFilledInPage=e.reportPagesDetails[s].sizeFilled,e.customReport.widgets[i].sizeLeftInPage=e.reportPagesDetails[s].sizeLeft,e.customReport.widgets[i].isLastWidgetInPage=!0,e.customReport.widgets[r].pageNumber+=1,e.customReport.widgets[i].pageNumber-=1;var d=e.customReport.widgets[r].row;e.customReport.widgets[r].row=e.customReport.widgets[i].row,e.swapArrayElements(r,i),t(function(){e.customReport.widgets[r].row=d},800)}else toastr.info("Sorry..! This widget can neither be pulled nor swapped at the moment")}else{if(1==o.isFirstWidgetInPage&&(e.customReport.widgets[r+1].isFirstWidgetInPage=!0,e.customReport.widgets[r].isFirstWidgetInPage=!1),1==e.customReport.widgets[r+1].isLastWidgetInPage&&(e.customReport.widgets[r].isLastWidgetInPage=!0,e.customReport.widgets[r].sizeFilledInPage=e.customReport.widgets[r+1].sizeFilledInPage||e.reportPagesDetails[s].sizeFilled,e.customReport.widgets[r].sizeLeftInPage=e.customReport.widgets[r+1].sizeLeftInPage||e.reportPagesDetails[s].sizeLeft,e.customReport.widgets[r+1].isLastWidgetInPage=!1),e.customReport.widgets[r].sizeY==e.customReport.widgets[r+1].sizeY){var d=e.customReport.widgets[r+1].row;e.customReport.widgets[r+1].row=e.customReport.widgets[r].row,e.customReport.widgets[r].row=d}else{var d=e.customReport.widgets[r].row;e.customReport.widgets[r+1].row=d,e.customReport.widgets[r].row=d+e.customReport.widgets[r+1].sizeY}e.swapArrayElements(r,r+1)}}}function CustomWidgetController(e,t){e.remove=function(t){e.dashboard.widgets.splice(e.dashboard.widgets.indexOf(t),1)},e.openSettings=function(a){t.open({scope:e,backdrop:!0,templateUrl:"fusion_settings.ejs",controller:"FusionSettingsController",resolve:{widget:function(){return a}}})}}function DashboardController(e,t,a,r,o,s,i,n,l,c){a.availableBasicWidgets,e.loading=!1,e.$window=o,e.autoArrangeGrid=!1,e.dashbd={widgets:[],widgetData:[]},e.dashbd.dashboardName="",e.widgetErrorCode=0,e.actionTypeEnable={},e.submitEnable={},e.messageEnable={};var d,h=l.defer();e.currentDate=moment(new Date).format("YYYY-DD-MM"),e.widgetsize=function(e){if(1==e)return{float:"left"}},e.stateValidation=function(e){switch(e){case"basicWidget":if(s.includes("app.reporting.dashboard")){toastr.options.closeButton=!0,toastr.options.positionClass="toast-top-right",r({method:"GET",url:"/api/v1/subscriptionLimits?requestType=basic"}).then(function(t){a.availableBasicWidgets=t.data.availableWidgets,1==t.data.isExpired?toastr.info("Please renew!"):a.availableBasicWidgets<=0?toastr.info("You have reached your Widgets limit. Please upgrade to enjoy more Widgets"):s.go("app.reporting.dashboard."+e,{widgetType:"basic"})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try Again</span> .",html:!0})})}else toastr.info("Please perform this action from within a dashboard");break;case"fusionWidget":s.includes("app.reporting.dashboard")?(toastr.options.closeButton=!0,toastr.options.positionClass="toast-top-right",r({method:"GET",url:"/api/v1/subscriptionLimits?requestType=fusion"}).then(function(t){availableFusionWidgets=t.data.availableWidgets,1==t.data.isExpired?toastr.info("Please renew !"):availableFusionWidgets<=0?toastr.info("You have reached your Fusions limit. Please upgrade to enjoy more Fusions"):s.go("app.reporting.dashboard."+e)},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again</span> .",html:!0})})):toastr.info("Please perform this action from within a dashboard")}},e.summaryAlignLessThanThree=[],e.toDisplayAllSummary=[],e.checkAllGraphsZero=function(t,a,r){void 0==e.summaryAlignLessThanThree[a]&&(e.summaryAlignLessThanThree[a]=[]),void 0==e.toDisplayAllSummary[a]&&(e.toDisplayAllSummary[a]=[]);for(var o=0,s=0;s<t.data.length;s++)0===t.data[s].summaryDisplay&&(o+=1);e.summaryAlignLessThanThree[a][r]=t.data.length-o,o===t.data.length&&(e.toDisplayAllSummary[a][r]=!0)};var p="";$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),e.dashboardConfiguration=function(){e.fetchDateForDashboard=function(){r({method:"GET",url:"/api/v1/getSubscriptionFromDashboard/"+s.params.id}).then(function(t){200==t.status?(d=t.data.response.limits.dateRange,e.userModifyDate(d)):e.userModifyDate(365)})},e.fetchDateForDashboard(),e.userModifyDate=function(t){e.dashboardCalendar=new Calendar({element:$(".daterange--double"),earliest_date:moment(new Date).subtract(t,"days"),latest_date:new Date,latest_date:new Date,start_date:moment(new Date).subtract(30,"days"),end_date:new Date,callback:function(){moment(this.start_date).format("ll"),moment(this.end_date).format("ll");r.pendingRequests.forEach(function(e){e.cancel&&e.cancel.resolve()}),e.populateDashboardWidgets()}}),e.fetchDashboardName()},e.fetchDashboardName=function(){r({method:"GET",url:"/api/v1/get/dashboards/"+s.params.id+"?buster="+new Date}).then(function(t){"200"==t.status?(e.dashboard.dashboardName=t.data.name,a.populateDashboardWidgets()):e.dashboard.dashboardName=null,r({method:"GET",url:"/api/v1/getUserActivityDetails/"}).then(function(t){"undefined"!=typeof t.data.isFirstTimeLogin&&1==t.data.isFirstTimeLogin&&e.CallMe()},function(e){swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please reload the dashboard</span>',html:!0})})},function(t){e.dashboard.dashboardName=null,swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please reload the dashboard</span>',html:!0})})},e.changeDashboardName=function(){var t={dashboardId:s.params.id,name:e.dashboard.dashboardName};r({method:"POST",url:"/api/v1/create/dashboards",data:t}).then(function(e){"200"==e.status&&a.fetchRecentDashboards()},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Error in changing the name! Please try again</span> .",html:!0})})},e.docHeight=window.innerHeight,e.docHeight=e.docHeight-110,e.dashboard={widgets:[],widgetData:[]},e.dashboard.dashboardName="",e.widgetsPresent=!0,e.spinerEnable=!0,e.loadedWidgetCount=0,e.widgetErrorCode=0,e.setChartSize=function(e,a){function r(){if(null!=document.getElementById("chartOptions"+e)){var t=document.getElementById("chartOptions"+e).offsetWidth,r=document.getElementById("chartOptions"+e).offsetHeight;document.getElementById("chartRepeat"+e+"-"+a).style.height=r+"px",document.getElementById("chartRepeat"+e+"-"+a).style.width=t+"px"}}t(r,100)},e.gridsterOptions={sparse:!0,margins:[20,20],maxRows:500,columns:6,defaultSizeX:2,defaultSizeY:2,minSizeX:1,minSizeY:1,swapping:!0,floating:!0,pushing:!0,width:"auto",colWidth:"auto",draggable:{enabled:!0,handle:".box-header",stop:function(e,t,r){a.$broadcast("storeGridStructure",{})}},outerMargin:!0,mobileBreakPoint:700,mobileModeEnabled:!0,resizable:{enabled:!0,handles:["se"],start:function(e,t,a){var r=$("#getWidgetColor-"+a.id).attr("ref");""==r&&(r="#288DC0"),$(".getBox-"+a.id).css("border","3px solid "+r)},resize:function(t,a,r){var o=$("#getWidgetColor-"+r.id).attr("ref");""==o&&(o="#288DC0"),$(".getBox-"+r.id).css("border","3px solid "+o);var s=e.dashboard.widgets.indexOf(r);if(null!=document.getElementById("chartOptions"+s))for(var i=document.getElementById("chartOptions"+s).offsetWidth,n=document.getElementById("chartOptions"+s).offsetHeight,l=0;l<Highcharts.charts.length;l++)Highcharts.charts[l].container.parentElement.id.includes("chartRepeat"+s)&&(Highcharts.charts[l].setSize(i,n),Highcharts.charts[l].reflow())},stop:function(r,o,s){function i(t){return function(){for(var a=e.dashboard.widgets.indexOf(t),r=0;r<e.dashboard.widgetData[a].chart.length;r++)if("visitorAcquisitionEfficiency"===e.dashboard.widgetData[a].chart[r].options.chart.type||"lineChart"===e.dashboard.widgetData[a].chart[r].options.chart.type||"pieChart"===e.dashboard.widgetData[a].chart[r].options.chart.type||"multiBarChart"===e.dashboard.widgetData[a].chart[r].options.chart.type||"multiChart"===e.dashboard.widgetData[a].chart[r].options.chart.type)for(var o=0;o<e.dashboard.widgetData[a].chart[r].data.length;o++){if("visitorAcquisitionEfficiency"===e.dashboard.widgetData[a].chart[r].options.chart.type)var s=0;else var s=document.getElementById("li-"+t.id+"-"+String(o)).offsetHeight;e.dashboard.widgetData[a].chart[r].data[o].myheight=s}var a=e.dashboard.widgets.indexOf(t);if(null!=document.getElementById("chartOptions"+a))for(var i=document.getElementById("chartOptions"+a).offsetWidth,n=document.getElementById("chartOptions"+a).offsetHeight,r=0;r<Highcharts.charts.length;r++)Highcharts.charts[r].container.parentElement.id.includes("chartRepeat"+a)&&(Highcharts.charts[r].setSize(i,n),Highcharts.charts[r].reflow())}}$(".getBox-"+s.id).css("border","1px solid #ccc"),a.$broadcast("storeGridStructure",{}),t(i(s),400)}}},e.changeWidgetName=function(e,t){var a=[],o={dashboardId:s.params.id,widgetId:e.id,name:t};a.push(o),r({method:"POST",url:"/api/v1/update/widgets",data:a}).then(function(e){},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Error in changing the name! Please try again</span> .",html:!0})})},e.$on("gridster-resized",function(a,r,o){function s(e){return function(){if(null!=document.getElementById("chartOptions"+e))for(var t=document.getElementById("chartOptions"+e).offsetWidth,a=document.getElementById("chartOptions"+e).offsetHeight,r=0;r<Highcharts.charts.length;r++)Highcharts.charts[r].container.parentElement.id.includes("chartRepeat"+e)&&(Highcharts.charts[r].setSize(t,a),Highcharts.charts[r].reflow())}}for(var i=0;i<e.dashboard.widgets.length;i++)t(s(i),10)}),e.$on("gridster-mobile-changed",function(t,a){e.isMobile=a.isMobile}),e.$on("storeGridStructure",function(t){var a=[];if(0!=e.dashboard.widgets.length){for(var o in e.dashboard.widgets){var i={dashboardId:s.params.id,widgetId:e.dashboard.widgets[o].id,name:e.dashboard.widgets[o].name,row:e.dashboard.widgets[o].row,col:e.dashboard.widgets[o].col,size:{h:e.dashboard.widgets[o].sizeY,w:e.dashboard.widgets[o].sizeX},minSize:{h:e.dashboard.widgets[o].minSizeY,w:e.dashboard.widgets[o].minSizeX},maxSize:{h:e.dashboard.widgets[o].maxSizeY,w:e.dashboard.widgets[o].maxSizeX}};a.push(i)}r({method:"POST",url:"/api/v1/widgets",data:a}).then(function(t){for(var a=0;a<e.dashboard.widgetData.length;a++)0===e.dashboard.widgetData[a].chart.length&&0==e.dashboard.widgetData[a].visibility&&(e.dashboard.widgetData[a].dataerror===!0?($("#widgetData-"+e.dashboard.widgetData[a].id).hide(),$("#errorWidgetData-"+e.dashboard.widgetData[a].id).hide(),$("#errorWidgetTokenexpire-"+e.dashboard.widgetData[a].id).show()):e.loadedWidgetCount!=e.dashboard.widgets.length?($("#widgetData-"+e.dashboard.widgetData[a].id).hide(),$("#errorWidgetData-"+e.dashboard.widgetData[a].id).hide(),$("#errorWidgetTokenexpire-"+e.dashboard.widgetData[a].id).hide()):($("#widgetData-"+e.dashboard.widgetData[a].id).hide(),$("#errorWidgetData-"+e.dashboard.widgetData[a].id).show(),$("#errorWidgetTokenexpire-"+e.dashboard.widgetData[a].id).hide()))},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something is missing! Please refresh the dashboard</span> .",html:!0})})}}),angular.element(o).on("resize",function(t){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-110,e.$broadcast("resize")}),e.$on("resize",function(a){function r(e){return function(){if(null!=document.getElementById("chartOptions"+e))for(var t=document.getElementById("chartOptions"+e).offsetWidth,a=document.getElementById("chartOptions"+e).offsetHeight,r=0;r<Highcharts.charts.length;r++)Highcharts.charts[r].container.parentElement.id.includes("chartRepeat"+e)&&(Highcharts.charts[r].setSize(t,a),Highcharts.charts[r].reflow())}}for(var o=0;o<e.dashboard.widgets.length;o++)t(r(o),10)}),e.calculateColumnWidth=function(e,t,a){return t=Math.floor(t/a),t<1&&(t=1),1==t?"col-sm-12 col-md-12 col-lg-12":2==t?e<=2?"col-sm-12 col-md-12 col-lg-12":"col-sm-6 col-md-6 col-lg-6":e<=2?"col-sm-12 col-md-12 col-lg-12":e>2&&e<=4?"col-sm-6 col-md-6 col-lg-6":"col-sm-4 col-md-4 col-lg-4"},e.calculateColumnWidthMoz=function(e,t,a){return 1==t?"col-sm-12 col-md-12 col-lg-12":t>=2&&t<=4?"col-sm-4 col-md-4 col-lg-4":t>=5?"col-sm-2 col-md-2 col-lg-2":void 0},e.calculateRowHeight=function(e,t,a,r,o){e.showComparision=!0},e.calculateSummaryHeight=function(e,t){var a;return a=1==t&&1==e?20:100/e,{height:a+"%"}},e.calculateSummaryHeightMoz=function(e,t){var a;return a=1==e?20:70/e,{height:a+"%"}},e.calculateChartHeight=function(a,r,o){t(function(){var t;t=1==r&&1==a?80:100-100/a,e.chartOptions=t+"%";var s=document.getElementById("updateHeight"+o);s.style.margin="0px",s.style.height=t+"%";
},1e3)}},e.getActionType=function(t,a){if(t.length){var r,o,s=[];e.actionTypeEnable[a]=!0;for(var i=0;i<t.length;i++){var n={};r=t[i],o=r.replace("_"," "),n.name=o,n.meta=t[i],s.push(n)}e.actionTypeList=s}else e.actionTypeEnable[a]=!1,e.messageEnable[a]=!0},e.saveMeta=function(t,a){a?e.submitEnable[t]=!0:e.submitEnable[t]=!1},e.reloadDashboard=function(t,o){e.actionTypeEnable[t]=!1,e.submitEnable[t]=!1;var s={method:"GET",url:"/api/v1/widget/"+t+"?meta="+o.meta+"&buster="+new Date};r(s).then(function(r){var o=e.dashboard.widgets.map(function(e){return e.id}).indexOf(t);e.dashboard.widgets.splice(o,1),e.dashboard.widgetData.splice(o,1),a.$broadcast("populateWidget",r.data)},function(){swal({title:"",text:'<span style = "sweetAlertFont">Error in saving the configuration. Please try again</span>',html:!0})})},a.populateDashboardWidgets=function(){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),p=0,e.dashboard.widgets=[],e.dashboard.widgetData=[],e.dashboard.dashoboardDate=[],e.dashboard.dashoboardDate={startDate:moment(e.dashboardCalendar.start_date).format("YYYY-MM-DD"),endDate:moment(e.dashboardCalendar.end_date).format("YYYY-MM-DD")},r({method:"GET",url:"/api/v1/dashboards/widgets/"+s.params.id+"?buster="+new Date,timeout:h.promise,cancel:h}).then(function(t){var a=[],r=t.data.widgetsList;for(i in r)1==r[i].visibility&&a.push(r[i]);a.length>0?(e.loadedWidgetCount=0,e.widgetsPresent=!0,e.spinerEnable=!1):(e.widgetsPresent=!1,e.spinerEnable=!1);var o=[],s=0;for(var i in a){o.push(n.widgetHandler(a[i],{startDate:moment(e.dashboardCalendar.start_date).format("YYYY-MM-DD"),endDate:moment(e.dashboardCalendar.end_date).format("YYYY-MM-DD")})),e.dashboard.widgets.push({row:"undefined"!=typeof a[i].row?a[i].row:s,col:"undefined"!=typeof a[i].col?a[i].col:0,sizeY:"undefined"!=typeof a[i].size?a[i].size.h:2,sizeX:"undefined"!=typeof a[i].size?a[i].size.w:2,minSizeY:"undefined"!=typeof a[i].minSize?a[i].minSize.h:1,minSizeX:"undefined"!=typeof a[i].minSize?a[i].minSize.w:1,maxSizeY:"undefined"!=typeof a[i].maxSize?a[i].maxSize.h:3,maxSizeX:"undefined"!=typeof a[i].maxSize?a[i].maxSize.w:3,name:"undefined"!=typeof a[i].name?a[i].name:"",widgetType:"undefined"!=typeof a[i].widgetType?a[i].widgetType:"",isAlert:"undefined"!=typeof a[i].isAlert&&a[i].isAlert,isFusion:"undefined"==typeof a[i].isFusion||a[i].isFusion,id:a[i]._id,visibility:!1,channelName:"undefined"!=typeof a[i].channelName?a[i].channelName:""}),e.dashboard.widgetData.push({id:a[i]._id,chart:[],visibility:!1,dataerror:!1,name:"undefined"!=typeof a[i].name?a[i].name:"",color:"undefined"!=typeof a[i].color?a[i].color:""});var l="undefined"!=typeof a[i].size?a[i].size.h:2;s+=l,o[i].then(function(t){var a=e.dashboard.widgets.map(function(e){return e.id}).indexOf(t.id);e.dashboard.widgetData[a]=t,p=1,e.loadedWidgetCount++},function(t){if(401===t.status)1003===t.data.errorstatusCode&&(k=e.dashboard.widgetData.map(function(e){return e.id}).indexOf(t.data.id),k!==-1&&(e.dashboard.widgetData[k].dataerror=!0),$("#widgetData-"+t.data.id).hide(),$("#errorWidgetData-"+t.data.id).hide(),$("#errorGatewayTimeout-"+a).hide(),$("#errorWidgetTokenexpire-"+t.data.id).show(),e.widgetErrorCode=1,e.loadedWidgetCount++,p=0);else if(e.loadedWidgetCount++,null!=t.data&&"undefined"!=typeof t.data)if("undefined"!=typeof t.data.id)$("#widgetData-"+t.data.id).hide(),$("#errorWidgetData-"+t.data.id).show(),$("#errorGatewayTimeout-"+a).hide(),$("#errorWidgetTokenexpire-"+t.data.id).hide(),p=0;else if(504===t.status&&"undefined"!=typeof t.config.data.widId){var a=t.config.data.widId;$("#widgetData-"+a).hide(),$("#errorWidgetData-"+a).hide(),$("#errorGatewayTimeout-"+a).show(),$("#errorWidgetTokenexpire-"+a).hide(),p=0}})}},function(e){e.status!=-1&&swal({title:"",text:'<span style = "sweetAlertFont">Error in populating widgets! Please refresh the dashboard again</span>',html:!0}),p=0})},e.$on("populateWidget",function(t,a){if("customFusion"===a.widgetType)for(var r=0;r<a.widgets.length;r++){var o=e.dashboard.widgets.map(function(e){return e.id}).indexOf(a.widgets[r].widgetId);e.dashboard.widgets.splice(o,1),e.dashboard.widgetData.splice(o,1)}var s=[];s.push(n.widgetHandler(a,{startDate:moment(e.dashboardCalendar.start_date).format("YYYY-MM-DD"),endDate:moment(e.dashboardCalendar.end_date).format("YYYY-MM-DD")})),e.widgetsPresent=!0,e.dashboard.widgets.push({row:"undefined"!=typeof a.row?a.row:0,col:"undefined"!=typeof a.col?a.col:0,sizeY:"undefined"!=typeof a.size?a.size.h:2,sizeX:"undefined"!=typeof a.size?a.size.w:2,minSizeY:"undefined"!=typeof a.minSize?a.minSize.h:1,minSizeX:"undefined"!=typeof a.minSize?a.minSize.w:1,maxSizeY:"undefined"!=typeof a.maxSize?a.maxSize.h:3,maxSizeX:"undefined"!=typeof a.maxSize?a.maxSize.w:3,name:"undefined"!=typeof a.name?a.name:"",widgetType:"undefined"!=typeof a.widgetType?a.widgetType:"",isAlert:"undefined"!=typeof a.isAlert&&a.isAlert,isFusion:"undefined"==typeof a.isAlert||a.isFusion,id:a._id,visibility:!1,channelName:"undefined"!=typeof a.channelName?a.channelName:""}),e.dashboard.widgetData.push({id:a._id,chart:[],visibility:!1,name:"undefined"!=typeof a.name?a.name:"",color:"undefined"!=typeof a.color?a.color:""}),l.all(s).then(function(t){e.loadedWidgetCount++;var a=e.dashboard.widgets.map(function(e){return e.id}).indexOf(t[0].id);e.dashboard.widgetData[a]=t[0],p=1},function(t){401===t.status?1003===t.data.errorstatusCode&&(k=e.dashboard.widgetData.map(function(e){return e.id}).indexOf(t.data.id),k!==-1&&(e.dashboard.widgetData[k].dataerror=!0),$("#widgetData-"+a._id).hide(),$("#errorWidgetData-"+a._id).hide(),$("#errorGatewayTimeout-"+a._id).hide(),$("#errorWidgetTokenexpire-"+a._id).show(),e.widgetErrorCode=1,e.loadedWidgetCount++,p=0):504===t.status?($("#widgetData-"+a._id).hide(),$("#errorWidgetData-"+a._id).hide(),$("#errorGatewayTimeout-"+a._id).show(),$("#errorWidgetTokenexpire-"+a._id).hide(),e.loadedWidgetCount++,p=0):($("#widgetData-"+a._id).hide(),$("#errorWidgetData-"+a._id).show(),$("#errorGatewayTimeout-"+a._id).hide(),$("#errorWidgetTokenexpire-"+a._id).hide(),e.loadedWidgetCount++,p=0)})}),e.exportModal=function(t){a.expObj=e.dashboard,s.go(t)},e.deleteWidget=function(t){var o=t.widgetType,s=t.id;r({method:"POST",url:"/api/v1/delete/widgets/"+t.id}).then(function(r){if("customFusion"!=o){e.loadedWidgetCount--;for(var i in e.dashboard.widgetData)e.dashboard.widgetData[i].id==s&&(e.dashboard.widgetData.splice(i,1),e.dashboard.widgets.splice(e.dashboard.widgets.indexOf(t),1));0==e.dashboard.widgets.length&&(e.widgetsPresent=!1)}else{for(var i in e.dashboard.widgetData)e.dashboard.widgetData[i].id==s&&(e.dashboard.widgetData.splice(i,1),e.dashboard.widgets.splice(e.dashboard.widgets.indexOf(t),1));for(var n in r.data.widgetsList)a.$broadcast("populateWidget",r.data.widgetsList[n])}},function(e){swal({title:"",text:'<span style = "sweetAlertFont">Error in deleting the widget! Please try again</span>',html:!0})})},e.alertModal=function(e,t){a.selectedWidget=t,s.go(e)},e.reArrangeWidgets=function(){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),p=0,e.gridsterOptions.autogenerate_stylesheet=!0;var t=e.dashboard.widgets,r=e.dashboard.widgetData;e.dashboard.widgets=[],e.dashboard.widgetData=[];for(var o in t)e.dashboard.widgets.push({sizeY:"undefined"!=typeof t[o].sizeY?t[o].sizeY:2,sizeX:"undefined"!=typeof t[o].sizeX?t[o].sizeX:2,minSizeY:"undefined"!=typeof t[o].minSizeY?t[o].minSizeY:1,minSizeX:"undefined"!=typeof t[o].minSizeX?t[o].minSizeX:1,maxSizeY:"undefined"!=typeof t[o].maxSizeY?t[o].maxSizeY:3,maxSizeX:"undefined"!=typeof t[o].maxSizeX?t[o].maxSizeX:3,name:"undefined"!=typeof t[o].name?t[o].name:"",widgetType:"undefined"!=typeof t[o].widgetType?t[o].widgetType:"",isAlert:"undefined"!=typeof t[o].isAlert&&t[o].isAlert,isFusion:"undefined"==typeof t[o].isAlert||t[o].isFusion,id:t[o].id,visibility:!1,channelName:"undefined"!=typeof t[o].channelName?t[o].channelName:""}),e.dashboard.widgetData.push(r[o]);e.autoArrangeGrid=!1,e.gridsterOptions.autogenerate_stylesheet=!1,p=1,a.$broadcast("storeGridStructure",{})},e.deleteDashboard=function(){swal({title:"Confirm Delete?",text:"Dashboard and all its associated Reports will be removed",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!0},function(){r({method:"POST",url:"/api/v1/delete/userDashboards/"+s.params.id}).then(function(e){a.fetchRecentDashboards(),s.go("app.reporting.dashboards")},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Unable to delete dashboard.Please try again</span> .",html:!0})})})},e.setAutoArrange=function(){e.autoArrangeGrid=!0,e.reArrangeWidgets()},e.showSettings=function(e){var t="settingsDropdown-"+e;document.getElementById(String(t)).classList.toggle("shw")},e.exportWidgetInPng=function(e,t){t=t||"Untitled Widget";var a=document.getElementById(e),r=document.getElementById("settingsDropdown-"+e);r.classList.contains("shw")&&r.classList.remove("shw"),toastr.info("Please wait while PNG is being generated.Download will start in few seconds"),document.getElementById("widget-dropdown-"+e).style.visibility="hidden",domtoimage.toBlob(a).then(function(a){var r=Number(new Date);window.saveAs(a,t+"_"+r+".png"),document.getElementById("widget-dropdown-"+e).style.visibility="visible"},function(t){toastr.info("Sorry PNG export failed.Please try again later."),document.getElementById("widget-dropdown-"+e).style.visibility="visible"})},e.toggleLegends=function(t){for(var a in e.dashboard.widgetData)if(e.dashboard.widgetData[a].id==t)for(var r in e.dashboard.widgetData[a].chart)"undefined"!=typeof e.dashboard.widgetData[a].chart[r].options.chart.showLegend&&(1==e.dashboard.widgetData[a].chart[r].options.chart.showLegend?e.dashboard.widgetData[a].chart[r].options.chart.showLegend=!1:e.dashboard.widgetData[a].chart[r].options.chart.showLegend=!0)};$(".exportModalContent").on("click",function(e){1==p?($(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#exportModalContent").addClass("md-show")):($(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#waitForWidgetsLoadModalContent").addClass("md-show"))}),$("#exportOptionJpeg").change(function(){$(".errorExportMessage").text("").hide()}),$("#exportOptionPDF").change(function(){$(".errorExportMessage").text("").hide()})}function ExportController(e,t,a,r,o,s,i,n){e.currentDate=moment(new Date).format("YYYY-DD-MM");var l="NoName";r.showExport=!0,e.expAct=!1,e.expDashboard={widgets:[],widgetData:[]},e.expDashboard.dashboardName="",e.expPages=[],e.exportObject={widgets:[],widgetData:[]},e.exportObject.dashboardName="",e.windowWidth=!1,e.closedCancle=!0,e.orgLogosList=[],e.cliLogosList=[],e.orgLogoSrc="/userFiles/datapoolt.png",e.cliLogoSrc="/userFiles/plain-white.jpg";var c,d,h,p;if(e.exportPDF=!1,e.exportUrl=!1,e.calculateSummaryHeightMoz=function(e,t){var a;return a=1==e?20:70/e,{height:a+"%"}},e.summaryAlignLessThanThree=[],e.toDisplayAllSummary=[],e.checkAllGraphsZero=function(t,a){for(var r=0,o=0;o<t.data.length;o++)0===t.data[o].summaryDisplay&&(r+=1);e.summaryAlignLessThanThree[a]=t.data.length-r,r===t.data.length&&(e.toDisplayAllSummary[a]=!0)},angular.element(document).ready(function(){$(".ladda-button").addClass("icon-arrow-right"),Ladda.bind(".ladda-button",{callback:function(t){$(".ladda-button").removeClass("icon-arrow-right"),e.closeExport();var a=0;if(0==d){$(".ladda-button").attr("data-style","");$(".ladda-button").addClass("icon-arrow-right")}else var r=($(".ladda-button").attr("data-style","expand-right"),setInterval(function(){a=Math.min(a+.1*Math.random(),1),t.setProgress(a),1===a&&1===h?(t.stop(),clearInterval(r)):1===a&&1===c?(t.stop(),clearInterval(r),$(".ladda-button").addClass("icon-arrow-right")):1===a&&1===p&&(t.stop(),clearInterval(r))},50))}})}),e.calculateColumnWidthMoz=function(e,t,a){return 1==t?"col-sm-12 col-md-12 col-lg-12":t>=2&&t<=4?"col-sm-4 col-md-4 col-lg-4":t>=5?"col-sm-2 col-md-2 col-lg-2":void 0},e.selectedIconIndicator=function(e,t){if("cli"==e){var a=$(".cliIcon");a.removeClass("selectIcon"),$("#"+t).addClass("selectIcon")}else if("org"==e){var a=$(".orgIcon");a.removeClass("selectIcon"),$("#"+t).addClass("selectIcon")}},e.fetchLogosFromDB=function(a){var r={accType:a};t({method:"post",url:"/api/v1/fetchLogoToPdf/dashboard",data:r}).then(function(t){"org"==a?e.orgLogosList=JSON.parse(JSON.stringify(t.data.logosInDB)):"cli"==a&&(e.cliLogosList=JSON.parse(JSON.stringify(t.data.logosInDB)))},function(t){e.orgLogosList=[],e.cliLogosList=[],swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please reload the dashboard</span>',html:!0})})},e.submitUpload=function(a,r){var o={file:a,accType:r},s="/api/v1/createLogoToPdf/createFolder",i=new FormData,n=a.type.split("/");if("png"==n[1]||"bmp"==n[1]||"jpg"==n[1]||"jpeg"==n[1]){for(var l in o)i.append(l,o[l]);t.post(s,i,{transformRequest:angular.indentity,headers:{"Content-Type":void 0}}).then(function(t){document.getElementById("orgUploadButton").disabled=!0,document.getElementById("clientUploadButton").disabled=!0,e.fetchLogosFromDB(r)},function(e){swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please reload the dashboard</span>',html:!0})})}else swal({title:"",text:'<span style="sweetAlertFont">Please Upload Only Image files(.jpg,.png,.jpeg,.bmp)</span>',html:!0})},e.removeLogo=function(a,r){var o={fileUrl:a.fileUrl,accType:r};t({method:"POST",url:"/api/v1/removeLogoToPdf/dashboard",data:o}).then(function(t){a.fileUrl==e.orgLogoSrc?e.orgLogoSrc="/userFiles/datapoolt.png":a.fileUrl==e.cliLogoSrc&&(e.cliLogoSrc="/userFiles/plain-white.jpg"),e.fetchLogosFromDB(r)},function(e){swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please reload the dashboard</span>',html:!0})})},e.enableUploadbutton=function(e){"org"==e?document.getElementById("orgUploadButton").disabled=!1:"cli"==e&&(document.getElementById("clientUploadButton").disabled=!1)},e.selectedOrgLogo=function(t){e.orgLogoSrc=t},e.selectedCliLogo=function(t){e.cliLogoSrc=t},void 0!=r.expObj){var g=r.expObj.widgets,u=r.expObj.widgetData,m=r.expObj.dashoboardDate;e.exportObject.dashboardName=r.expObj.dashboardName,void 0==e.exportObject.dashboardName&&null==e.exportObject.dashboardName||(l=e.exportObject.dashboardName),delete r.expObj;for(var f=g.length,b=0;b<f;b++)e.exportObject.widgets.push(g[b]),e.exportObject.widgetData.push(u[b])}e.expgridsterOptions={margins:[20,20],columns:6,rows:4,defaultSizeX:6,defaultSizeY:4,minSizeX:1,minSizeY:1,width:"auto",resizable:{enabled:!1},draggable:{enabled:!1},outerMargin:!0,mobileBreakPoint:700,mobileModeEnabled:!0},angular.element(o).on("resize",function(t){e.$broadcast("resize")}),e.$on("resize",function(t){n(function(){function t(e,t){return function(){if(null!=document.getElementById("exportChartOptions-"+e+"-"+t))for(var a=document.getElementById("exportChartOptions-"+e+"-"+t).offsetWidth,r=document.getElementById("exportChartOptions-"+e+"-"+t).offsetHeight,o=0;o<Highcharts.charts.length;o++)Highcharts.charts[o].container.parentElement.id.includes("exportChartRepeat-"+e+"-"+t)&&(Highcharts.charts[o].setSize(a,r),Highcharts.charts[o].reflow())}}for(var a in e.expPages)for(var r in e.expPages[a].widgets)"reportParaWidget"==e.expPages[a].widgets[r].widgetType&&"reportHeadingWidget"==e.expPages[a].widgets[r].widgetType||n(t(a,r),300)},10)}),e.calcColumnWidth=function(e,t,a){return e<=2?"col-sm-12 col-md-12 col-lg-12":e>2&&e<=4?"col-sm-6 col-md-6 col-lg-6":e>5&&e<=9&&1==t&&1!=a?"col-sm-6 col-md-6 col-lg-6":"col-sm-4 col-md-4 col-lg-4"},e.calculateRowHeight=function(e,t,a,r){e.showComparision=!1,a<6?t>6?e.showComparision=!1:e.showComparision=!0:t>12?e.showComparision=!1:e.showComparision=!0},e.calculateSummaryHeight=function(e,t){var a;return a=e<=1?1==t?20:100:2==e?1==t?20:t<=4&&t>1?30:50:1==t?20:t<=4&&t>1?30:t<=9&&t>5?40:t<=15&&t>10?50:60,{height:a+"%"}},e.calculateChartHeight=function(e,t){var a;return a=e<=1?1==t?80:0:2==e?1==t?80:t<=4&&t>1?70:50:1==t?80:t<=4&&t>1?70:t<=9&&t>5?60:t<=15&&t>10?50:40,{height:a+"%"}};var y=this;e.pdfPrintPreview=function(t){e.expAct=t,e.exportPDF=t,e.exportUrl=!1,document.getElementById("submitExportButton").disabled=t},e.printpaperPDF=function(){o.outerWidth>=1600&&(e.windowWidth=!0),y.dashboard=e.exportObject;for(var t=new Array,a=y.dashboard.widgets.length,r=y.dashboard.widgets,s=y.dashboard.widgetData,i=(y.dashboard.dashboardName,[]),l=[],c=[],d=[],h=[],p=0;p<a;p++)h.push(y.dashboard.widgets[p].row);for(var g=Math.max.apply(null,h),u=0;u<=g;u++)for(var m=0;m<=5;m++)e:for(var f=0;f<r.length;f+=1)if(r[f].row==u&&r[f].col==m){c.push(r[f]),d.push(s[f]);break e}angular.copy(d,l),angular.copy(c,i);for(var b in l)for(var v in l[b].chart)"undefined"!=typeof l[b].chart[v].options.chart.showLegend&&(l[b].chart[v].options.chart.showLegend=!1);var w=0;do{var D=1,C={sizeFilled:new Array(6),sizeLeft:new Array(6),widgets:[],widgetData:[],empWidget:[]};C.sizeFilled=[0,0,0,0,0,0],C.sizeLeft=[4,4,4,4,4,4];e:for(var x in i){for(var D=1,T=i[x].col,A=T+i[x].sizeX-1,S=T;S<=A;S++)D*=i[x].sizeY<=C.sizeLeft[S]?1:0;if(1!=D){for(var L=i[x].row,I=x;I<i.length;I++)i[I].row-=L;break e}for(var k=0;k<l[x].chart.length;k++)l[x].chart[k].data.length>15&&(i[x].sizeY=3,l[x].chart[k].data.length>30&&(i[x].sizeY=4));C.widgets.push({row:"undefined"!=typeof i[x].row?i[x].row:0,col:i[x].col,sizeY:"undefined"!=typeof i[x].sizeY?i[x].sizeY:2,sizeX:"undefined"!=typeof i[x].sizeX?i[x].sizeX:2,minSizeY:"undefined"!=typeof i[x].minSizeY?i[x].minSizeY:2,minSizeX:"undefined"!=typeof i[x].minSizeX?i[x].minSizeX:2,maxSizeY:"undefined"!=typeof i[x].maxSizeY?i[x].maxSizeY:3,maxSizeX:"undefined"!=typeof i[x].maxSizeX?i[x].maxSizeX:3,name:"undefined"!=typeof i[x].name?i[x].name:"",widgetType:"undefined"!=typeof i[x].widgetType?i[x].widgetType:"",isAlert:"undefined"!=typeof i[x].isAlert&&i[x].isAlert,id:i[x].id,visibility:!1}),C.widgetData.push(l[x]);for(var F=0;F<i[x].sizeX;F++)C.sizeFilled[T+F]+=i[x].sizeY,C.sizeLeft[T+F]-=C.sizeFilled[T+F];i[x]=null,l[x]=null}for(var a=i.length,j=new Array,P=new Array,E=0;E<a;E++)null!=i[E]&&(j.push(i[E]),P.push(l[E]));i=[],i=j,l=[],l=P;var W,O=Math.max.apply(null,C.sizeFilled);if(O<4){for(var N=0;N<6;N++)if(C.sizeFilled[N]==O){W=N;break}C.empWidget.push({row:O,col:W,sizeY:4-O,sizeX:1,visibility:!1})}t[w]=C,++w}while(i.length>0);e.expPages=t,n(function(){function t(e,t){return function(){if(null!=document.getElementById("exportChartOptions-"+e+"-"+t))for(var a=document.getElementById("exportChartOptions-"+e+"-"+t).offsetWidth,r=document.getElementById("exportChartOptions-"+e+"-"+t).offsetHeight,o=0;o<Highcharts.charts.length;o++)Highcharts.charts[o].container.parentElement.id.includes("exportChartRepeat-"+e+"-"+t)&&(Highcharts.charts[o].setSize(a,r),Highcharts.charts[o].reflow())}}var a=e.expPages.length;for(var r in e.expPages){for(var o in e.expPages[r].widgets)"reportParaWidget"==e.expPages[r].widgets[o].widgetType&&"reportHeadingWidget"==e.expPages[r].widgets[o].widgetType||n(t(r,o),300);r==a-1&&(document.getElementById("submitExportButton").disabled=!1)}},10)},e.closeExport=function(){$("input").attr("disable",!0);var t=$("#exportOptionJpeg").prop("checked"),a=$("#exportOptionPDF").prop("checked"),s=$("#exportOptionUrl").prop("checked"),i=$("#exportOptionExcel").prop("checked");0==t&&0==a&&0==s&&0==i?(o.alert("* Please Select the option to export"),d=!1):(d=!0,document.getElementById("submitExportButton").disabled=!0,1==a?(r.showExport=!1,e.exportUrl=!1,e.closedCancle=!1,n(function(){e.submitExport()},1800)):(h=0,p=0,e.submitExport()))},e.submitExport=function(){function o(e,t,a){function r(e,t,a){var r=[];for(var o in e)e.hasOwnProperty(o)&&r.push(o);"function"==typeof t?r.sort(t):"value"===t?r.sort(function(t,r){var o=e[t],s=e[r];return a||(o=o.toLowerCase?o.toLowerCase():o,s=s.toLowerCase?s.toLowerCase():s),o>s?-1:o<s?1:0}).reverse():r.sort().reverse();for(var s={},i=0;i<r.length;i++)s[r[i]]=e[r[i]];return s}var o=s.defer(),i="object"!=typeof e?JSON.parse(e):e,n=[];for(var l in i[0])n.push(l);var c=n.indexOf("Date");if(c!==-1&&0!==c){for(var d=[],h=0;h<i.length;h++){var p=r(i[h]);d.push(p)}i=d}var g="";if(g="\r\n",g+=t+"\r\n\n",a){var u="";for(var l in i[0])u+='="'+l+'",';u=u.slice(0,-1),g+=u+"\r\n"}for(var h=0;h<i.length;h++){var u="";for(var l in i[h])u+='="'+i[h][l]+'",';u.slice(0,u.length-1),g+=u+"\r\n"}if(""==g)return void alert("Invalid data");var m=g;return o.resolve(m),o.promise}var i=document.getElementById("dashboardLayout"),n=(document.getElementById("dashLayout"),$("#exportOptionJpeg").prop("checked")),d=$("#exportOptionUrl").prop("checked"),g=$("#exportOptionPDF").prop("checked"),u=$("#exportOptionExcel").prop("checked");if(1==n&&($(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#dashboardContent").removeClass("dashboardContent"),$("#dashboardContent").addClass("dashboardContentJpeg"),domtoimage.toBlob(i).then(function(t){$("#dashboardContent").removeClass("dashboardContentJpeg"),$("#dashboardContent").addClass("dashboardContent");var a=Number(new Date);window.saveAs(t,l+"_"+a+".jpeg"),$("#exportOptionJpeg").prop("checked",!1),h=1,e.expAct=!1,r.closePdfModal()},function(t){$("#dashboardContent").removeClass("dashboardContentJpeg"),$("#dashboardContent").addClass("dashboardContent"),$("#exportJPEGModalContent").removeClass("md-show"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#exportPDFModalContent").addClass("md-show"),$(".loadingStatus").hide(),$(".pdfHeadText").show().text("Uh-Oh!!").css("font-style","normal"),$(".pdfContentText").html("<b>Something went wrong. Please try again</b>"),document.getElementById("dashboardTitleIcons").style.visibility="visible",e.expAct=!1,r.closePdfModal()})),1==g){$(".navbar").css("z-index","1"),$("#exportModalContent").removeClass("md-show"),$(".exportContentText").html("<b>Please wait while the PDF file is being generated</b>"),$(".loadingStatus").show();var f=[],b=[];e.exportPromise=function(e){var t=s.defer();return domtoimage.toPng(e).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise};for(var y=0;y<e.expPages.length;y++)f[y]=document.getElementById("dashLayoutpages-"+y),b.push(e.exportPromise(f[y]));s.all(b).then(function(o){var s={dashboardLayout:o,dashboardId:a.params.id,dashboardName:l};t({method:"POST",url:"/api/v1/createHtml5ToPdf/dashboard",data:s}).then(function(t){$("#exportOptionPDF").prop("checked",!1);var a=(Number(new Date),"");a="localhost"==window.location.hostname?"http://localhost:8080":"";var r=String(a+t.data.Response);e.closedCancle=!0,$(".exportContentText").html('<p><span class="pdfHeadText">PDF has been generated successfully</span><br><span class="pdfContentText"><b><a href="'+r+'" download style="color: green;font-size: 20px;"  id="yourLinkID">Click here to download your PDF</a></b></span></p>'),$(".preview-loading").hide(),e.expAct=!1},function(t){r.closePdfModal(),$("#exportPDFModalContent").removeClass("md-show"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#exportPDFModalContent").addClass("md-show"),$(".loadingStatus").hide(),$(".pdfHeadText").show().text("Uh-Oh!!").css({"font-style":"normal",color:"red"}),$(".pdfContentText").html("<b>Something went wrong. Please try again</b>"),document.getElementById("dashboardTitleIcons").style.visibility="visible",e.expAct=!1})},function(t){$("#exportPDFModalContent").removeClass("md-show"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#exportPDFModalContent").addClass("md-show"),$(".loadingStatus").hide(),$(".pdfHeadText").show().text("Oh!!").css({"font-style":"normal",color:"red"}),$(".pdfContentText").html("<b>Something went wrong. Please try again</b>"),e.expAct=!1,r.closePdfModal()})}if(d===!0&&t({method:"GET",url:"/api/v1/get/dashboards/"+a.params.id+"?buster="+new Date}).then(function(t){var a=t.data.reportId,r="localhost"==window.location.hostname?"localhost:8080/reports":window.location.hostname+"/reports";e.sharingUrl=r+"#/"+a,$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),c=1,e.exportUrl=!0,e.expAct=!0;var o=new Clipboard(".btn");o.on("success",function(e){e.clearSelection()})},function(t){e.dashboard.dashboardName=null,swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please reload the dashboard</span>',html:!0})}),u===!0){for(var v=[],w=[],D=m.startDate+"-"+m.endDate,C=D.replace(/-/g,""),x=0;x<e.exportObject.widgetData.length;x++)for(var T,A=0;A<e.exportObject.widgetData[x].chart.length;A++)if(e.exportObject.widgetData[x].chart[A].data){var S=[];if("line"==e.exportObject.widgetData[x].chart[A].data[0].type||"stackcolumn"==e.exportObject.widgetData[x].chart[A].data[0].type||"bar"==e.exportObject.widgetData[x].chart[A].data[0].type||"area"==e.exportObject.widgetData[x].chart[A].data[0].type||"reachVsImpressions"==e.exportObject.widgetData[x].chart[A].data[0].type||"engagedUsersReach"==e.exportObject.widgetData[x].chart[A].data[0].type||"column"==e.exportObject.widgetData[x].chart[A].data[0].type){T=e.exportObject.widgetData[x].chart[0].data[0].values.length;for(var y=0;y<T;){for(var L={},I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;"line"!=e.exportObject.widgetData[x].chart[A].data[I].type&&"stackcolumn"!=e.exportObject.widgetData[x].chart[A].data[I].type&&"bar"!=e.exportObject.widgetData[x].chart[A].data[I].type&&"area"!=e.exportObject.widgetData[x].chart[A].data[I].type&&"column"!=e.exportObject.widgetData[x].chart[A].data[I].type&&"reachVsImpressions"!=e.exportObject.widgetData[x].chart[A].data[I].type&&"engagedUsersReach"!=e.exportObject.widgetData[x].chart[A].data[I].type||(e.exportObject.widgetData[x].chart[A].data[I].message?k=1:(L[e.exportObject.widgetData[x].chart[A].data[I].key]=e.exportObject.widgetData[x].chart[A].data[I].values[y].y,"object"!=typeof e.exportObject.widgetData[x].chart[A].data[I].values[y].x?L.Date=e.exportObject.widgetData[x].chart[A].data[I].values[y].x:L.Date=moment(e.exportObject.widgetData[x].chart[A].data[I].values[y].x).format("YYYY-MM-DD")))}1!=k&&S.push(L),y++}}else if("percentageArea"==e.exportObject.widgetData[x].chart[A].data[0].type){T=e.exportObject.widgetData[x].chart[0].data[0].totalChartLength.length;for(var y=0;y<T;){for(var L={},I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;"percentageArea"==e.exportObject.widgetData[x].chart[A].data[I].type&&(e.exportObject.widgetData[x].chart[A].data[I].message?k=1:(L[e.exportObject.widgetData[x].chart[A].data[I].key]=e.exportObject.widgetData[x].chart[A].data[I].totalChartLength[y].y.total,"object"!=typeof e.exportObject.widgetData[x].chart[A].data[I].totalChartLength[y].x?L.Date=e.exportObject.widgetData[x].chart[A].data[I].totalChartLength[y].x:L.Date=moment(e.exportObject.widgetData[x].chart[A].data[I].totalChartLength[y].x).format("YYYY-MM-DD")))}1!=k&&S.push(L),y++}}else if("stackbar"==e.exportObject.widgetData[x].chart[A].data[0].type){S=[],T=e.exportObject.widgetData[x].chart[0].data[0].values[0].total.length;for(var I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var L={};for(var F in e.exportObject.widgetData[x].chart[0].data[I].values[0].total[0]){var k=0;"stackbar"==e.exportObject.widgetData[x].chart[A].data[I].type&&(e.exportObject.widgetData[x].chart[A].data[I].message?k=1:(L[F]=e.exportObject.widgetData[x].chart[0].data[I].values[0].total[0][F],L.Type=e.exportObject.widgetData[x].chart[0].data[I].values[0].date))}1!=k&&S.push(L)}}else if("pie"==e.exportObject.widgetData[x].chart[A].data[0].type||"fbReachByCity"==e.exportObject.widgetData[x].chart[A].data[0].type||"angularGauge"==e.exportObject.widgetData[x].chart[A].data[0].type){for(var L={},I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;e.exportObject.widgetData[x].chart[A].data[I].message?k=1:L[e.exportObject.widgetData[x].chart[A].data[I].key]=void 0!==e.exportObject.widgetData[x].chart[A].data[I].y?e.exportObject.widgetData[x].chart[A].data[I].y:e.exportObject.widgetData[x].chart[A].data[I].summaryDisplay}1!=k&&S.push(L)}else if("audienceBehaviourbyDay"==e.exportObject.widgetData[x].chart[A].data[0].type){var k,S=[];if(!e.exportObject.widgetData[x].chart[A].data[0].message)for(var j=0;j<e.exportObject.widgetData[x].chart[A].data[0].values.length;j++){var L={};k=0;for(var P in e.exportObject.widgetData[x].chart[A].data[0].values[j].total)L[P]=e.exportObject.widgetData[x].chart[A].data[0].values[j].total[P];L.Day=e.exportObject.widgetData[x].chart[A].data[0].values[j].date,S.push(L)}}else if("twitterEngagements"==e.exportObject.widgetData[x].chart[A].data[0].type){var k,S=[];if(!e.exportObject.widgetData[x].chart[A].data[0].message)for(var j=0;j<e.exportObject.widgetData[x].chart[A].data[0].values.length;j++){var L={};k=0;for(var P in e.exportObject.widgetData[x].chart[A].data[0].values[j])L[P]=e.exportObject.widgetData[x].chart[A].data[0].values[j][P];S.push(L)}}else if("pageContentEfficiency"==e.exportObject.widgetData[x].chart[A].data[0].type||"visitorAcquisitionEfficiency"==e.exportObject.widgetData[x].chart[A].data[0].type||"pageTechnicalEfficiency"==e.exportObject.widgetData[x].chart[A].data[0].type||"topReferringSites"==e.exportObject.widgetData[x].chart[A].data[0].type||"gaSocialMediaOverview"==e.exportObject.widgetData[x].chart[A].data[0].type||"socialContributionToSiteTraffic"==e.exportObject.widgetData[x].chart[A].data[0].type){var k,S=[];if(!e.exportObject.widgetData[x].chart[A].data[0].message)for(var j=0;j<e.exportObject.widgetData[x].chart[A].data[0].values.length;j++){var L={};k=0;for(var P in e.exportObject.widgetData[x].chart[A].data[0].values[j]){if("string"==typeof e.exportObject.widgetData[x].chart[A].data[0].values[j][P]){var E=e.exportObject.widgetData[x].chart[A].data[0].values[j][P];e.exportObject.widgetData[x].chart[A].data[0].values[j][P]=E.split(",").join("")}L[P]=e.exportObject.widgetData[x].chart[A].data[0].values[j][P]}S.push(L)}}else if("gaVisitorAcquisitionEfficiencyAnalysisTable"==e.exportObject.widgetData[x].chart[A].options.chart.type||"gaPageTechnicalEfficiencyTable"==e.exportObject.widgetData[x].chart[A].options.chart.type||"gaPageContentEfficiencyTable"==e.exportObject.widgetData[x].chart[A].options.chart.type||"topReferringSitesTable"==e.exportObject.widgetData[x].chart[A].options.chart.type||"topLinks"==e.exportObject.widgetData[x].chart[A].options.chart.type||"engagementByUsersTalkedAbout"==e.exportObject.widgetData[x].chart[A].options.chart.type||"hashTag"==e.exportObject.widgetData[x].chart[A].options.chart.type||"instagramHashtagLeaderBoard"==e.exportObject.widgetData[x].chart[A].options.chart.type||"campaignOverview"==e.exportObject.widgetData[x].chart[A].options.chart.type||"adgroupOverview"==e.exportObject.widgetData[x].chart[A].options.chart.type||"campaignOverViewbyAge"==e.exportObject.widgetData[x].chart[A].options.chart.type||"adOverview"==e.exportObject.widgetData[x].chart[A].options.chart.type||"youtubeVideosOverview"==e.exportObject.widgetData[x].chart[A].options.chart.type){var k,S=[];if(!e.exportObject.widgetData[x].chart[A].data[0].message)for(var j=0;j<e.exportObject.widgetData[x].chart[A].data.length;j++){var L={};k=0;for(var P in e.exportObject.widgetData[x].chart[A].data[j]){if("string"==typeof e.exportObject.widgetData[x].chart[A].data[j][P]){var E=e.exportObject.widgetData[x].chart[A].data[j][P];e.exportObject.widgetData[x].chart[A].data[j][P]=E.split(",").join("")}"$$hashKey"!=P&&(L[P]=e.exportObject.widgetData[x].chart[A].data[j][P])}S.push(L)}}else if("highEngagementTweets"==e.exportObject.widgetData[x].chart[A].options.chart.type){T=e.exportObject.widgetData[x].chart[0].data.length;for(var I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;if(e.exportObject.widgetData[x].chart[A].data[I].message)k=1;else var L={Date:e.exportObject.widgetData[x].chart[A].data[I].date,Post:e.exportObject.widgetData[x].chart[A].data[I].postComment.replace(/\r?\n|\r/g,"").trim(),
Likes:e.exportObject.widgetData[x].chart[A].data[I].likes,ReTweet:e.exportObject.widgetData[x].chart[A].data[I].reTweet};1!=k&&S.push(L)}}else if("instagramPosts"==e.exportObject.widgetData[x].chart[A].options.chart.type)for(var I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;if(e.exportObject.widgetData[x].chart[A].data[I].message)k=1;else var L={Date:e.exportObject.widgetData[x].chart[A].data[I].date,Post:e.exportObject.widgetData[x].chart[A].data[I].postComment.replace(/\r?\n|\r/g,""),Likes:e.exportObject.widgetData[x].chart[A].data[I].likes,Comments:e.exportObject.widgetData[x].chart[A].data[I].comments};1!=k&&S.push(L)}else if("highestEngagementLinkedIn"==e.exportObject.widgetData[x].chart[A].options.chart.type)for(var I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;if(e.exportObject.widgetData[x].chart[A].data[I].message)k=1;else var L={Date:e.exportObject.widgetData[x].chart[A].data[I].date,Post:e.exportObject.widgetData[x].chart[A].data[I].postComment.replace(/\r?\n|\r/g,""),Likes:e.exportObject.widgetData[x].chart[A].data[I].likes,Comments:e.exportObject.widgetData[x].chart[A].data[I].comments,Impression:e.exportObject.widgetData[x].chart[A].data[I].impressions,Clicks:e.exportObject.widgetData[x].chart[A].data[I].clicks,Shares:e.exportObject.widgetData[x].chart[A].data[I].shares};1!=k&&S.push(L)}else if("pinterestEngagementRate"==e.exportObject.widgetData[x].chart[A].options.chart.type)for(var I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;if(e.exportObject.widgetData[x].chart[A].data[I].message)k=1;else var L={Date:e.exportObject.widgetData[x].chart[A].data[I].date,Post:e.exportObject.widgetData[x].chart[A].data[I].postComment.replace(/\r?\n|\r/g,""),Likes:e.exportObject.widgetData[x].chart[A].data[I].likes,Comments:e.exportObject.widgetData[x].chart[A].data[I].comments,Repins:e.exportObject.widgetData[x].chart[A].data[I].repins};1!=k&&S.push(L)}else if("pinterestLeaderboard"==e.exportObject.widgetData[x].chart[A].options.chart.type)for(var I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;if(e.exportObject.widgetData[x].chart[A].data[I].message)k=1;else var L={Date:e.exportObject.widgetData[x].chart[A].data[I].date,Post:e.exportObject.widgetData[x].chart[A].data[I].postComment.replace(/\r?\n|\r/g,""),Collaborators:e.exportObject.widgetData[x].chart[A].data[I].collaborators,Pins:e.exportObject.widgetData[x].chart[A].data[I].pins,Followers:e.exportObject.widgetData[x].chart[A].data[I].followers};1!=k&&S.push(L)}else if("vimeoTopVideos"==e.exportObject.widgetData[x].chart[A].options.chart.type)for(var I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;if(e.exportObject.widgetData[x].chart[A].data[I].message)k=1;else var L={Date:e.exportObject.widgetData[x].chart[A].data[I].date,Post:e.exportObject.widgetData[x].chart[A].data[I].title.replace(/\r?\n|\r/g,""),Comment:e.exportObject.widgetData[x].chart[A].data[I].Comment,likes:e.exportObject.widgetData[x].chart[A].data[I].likes,Views:e.exportObject.widgetData[x].chart[A].data[I].views};1!=k&&S.push(L)}else if("gaTopPagesByVisit"==e.exportObject.widgetData[x].chart[A].options.chart.type)for(var I=0;I<e.exportObject.widgetData[x].chart[A].data.length;I++){var k=0;if(e.exportObject.widgetData[x].chart[A].data[I].message)k=1;else var L={PageTitle:e.exportObject.widgetData[x].chart[A].data[I].pageTitle.replace(/\r?\n|\r/g,""),PagePath:e.exportObject.widgetData[x].chart[A].data[I].pagePath,PageViews:e.exportObject.widgetData[x].chart[A].data[I].pageviews,AvgTimeOnpage:e.exportObject.widgetData[x].chart[A].data[I].avgTimeOnpage,BouncesRate:e.exportObject.widgetData[x].chart[A].data[I].bouncesRate};1!=k&&S.push(L)}else if("mozoverview"==e.exportObject.widgetData[x].chart[A].options.chart.type){var k=0;if(e.exportObject.widgetData[x].chart[A].data[I].message)k=1;else var L={"Moz Rank":e.exportObject.widgetData[x].chart[A].displayData.mozRankURL,"External Links":e.exportObject.widgetData[x].chart[A].displayData.externalEquityLinks,"Domain Authority":e.exportObject.widgetData[x].chart[A].displayData.domainageAuthority,"Page Authority":e.exportObject.widgetData[x].chart[A].displayData.pageAuthority,"Back Links ":e.exportObject.widgetData[x].chart[A].displayData.links};1!=k&&S.push(L)}v.push({data:S,title:e.exportObject.widgetData[x].name})}for(var j=0;j<v.length;j++)w.push(o(v[j].data,v[j].title,!0));s.all(w).then(function(e){var t="data:text/csv;charset=utf-8,"+escape(e),a=document.createElement("a");a.href=t;var o="Report_"+C;a.style="visibility:hidden",a.download=o+".csv",document.body.appendChild(a),a.click(),document.body.removeChild(a),p=1,r.closePdfModal()},function(t){$("#exportPDFModalContent").removeClass("md-show"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#exportPDFModalContent").addClass("md-show"),$(".loadingStatus").hide(),$(".pdfHeadText").show().text("Oh!!").css({"font-style":"normal",color:"red"}),$(".pdfContentText").html("<b>Something went wrong. Please try again</b>"),e.expAct=!1,r.closePdfModal()})}}}function FusionSettingsController(e,t,a,r,o,s){e.widget=a,e.form={id:a.id,name:a.name,type:a.widgetType},e.widgetsList=[],e.selectedWidgetsList=[],e.dashboardWidgets=[],e.fusionView=!1,e.dismiss=function(){e.widgetsList=[],e.selectedWidgetsList=[],e.dashboardWidgets=[],t.dismiss()},e.selectedFusableWidgets=function(){e.dashboardWidgets.length>0?(e.dashboardWidgets.forEach(function(t,a){t._id!=e.widget.id&&"customFusion"!=t.widgetType&&e.widgetsList.push({id:t._id,label:t.name,widgetType:t.widgetType})}),e.fusionView=!0):r({method:"GET",url:"/api/v1/dashboards/widgets/"+o.params.id+"?buster="+new Date}).then(function(t){for(var a=[],r=0;r<t.data.widgetsList.length;r++)t.data.widgetsList[r].isFusion===!0&&a.push(t.data.widgetsList[r]);var o;o=a,o.forEach(function(t,a){t._id!=e.widget.id&&"customFusion"!=t.widgetType&&0!=t.visibility&&e.widgetsList.push({id:t._id,label:t.name,widgetType:t.widgetType})}),e.fusionView=!0},function(t){e.dismiss(),swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen settings to fuse the widget</span> .",html:!0})})},e.createCustomFusionWidget=function(){var t=[],i="customFusion",n=[];if(e.selectedWidgetsList.length>0){e.selectedWidgetsList.forEach(function(e){n.push({widgetId:e.id,widgetType:e.widgetType})}),n.push({widgetId:a.id,widgetType:a.widgetType});var l={dashboardId:o.params.id,name:"Custom Fusion",widgetType:i,widgets:n,size:{h:2,w:6},minSize:{h:2,w:6},maxSize:{h:3,w:6},color:"#1F77B4",channelName:"customFusion"};t.push(l),r({method:"POST",url:"/api/v1/widgets",data:t}).then(function(t){s.$broadcast("populateWidget",t.data.widgetsList[0]),e.dismiss()},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again</span> .",html:!0})})}else swal({title:"",text:"<span style='sweetAlertFont'>Please choose at least one widget</span> .",html:!0})},e.pushSelectedWidgets=function(e,t,a){for(var r=0;r<e.length;r++){var o=t.indexOf(e[r]);o!=-1&&(t.splice(o,1),a.push(e[r]))}}}function FusionWidgetController(e,t,a,r,o,s,i){e.currentView="step_one",e.objectList=[],e.metricList={},e.tokenExpired=[],e.referenceWidgetsList=[],e.defaultWidgetName,e.profileList=[],e.storedObjects={},e.referencechannelList=[],e.widgetType="fusion",e.storedUserChosenValues=[],e.profileOptionsModel=[],e.objectTypeList=[],e.fbAdObjId="",e.gaAdObjId="";var n=[];e.canManage=!0;var l;e.fusionRefreshButton="";var c=0;angular.element(document).ready(function(){$(".ladda-button").addClass("icon-arrow-right"),Ladda.bind(".ladda-button",{callback:function(t){e.createAndFetchBasicWidget(),$(".ladda-button").removeClass("icon-arrow-right");var a=0,r=setInterval(function(){a=Math.min(a+.1*Math.random(),1),t.setProgress(a),1===a&&1===c&&(t.stop(),clearInterval(r),e.ok())},50)}})}),e.changeViewsInBasicWidget=function(t){e.currentView=t,"step_one"===e.currentView?(e.clearReferenceWidget(),e.listOfReferenceWidget()):"step_two"===e.currentView&&e.getProfilesForDropdown()},e.listOfReferenceWidget=function(){t({method:"GET",url:"/api/v1/get/referenceWidgets/"+e.widgetType+"?buster="+new Date}).then(function(r){e.userDetail=r.data.user,t({method:"GET",url:"/api/v1/get/channels"}).then(function(t){for(var o=[],s=0;s<r.data.referenceWidgets.length;s++)o.push(e.getChannelByReference(r.data.referenceWidgets[s],s,t.data));a.all(o).then(function(t){for(var a=0;a<r.data.referenceWidgets.length;a++)e.referenceWidgetsList[a]=t[a].widget,e.referenceWidgetsList[a].channels=t[a].channels},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen fusions link</span> .",html:!0})})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen fusions link</span> .",html:!0})})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen fusions link</span> .",html:!0})})},e.getChannelByReference=function(t,r,o){var s=a.defer();if(null!=t&&void 0!=t&&null!=o&&void 0!=o){e.getAllChannels=[],e.uniqueChannelList=[],e.uniquechannelNames=[];for(var i={},n=0;n<t.charts.length;n++)e.getAllChannels.push(t.charts[n].channelId);e.uniqueChannelList=_.uniq(e.getAllChannels);for(var l=0;l<e.uniqueChannelList.length;l++)for(var c=0;c<o.length;c++)o[c]._id==e.uniqueChannelList[l]&&e.uniquechannelNames.push(o[c].name);i.widget=t,i.channels=e.uniquechannelNames,s.resolve(i)}else s.reject("getChannelByReference falied");return s.promise},e.storeReferenceWidget=function(){e.storedReferenceWidget=this.referenceWidgets,e.storedReferenceCharts=this.referenceWidgets.charts},e.clearReferenceWidget=function(){e.referenceWidgetsList=[],e.referencechannelList=[],e.objectList=[],e.profileList=[],e.storedUserChosenValues=[]},e.getProfilesForDropdown=function(){e.defaultWidgetName=e.storedReferenceWidget.name;for(var r=0;r<e.storedReferenceCharts.length;r++)e.referencechannelList.push(e.storedReferenceCharts[r].channelId);var o=e.referencechannelList;e.uniquechannelList=[],e.uniquechannelNames=[],$.each(o,function(t,a){$.inArray(a,e.uniquechannelList)===-1&&e.uniquechannelList.push(a)}),t({method:"GET",url:"/api/v1/get/channels"}).then(function(t){for(var a=0;a<e.uniquechannelList.length;a++)for(var r=0;r<t.data.length;r++)t.data[r]._id==e.uniquechannelList[a]&&(n=[],e.uniquechannelNames.push(t.data[r].name))},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen fusions link</span> .",html:!0})});var s=[];for(r=0;r<e.uniquechannelList.length;r++)s.push(e.selectProfile(e.uniquechannelList[r],r));a.all(s).then(function(t){e.profileList=t},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen fusions link</span> .",html:!0})})},e.addNewProfile=function(t){function a(a,r,o,s){switch(e.uniquechannelNames[t]){case"Facebook":a="/api/v1/auth/facebook",r=e.uniquechannelNames[t];break;case"Google Analytics":a="/api/v1/auth/google",r=e.uniquechannelNames[t];break;case"FacebookAds":a="/api/auth/facebookads",r=e.uniquechannelNames[t];break;case"Twitter":a="/api/auth/twitter",r=e.uniquechannelNames[t];break;case"Instagram":a="/api/auth/instagram",r=e.uniquechannelNames[t];break;case"GoogleAdwords":a="/api/auth/adwords",r=e.uniquechannelNames[t]}var i=screen.width/2-o/2,n=screen.height/2-s/2;return e.tokenExpired=!1,window.open(a,r,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+o+", height="+s+", top="+n+", left="+i)}var r,o;a(r,o,1e3,500)},r.afterAuthentication=function(){e.getProfilesForDropdown()},e.selectProfile=function(r,o){var s=a.defer();return t({method:"GET",url:"/api/v1/get/profiles/"+r+"?buster="+new Date}).then(function(a){s.resolve({index:o,profiles:a.data.profileList}),e.objectList=[],t({method:"GET",url:"/api/v1/get/objectType/"+r+"?buster="+new Date}).then(function(t){e.objectTypeList=t.data.objectType;for(var a=0;a<e.objectTypeList.length;a++)"fbadaccount"==e.objectTypeList[a].type?e.fbAdObjId=e.objectTypeList[a]._id:"adwordaccount"==e.objectTypeList[a].type&&(e.gaAdObjId=e.objectTypeList[a]._id)},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},function(e){s.reject(e)}),s.promise},e.getObjectsForChosenProfile=function(a,r){if(e.checkExpiresIn=null,e.tokenExpired[r]=!1,a){if(document.getElementById("basicWidgetFinishButton").disabled=!0,n[r]=a,e.storedUserChosenValues[r]=null,e.hasNoAccess=a.hasNoAccess,"Google Analytics"===e.uniquechannelNames[r]&&(this.objectOptionsModel1="",document.getElementById("basicWidgetFinishButton").disabled=!0),a.canManageClients===!1&&"GoogleAdwords"===e.uniquechannelNames[r]&&(e.canManage=!1,e.objectList[r]=null),a.canManageClients===!0&&(document.getElementById("basicWidgetFinishButton").disabled=!0,e.canManage=!0),"Facebook"==e.uniquechannelNames[r]||"FacebookAds"==e.uniquechannelNames[r]){e.expiredRefreshButton=e.uniquechannelNames[r],void 0!=a.expiresIn&&(e.checkExpiresIn=new Date(a.expiresIn)),e.tokenExpired[r]=!1;var o=a.expiresIn,s=new Date,i=new Date(o);s<=i?e.tokenExpired[r]=!1:void 0===o?e.tokenExpired[r]=!1:e.tokenExpired[r]=!0}t({method:"GET",url:"/api/v1/get/objects/"+a._id+"?buster="+new Date}).then(function(t){if("FacebookAds"===e.uniquechannelNames[r]){e.objectList[r]=[];for(var o=0;o<t.data.objectList.length;o++)t.data.objectList[o].objectTypeId==e.fbAdObjId&&e.objectList[r].push(t.data.objectList[o])}else if("GoogleAdwords"===e.uniquechannelNames[r]){e.objectList[r]=[];for(var o=0;o<t.data.objectList.length;o++)t.data.objectList[o].objectTypeId==e.gaAdObjId&&e.objectList[r].push(t.data.objectList[o])}else e.objectList[r]=t.data.objectList;"Twitter"!==e.uniquechannelNames[r]&&"Instagram"!==e.uniquechannelNames[r]||e.objectForWidgetChosen(e.objectList[r][0],r),a.canManageClients===!1&&"GoogleAdwords"===e.uniquechannelNames[r]&&e.objectForWidgetChosen(e.objectList[r][0],r)},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen fusions link</span> .",html:!0})})}else n[r]=null,e.objectList[r]=null,"Google Analytics"===e.uniquechannelNames[r]&&(this.objectOptionsModel1="",e.objectForWidgetChosen(e.objectList[r],r)),("Twitter"===e.uniquechannelNames[r]||"Instagram"===e.uniquechannelNames[r]||"GoogleAdwords"===e.uniquechannelNames[r]&&0==e.canManage)&&e.objectForWidgetChosen(e.objectList[r],r)},e.objectForWidgetChosen=function(t,a){"string"==typeof t&&0!=t.length?t=JSON.parse(t):"string"==typeof t&&0==t.length&&(t=null),null!=t&&"step_two"==e.currentView?e.storedUserChosenValues[a]={object:t,profile:this.profileOptionsModel[a]}:null==t&&"step_two"==e.currentView?e.storedUserChosenValues[a]={object:null,profile:null}:null!=t&&"step_one"==e.currentView&&(e.storedUserChosenValues=null);for(var r=0,o=0,s=0;s<e.storedUserChosenValues.length;s++)null!=e.storedUserChosenValues[s]&&null!=e.storedUserChosenValues[s].object&&r++;for(var i=0;i<n.length;i++)"undefined"!=typeof n[i]&&null!=n[i]&&o++;0!=r&&r==o&&(null===e.checkExpiresIn||e.checkExpiresIn>=new Date)?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0},e.removeExistingProfile=function(a){var r=this.profileOptionsModel;swal({title:"Confirm Delink the Profile?",text:"All data, widgets associated with this profile will be deleted! Confirm?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!0},function(){r&&t({method:"POST",url:"/api/v1/post/removeProfiles/"+r[a]._id}).then(function(t){e.getProfilesForDropdown()},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Unable to delete profile.Please try again</span> .",html:!0})})})},e.refreshObjectsForChosenProfile=function(a){if("Google Analytics"==e.uniquechannelNames[a]&&(this.objectOptionsModel1="",e.objectList[a]="",document.getElementById("basicWidgetFinishButton").disabled=!0),this.profileOptionsModel[a]._id){switch(e.fusionRefreshButton=e.uniquechannelNames[a],e.uniquechannelNames[a]){case"Facebook":e.objectType="page";break;case"Google Analytics":e.objectType="gaview";break;case"FacebookAds":e.objectType="fbadaccount";break;case"Twitter":e.objectType="tweet";break;case"Instagram":e.objectType="instagram";break;case"GoogleAdwords":e.objectType="adwordaccount"}t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+this.profileOptionsModel[a]._id+"?objectType="+e.objectType+"&buster="+new Date}).then(function(t){e.objectList[a]=t.data,e.fusionRefreshButton=""},function(t){e.fusionRefreshButton="",401===t.status?1003===t.data.errorstatusCode&&(swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}),e.getProfilesForDropdown()):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})}},e.createAndFetchBasicWidget=function(){var a=[],r=[],n=e.storedReferenceWidget.charts.length;a=i.fetchRandomColors(n);for(var d=[],h=[],p=e.storedReferenceWidget.name||e.defaultWidgetName,g=0;g<e.storedReferenceCharts.length;g++){d=[];for(var u=0;u<e.storedUserChosenValues.length;u++)if("undefined"!=typeof e.storedUserChosenValues[u]&&null!=e.storedUserChosenValues[u].profile&&e.storedReferenceCharts[g].channelId===e.storedUserChosenValues[u].profile.channelId){for(var m=0;m<e.storedReferenceCharts[g].metrics.length;m++)e.storedReferenceCharts[g].metrics[m].objectTypeId===e.storedUserChosenValues[u].object.objectTypeId&&(d.push(e.storedReferenceCharts[g].metrics[m]),d[0].objectId=e.storedUserChosenValues[u].object._id);e.storedReferenceWidget.charts[g].objectName=e.storedUserChosenValues[u].object.name}e.storedReferenceWidget.charts[g].metrics=d,e.storedReferenceWidget.charts[g].colour=a[g]}for(var f=0;f<e.storedReferenceWidget.charts.length;f++)0!=e.storedReferenceWidget.charts[f].metrics.length&&r.push(e.storedReferenceWidget.charts[f]);var b={dashboardId:o.params.id,widgetType:e.widgetType,name:p,description:e.storedReferenceWidget.description,charts:r,order:e.storedReferenceWidget.order,offset:e.storedReferenceWidget.offset,size:e.storedReferenceWidget.size,minSize:e.storedReferenceWidget.minSize,maxSize:e.storedReferenceWidget.maxSize,isAlert:e.storedReferenceWidget.isAlert,visibility:!0,channelName:"custom"};h.push(b),t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=fusion"}).then(function(a){if(l=a.data.availableWidgets,l>0&&l>=h.length)e.ok(),t({method:"POST",url:"/api/v1/widgets",data:h}).then(function(e){c=1;for(widgetObjects in e.data.widgetsList)s.$broadcast("populateWidget",e.data.widgetsList[widgetObjects])},function(e){c=1,swal({title:"",text:"<span style='sweetAlertFont'>Please try again! Something is missing</span> .",html:!0})});else{var r=document.getElementById("scroller");r.scrollTop=0,$("#errorInFusionWidgets").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Fusions limit. Please upgrade to enjoy more Fusions</div>')}},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong!!!!</span> .",html:!0})})},e.dropdownWidth=function(e,t){if(1==e||1==t)return"col-sm-9 col-md-10 col-lg-10 col-xs-10"}}function GridviewController(e,t,a,r){e.dashboardList=null,e.allDashboards=null,e.gridloading=!0,e.sessionUser,$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),angular.element(a).on("resize",function(t){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-105}),e.fetchAllDashboards=function(){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-105,t({method:"GET",url:"/api/v1/get/dashboardList?buster="+new Date}).then(function(t){e.gridloading=!1,"200"==t.status?"admin"===t.data.user.roleId?e.allDashboards=_.groupBy(t.data.dashboardList,"userId"):e.dashboardList=t.data.dashboardList:e.dashboardList=null},function(t){e.gridloading=!1,e.dashboardList=null,$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#somethingWentWrongModalContent").addClass("md-show")})},e.deleteDashboard=function(a){swal({title:"Confirm Delete?",text:"Dashboard and all its contents will be removed",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!0},function(){e.gridloading=!0,$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),t({method:"POST",url:"/api/v1/delete/userDashboards/"+a._id}).then(function(t){r.fetchRecentDashboards(),e.fetchAllDashboards()},function(e){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#somethingWentWrongModalContent").addClass("md-show"),$("#somethingWentWrongText").text("Unable to delete dashboard.Please try again")})})}}function LightBoxController(e,t,a,r,o){e.state=r,e.animationsEnabled=!0,e.open=function(o){var s=t.open({animation:e.animationsEnabled,templateUrl:"modal.ejs",controller:"ModalInstanceController",size:o,windowClass:"modal-background"});s.result.then(function(t){e.selected=t,r.go("^")},function(){r.go("^"),a.info("Modal dismissed at: "+new Date)})},e.openRecommendDashboard=function(a){var o=t.open({animation:e.animationsEnabled,templateUrl:"modal.ejs",controller:"ModalInstanceController",size:a,windowClass:"modal-background"});o.result.then(function(t){e.selected=t,r.go("app.reporting.dashboards")},function(){r.go("app.reporting.dashboards")})},e.openProfileListModal=function(a){var o=t.open({animation:e.animationsEnabled,templateUrl:"modal.ejs",controller:"ModalInstanceController",size:a,windowClass:"modal-background"});o.result.then(function(t){e.selected=t,r.go("app.reporting.dashboards")},function(){r.go("app.reporting.dashboards")})},e.openPDFModal=function(o){var s=t.open({animation:e.animationsEnabled,templateUrl:"modal.ejs",controller:"ModalInstanceController",size:o,backdrop:"static",windowClass:"modal-background"});s.result.then(function(t){e.selected=t,r.go("^")},function(){r.go("^"),a.info("Modal dismissed at: "+new Date)})},e.toggleAnimation=function(){e.animationsEnabled=!e.animationsEnabled}}function MainCtrl(e,t,a,r){e.navbarHeight=window.innerHeight,e.IntroOptions={steps:[{element:"#step8",intro:"Blank Dashboard - Click here to create a new blank dashboard. Create dashboards to organize your widgets and monitor them.",position:"right"},{element:"#step9",intro:"Dashboard Templates - Ready made pre-built dashboards comprising of specific curated widgets to address an unique theme or purpose. They provide a great way to quickly get your dashboard created rather than building it one widget at a time.",position:"right"},{element:"#step10",intro:"Reports - Take complete control of your reporting. Easily build reports with custom logos, custom text and export them as professional looking PDFs. White label your reports and use your own logo to send reports.",position:"right"},{element:"#step11",intro:"Get it, use it.",position:"bottom"},{element:"#step12",intro:"Get it, use it.",position:"left"},{element:"#step13",intro:"Get it, use it.",position:"left"},{element:"#step14",intro:"Get it, use it.",position:"left"},{element:"#soonModel",intro:"Get it, use it.",position:"left"},{element:"#step15",intro:"Get it, use it.",position:"left"},{element:"#step17",intro:"Get it, use it.",position:"left"}],showStepNumbers:!0,exitOnOverlayClick:!0,exitOnEsc:!0,nextLabel:"<strong>Next</strong>",prevLabel:"<strong>Previous</strong>",skipLabel:'<span style="color:red">Exit</span>',doneLabel:'<span style="color:green">Thanks</span>'},window.addEventListener("resize",function(t){e.navbarHeight=window.innerHeight}),t.dropDownActive=!1,e.ShouldAutoStart=!1,t.$on("$stateChangeSuccess",function(a,r,o,s,i){t.currentStateForIntro=r.name,"app.reporting.dashboard"==t.currentStateForIntro?e.IntroOptions={steps:[{element:"#step1",intro:"Name all your dashboards here the way you see fit for easy organization",position:"bottom"},{element:"#step2",intro:"Choose the date range for which you want to analyze the data of your dashboard widgets",position:"bottom"},{element:"#step3",intro:"Add new widgets to your dashboards from all our integrated channels. Choose your channels followed by the metrics. Choose the profiles for which your want to see the data for your chosen metrics.",position:"left"},{element:"#step4",intro:"Take relevant metrics from two different channels and fuse them together to spot interesting correlations and trends.",position:"left"},{element:"#step5",intro:"Arrange all the widgets in your dashboard in a presentable manner with a single click.",position:"left"},{element:"#step6",intro:"Export the current dashboard in different available formats. Also share the url of this dashboard to people who require view access for analysis.",position:"left"},{element:"#step7",intro:"Click here to delete your current dashboard.",position:"left"},{element:"#step8",intro:"Blank Dashboard - Click here to create a new blank dashboard. Create dashboards to organize your widgets and monitor them.",position:"right"},{element:"#step9",intro:"Dashboard Templates - Ready made pre-built dashboards comprising of specific curated widgets to address an unique theme or purpose. They provide a great way to quickly get your dashboard created rather than building it one widget at a time.",position:"right"},{element:"#step10",intro:"Reports - Take complete control of your reporting. Easily build reports with custom logos, custom text and export them as professional looking PDFs. White label your reports and use your own logo to send reports.",position:"right"},{element:"#step11",intro:"Quickly navigate back and forth between your recent dashboards in a single click. Get a complete view of all your dashboards by clicking on All dashboards",position:"bottom"},{element:"#step12",intro:"Navigate to handle all your account related features and settings through this menu.",position:"left"},{element:"#step13",intro:"View and manage (create/edit/delete) all the social/digital profiles whose health you want to monitor in your dashboards.",position:"left"},{element:"#step14",intro:"View your account plan and status, invoice history and manage/upgrade your account.",position:"left"},{element:"#soonModel",intro:"View and manage all the users from your team whom you would like to use and benefit from Datapoolt",position:"left"},{element:"#step15",intro:"Have a quick tour and understand the features available in Datapoolt",position:"left"},{element:"#step17",intro:"Click here to logout of Datapoolt till you visit again soon",position:"left"}],showStepNumbers:!0,exitOnOverlayClick:!1,exitOnEsc:!0,nextLabel:"<strong>Next</strong>",prevLabel:"<strong>Previous</strong>",skipLabel:'<span style="color:red">Exit</span>',doneLabel:'<span style="color:green">Thanks</span>'}:e.IntroOptions={steps:[{element:"#step8",intro:"Blank Dashboard - Click here to create a new blank dashboard. Create dashboards to organize your widgets and monitor them.",position:"right"},{element:"#step9",intro:"Dashboard Templates - Ready made pre-built dashboards comprising of specific curated widgets to address an unique theme or purpose. They provide a great way to quickly get your dashboard created rather than building it one widget at a time.",position:"right"},{element:"#step10",intro:"Reports - Take complete control of your reporting. Easily build reports with custom logos, custom text and export them as professional looking PDFs. White label your reports and use your own logo to send reports.",position:"right"},{element:"#step11",intro:"Quickly navigate back and forth between your recent dashboards in a single click. Get a complete view of all your dashboards by clicking on All dashboards",position:"bottom"},{element:"#step12",intro:"Navigate to handle all your account related features and settings through this menu.",position:"left"},{element:"#step13",intro:"View and manage (create/edit/delete) all the social/digital profiles whose health you want to monitor in your dashboards.",position:"left"},{element:"#step14",intro:"View your account plan and status, invoice history and manage/upgrade your account.",position:"left"},{element:"#soonModel",intro:"View and manage all the users from your team whom you would like to use and benefit from Datapoolt",position:"left"},{element:"#step15",intro:"Have a quick tour and understand the features available in Datapoolt",position:"left"},{element:"#step17",intro:"Click here to logout of Datapoolt till you visit again soon",position:"left"}],showStepNumbers:!0,exitOnOverlayClick:!0,exitOnEsc:!0,nextLabel:"<strong>Next</strong>",prevLabel:"<strong>Previous</strong>",skipLabel:'<span style="color:red">Exit</span>',doneLabel:'<span style="color:green">Thanks</span>'}}),e.CompletedEvent=function(e){t.dropDownActive=!1,document.getElementById("myDropdown").classList.remove("show")},e.ExitEvent=function(e){t.dropDownActive=!1,document.getElementById("myDropdown").classList.remove("show")},e.ChangeEvent=function(e,t){},e.BeforeChangeEvent=function(e,a){"step13"==e.id||"step14"==e.id||"step15"==e.id||"step16"==e.id||"step17"==e.id||"soonModel"==e.id?(t.dropDownActive=!0,document.getElementById("myDropdown").classList.contains("show")||document.getElementById("myDropdown").classList.add("show")):t.dropDownActive=!1},e.AfterChangeEvent=function(e,t){},this.daterange={startDate:null,endDate:null},this.slideInterval=5e3,this.states=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],this.persons=[{id:"1",firstName:"Monica",lastName:"Smith"},{id:"2",firstName:"Sandra",lastName:"Jackson"},{id:"3",firstName:"John",lastName:"Underwood"},{id:"4",firstName:"Chris",lastName:"Johnatan"},{id:"5",firstName:"Kim",lastName:"Rosowski"}],this.checkOne=!0,this.checkTwo=!0,this.checkThree=!0,this.checkFour=!0,this.knobOne=75,this.knobTwo=25,this.knobThree=50,this.bigTotalItems=175,this.bigCurrentPage=1,this.maxSize=5,this.singleModel=1,this.radioModel="Middle",this.checkModel={left:!1,middle:!0,right:!1},this.groups=[{title:"Dynamic Group Header - 1",content:"Dynamic Group Body - 1"},{title:"Dynamic Group Header - 2",content:"Dynamic Group Body - 2"}],this.alerts=[{type:"danger",msg:"Oh snap! Change a few things up and try submitting again."},{type:"success",msg:"Well done! You successfully read this important alert message."},{type:"info",msg:"OK, You are done a great job man."}],this.addAlert=function(){this.alerts.push({msg:"Another alert!"})},this.closeAlert=function(e){this.alerts.splice(e,1)},this.randomStacked=function(){this.stacked=[];for(var e=["success","info","warning","danger"],t=0,a=Math.floor(4*Math.random()+1);t<a;t++){var r=Math.floor(4*Math.random());this.stacked.push({value:Math.floor(30*Math.random()+1),type:e[r]})}},this.randomStacked(),this.summernoteText=["<h3>Hello Jonathan! </h3>","<p>dummy text of the printing and typesetting industry. <strong>Lorem Ipsum has been the dustrys</strong> standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more","recently with</p>"].join(""),
this.BarChart={data:[5,3,9,6,5,9,7,3,5,2,4,7,3,2,7,9,6,4,5,7,3,2,1,0,9,5,6,8,3,2,1],options:{fill:["#1ab394","#d7d7d7"],width:100}},this.BarChart2={data:[5,3,9,6,5,9,7,3,5,2],options:{fill:["#1ab394","#d7d7d7"]}},this.BarChart3={data:[5,3,2,-1,-3,-2,2,3,5,2],options:{fill:["#1ab394","#d7d7d7"]}},this.LineChart={data:[5,9,7,3,5,2,5,3,9,6,5,9,4,7,3,2,9,8,7,4,5,1,2,9,5,4,7],options:{fill:"#1ab394",stroke:"#169c81",width:64}},this.LineChart2={data:[3,2,9,8,47,4,5,1,2,9,5,4,7],options:{fill:"#1ab394",stroke:"#169c81",width:64}},this.LineChart3={data:[5,3,2,-1,-3,-2,2,3,5,2],options:{fill:"#1ab394",stroke:"#169c81",width:64}},this.LineChart4={data:[5,3,9,6,5,9,7,3,5,2],options:{fill:"#1ab394",stroke:"#169c81",width:64}},this.PieChart={data:[1,5],options:{fill:["#1ab394","#d7d7d7"]}},this.PieChart2={data:[226,360],options:{fill:["#1ab394","#d7d7d7"]}},this.PieChart3={data:[.52,1.561],options:{fill:["#1ab394","#d7d7d7"]}},this.PieChart4={data:[1,4],options:{fill:["#1ab394","#d7d7d7"]}},this.PieChart5={data:[226,134],options:{fill:["#1ab394","#d7d7d7"]}},this.PieChart6={data:[.52,1.041],options:{fill:["#1ab394","#d7d7d7"]}}}function ModalInstanceController(e,t,a,r){e.ok=function(){r.close()},e.cancel=function(){r.dismiss("cancel")},e.closeBasicWidgetModal=function(e){if("step_two"==e){var o=t.customWidgetId;void 0!=o&&a({method:"POST",url:"/api/v1/delete/widgets/"+o}).then(function(e){},function(e){})}r.dismiss("cancel")},e.closeExportModal=function(){r.close()},t.closePdfModal=function(){r.close()},e.closeProfilelistModal=function(){r.close()}}function NavigationController(e,t,a,r,o){o.getReportBuilder=function(){a({method:"POST",url:"/api/v1/updateUserSubscription?buster="+new Date}).then(function(t){e.canAccessReportBuilder=t.data.response.reportBuilder},function(t){e.dashboard.dashboardName=null,swal({title:"",text:'<span style="sweetAlertFont">Something went wrong! Please reload the dashboard</span>',html:!0})})},o.getReportBuilder(),t.includes("app.reporting.dashboard"),e.stateValidation=function(r){switch(r){case"recommendedDashboard":a({method:"GET",url:"/api/v1/subscriptionLimits?requestType=dashboards"}).then(function(e){e.data.isExpired===!1?e.data.availableDashboards>0?t.go("app.reporting."+r):toastr.info("You have reached your Dashboards limit. Please upgrade to create more Dashboards"):toastr.info("Please renew!")},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})});break;case"chooseDashboardType":a({method:"GET",url:"/api/v1/subscriptionLimits?requestType=dashboards"}).then(function(e){e.data.isExpired===!1?e.data.availableDashboards>0?t.go("app.reporting."+r):toastr.info("You have reached your Dashboards limit. Please upgrade to create more Dashboards"):toastr.info("Please renew !")},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})});break;case"buildReports":e.canAccessReportBuilder?t.go("app.reporting."+r):swal({title:"",text:"Sorry! The Report builder feature is only available on the Agency Plan.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Upgrade",closeOnConfirm:!0},function(){t.go("app.reporting.upgrade")});break;case"insights":toastr.info("Coming Soon")}},e.addRecommendedDashboard=function(){a({method:"GET",url:"/api/v1/subscriptionLimits?requestType=dashboards"}).then(function(e){e.data.isExpired===!1?e.data.availableDashboards>0?t.go("app.reporting.dashboard.recommendedDashboard"):toastr.info("You have reached your Dashboards limit. Please upgrade to create more Dashboards"):toastr.info("Please renew!")},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},$(".insightsModalContent").on("click",function(e){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#insightsModalContent").addClass("md-show")}),$(".addRemoveModalContent").on("click",function(e){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#addRemoveModalContent").addClass("md-show")})}function ProfileListController(e,t,a,r){e.profile={},e.channelList=[],e.currentView="step_one",e.configProfileListModal=function(){e.profileListArray=[],t({method:"GET",url:"/api/v1/get/profileList?buster="+new Date}).then(function(t){e.userDetail=t.data.user,e.profileListArray=t.data.profileList,void 0!==e.profile._id&&(k=e.profileListArray.map(function(e){return e._id}).indexOf(e.profile._id),k!==-1&&e.profileListArray[k].hasNoAccess&&$("#errorInRelink").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>Please login with your Account</div>'))},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.changeViewsInProfileList=function(t){e.currentView=t,"step_one"===e.currentView?e.configProfileListModal():"step_two"===e.currentView&&e.listChannels()},e.listChannels=function(){t({method:"GET",url:"/api/v1/get/channels"}).then(function(t){var a=t.data;for(i in a)e.channelList=a},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.linkProfile=function(e){function t(e,t,a,r){switch(o){case"Facebook":e="/api/v1/auth/facebook",t=o;break;case"Google Analytics":e="/api/v1/auth/google",t=o;break;case"FacebookAds":e="/api/auth/facebookads",t=o;break;case"Twitter":e="/api/auth/twitter",t=o;break;case"Instagram":e="/api/auth/instagram",t=o;break;case"GoogleAdwords":e="/api/auth/adwords",t=o;break;case"YouTube":e="/api/v1/auth/youTube",t=o;break;case"Mailchimp":e="/api/auth/mailchimp",t=o;break;case"linkedin":e="/api/auth/linkedIn",t=o;break;case"Aweber":e="/api/auth/aweber",t=o;break;case"Vimeo":e="/api/auth/vimeo",t=o;break;case"Pinterest":e="/api/auth/pinterest",t=o}var s=screen.width/2-a/2,i=screen.height/2-r/2;return window.open(e,t,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+a+", height="+r+", top="+i+", left="+s)}var a,r,o=e;t(a,r,1e3,500)},e.refreshProfile=function(t){function a(e,t,a,o){switch(r){case"Facebook":e="/api/v1/auth/facebook",t=r;break;case"Google Analytics":e="/api/v1/auth/google",t=r;break;case"FacebookAds":e="/api/auth/facebookads",t=r;break;case"Twitter":e="/api/auth/twitter",t=r;break;case"Instagram":e="/api/auth/instagram",t=r;break;case"GoogleAdwords":e="/api/auth/adwords",t=r;break;case"YouTube":e="/api/v1/auth/youTube",t=r;break;case"Mailchimp":e="/api/auth/mailchimp",t=r;break;case"linkedin":e="/api/auth/linkedIn",t=r;break;case"Aweber":e="/api/auth/aweber",t=r;break;case"Vimeo":e="/api/auth/vimeo",t=r;break;case"Pinterest":e="/api/auth/pinterest",t=r}var s=screen.width/2-a/2,i=screen.height/2-o/2;return window.open(e,t,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+a+", height="+o+", top="+i+", left="+s)}var r=t.channelName;e.profile=t;var o,s;a(o,s,1e3,500)},a.afterAuthentication=function(){e.configProfileListModal(),"step_one"===e.currentView?e.configProfileListModal():"step_two"===e.currentView&&(e.configProfileListModal(),e.changeViewsInProfileList("step_one"))},e.removeExistingProfile=function(a){var r=a;swal({title:"Confirm Profile Delink?",text:"All data, widgets associated with this profile will be deleted! Confirm?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!0},function(){r&&t({method:"POST",url:"/api/v1/post/removeProfiles/"+r._id}).then(function(t){e.configProfileListModal()},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong with Profile delink.Please try again</span>",html:!0})})})}}function RecommendedDashboardController(e,t,a,r,o,s,i){function n(){function t(){e.ok(),a.resolve("open")}var a=r.defer();return t(),a.promise}e.currentView="step_one",e.expiredRefreshButton=[],e.recommendDashboard=[],e.getChannelList={},e.profileList=[],e.objectList=[],e.profileCount=0,e.otherObjectList=[],e.objectTypeList=[],e.tempList=[],e.recommendeDashboardName,e.metricList={},e.referenceWidgetsList=[],e.storedObjects={},e.referencechannelList=[],e.storedUserChosenValues=[],e.profileOptionsModel=[],e.dashboard={},e.objectTypeList=[],e.fbAdObjId="",e.gaAdObjId="",e.canManage=!0,e.fbSelectEnable=!1,e.googleSelectEnable=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaignChosen=!1,e.groupChosen=!1,e.adChosen=!1,e.messageEnable=[],e.recommendedRefreshButton=[],e.otherRefreshButton=[],e.tokenExpired=[];var l,c=0,d=!1,h=!1,p=!1,g=!1,u=!1,m=[];angular.element(document).ready(function(){$(".ladda-button").addClass("icon-arrow-right"),Ladda.bind(".ladda-button",{callback:function(t){e.createRecommendedDashboard(),$(".ladda-button").removeClass("icon-arrow-right");var a=0,r=setInterval(function(){a=Math.min(a+.1*Math.random(),1),t.setProgress(a),1===a&&1===c&&(t.stop(),clearInterval(r),e.ok())},50)}})}),e.dropdownWidth=function(e,t){if(1==e||1==t)return"col-sm-10 col-md-10 col-lg-10 col-xs-10"},e.changeViewsInBasicWidget=function(t){l?e.currentView="step_error":e.currentView=t,"step_one"===e.currentView&&(d=!1,g=!1,u=!1,h=!1,p=!1,m=[],e.fbSelectEnable=!1,e.googleSelectEnable=!1,e.clearReferenceWidget(),e.listOfRecommendedDashboard())},e.clearReferenceWidget=function(){e.objectList=[],e.profileList=[],e.otherObjectList=[],e.objectTypeList=[],e.storedUserChosenValues=[],e.recommendDashboard=[]},e.listOfRecommendedDashboard=function(){t({method:"GET",url:"api/get/recommendDashboard?buster="+new Date}).then(function(a){e.wholeDataDetail=a.data;for(var r in a.data)e.recommendDashboard.push(a.data[r]);t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=basic"}).then(function(t){e.userDetail=t.data.user,e.widgetCount=t.data.availableWidgets},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen recommended dashboards link</span> .",html:!0})})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen recommended dashboards link</span>",html:!0})})},e.closeRecommendedDashboardModal=function(){n().then(function(){o.go("app.reporting.dashboards")})},e.getProfileForChosenChannel=function(a){t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=basic"}).then(function(t){if(a.referenceWidgets.length>=t.data.availableWidgets)l=!0,$("#error").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Widgets limit. Please upgrade to enjoy more Widgets</div>');else{e.changeViewsInBasicWidget("step_two"),document.getElementById("basicWidgetFinishButton").disabled=!0,h=!1,p=!1,e.fullOfDashboard=a,e.getChannelList=a.channels,e.referenceWidgetsList=a.referenceWidgets;for(var o=0;o<e.referenceWidgetsList.length;o++)for(var s=0;s<e.referenceWidgetsList[o].charts.length;s++)m.push(e.referenceWidgetsList[o].charts[s].metrics[0].objectTypeId);m=_.uniq(m);var i=[];for(var n in e.getChannelList)i.push(e.correspondingProfile(e.getChannelList[n],n));r.all(i).then(function(t){e.profileList=t},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen recommended dashboards link</span>",html:!0})})}},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},e.correspondingProfile=function(a,o){var s=r.defer();return t({method:"GET",url:"/api/v1/get/profiles/"+a._id+"?buster="+new Date}).then(function(r){s.resolve({profiles:r.data.profileList}),e.objectList[o]=[],e.otherObjectList=[],e.objectTypeList[o]=[],e.messageEnable[o]=!1;var i=[];t({method:"GET",url:"/api/v1/get/objectType/"+a._id+"?buster="+new Date}).then(function(t){i=t.data.objectType;for(var a=0;a<i.length;a++)for(var r=0;r<m.length;r++)i[a]._id==m[r]&&e.objectTypeList[o].push(i[a]._id);for(var a=0;a<i.length;a++)"fbadaccount"==i[a].type?e.fbAdObjId=i[a]._id:"adwordaccount"==i[a].type&&(e.gaAdObjId=i[a]._id)},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},function(e){s.reject(e),swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen recommended dashboards link</span>",html:!0})}),s.promise},e.getObjectsForChosenProfile=function(a,r){if(e.tokenExpired[r]=!1,e.messageEnable[r]=!1,"FacebookAds"==e.getChannelList[r].name&&(e.selectedLevel=null,document.getElementById("basicWidgetFinishButton").disabled=!0,e.campaignEnable=!1,e.adSetAdsEnable=!1,e.adSetEnable=!1,e.campaign=null,e.adSetAds=null,e.adSet=null,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.fbSelectEnable=!1),"GoogleAdwords"==e.getChannelList[r].name&&(e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleGroup=null,e.googleAd=null,e.googleCampaignChosen=!1,e.groupChosen=!1,e.adChosen=!1,e.googleSelectEnable=!1,document.getElementById("basicWidgetFinishButton").disabled=!0),a){e.profileCount++,e.getChannelList[r].enable=!1,document.getElementById("basicWidgetFinishButton").disabled=!0,e.otherObjectList[r]=[],"Google Analytics"===e.getChannelList[r].name&&(this.objectOptionsModel1="",document.getElementById("basicWidgetFinishButton").disabled=!0),a.canManageClients===!1&&"GoogleAdwords"===e.getChannelList[r].name&&(e.canManage=!1,e.objectList[r]=null),a.canManageClients===!0&&(document.getElementById("basicWidgetFinishButton").disabled=!0,e.canManage=!0),void 0!=e.profileOptionsModel.expiresIn&&(e.checkExpiresIn=new Date(e.profileOptionsModel.expiresIn)),e.tokenExpired[r]=!1;var o=a.expiresIn,s=new Date,i=new Date(o);s<=i&&null!=o?e.tokenExpired[r]=!1:void 0===o||null===o?e.tokenExpired[r]=!1:e.tokenExpired[r]=!0,t({method:"GET",url:"/api/v1/get/objects/"+a._id+"?buster="+new Date}).then(function(t){if("FacebookAds"===e.getChannelList[r].name){e.profileId=a._id,e.expiredRefreshButton[r]=e.getChannelList[r].name,e.objectList[r]=[];for(var o=0;o<t.data.objectList.length;o++)t.data.objectList[o].objectTypeId==e.fbAdObjId&&e.objectList[r].push(t.data.objectList[o])}else if("GoogleAdwords"===e.getChannelList[r].name){e.googleProfileId=a._id,e.expiredRefreshButton[r]=e.getChannelList[r].name,e.objectList[r]=[];for(var o=0;o<t.data.objectList.length;o++)t.data.objectList[o].objectTypeId==e.gaAdObjId&&e.objectList[r].push(t.data.objectList[o])}else if("Mailchimp"===e.getChannelList[r].name||"Aweber"===e.getChannelList[r].name)for(var s=t.data.objectList,i=0;i<e.objectTypeList[r].length;i++){e.otherObjectList[r][i]=[];for(var o=0;o<s.length;o++)e.objectTypeList[r][i]==s[o].objectTypeId&&e.otherObjectList[r][i].push(s[o])}else e.expiredRefreshButton[r]=e.getChannelList[r].name,e.objectList[r]=t.data.objectList;"Twitter"!==e.getChannelList[r].name&&"Instagram"!==e.getChannelList[r].name||(e.expiredRefreshButton[r]=null,e.objectForWidgetChosen(e.objectList[r][0],r,0)),a.canManageClients===!1&&"GoogleAdwords"===e.getChannelList[r].name&&e.objectForWidgetChosen(e.objectList[r][0],r,0)},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen recommended dashboards link</span>",html:!0})})}else{if("FacebookAds"==e.getChannelList[r].name&&(h=!1),"GoogleAdwords"==e.getChannelList[r].name&&(p=!1),--e.profileCount,e.profileCount){e.getChannelList[r].enable=!0;var n=e.getChannelList.map(function(e){return e.enable}).indexOf(!1);n!=-1?"Twitter"===e.getChannelList[n].name||"Instagram"===e.getChannelList[n].name||e.getChannelList[n].name===e.getChannelList[r].name?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:document.getElementById("basicWidgetFinishButton").disabled=!1}else document.getElementById("basicWidgetFinishButton").disabled=!0;if(e.objectList[r]=null,"Mailchimp"===e.getChannelList[r].name||"Aweber"===e.getChannelList[r].name)for(var l=0;l<e.otherObjectList[r].length;l++)e.otherObjectList[r][l]=[],e.objectForWidgetChosen(e.otherObjectList[r][l],r,l);"Google Analytics"===e.getChannelList[r].name&&(this.objectOptionsModel1="",e.objectForWidgetChosen(e.objectList[r],r,0)),("Twitter"===e.getChannelList[r].name||"Instagram"===e.getChannelList[r].name||"GoogleAdwords"===e.getChannelList[r].name&&0==e.canManage)&&e.objectForWidgetChosen(e.objectList[r],r,0)}},e.objectForWidgetChosen=function(a,r,o){if(e.getChannelList[r].enable=!1,e.storedUserChosenValues[r]||(e.storedUserChosenValues[r]=[]),"string"==typeof a&&""!=a){var s=JSON.parse(a);a=s}null!=a&&"step_two"==e.currentView?""!=a&&this.profileOptionsModel[r]?(e.getChannelList[r].enable=!0,e.storedUserChosenValues[r][o]={object:a,profile:this.profileOptionsModel[r],channelName:e.getChannelList[r].name,objectTypeLength:e.otherObjectList[r].length}):e.storedUserChosenValues.splice(r,1):null==a&&"step_two"==e.currentView?(this.profileOptionsModel[r]?e.getChannelList[r].enable=!1:e.getChannelList[r].enable=!0,e.storedUserChosenValues.splice(r,1)):null!=a&&"step_one"==e.currentView&&(e.storedUserChosenValues=null);for(var i=0,n=0;n<e.storedUserChosenValues.length;n++){var l=0;if(e.storedUserChosenValues[n])for(var c=0;c<e.storedUserChosenValues[n].length;c++)null!=e.storedUserChosenValues[n][c]&&("Mailchimp"===e.storedUserChosenValues[n][c].channelName||"Aweber"===e.storedUserChosenValues[n][c].channelName?null!=e.storedUserChosenValues[n][c].object&&(l++,l==e.storedUserChosenValues[n][c].objectTypeLength&&i++):null!=e.storedUserChosenValues[n][c].object&&i++)}d=!!i,"FacebookAds"===e.getChannelList[r].name&&(h=!0,a?(e.selectedObjectType=null,e.selectedLevel=null,e.selectedId=null,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null,e.accountId=a.channelObjectId,e.fbSelectEnable=!0,t({method:"GET",url:"/api/v1/get/objectType/"+e.getChannelList[r]._id+"?buster="+new Date}).then(function(t){e.fbObjectTypeList=t.data.objectType},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})):(e.selectedObjectType=null,e.selectedLevel=null,e.selectedId=null,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null,e.fbSelectEnable=!1,document.getElementById("basicWidgetFinishButton").disabled=!0)),"GoogleAdwords"===e.getChannelList[r].name&&(p=!0,a?(e.googleCampaignChosen=!1,e.adChosen=!1,e.groupChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleAd=null,e.googleGroup=null,e.selectedGoogleObjectType=null,e.selectedGoogleLevel=null,e.selectedGoogleId=null,e.googleAccountId=a.channelObjectId,e.googleSelectEnable=!0,t({method:"GET",url:"/api/v1/get/objectType/"+e.getChannelList[r]._id+"?buster="+new Date}).then(function(t){e.googleObjectTypeList=t.data.objectType},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})):(e.googleCampaignChosen=!1,e.adChosen=!1,e.groupChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleAd=null,e.googleGroup=null,e.selectedGoogleObjectType=null,e.selectedGoogleLevel=null,e.selectedGoogleId=null,e.googleSelectEnable=!1,document.getElementById("basicWidgetFinishButton").disabled=!0)),e.checkComplete()},e.selectLevelChosen=function(t,a){if(e.messageEnable[a]=!1,t){for(var r=0,o=!1,s=!1,i=0;i<e.referenceWidgetsList.length;i++)"Cost per objective"==e.referenceWidgetsList[i].name&&(r=1),"Fb Ads Adgroup overview (Campaign level)"==e.referenceWidgetsList[i].name&&(r=1),"Fb Ads campaign overview (Account level)"==e.referenceWidgetsList[i].name&&(o=!0),"Fb Ads Ad overview (Adgroup level)"==e.referenceWidgetsList[i].name&&(s=!0);this.objectTypeOptionsModel[a]?(document.getElementById("basicWidgetFinishButton").disabled=!0,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null,e.selectedObjectType=this.objectTypeOptionsModel[a],e.selectedLevel=this.objectTypeOptionsModel[a].type,e.selectedId=this.objectTypeOptionsModel[a]._id,g=!1):(document.getElementById("basicWidgetFinishButton").disabled=!0,e.campaignChosen=!1,e.adSetChosen=!1,e.adSetAdsChosen=!1,e.campaignEnable=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=null,e.adSet=null,e.adSetAds=null,e.selectedObjectType=this.objectTypeOptionsModel[a],e.selectedLevel=null,e.selectedId=null,g=!1)}"fbadaccount"==e.selectedLevel?(r||s?(e.messageEnable[a]=!0,g=!1):g=null!=e.profileId&&null!=e.accountId,e.checkComplete()):"fbAdcampaign"==e.selectedLevel?(o||s?(e.messageEnable[a]=!0,g=!1):0==e.campaignChosen?(g=!1,e.campaignEnable=!0,e.getCampaigns()):g=null!=e.profileId&&null!=e.accountId&&null!=e.campaign,e.checkComplete()):"fbAdSet"==e.selectedLevel?(r||o?(e.messageEnable[a]=!0,g=!1):1==e.campaignChosen&&1==e.adSetChosen?g=null!=e.profileId&&null!=e.accountId&&null!=e.campaign&&null!=e.adSet:0==e.campaignChosen&&0==e.adSetChosen?(e.campaignEnable=!0,e.getCampaigns()):1==e.campaignChosen&&0==e.adSetChosen?(e.campaignEnable=!0,e.adSetEnable=!0,e.getAdSet(),g=!1):g=!1,e.checkComplete()):"fbAdSetAds"==e.selectedLevel&&(r||o||s?(e.messageEnable[a]=!0,g=!1):1==e.campaignChosen&&1==e.adSetChosen&&1==e.adSetAdsChosen?g=null!=e.profileId&&null!=e.accountId&&null!=e.campaign&&null!=e.adSet&&null!=e.adSetAds:0==e.campaignChosen&&0==e.adSetChosen&&1==e.adSetAdsChosen?(g=!1,e.campaignEnable=!0,e.getCampaigns(),e.adSetAdsChosen=!1,e.adSetAds=null):1==e.campaignChosen&&1==e.adSetChosen&&0==e.adSetAdsChosen?(g=!1,e.adSetAdsEnable=!0,e.getAdSetAds()):0==e.campaignChosen&&0==e.adSetChosen&&0==e.adSetAdsChosen?(g=!1,e.campaignEnable=!0,e.getCampaigns()):1==e.campaignChosen&&0==e.adSetChosen&&0==e.adSetAdsChosen?(g=!1,e.adSetEnable=!0,e.getAdSet()):1==e.campaignChosen&&0==e.adSetChosen&&1==e.adSetAdsChosen?(g=!1,e.adSetEnable=!0,e.getAdSet(),e.adSetAdsChosen=!1,e.adSetAds=null):0==e.campaignChosen&&1==e.adSetChosen&&1==e.adSetAdsChosen?(g=!1,e.campaignEnable=!0,e.getCampaigns(),e.adSetAdsChosen=!1,e.adSetAds=null,e.adSetChosen=!1,e.adSet=null):0==e.campaignChosen&&1==e.adSetChosen&&0==e.adSetAdsChosen&&(g=!1,e.campaignEnable=!0,e.getCampaigns(),e.adSetAdsChosen=!1,e.adSetAds=null,e.adSetChosen=!1,e.adSet=null),e.checkComplete())},e.fbAdsCheck=function(t){var a=0;document.getElementById("basicWidgetFinishButton").disabled=!0,"campaign"==t?(e.adSet=null,e.adSetChosen=!1,e.adSetAds=null,e.adSetAdsChosen=!1,e.adSetEnable=!1,e.adSetAdsEnable=!1,e.campaign=this.campaignOptionsModel,e.campaign?e.campaignChosen=!0:e.campaignChosen=!1,a=1):"adset"==t?(e.adSetAds=null,e.adSetAdsChosen=!1,e.adSetAdsEnable=!1,e.adSet=this.adSetOptionsModel,e.adSet?e.adSetChosen=!0:e.adSetChosen=!1,a=1):(e.adSetAds=this.adSetAdsOptionsModel,e.adSetAds?e.adSetAdsChosen=!0:e.adSetAdsChosen=!1,a=1),1==a&&e.selectLevelChosen()},e.getCampaigns=function(){var a=e.selectedId,r=e.accountId,o=e.profileId;t({method:"GET",url:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&accountId="+r+"&buster="+new Date}).then(function(t){e.campaignList=t.data.objectList,e.campaignOptionsModel=e.campaignList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getAdSet=function(){var a=e.selectedId,r=e.campaign.channelObjectId,o=e.profileId;t({method:"GET",url:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&campaignId="+r+"&buster="+new Date}).then(function(t){e.adSetList=t.data.objectList,e.adSetOptionsModel=e.adSetList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getAdSetAds=function(){var a=e.selectedId,r=e.adSet.channelObjectId,o=e.profileId;t({method:"GET",url:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&adSetId="+r+"&buster="+new Date}).then(function(t){e.adSetAdsList=t.data.objectList,e.adSetAdsOptionsModel=e.adSetAdsList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshAdCampaign=function(a){e.refreshAdCampaignLoading=!0;var r=a,o=e.accountId,s=e.profileId;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&accountId="+o+"&buster="+new Date}).then(function(t){e.campaignList=t.data,e.campaignOptionsModel=e.campaignList,e.refreshAdCampaignLoading=!1},function(t){e.refreshAdCampaignLoading=!1,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshAdSet=function(a){e.refreshAdSetLoading=!0;var r=a,o=e.campaign.channelObjectId,s=e.profileId;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&campaignId="+o+"&buster="+new Date}).then(function(t){e.adSetList=t.data,e.adSetOptionsModel=e.adSetList,e.refreshAdSetLoading=!1},function(t){e.refreshAdSetLoading=!1,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshAdSetAds=function(a){e.refreshAdSetAdsLoading=!0;var r=a,o=e.adSet.channelObjectId,s=e.profileId;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&adSetId="+o+"&buster="+new Date}).then(function(t){e.adSetAdsList=t.data,e.adSetAdsOptionsModel=e.adSetAdsList,e.refreshAdSetAdsLoading=!1},function(t){e.refreshAdSetAdsLoading=!1,401===t.status?1003===t.data.errorstatusCode&&(swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}),e.tokenExpired=!0):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.googleSelectLevelChosen=function(t,a){if(e.messageEnable[a]=!1,t){for(var r=0,o=0,s=0,i=0,n=!1,l=!1,c=!1,d=0;d<e.referenceWidgetsList.length;d++)"Adwords campaigns overview (Account level)"==e.referenceWidgetsList[d].name&&(c=!0),"Adgroups overview (Campaign level)"!=e.referenceWidgetsList[d].name&&"Age Demographics (Campaign Level)"!=e.referenceWidgetsList[d].name&&"Gender Demographics (Campaign Level)"!=e.referenceWidgetsList[d].name&&"Device Demographics (Campaign Level)"!=e.referenceWidgetsList[d].name||(n=!0),"Ads overview (Adgroup level)"!=e.referenceWidgetsList[d].name&&"Age Demographics (Adgroup Level)"!=e.referenceWidgetsList[d].name&&"Gender Demographics (Adgroup Level)"!=e.referenceWidgetsList[d].name&&"Device Demographics (Adgroup Level)"!=e.referenceWidgetsList[d].name||(l=!0);0==n&&0==l&&0==c&&(r=0,o=0,s=0,i=0),0==n&&1==l&&0==c&&(r=1,o=1,s=0,i=1),1==n&&0==l&&0==c&&(r=1,o=0,s=1,i=1),0==n&&0==l&&1==c&&(r=0,o=1,s=1,i=1),1==n&&1==l&&0==c&&(r=1,o=1,s=1,i=1),1==n&&0==l&&1==c&&(r=1,o=1,s=1,i=1),0==n&&1==l&&1==c&&(r=1,o=1,s=1,i=1),1==n&&1==l&&1==c&&(r=1,o=1,s=1,i=1),this.objectTypeOptionsModel[a]?(document.getElementById("basicWidgetFinishButton").disabled=!0,e.selectedGoogleObjectType=null,e.selectedGoogleLevel=null,e.selectedGoogleId=null,e.googleCampaignChosen=!1,e.adChosen=!1,e.groupChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleAd=null,e.googleGroup=null,e.selectedGoogleObjectType=this.objectTypeOptionsModel[a],e.selectedGoogleLevel=this.objectTypeOptionsModel[a].type,e.selectedGoogleId=this.objectTypeOptionsModel[a]._id,u=!1):(document.getElementById("basicWidgetFinishButton").disabled=!0,e.selectedGoogleObjectType=null,e.selectedGoogleLevel=null,e.selectedGoogleId=null,e.googleCampaignChosen=!1,e.adChosen=!1,e.groupChosen=!1,e.googleCampaignEnable=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=null,e.googleAd=null,e.googleGroup=null,e.selectedGoogleObjectType=this.objectTypeOptionsModel[a],e.selectedGoogleLevel=null,e.selectedGoogleId=null,u=!1)}"adwordaccount"==e.selectedGoogleLevel?(r?(e.messageEnable[a]=!0,u=!1):u=null!=e.profileOptionsModel&&null!=e.googleAccountId,e.checkComplete()):"adwordCampaign"==e.selectedGoogleLevel?(o?(e.messageEnable[a]=!0,u=!1):0==e.googleCampaignChosen?(u=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns()):u=null!=e.googleProfileId&&null!=e.googleAccountId&&null!=e.googleCampaign,e.checkComplete()):"adwordAdgroup"==e.selectedGoogleLevel?(s?(e.messageEnable[a]=!0,u=!1):1==e.googleCampaignChosen&&1==e.groupChosen?u=null!=e.profileOptionsModel&&null!=e.googleAccountId&&null!=e.googleCampaign&&null!=e.googleGroup:0==e.googleCampaignChosen&&0==e.groupChosen?(e.googleCampaignEnable=!0,e.getGoogleCampaigns()):1==e.googleCampaignChosen&&0==e.groupChosen?(e.googleCampaignEnable=!0,e.groupEnable=!0,e.getGoogleGroup(),u=!1):u=!1,e.checkComplete()):"adwordsAd"==e.selectedGoogleLevel&&(i?(e.messageEnable[a]=!0,u=!1):1==e.googleCampaignChosen&&1==e.groupChosen&&1==e.adChosen?u=null!=e.profileOptionsModel&&null!=e.googleAccountId&&null!=e.googleCampaign&&null!=e.googleGroup&&null!=e.googleAd:0==e.googleCampaignChosen&&0==e.groupChosen&&1==e.adChosen?(u=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns(),e.adChosen=!1,e.googleAd=null):1==e.googleCampaignChosen&&1==e.groupChosen&&0==e.adChosen?(u=!1,e.adEnable=!0,e.getGoogleAd()):0==e.googleCampaignChosen&&0==e.groupChosen&&0==e.adChosen?(u=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns()):1==e.googleCampaignChosen&&0==e.groupChosen&&0==e.adChosen?(u=!1,e.groupEnable=!0,e.getGoogleGroup()):1==e.googleCampaignChosen&&0==e.groupChosen&&1==e.adChosen?(u=!1,e.groupEnable=!0,e.getGoogleGroup(),e.adChosen=!1,e.googleAd=null):0==e.googleCampaignChosen&&1==e.groupChosen&&1==e.adChosen?(u=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns(),e.adChosen=!1,e.googleAd=null,e.groupChosen=!1,e.googleGroup=null):0==e.googleCampaignChosen&&1==e.groupChosen&&0==e.adChosen&&(u=!1,e.googleCampaignEnable=!0,e.getGoogleCampaigns(),e.adChosen=!1,e.googleAds=null,e.groupChosen=!1,e.googleGroup=null),e.checkComplete())},e.googleAdsCheck=function(t){var a=0;document.getElementById("basicWidgetFinishButton").disabled=!0,"campaign"==t?(e.googleGroup=null,e.groupChosen=!1,e.googleAd=null,e.adChosen=!1,e.adEnable=!1,e.groupEnable=!1,e.googleCampaign=this.googleCampaignOptionsModel,e.googleCampaign?e.googleCampaignChosen=!0:e.googleCampaignChosen=!1,a=1):"group"==t?(e.googleAd=null,e.adChosen=!1,e.adEnable=!1,e.googleGroup=this.groupOptionsModel,e.googleGroup?e.groupChosen=!0:e.groupChosen=!1,a=1):(e.googleAd=this.adOptionsModel,e.googleAd?e.adChosen=!0:e.adChosen=!1,a=1),1==a&&e.googleSelectLevelChosen()},e.getGoogleCampaigns=function(){var a=e.selectedGoogleId,r=e.googleAccountId,o=e.googleProfileId;t({method:"GET",url:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&accountId="+r+"&buster="+new Date}).then(function(t){e.googleCampaignList=t.data.objectList,e.googleCampaignOptionsModel=e.googleCampaignList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getGoogleGroup=function(){var a=e.selectedGoogleId,r=e.googleCampaign.channelObjectId,o=e.googleProfileId,s=e.googleAccountId,i="";i=1==e.canManage?"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&campaignId="+r+"&accountId="+s+"&buster="+new Date:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&campaignId="+r+"&accountId="+s+"&buster="+new Date,
t({method:"GET",url:i}).then(function(t){e.groupList=t.data.objectList,e.groupOptionsModel=e.groupList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.getGoogleAd=function(){var a=e.selectedGoogleId,r=e.googleGroup.channelObjectId,o=e.googleProfileId,s=e.googleAccountId,i="";i=1==e.canManage?"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&adSetId="+r+"&accountId="+s+"&buster="+new Date:"/api/v1/get/objects/"+o+"?objectTypeId="+a+"&adSetId="+r+"&accountId="+s+"&buster="+new Date,t({method:"GET",url:i}).then(function(t){e.adList=t.data.objectList,e.adOptionsModel=e.adList},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshGoogleCampaign=function(a){e.refreshGoogleCampaignLoading=!0;var r=a,o=e.googleAccountId,s=e.googleProfileId;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&accountId="+o+"&buster="+new Date}).then(function(t){e.googleCampaignList=t.data,e.googleCampaignOptionsModel=e.googleCampaignList,e.refreshGoogleCampaignLoading=!1},function(t){e.refreshGoogleCampaignLoading=!1,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span> .",html:!0})})},e.refreshGroup=function(a){e.refreshGroupLoading=!0;var r=a,o=e.googleCampaign.channelObjectId,s=e.googleProfileId,i=e.googleAccountId,n="";n=1==e.canManage?"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&campaignId="+o+"&accountId="+i+"&buster="+new Date:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&campaignId="+o+"&buster="+new Date,t({method:"GET",url:n}).then(function(t){e.groupList=t.data,e.groupOptionsModel=e.groupList,e.refreshGroupLoading=!1},function(t){e.refreshGroupLoading=!1,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},e.refreshAd=function(a){e.refreshAdLoading=!0;var r=a,o=e.googleGroup.channelObjectId,s=e.googleProfileId,i=e.googleAccountId,n="";n=1==e.canManage?"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&adSetId="+o+"&accountId="+i+"&buster="+new Date:"/api/v1/channel/profiles/objectsList/"+s+"?objectType="+r+"&adSetId="+o+"&buster="+new Date,t({method:"GET",url:n}).then(function(t){e.adList=t.data,e.adOptionsModel=e.adList,e.refreshAdLoading=!1},function(t){e.refreshAdLoading=!0,401===t.status?1003===t.data.errorstatusCode&&swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile!</span>",html:!0}):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})},e.checkComplete=function(){var t=e.getChannelList.map(function(e){return e.enable}).indexOf(!1);t!=-1&&e.profileCount?"Twitter"===e.getChannelList[t].name||"Instagram"===e.getChannelList[t].name?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:e.profileCount?0==h&&0==p?1==d?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:0==h&&1==p?1==d&&1==u?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:1==h&&0==p?1==d&&1==g?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0:1==h&&1==p&&(1==d&&1==u&&1==g?document.getElementById("basicWidgetFinishButton").disabled=!1:document.getElementById("basicWidgetFinishButton").disabled=!0):document.getElementById("basicWidgetFinishButton").disabled=!0},e.addNewProfile=function(t){function a(a,r,o,s){switch(e.getChannelList[t].name){case"Facebook":a="/api/v1/auth/facebook",r=e.getChannelList[t].name;break;case"Google Analytics":a="/api/v1/auth/google",r=e.getChannelList[t].name;break;case"FacebookAds":a="/api/auth/facebookads",r=e.getChannelList[t].name;break;case"Twitter":a="/api/auth/twitter",r=e.getChannelList[t].name;break;case"Instagram":a="/api/auth/instagram",r=e.getChannelList[t].name;break;case"GoogleAdwords":a="/api/auth/adwords",r=e.getChannelList[t].name;break;case"Mailchimp":a="/api/auth/mailchimp",r=e.getChannelList[t].name;break;case"Aweber":a="/api/auth/aweber",r=e.getChannelList[t].name}var i=screen.width/2-o/2,n=screen.height/2-s/2;return e.tokenExpired[t]=!1,window.open(a,r,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+o+", height="+s+", top="+n+", left="+i)}var r,o;a(r,o,1e3,500)},a.afterAuthentication=function(){e.getProfileForChosenChannel(e.fullOfDashboard)},e.removeExistingProfile=function(a){swal({title:"Confirm Profile Delink?",text:"All data, widgets associated with this profile will be deleted! Confirm?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Confirm",closeOnConfirm:!0},function(){e.profileOptionsModel[a]&&t({method:"POST",url:"/api/v1/post/removeProfiles/"+e.profileOptionsModel[a]._id}).then(function(t){e.getProfileForChosenChannel(e.fullOfDashboard)},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen recommended dashboards link</span>",html:!0})})})},e.refreshObjectsForChosenProfile=function(a){if("Google Analytics"===e.getChannelList[a].name&&(this.objectOptionsModel1[a]="",e.objectList[a]=""),this.profileOptionsModel[a]._id){switch(e.recommendedRefreshButton=e.getChannelList[a].name,e.getChannelList[a].name){case"Facebook":e.objectType="page";break;case"Google Analytics":e.objectType="gaview";break;case"FacebookAds":e.objectType="fbadaccount";break;case"Twitter":e.objectType="tweet";break;case"Instagram":e.objectType="instagram";break;case"GoogleAdwords":e.objectType="adwordaccount"}t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+this.profileOptionsModel[a]._id+"?objectType="+e.objectType+"&buster="+new Date}).then(function(t){e.objectList[a]=t.data,e.recommendedRefreshButton=""},function(t){e.recommendedRefreshButton="",401===t.status?1003===t.data.errorstatusCode&&(e.recommendedRefreshButton="",swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile</span>",html:!0}),e.getProfileForChosenChannel(e.fullOfDashboard)):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen widgets link</span>",html:!0})})}},e.refreshOtherObjects=function(a,r,o){var s=a;if(this.profileOptionsModel[r]._id){e.otherRefreshButton[o]=e.getChannelList[r].name;var i=this.profileOptionsModel[r]._id;t({method:"GET",url:"/api/v1/get/objectTypeDetail/"+s+"?buster="+new Date}).then(function(a){var n=a.data.objectType.type;t({method:"GET",url:"/api/v1/channel/profiles/objectsList/"+i+"?objectType="+n+"&buster="+new Date}).then(function(t){var a=t.data;e.otherObjectList[r][o]=[],e.objectForWidgetChosen(e.otherObjectList[r][o],r,o);for(var i=0;i<a.length;i++)s==a[i].objectTypeId&&e.otherObjectList[r][o].push(a[i]);e.otherRefreshButton[o]=""},function(t){e.otherRefreshButton[o]="",401===t.status?1003===t.data.errorstatusCode&&(e.otherRefreshButton[o]="",swal({title:"",text:"<span style='sweetAlertFont'>Please refresh your profile</span>",html:!0}),e.getProfileForChosenChannel(e.fullOfDashboard)):swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong!</span>",html:!0})})},function(t){e.otherRefreshButton[o]="",swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong!</span>",html:!0})})}},e.createRecommendedDashboard=function(){var a=[];t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=dashboards"}).then(function(r){r.data.availableDashboards<1?($("#errorInFinish").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Dashboards limit. Please upgrade to create more Dashboards</div>'),document.getElementById("basicWidgetFinishButton").disabled=!0):t({method:"GET",url:"/api/v1/subscriptionLimits?requestType=basic"}).then(function(r){if(e.widgetCount=r.data.availableWidgets,e.referenceWidgetsList.length<=e.widgetCount){var s={name:e.recommendeDashboardName};t({method:"POST",url:"/api/v1/create/dashboards",data:s}).then(function(r){for(var s=[],l=r.data,d=0;d<e.referenceWidgetsList.length;d++){for(var h=[],p=0;p<e.referenceWidgetsList[d].charts.length;p++){a=[];for(var g=0;g<e.storedUserChosenValues.length;g++)if(void 0!=e.storedUserChosenValues[g])for(var u=0;u<e.storedUserChosenValues[g].length;u++)if(e.referenceWidgetsList[d].charts[p].channelId===e.storedUserChosenValues[g][u].profile.channelId){for(var m=0;m<e.getChannelList.length;m++){var f,b;if(e.storedUserChosenValues[g][u].profile.channelId===e.getChannelList[m]._id){var y=i.fetchWidgetColor(e.getChannelList[m].name);f="Twitter"===e.getChannelList[m].name||"Instagram"===e.getChannelList[m].name||"Google Analytics"===e.getChannelList[m].name?e.referenceWidgetsList[d].name+" - "+e.storedUserChosenValues[g][u].profile.name:e.referenceWidgetsList[d].name+" - "+e.storedUserChosenValues[g][u].object.name,b=e.getChannelList[m].name}}for(var v=0;v<e.referenceWidgetsList[d].charts[p].metrics.length;v++)"FacebookAds"===b?(a.push(e.referenceWidgetsList[d].charts[p].metrics[v]),"fbadaccount"==e.selectedLevel?(a[0].objectTypeId=e.selectedObjectType._id,a[0].objectId=e.storedUserChosenValues[g][u].object._id):"fbAdcampaign"==e.selectedLevel?(a[0].objectTypeId=e.selectedObjectType._id,a[0].objectId=e.campaign._id,f=e.referenceWidgetsList[d].name+" - "+e.campaign.name):"fbAdSet"==e.selectedLevel?(a[0].objectTypeId=e.selectedObjectType._id,a[0].objectId=e.adSet._id,f=e.referenceWidgetsList[d].name+" - "+e.adSet.name):"fbAdSetAds"==e.selectedLevel&&(a[0].objectTypeId=e.selectedObjectType._id,a[0].objectId=e.adSetAds._id,f=e.referenceWidgetsList[d].name+" - "+e.adSetAds.name)):"GoogleAdwords"===b?(a.push(e.referenceWidgetsList[d].charts[p].metrics[v]),"adwordaccount"==e.selectedGoogleLevel?(a[0].objectTypeId=e.selectedGoogleObjectType._id,a[0].objectId=e.storedUserChosenValues[g][u].object._id):"adwordCampaign"==e.selectedGoogleLevel?(a[0].objectTypeId=e.selectedGoogleObjectType._id,a[0].objectId=e.googleCampaign._id,f=e.referenceWidgetsList[d].name+" - "+e.googleCampaign.name):"adwordAdgroup"==e.selectedGoogleLevel?(a[0].objectTypeId=e.selectedGoogleObjectType._id,a[0].objectId=e.googleGroup._id,f=e.referenceWidgetsList[d].name+" - "+e.googleGroup.name):"adwordsAd"==e.selectedGoogleLevel&&(a[0].objectTypeId=e.selectedGoogleObjectType._id,a[0].objectId=e.googleAd._id,f=e.referenceWidgetsList[d].name+" - "+e.googleAd.name)):e.referenceWidgetsList[d].charts[p].metrics[v].objectTypeId===e.storedUserChosenValues[g][u].object.objectTypeId&&(a.push(e.referenceWidgetsList[d].charts[p].metrics[v]),a[0].objectId=e.storedUserChosenValues[g][u].object._id)}a.length&&(e.referenceWidgetsList[d].charts[p].metrics=a,h.push(e.referenceWidgetsList[d].charts[p]))}if(e.referenceWidgetsList[d].charts=h,"fusion"===e.referenceWidgetsList[d].widgetType&&(b="custom"),h.length){var w={dashboardId:r.data,widgetType:e.referenceWidgetsList[d].widgetType,name:f,description:e.referenceWidgetsList[d].description,charts:h,order:e.referenceWidgetsList[d].order,offset:e.referenceWidgetsList[d].offset,size:e.referenceWidgetsList[d].size,minSize:e.referenceWidgetsList[d].minSize,maxSize:e.referenceWidgetsList[d].maxSize,isAlert:e.referenceWidgetsList[d].isAlert,color:y,channelName:b};s.push(w)}}t({method:"POST",url:"/api/v1/widgets",data:s}).then(function(e){n().then(function(){o.go("app.reporting.dashboard",{id:l})})},function(e){c=1,swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen recommended dashboards link</span>",html:!0})})},function(e){c=1,swal({title:"",text:"<span style='sweetAlertFont'>Please try again! Something is missing</span>",html:!0})})}else{var l=document.getElementById("scroller");l.scrollTop=0,$("#errorInFinish").html('<div class="alert alert-danger fade in" style="width: 400px;margin-left: 212px;"><button type="button" class="close close-alert" data-dismiss="alert" aria-hidden="true">×</button>You have reached your Widgets limit. Please upgrade to enjoy more Widgets</div>'),document.getElementById("basicWidgetFinishButton").disabled=!0}},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen recommended dashboards link</span> .",html:!0})})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})}}function SharedDashboardController(e,t,a,r,o,s,i,n,l){var c;e.loading=!1,e.$window=o,e.autoArrangeGrid=!1,e.currentDate=moment(new Date).format("YYYY-DD-MM"),e.summaryAlignLessThanThree=[],e.toDisplayAllSummary=[],e.checkAllGraphsZero=function(t,a,r){void 0==e.summaryAlignLessThanThree[a]&&(e.summaryAlignLessThanThree[a]=[]),void 0==e.toDisplayAllSummary[a]&&(e.toDisplayAllSummary[a]=[]);for(var o=0,s=0;s<t.data.length;s++)0===t.data[s].summaryDisplay&&(o+=1);e.summaryAlignLessThanThree[a][r]=t.data.length-o,o===t.data.length?e.toDisplayAllSummary[a][r]=!0:e.toDisplayAllSummary[a][r]=!1},e.dashboardConfiguration=function(){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-60,e.dashboard={widgets:[],widgetData:[]},e.dashboard.dashboardName="",e.widgetsPresent=!0,e.spinerEnable=!0,e.loadedWidgetCount=0,e.widgetErrorCode=0,e.startDate,e.endDate,e.fetchDateForDashboard=function(){var t,a="undefined";r({method:"GET",url:"/api/v1/getSubscriptionFromDashboard/"+a,params:{dashboardId:s.params.id}}).then(function(a){200==a.status?(t=a.data.response.limits.dateRange,e.userModifyDate(t)):e.userModifyDate(365)})},e.fetchDateForDashboard(),e.userModifyDate=function(t){e.dashboardCalendar=new Calendar({element:$(".daterange--double"),earliest_date:moment(new Date).subtract(t,"days"),latest_date:new Date,start_date:moment(new Date).subtract(30,"days"),end_date:new Date,callback:function(){moment(this.start_date).format("ll"),moment(this.end_date).format("ll");e.populateDashboardWidgets()}}),e.populateDashboardWidgets()},e.setChartSize=function(e,a){function r(){if(null!=document.getElementById("chartOptions"+e)){var t=document.getElementById("chartOptions"+e).offsetWidth,r=document.getElementById("chartOptions"+e).offsetHeight;document.getElementById("chartRepeat"+e+"-"+a).style.height=r+"px",document.getElementById("chartRepeat"+e+"-"+a).style.width=t+"px"}}t(r,100)},e.gridsterOptions={sparse:!0,margins:[20,20],maxRows:500,columns:6,defaultSizeX:2,defaultSizeY:2,minSizeX:1,minSizeY:1,swapping:!0,float:!0,pushing:!0,width:"auto",colWidth:"auto",draggable:{enabled:!1},outerMargin:!0,mobileBreakPoint:700,mobileModeEnabled:!0,resizable:{enabled:!1}},e.$on("gridster-resized",function(a,r){function o(e){return function(){if(null!=document.getElementById("chartOptions"+e))for(var t=document.getElementById("chartOptions"+e).offsetWidth,a=document.getElementById("chartOptions"+e).offsetHeight,r=0;r<Highcharts.charts.length;r++)Highcharts.charts[r].container.parentElement.id.includes("chartRepeat"+e)&&(Highcharts.charts[r].setSize(t,a),Highcharts.charts[r].reflow())}}for(var s=0;s<e.dashboard.widgets.length;s++)t(o(s),10)}),e.$on("gridster-mobile-changed",function(t,a){e.isMobile=a.isMobile}),angular.element(o).on("resize",function(t){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-60,e.$broadcast("resize")}),e.$on("resize",function(a){function r(e){return function(){if(null!=document.getElementById("chartOptions"+e))for(var t=document.getElementById("chartOptions"+e).offsetWidth,a=document.getElementById("chartOptions"+e).offsetHeight,r=0;r<Highcharts.charts.length;r++)Highcharts.charts[r].container.parentElement.id.includes("chartRepeat"+e)&&(Highcharts.charts[r].setSize(t,a),Highcharts.charts[r].reflow())}}for(var o=0;o<e.dashboard.widgets.length;o++)t(r(o),100)}),e.calculateColumnWidth=function(e,t,a){return t=Math.floor(t/a),t<1&&(t=1),1==t?"col-sm-12 col-md-12 col-lg-12":2==t?e<=2?"col-sm-12 col-md-12 col-lg-12":"col-sm-6 col-md-6 col-lg-6":e<=2?"col-sm-12 col-md-12 col-lg-12":e>2&&e<=4?"col-sm-6 col-md-6 col-lg-6":"col-sm-4 col-md-4 col-lg-4"},e.calculateColumnWidthMoz=function(e,t,a){return 1==t?"col-sm-12 col-md-12 col-lg-12":t>=2&&t<=4?"col-sm-4 col-md-4 col-lg-4":t>=5?"col-sm-2 col-md-2 col-lg-2":void 0},e.calculateRowHeight=function(e,t,a,r,o){e.showComparision=!0},e.calculateSummaryHeight=function(e,t){var a;return a=1==t&&1==e?20:100/e,{height:a+"%"}},e.calculateSummaryHeightMoz=function(e,t){var a;return a=1==t&&1==e?20:100/e,{height:a+"%"}},e.calculateChartHeight=function(a,r,o){t(function(){var t;t=1==r&&1==a?80:100-100/a,e.chartOptions=t+"%";var s=document.getElementById("updateHeight"+o);s.style.margin="0px",s.style.height=t+"%"},1e3)}},a.populateDashboardWidgets=function(){e.dashboard.widgets=[],e.dashboard.widgetData=[],r({method:"GET",url:"/api/v1/dashboards/widgets/null",params:{reportId:s.params.id}}).then(function(t){if($(".dr-dates").attr("contenteditable","false"),t.data)if(t.data.error)isExportOptionSet=0,swal({title:"",text:'<span style = "sweetAlertFont">The requested dashboard has no widgets</span>',html:!0});else{c=t.data.widgetsList._id,e.dashboard.dashboardName=t.data.dashboardDetails.name;var a=[],r=t.data.widgetsList;for(s in r)1==r[s].visibility&&a.push(r[s]);a.length>0?(e.loadedWidgetCount=0,e.widgetsPresent=!0,e.spinerEnable=!1):(e.widgetsPresent=!1,e.spinerEnable=!1);var o=[];for(var s in a)o.push(n.widgetHandler(a[s],{startDate:moment(e.dashboardCalendar.start_date).format("YYYY-MM-DD"),endDate:moment(e.dashboardCalendar.end_date).format("YYYY-MM-DD")},"public")),e.dashboard.widgets.push({row:"undefined"!=typeof a[s].row?a[s].row:0,col:"undefined"!=typeof a[s].col?a[s].col:0,sizeY:"undefined"!=typeof a[s].size?a[s].size.h:2,sizeX:"undefined"!=typeof a[s].size?a[s].size.w:2,minSizeY:"undefined"!=typeof a[s].minSize?a[s].minSize.h:1,minSizeX:"undefined"!=typeof a[s].minSize?a[s].minSize.w:1,maxSizeY:"undefined"!=typeof a[s].maxSize?a[s].maxSize.h:3,maxSizeX:"undefined"!=typeof a[s].maxSize?a[s].maxSize.w:3,name:"undefined"!=typeof a[s].name?a[s].name:"",widgetType:"undefined"!=typeof a[s].widgetType?a[s].widgetType:"",isAlert:"undefined"!=typeof a[s].isAlert&&a[s].isAlert,id:a[s]._id,visibility:!1,channelName:"undefined"!=typeof a[s].channelName?a[s].channelName:""}),e.dashboard.widgetData.push({id:a[s]._id,chart:[],visibility:!1,dataerror:!1,name:"undefined"!=typeof a[s].name?a[s].name:"",color:"undefined"!=typeof a[s].color?a[s].color:""}),o[s].then(function(t){var a=e.dashboard.widgets.map(function(e){return e.id}).indexOf(t.id);e.dashboard.widgetData[a]=t,isExportOptionSet=1,e.loadedWidgetCount++},function(t){401===t.status?($("#widgetData-"+t.data.id).hide(),1003===t.data.errorstatusCode&&($("#widgetData-"+t.data.id).hide(),$("#errorWidgetData-"+t.data.id).hide(),$("#errorWidgetTokenexpire-"+t.data.id).show(),e.widgetErrorCode=1,e.loadedWidgetCount++,isExportOptionSet=0)):(e.loadedWidgetCount++,"undefined"!=typeof t.data.id&&($("#widgetData-"+t.data.id).hide(),$("#errorWidgetData-"+t.data.id).show(),$("#errorWidgetTokenexpire-"+t.data.id).hide(),isExportOptionSet=0))})}else isExportOptionSet=0,swal({title:"",text:'<span style = "sweetAlertFont">The requested dashboard has been deleted</span>',html:!0})},function(e){swal({title:"",text:'<span style = "sweetAlertFont">Error in populating widgets! Please refresh the dashboard again</span>',html:!0}),isExportOptionSet=0})},e.toggleLegends=function(t){for(var a in e.dashboard.widgetData)if(e.dashboard.widgetData[a].id==t)for(var r in e.dashboard.widgetData[a].chart)"undefined"!=typeof e.dashboard.widgetData[a].chart[r].options.chart.showLegend&&(1==e.dashboard.widgetData[a].chart[r].options.chart.showLegend?e.dashboard.widgetData[a].chart[r].options.chart.showLegend=!1:e.dashboard.widgetData[a].chart[r].options.chart.showLegend=!0)}}function SwitchController(e,t,a,r,o,s,i){}function TopNavbarController(e,t,a,r){e.theBestVideo="sMKoNBRZM1M",e.anotherGoodOne="https://www.youtube.com/watch?v=18-xvIjH8T4",$(".modifyUserModalContent").on("click",function(e){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#modifyUserModalContent").addClass("md-show")}),$(".newAccountModalContent").on("click",function(e){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#newAccountModalContent").addClass("md-show")}),$("#step16").on("click",function(e){$(".navbar").css("z-index","1"),$(".md-overlay").css("background","rgba(0,0,0,0.5)"),$("#videoTourModalContent").addClass("md-show")}),e.getDropdown=function(){document.getElementById("myDropdown").classList.toggle("show")},window.onclick=function(e){if(e.target.matches(".topdropbtn")||e.target.matches(".glyphicon.glyphicon-chevron-down")){var t,r=document.getElementsByClassName("dropdown-content");for(t=0;t<r.length;t++){var o=r[t];o.classList.contains("shw")&&o.classList.remove("shw")}}else if(e.target.matches(".fa.fa-cog")){var r=document.getElementById("myDropdown");r.classList.contains("show")&&r.classList.remove("show")}else if(a.dropDownActive=a.dropDownActive||!1,0==a.dropDownActive){var r=document.getElementById("myDropdown");r.classList.contains("show")&&r.classList.remove("show");var t,s=document.getElementsByClassName("dropdown-content");for(t=0;t<s.length;t++){var o=s[t];o.classList.contains("shw")&&o.classList.remove("shw")}}}}function UpgradeController(e,t,a,r,o){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-60,angular.element(o).on("resize",function(t){e.docHeight=window.innerHeight,e.docHeight=e.docHeight-60,e.$broadcast("resize")});var s,i,n={free:0,starter:1,advanced:2,premium:3,agency:4};e.getSubscriptions=function(){t({method:"GET",url:"/api/v1/me"}).then(function(t){r.subscriptionDetails=t.data.userDetails,e.subscriptionType=r.subscriptionDetails.subscriptionType.code},function(e){}),t({method:"POST",url:"/api/v1/updateUserSubscription"}).then(function(e){s=e;var t=n[e.data.response.code];document.getElementById("enableStarter").disabled=!0,document.getElementById("enableAdvanced").disabled=!0,document.getElementById("enablePremium").disabled=!0,document.getElementById("enableAgency").disabled=!0,"free"===String(t)?(document.getElementById("enableStarter").disabled=!1,document.getElementById("enableAdvanced").disabled=!1,document.getElementById("enablePremium").disabled=!1,document.getElementById("enableAgency").disabled=!1):(n.starter>=t&&(document.getElementById("enableStarter").disabled=!1),n.advanced>=t&&(document.getElementById("enableAdvanced").disabled=!1),n.premium>=t&&(document.getElementById("enablePremium").disabled=!1),n.agency>=t&&(document.getElementById("enableAgency").disabled=!1)),n[e.data.response.code]===t?($(".startedButton_"+e.data.response.code).hide(),$(".RenewalButton_"+e.data.response.code).show()):($(".startedButton_"+e.data.response.code).show(),$(".RenewalButton_"+e.data.response.code).hide())},function(){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},e.loadCheckoutForm=function(o){var n,l,c={code:o},d={};t({method:"POST",url:"/api/v1/updateUserSubscription",data:c}).then(function(o){if(l=s.data.response.subscriptionCost/30,s.data.response.code===o.data.response.code){if(d.expDate=s.data.orgDetails.subscriptionExpiresOn,moment(s.data.orgDetails.subscriptionExpiresOn).diff(moment(new Date),"days")<=15)var c=!0;else var c=!1;var h=o.data.response.subscriptionCost}else{var c=!0;if(moment(s.data.orgDetails.subscriptionExpiresOn).format("YYYY-MM-DD")>=moment(new Date).format("YYYY-MM-DD")){n=moment(s.data.orgDetails.subscriptionExpiresOn).format("YYYY-MM-DD")===moment(new Date).format("YYYY-MM-DD")?1:moment(s.data.orgDetails.subscriptionExpiresOn).diff(moment(new Date),"days");var h=(o.data.response.subscriptionCost-l*n).toFixed(2)}}if(c){var p={key:o.data.apiKey,amount:100*h,name:"Datapoolt",description:"Purchase Description",image:"https://www.datapoolt.co/wp-content/uploads/2016/10/Logo@3x.png",handler:function(s){d.paymentId=s.razorpay_payment_id,d.amount=100*h,d.orgId=o.data.orgDetails._id,d.subscriptionId=o.data.response._id,d.subscription=o.data.response,t({method:"POST",url:"/api/v1/payment/capture",data:d}).then(function(t){200===t.data.error?(r.getReportBuilder(),e.subscriptionType=o.data.response.code,toastr.info("Your payment is completed successfully !"),a.go("app.reporting.accountManagement")):(toastr.info("Your payment is failed.Please try again."),a.go("app.reporting.accountManagement"))},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},theme:{color:"#232c3b"}};e.showCheckoutForm=!0,i=new Razorpay(p),i.open()}else toastr.info("You can't renew the subscription prior to 15 days of current subscription's expiration date")},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})}}function UserManagementController(e,t,a,r,o){e.userloading=!0,e.users=null,e.username,e.fetchAllUser=function(){t({method:"GET",url:"/api/v1/getUsersUnderAdmin/"}).then(function(t){e.users=_.orderBy(t.data.users,["roleId"]),e.userloading=!1},function(t){e.userloading=!1,swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},e.removeExistingUser=function(t){swal({title:"Are you sure you want to Delete? ",text:"All dashboards, alerts, reports created by this user will be deleted as well",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete this user",closeOnConfirm:!0},function(){e.removeUser(t)})},e.removeUser=function(a){e.userloading=!0;var r={userId:a};t({method:"POST",url:"/api/v1/removeUserUnderAdmin/",data:r}).then(function(t){e.userloading=!1;var r=e.users.map(function(e){return e._id}).indexOf(a);r!=-1&&e.users.splice(r,1)},function(t){e.userloading=!1,swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})},e.changeUserName=function(e,a){var r={id:e,name:a};t({method:"POST",url:"/api/v1/changeUserName/",data:r}).then(function(e){},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again!</span> .",html:!0})})}}function WidgetSettingsController(e,t,a,r,o,s){e.widget=a,e.form={id:a.id,name:a.name,type:a.widgetType},e.widgetsList=[],e.selectedWidgetsList=[],e.dashboardWidgets=[],e.dismiss=function(){e.widgetsList=[],e.selectedWidgetsList=[],e.dashboardWidgets=[],t.dismiss()},e.remove=function(){e.dashboard.widgets.splice(e.dashboard.widgets.indexOf(a),1),t.close()},e.submit=function(){var s=[],i={dashboardId:o.params.id,widgetId:e.form.id,name:e.form.name};s.push(i),r({method:"POST",url:"/api/v1/update/widgets",data:s}).then(function(t){e.renameWidget=[];var a=e.dashboard.widgets.map(function(e){return e.id}).indexOf(t.data.widgetsList[0]._id);e.dashboard.widgetData[a].name=t.data.widgetsList[0].name,angular.extend(e.widget,e.form)},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen settings to rename the widget</span> .",html:!0})}),t.close(a)},e.changeViews=function(t){e.currentView=t,s.currentModalView=t,"step_one"===e.currentView&&(e.widgetsList=[],e.selectedWidgetsList=[])},e.selectedFusableWidgets=function(){e.changeViews("step_two"),e.dashboardWidgets.length>0?e.dashboardWidgets.forEach(function(t,a){t._id!=e.widget.id&&"customFusion"!=t.widgetType&&e.widgetsList.push({id:t._id,label:t.name,widgetType:t.widgetType})}):r({method:"GET",url:"/api/v1/dashboards/widgets/"+o.params.id+"?buster="+new Date}).then(function(t){var a;a=t.data.widgetsList,a.forEach(function(t,a){t._id!=e.widget.id&&"customFusion"!=t.widgetType&&0!=t.visibility&&e.widgetsList.push({id:t._id,label:t.name,widgetType:t.widgetType})})},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please reopen settings to fuse the widget</span> .",html:!0})})},e.createCustomFusionWidget=function(){var t=[],i="customFusion",n=[];if(e.selectedWidgetsList.length>0){e.selectedWidgetsList.forEach(function(e){n.push({widgetId:e.id,widgetType:e.widgetType})}),n.push({widgetId:a.id,widgetType:a.widgetType});var l={dashboardId:o.params.id,name:"Custom Fusion",widgetType:i,widgets:n,size:{h:2,w:4},minSize:{h:2,w:4},maxSize:{h:3,w:6},color:"#1F77B4",channelName:"customFusion"};t.push(l),r({method:"POST",url:"/api/v1/widgets",data:t}).then(function(t){s.populateDashboardWidgets(),e.dismiss()},function(e){swal({title:"",text:"<span style='sweetAlertFont'>Something went wrong! Please try again</span> .",html:!0})})}else swal({title:"",text:"<span style='sweetAlertFont'>Please choose at least one widget</span> .",html:!0})},e.pushSelectedWidgets=function(e,t,a){var r=t.indexOf(e);r!=-1&&(t.splice(r,1),a.push(e))}}config.$inject=["$translateProvider"],pageTitle.$inject=["$rootScope","$timeout"],sideNavigation.$inject=["$timeout"],iboxTools.$inject=["$timeout"],minimalizaSidebar.$inject=["$timeout"],icheck.$inject=["$timeout"],chatSlimScroll.$inject=["$timeout"],fullScroll.$inject=["$timeout"],iboxToolsFullScreen.$inject=["$timeout"],slimScroll.$inject=["$timeout"],hcChart.$inject=["$timeout"],fileModel.$inject=["$parse"],AccountManagementController.$inject=["$scope","$http","$location","$window"],addNewUserController.$inject=["$scope","$http","$window","$state","$rootScope"],AlertController.$inject=["$scope","$http","$q","$state","$rootScope","$window","$stateParams","generateChartColours"],AppController.$inject=["$http","$state","$scope","$rootScope"],BasicWidgetController.$inject=["$scope","$http","$state","$rootScope","$window","$stateParams","generateChartColours","$q"],buildReportController.$inject=["$scope","$http","$window","$timeout"],ChangePasswordController.$inject=["$scope","$http","$location","$window"],ChooseDashboardController.$inject=["$scope","$state","$q","$http","$stateParams","$rootScope"],customReportController.$inject=["$scope","$timeout","$rootScope","$http","$window","$state","$stateParams","createWidgets","$q"],CustomWidgetController.$inject=["$scope","$uibModal"],DashboardController.$inject=["$scope","$timeout","$rootScope","$http","$window","$state","$stateParams","createWidgets","$q","$compile"],ExportController.$inject=["$scope","$http","$state","$rootScope","$window","$q","$stateParams","$timeout"],FusionSettingsController.$inject=["$scope","$uibModalInstance","widget","$http","$state","$rootScope"],FusionWidgetController.$inject=["$scope","$http","$q","$window","$state","$rootScope","generateChartColours"],GridviewController.$inject=["$scope","$http","$window","$rootScope"],LightBoxController.$inject=["$scope","$uibModal","$log","$state","$rootScope"],MainCtrl.$inject=["$scope","$rootScope","$http","$timeout"],ModalInstanceController.$inject=["$scope","$rootScope","$http","$uibModalInstance"],NavigationController.$inject=["$scope","$state","$http","$stateParams","$rootScope"],ProfileListController.$inject=["$scope","$http","$window","$stateParams"],RecommendedDashboardController.$inject=["$scope","$http","$window","$q","$state","$rootScope","generateChartColours"],SharedDashboardController.$inject=["$scope","$timeout","$rootScope","$http","$window","$state","$stateParams","createWidgets","$q"],SwitchController.$inject=["$scope","$http","$state","$rootScope","$window","$stateParams","generateChartColours"],TopNavbarController.$inject=["$scope","$http","$rootScope","$state"],
UpgradeController.$inject=["$scope","$http","$state","$rootScope","$window"],UserManagementController.$inject=["$scope","$http","$window","$state","$rootScope"],WidgetSettingsController.$inject=["$scope","$uibModalInstance","widget","$http","$state","$rootScope"],angular.module("inspinia").config(config),angular.module("inspinia").directive("pageTitle",pageTitle).directive("sideNavigation",sideNavigation).directive("iboxTools",iboxTools).directive("minimalizaSidebar",minimalizaSidebar).directive("vectorMap",vectorMap).directive("sparkline",sparkline).directive("icheck",icheck).directive("ionRangeSlider",ionRangeSlider).directive("dropZone",dropZone).directive("responsiveVideo",responsiveVideo).directive("chatSlimScroll",chatSlimScroll).directive("customValid",customValid).directive("fullScroll",fullScroll).directive("closeOffCanvas",closeOffCanvas).directive("clockPicker",clockPicker).directive("landingScrollspy",landingScrollspy).directive("fitHeight",fitHeight).directive("iboxToolsFullScreen",iboxToolsFullScreen).directive("slimScroll",slimScroll).directive("channelDiv",channelDiv).directive("chartHeight",chartHeight).directive("sizeWatcher",sizeWatcher).directive("expSizeWatcher",expSizeWatcher).directive("hcChart",hcChart).directive("fileModel",fileModel);var showMetricApp=angular.module("inspinia");showMetricApp.service("createWidgets",["$http","$q",function(e,t){this.widgetHandler=function(a,r,o){function s(a,r){function o(a,r){var o=t.defer();if(r)var s={method:"GET",url:"/api/v1/widget/"+a+"?isPublic="+r,timeout:f.promise,cancel:f};else var s={method:"GET",url:"/api/v1/widget/"+a,timeout:f.promise,cancel:f};return e(s).then(function(e){o.resolve(e.data[0])},function(e){o.reject(e)}),o.promise}var s=t.defer(),i=[];for(var n in a.widgets){var l=a.widgets[n].widgetType;"basic"!=l&&"adv"!=l&&"fusion"!=l&&"custom"!=l||i.push(o(a.widgets[n].widgetId,r))}return t.all(i).then(function(e){s.resolve(e)},function(e){s.reject(e)}),s.promise}function i(a,r){var o=t.defer(),s=[],i=0;return e({method:"POST",url:"/api/v1/customWidget/data/"+a._id,data:{startDate:r.startDate,endDate:r.endDate},timeout:f.promise,cancel:f}).then(function(e){i++;for(var t in e.data)e.data[t].widgetId==a._id&&s.push({_id:e.data[t]._id,chartName:"Custom Data "+i,chartType:e.data[t].chartType,widgetId:e.data[t].widgetId,chartData:e.data[t].data,intervalType:e.data[t].intervalType,metricsCount:e.data[t].metricsCount});a.charts=s,o.resolve(a)},function(e){o.reject(e)}),o.promise}function n(e){var a=t.defer(),r=[];for(var o in e.charts){var s=[];if("line"==e.charts[o].chartType||"bar"==e.charts[o].chartType||"column"==e.charts[o].chartType||"area"==e.charts[o].chartType)for(var i in e.charts[o].chartData){var n=0;for(var l in r)if(r[l].key==e.charts[o].chartData[i].name){s=r[l].values;var c={x:moment(e.charts[o].chartData[i].date),y:e.charts[o].chartData[i].values};s.push(c),s.sort(function(e,t){var a=new Date(e.x),r=new Date(t.x);return a-r}),r[l].values=s,n=1}if(1!=n){s=[];var c={x:moment(e.charts[o].chartData[i].date),y:e.charts[o].chartData[i].values};s.push(c),s.sort(function(e,t){var a=new Date(e.x),r=new Date(t.x);return a-r}),r.push({type:e.charts[o].chartType,values:s,key:e.charts[o].chartData[i].name,color:null})}}else if("pie"==e.charts[o].chartType)for(var i in e.charts[o].chartData){var n=0;for(l in r){var d=0;r[l].key==e.charts[o].chartData[i].name&&(d=parseInt(r[l].y),r[l].y=parseInt(d)+parseInt(e.charts[o].chartData[i].values),n=1)}1!=n&&r.push({type:e.charts[o].chartType,y:parseInt(e.charts[o].chartData[i].values),key:e.charts[o].chartData[i].name,color:null})}}return a.resolve(r),a.promise}function l(e,a){var r,s=t.defer();return r=c(e,a,o),r.then(function(t){e.charts=t,s.resolve(e)},function(e){s.reject(e)}),s.promise}function c(a,r,o){var s=t.defer(),i=[];if(o)var n={method:"POST",url:"/api/v1/widgets/data/"+a._id,data:{startDate:r.startDate,endDate:r.endDate,params:"public"}};else var n={method:"POST",url:"/api/v1/widgets/data/"+a._id,data:{startDate:r.startDate,endDate:r.endDate,widId:a._id},timeout:f.promise,cancel:f};return e(n).then(function(e){for(var t in a.charts)for(var r in e.data)String(a.charts[t].metrics[0].metricId)===String(e.data[r].metricId)&&i.push({channelId:a.charts[t].channelId,chartType:"undefined"!=typeof a.charts[t].metrics[0].chartType?a.charts[t].metrics[0].chartType:"",chartSubType:void 0!=a.charts[t].metrics[0].subChartType?a.charts[t].metrics[0].subChartType:"",chartName:a.charts[t].name,chartColour:a.charts[t].metrics[0].color,chartOptions:a.charts[t].metrics[0].chartOptions,chartMetricId:e.data[r].metricId,metricDetails:e.data[r].metricDetails,chartObjectId:e.data[r].objectId,chartObjectTypeId:a.charts[t].metrics[0].objectTypeId,chartObjectName:a.charts[t].objectName,chartData:e.data[r].data});s.resolve(i)},function(e){b.widgets.length>0?(k=b.widgets.map(function(e){return e._id}).indexOf(e._id),k!==-1&&(e.data.id=b._id),s.reject(e)):s.reject(e)}),s.promise}function d(e,a){function r(e,t){return t>e?t-e:e-t}function r(e,t){return t>e?t-e:e-t}function o(e){for(var t=0,a=0;a<e.length;a++)t+=parseFloat(e[a].value);return t}function s(e){for(var t=0,a=0;a<e.length;a++)t+=parseFloat(e[a].value);return t}function i(e){for(var t=0,a=0;a<e.length;a++)t+=parseFloat(e[a].value);return t}function o(e){for(var t=0,a=0;a<e.length;a++)t+=parseFloat(e[a].value);return t}function s(e){for(var t=0,a=0;a<e.length;a++)t+=parseFloat(e[a].value);return t}function i(e){for(var t=0,a=0;a<e.length;a++)t+=parseFloat(e[a].value);return t}function o(e){for(var t=0,a=0;a<e.length;a++)t+=parseFloat(e[a].value);return t}var n=t.defer(),l=[],c={Facebook:"FB",Twitter:"TW","Google Analytics":"GA","Facebook Ads":"FBAds","Google Adwords":"GAds",Instagram:"In",Pinterest:"Pi",Mailchimp:"Mc",Vimeo:"Vi",Linkedin:"Lin",Youtube:"YT",Moz:"Moz","Google Sheets":"GSheet",Aweber:"AW"},d=-1,h=0;if(e.charts.length>0){for(var g in e.charts){var u=e.charts[g].chartType;switch(u){case"bounceRateArea":var m=[];if("object"==typeof e.charts[g].chartData[0].total)for(var f=0;f<e.charts[g].chartData.length;f++){var b=parseFloat(e.charts[g].chartData[f].total[0].bounces),y=parseFloat(e.charts[g].chartData[f].total[0].sessions);if(0===y)var v=b;else var v=(b/y*100).toFixed(2);m.push({x:moment(e.charts[g].chartData[f].date),y:v,bounces:b,sessions:Math.round(100*y)/100})}e.charts[g].chartData=m;break;case"costPerClick":case"costPerThosuandImpressions":case"clickThroughRate":case"ConversionRate":case"costPerConversion":var m=[];if("costPerClick"==u)var w="Cost",D="Clicks";else if("costPerThosuandImpressions"==u)var w="Cost",D="Impressions";else if("clickThroughRate"==u)var w="Clicks",D="Impressions";else if("ConversionRate"==u)var w="Conversions",D="Clicks";else if("costPerConversion"==u)var w="Cost",D="Conversions";for(var f=0;f<e.charts[g].chartData.length;f++){var C=0,x=0;if("object"==typeof e.charts[g].chartData[f].total[0]&&(C="Cost"===w?parseFloat(e.charts[g].chartData[f].total[0][w]/1e6).toFixed(2):parseFloat(e.charts[g].chartData[f].total[0][w]),x=parseFloat(e.charts[g].chartData[f].total[0][D])),0===C)var T=C;else if("costPerThosuandImpressions"==u)var T=(C/x*1e3).toFixed(2);else if("clickThroughRate"==u||"clickThroughRate"==u||"costPerConversion"==u)var T="Infinity"===(C/x*100).toFixed(2)?0:(C/x*100).toFixed(2);else var T=(C/x).toFixed(2);m.push({x:moment(e.charts[g].chartData[f].date),y:T,dividend:C,divisor:x})}e.charts[g].chartData=m;break;case"line":case"area":case"bar":case"column":case"stackcolumn":case"mozoverview":case"negativeBar":if("object"==typeof e.charts[g].chartData[0].total){var A,S=e.charts[g].chartCode;for(ae in e.charts[g].metricDetails.objectTypes)e.charts[g].metricDetails.objectTypes[ae].objectTypeId==e.charts[g].chartObjectTypeId&&(A=e.charts[g].metricDetails.objectTypes[ae].meta.endpoint,e.charts[g].metricDetails.objectTypes[ae].meta.endpoint=void 0!=e.charts[g].metricDetails.objectTypes[ae].meta.endpointDisplay?e.charts[g].metricDetails.objectTypes[ae].meta.endpointDisplay:e.charts[g].metricDetails.objectTypes[ae].meta.endpoint);var L=[];if(0!=A.length)for(or in A){var I=A[or],k=[];for(U in e.charts[g].chartData){var F,j=0;if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)if(P.search("/")>-1){F=P.split("/");for(var E in F)F[E]==I&&(j+=parseFloat(e.charts[g].chartData[U].total[P]))}else P==I&&(j=e.charts[g].chartData[U].total[I]);k.push({x:moment(e.charts[g].chartData[U].date),y:Math.round(100*j)/100})}L.push(k)}else{var k=[];if("fbTopReferringDomain"===e.charts[g].chartSubType){for(var W=[],O=0;O<e.charts[g].chartData.length;O++)if("object"==typeof e.charts[g].chartData[O].total)for(var N in e.charts[g].chartData[O].total)W.push({domain:N,value:e.charts[g].chartData[O].total[N]});var B=_.groupBy(W,"domain");for(var R in B){for(var M=R,z=0,f=0;f<B[R].length;f++)z+=parseFloat(B[R][f].value);k.push({x:M,y:isNaN(z)?0:z})}}else for(U in e.charts[g].chartData){var H,F,j=0,G=e.charts[g].chartData[U].total;if(null!=e.charts[g].chartData[U].total&&0!=Object.keys(e.charts[g].chartData[U].total).length){for(var P in e.charts[g].chartData[U].total){if(P.search("/")>-1){F=P.split("/");for(var E in F)j+=parseFloat(e.charts[g].chartData[U].total[P]),H=P}else j=e.charts[g].chartData[U].total[I];H=P}k.push({x:H,y:Math.round(100*j)/100})}}L.push(k)}var Y=[];if("userinteractions_clicks"==S&&"Facebook"==e.channelName){for(var f=0;f<L.length;f++)for(var V=0;V<L[f].length;V++)Y[V]||(Y[V]={x:0,y:0}),Y[V].x=L[0][V].x,Y[V].y+=L[f][V].y;L=Y}e.charts[g].chartData=L}else{var k=[];for(var U in e.charts[g].chartData)k.push({x:moment(e.charts[g].chartData[U].date),y:null!=e.charts[g].chartData[U].total?Math.round(100*e.charts[g].chartData[U].total)/100:0});e.charts[g].chartData=k}if("fbTopReferringDomain"===e.charts[g].chartSubType){var q=_.sortBy(k,"y").reverse(),X=[];if(k.length<10)var J=k.length-1;else var J=9;for(var O=0;O<=J;O++)X.push({x:q[O].x,y:q[O].y});e.charts[g].chartData=X}break;case"reachVsImpressions":case"engagedUsersReach":if("Total Impressions"==e.charts[g].chartName||"Engaged Users"==e.charts[g].chartName){for(var K=[],Z=[],f=0;f<e.charts.length;f++)"Total Impressions"!=e.charts[f].chartName&&"Engaged Users"!=e.charts[f].chartName||(K=e.charts[f].chartData),"Total Reach"==e.charts[f].chartName&&(Z=e.charts[f].chartData);var Q=[];for(var ee in K){var te=K[ee].total/Z[ee].total*100;!isNaN(te)&&isFinite(te)||(te=0),Q.push({x:moment(K[ee].date),y:parseFloat(te).toFixed(2),imp:K[ee].total,rea:Z[ee].total})}e.charts[g].chartData=Q}else{var k=[];for(var U in e.charts[g].chartData)k.push({x:moment(e.charts[g].chartData[U].date),y:null!=e.charts[g].chartData[U].total?e.charts[g].chartData[U].total:0});e.charts[g].chartData=k}break;case"trafficSourcesBrkdwnLine":if("object"==typeof e.charts[g].chartData[0].total){var A;for(ae in e.charts[g].metricDetails.objectTypes)e.charts[g].metricDetails.objectTypes[ae].objectTypeId==e.charts[g].chartObjectTypeId&&(A=e.charts[g].metricDetails.objectTypes[ae].meta.endpoint);var L=[];for(U in e.charts[g].chartData){var F,j=0;if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)e.charts[g].chartData[U].total["social/Yes"]="undefined"!=typeof e.charts[g].chartData[U].total["social/Yes"]?Number(e.charts[g].chartData[U].total["social/Yes"]):0,P.search("/")>-1&&(F=P.split("/"),"Yes"==F[1]&&(e.charts[g].chartData[U].total["social/Yes"]+=Number(e.charts[g].chartData[U].total[P]),e.charts[g].chartData[U].total[P]=0))}for(or in A){var I=A[or],k=[];for(U in e.charts[g].chartData){var F,j=0;if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)if(P.search("/")>-1){F=P.split("/");for(var E in F)F[E]==I&&(j+=parseFloat(e.charts[g].chartData[U].total[P]))}else P==I&&(j=e.charts[g].chartData[U].total[I]);k.push({x:moment(e.charts[g].chartData[U].date),y:Math.round(100*j)/100})}L.push(k)}e.charts[g].chartData=L}else{var k=[];for(var U in e.charts[g].chartData)k.push({x:moment(e.charts[g].chartData[U].date),y:null!=e.charts[g].chartData[U].total?Math.round(100*e.charts[g].chartData[U].total)/100:0});e.charts[g].chartData=k}break;case"pie":if("object"==typeof e.charts[g].chartData[0].total){var A=[];for(var ae in e.charts[g].metricDetails.objectTypes)e.charts[g].metricDetails.objectTypes[ae].objectTypeId==e.charts[g].chartObjectTypeId&&(A=e.charts[g].metricDetails.objectTypes[ae].meta.endpoint);var L=[];for(or in A){var I=A[or];k=[];var j=0;for(U in e.charts[g].chartData)if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)if(P.search("/")>-1){F=P.split("/");for(var E in F)F[E]==I&&(j+=parseFloat(e.charts[g].chartData[U].total[P]))}else P==I&&(j+=parseFloat(e.charts[g].chartData[U].total[I]));k.push({y:parseFloat(j).toFixed(2)%Math.floor(parseFloat(j).toFixed(2))>0?parseFloat(j).toFixed(2):parseFloat(j).toFixed(2)>1?parseInt(j):parseFloat(j)>0?parseFloat(j).toFixed(2):parseInt(j)}),L.push(k)}e.charts[g].chartData=L}else{var j=0;for(U in e.charts[g].chartData)j+=parseFloat(e.charts[g].chartData[U].total);k.push({y:parseFloat(j).toFixed(2)%Math.floor(parseFloat(j).toFixed(2))>0?parseFloat(j).toFixed(2):parseFloat(j).toFixed(2)>1?parseInt(j):parseFloat(j)>0?parseFloat(j).toFixed(2):parseInt(j)}),e.charts[g].chartData=k}break;case"trafficSourcesBrkdwnPie":if("object"==typeof e.charts[g].chartData[0].total){var A=[];for(ae in e.charts[g].metricDetails.objectTypes)e.charts[g].metricDetails.objectTypes[ae].objectTypeId==e.charts[g].chartObjectTypeId&&(A=e.charts[g].metricDetails.objectTypes[ae].meta.endpoint);var L=[];for(U in e.charts[g].chartData){var F,j=0;if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)e.charts[g].chartData[U].total["social/Yes"]="undefined"!=typeof e.charts[g].chartData[U].total["social/Yes"]?Number(e.charts[g].chartData[U].total["social/Yes"]):0,P.search("/")>-1&&(F=P.split("/"),"Yes"==F[1]&&(e.charts[g].chartData[U].total["social/Yes"]+=Number(e.charts[g].chartData[U].total[P]),e.charts[g].chartData[U].total[P]=0))}for(or in A){var I=A[or];k=[];var j=0;for(U in e.charts[g].chartData)if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)if(P.search("/")>-1){F=P.split("/");for(var E in F)F[E]==I&&(j+=parseFloat(e.charts[g].chartData[U].total[P]))}else P==I&&(j+=e.charts[g].chartData[U].total[I]);k.push({y:Math.round(100*j)/100}),L.push(k)}e.charts[g].chartData=L}else{var j=0;for(U in e.charts[g].chartData)j+=parseInt(e.charts[g].chartData[U].total);k.push({y:Math.round(100*j)/100}),e.charts[g].chartData=k}break;case"instagramPosts":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var re="images",oe="thumbnail",se="likes",ie="comments",z="count",ne="caption",le="text",ce="link",de="url",L=[];for(U in e.charts[g].chartData){var k={date:moment(e.charts[g].chartData[U].date).format("DD-MMM-YYYY"),image:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[re]&&null!=e.charts[g].chartData[U].total[re][oe]&&"undefined"!=typeof e.charts[g].chartData[U].total[re][oe][de]?e.charts[g].chartData[U].total[re][oe][de]:"",postComment:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[ne]&&"undefined"!=typeof e.charts[g].chartData[U].total[ne][le]?e.charts[g].chartData[U].total[ne][le]:"",likes:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[se]&&"undefined"!=typeof e.charts[g].chartData[U].total[se][z]?e.charts[g].chartData[U].total[se][z]:0,comments:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[ie]&&"undefined"!=typeof e.charts[g].chartData[U].total[ie][z]?e.charts[g].chartData[U].total[ie][z]:0,links:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&"undefined"!=typeof e.charts[g].chartData[U].total[ce]?e.charts[g].chartData[U].total[ce]:""};L.push(k)}e.charts[g].chartData=L}break;case"instagramEngagements":var he=e.charts[g].chartSubType;if("instagramPostFrequency"===he||"instagramPostTypes"===he||"instagramPostEngagement"===he){var pe=0,se="likes",ie="comments",ge=[];if("undefined"!=typeof e.charts[g].chartData[0])for(var f=0;f<e.charts[g].chartData.length;f++){pe++;var ue=e.charts[g].chartData[f].total[se].count,me=e.charts[g].chartData[f].total[ie].count,fe=ue+me,R=e.charts[g].chartData[f].total.type;ge.push({type:R,engagement:fe})}for(var be={},ye={},O=0;O<ge.length;O++){if(be.hasOwnProperty(ge[O].type)){var R=ge[O].type;be[R]+=1}else{var R=ge[O].type;be[R]=1}if(ye.hasOwnProperty(ge[O].type)){var N=ge[O].type;ye[N]+=ge[O].engagement}else{var N=ge[O].type;ye[N]=ge[O].engagement}}}"instagramPostFrequency"===he?e.charts[g].chartData=pe:"instagramPostEngagement"===he?e.charts[g].chartData=ye:"instagramPostTypes"===he&&(e.charts[g].chartData=be);break;case"highEngagementTweets":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var se="favorite_count",ve="retweet_count",le="text",ce="expanded_url",L=[];for(U in e.charts[g].chartData){var k={date:moment(new Date(e.charts[g].chartData[U].date)).format("DD-MMM-YYYY"),likes:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&"undefined"!=typeof e.charts[g].chartData[U].total[se]?e.charts[g].chartData[U].total[se]:0,reTweet:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&"undefined"!=typeof e.charts[g].chartData[U].total[ve]?e.charts[g].chartData[U].total[ve]:0,postComment:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&"undefined"!=typeof e.charts[g].chartData[U].total[le]?e.charts[g].chartData[U].total[le]:0,links:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&"undefined"!=typeof e.charts[g].chartData[U].total.entities?e.charts[g].chartData[U].total.entities:0};L.push(k)}e.charts[g].chartData=L}break;case"highestEngagementLinkedIn":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var se="likes",we="clicks",De="impressions",Ce="shares",ie="comments",le="text",de="url",L=[];for(U in e.charts[g].chartData){var k={date:moment(e.charts[g].chartData[U].date).format("DD-MMM-YYYY"),link:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[de]&&"undefined"!=typeof e.charts[g].chartData[U].total[de]?e.charts[g].chartData[U].total[de]:"",postComment:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[le]&&"undefined"!=typeof e.charts[g].chartData[U].total[le]?e.charts[g].chartData[U].total[le]:"",impressions:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[De]&&"undefined"!=typeof e.charts[g].chartData[U].total[De]?e.charts[g].chartData[U].total[De]:0,shares:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[Ce]&&"undefined"!=typeof e.charts[g].chartData[U].total[Ce]?e.charts[g].chartData[U].total[Ce]:0,likes:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[se]&&"undefined"!=typeof e.charts[g].chartData[U].total[se]?e.charts[g].chartData[U].total[se]:0,comments:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[ie]&&"undefined"!=typeof e.charts[g].chartData[U].total[ie]?e.charts[g].chartData[U].total[ie]:0,clicks:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[we]&&"undefined"!=typeof e.charts[g].chartData[U].total[we]?e.charts[g].chartData[U].total[we]:0};L.push(k)}e.charts[g].chartData=L}break;case"gaTopPagesByVisit":;if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}var Ae="pageTitle",L=[],B=_.groupBy(xe,"pagePath");for(var R in B){for(var Se=R,y=0,Le=0,Ie=0,ke=0,b=0,f=0;f<B[R].length;f++)y+=parseFloat(B[R][f].sessions),Le+=parseFloat(B[R][f].pageviews),b+=parseFloat(B[R][f].bounces),ke+=parseFloat(B[R][f].exits),Ie+=parseFloat(B[R][f].timeOnPage);var Fe=r(Le,ke);if(0===y)var v=b;else var v=(b/y*100).toFixed(2);if(0===Fe)var je=Ie;else var je=Ie/Fe;je=Math.ceil(je);var Pe=new Date(null);Pe.setSeconds(je),je=Pe.toISOString().substr(11,8);var Se={bouncesRate:b,pagePath:Se,sessions:y,pageTitle:B[R][0][Ae],bouncesRate:v,avgTimeOnpage:je,pageviews:Le};L.push(Se)}L.sort(function(e,t){return parseFloat(e.pageviews)-parseFloat(t.pageviews)}),L.reverse(),e.charts[g].chartData=L}break;case"gaPageContentEfficiencyTable":;if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}var Ae="pageTitle",L=[],B=_.groupBy(xe,"pagePath");for(var R in B){for(var Se=R,Ee=0,Le=0,We=0,Oe=0,Ie=0,ke=0,b=0,y=0,Ne=0,Be=0,f=0;f<B[R].length;f++){Ee+=parseFloat(B[R][f].uniquePageviews),y+=parseFloat(B[R][f].sessions),Le+=parseFloat(B[R][f].pageviews),b+=parseFloat(B[R][f].bounces),ke+=parseFloat(B[R][f].exits),Ie+=parseFloat(B[R][f].timeOnPage),Be+=B[R][f].pageviews*B[R][f].entranceRate,We+=parseFloat(B[R][f].pageValue);var Ae=B[R][f].pageTitle}var Fe=r(Le,ke);if(0===y)var v=b;else var v=(b/y*100).toFixed(2);if(0===Fe)var je=Ie;else var je=Ie/Fe;Ne=Be/Le;var Se={uniquePageviews:Ee,sessions:y,pageviews:Le,pagePath:Se,avgTimeOnPage:je,pageTitle:Ae,entranceRate:Ne.toFixed(2),pageviews:Le,pageValue:We,bounceRate:v},Pe=new Date(null);Pe.setSeconds(Se.avgTimeOnPage),Se.avgTimeOnPage=Pe.toISOString().substr(11,8),L.push(Se)}L.sort(function(e,t){return parseFloat(e.pageviews)-parseFloat(t.pageviews)}),L.reverse(),e.charts[g].chartData=L}break;case"gaPageTechnicalEfficiencyTable":;if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}var Ae="pageTitle",L=[],B=_.groupBy(xe,"pagePath");for(var R in B){for(var Se=R,Le=0,Re=0,Me=0,Oe=0,y=0,b=0,ze=0,f=0;f<B[R].length;f++){ze+=parseFloat(B[R][f].pageLoadTime),y+=parseFloat(B[R][f].sessions),b+=parseFloat(B[R][f].bounces),Le+=parseFloat(B[R][f].pageviews),Me+=parseFloat(B[R][f].pageLoadSample),Oe+=parseFloat(B[R][f].bounceRate);var Ae=B[R][f].pageTitle}var Re=(ze/Me/1e3).toFixed(2);if(isNaN(Re)&&(Re=0),0===y)var v=b;else var v=b/y*100;Re=Math.ceil(Re);var Se={pageviews:Le,sessions:y,pagePath:Se,pageTitle:Ae,avgPageLoadTime:Re.toFixed(2),pageLoadSample:Me,pageviews:Le,bounceRate:v.toFixed(2)};L.push(Se)}L.sort(function(e,t){return parseFloat(e.pageviews)-parseFloat(t.pageviews)}),L.reverse(),e.charts[g].chartData=L}break;case"gaVisitorAcquisitionEfficiencyAnalysisTable":;if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}var L=[],B=_.groupBy(xe,"sourceMedium");for(var R in B){for(var $e=R,y=0,_e=0,He=0,Ge=0,Me=0,Ye=0,f=0;f<B[R].length;f++)y+=parseFloat(B[R][f].sessions),_e+=parseFloat(B[R][f].users),He+=parseFloat(B[R][f].newUsers),Ge+=parseFloat(B[R][f].goalConversionRateAll),Me+=parseFloat(B[R][f].pageLoadSample),Ye+=parseFloat(B[R][f].goalValuePerSession),Oe+=parseFloat(B[R][f].bounceRate);var Se={sourceMedium:$e,sessions:y,users:_e,newUsers:He,goalValuePerSession:Ye,goalConversionRateAll:Ge.toFixed(2)};L.push(Se)}L.sort(function(e,t){return parseFloat(e.sessions)-parseFloat(t.sessions)}),L.reverse(),e.charts[g].chartData=L}break;case"pageContentEfficiency":;if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Ve=$.isEmptyObject(e.charts[g].chartData[O].total);if(1!=Ve){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}}var Ae="pageTitle",L=[],B=_.groupBy(xe,"pagePath");for(var R in B){for(var v,Ee=0,Le=0,b=0,y=0,Ne=0,Be=0,f=0;f<B[R].length;f++)Ee+=parseFloat(B[R][f].uniquePageviews),y+=parseFloat(B[R][f].sessions),Le+=parseFloat(B[R][f].pageviews),b+=parseFloat(B[R][f].bounces),Be+=B[R][f].pageviews*B[R][f].entranceRate,Ae=B[R][f].pageTitle;v=0===y?b:(b/y*100).toFixed(2),Ne=Be/Le;var Se={bounceRate:v,pageTitle:Ae,uniquePageviews:Ee.toFixed(2),pageviews:Le,entranceRate:Ne.toFixed(2)};L.push(Se)}L.sort(function(e,t){return parseFloat(e.uniquePageviews)-parseFloat(t.uniquePageviews)}),L.reverse();var Ue=[];if(L.length>10)for(var f=0;f<10;f++)Ue.push(L[f]);else for(var f=0;f<L.length;f++)Ue.push(L[f]);e.charts[g].chartData=Ue}break;case"gaSocialMediaOverview":;if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}var L=[];if("Time spent on site from various sources"==String(e.charts[g].chartName)){for(var O=0;O<xe.length;O++)"Yes"===xe[O].hasSocialSourceReferral&&(xe[O].medium="social");var B=_.groupBy(xe,"medium")}else var B=_.groupBy(xe,"socialNetwork");for(var R in B){for(var qe=R,Le=0,y=0,ke=0,Ie=0,f=0;f<B[R].length;f++)y+=parseFloat(B[R][f].sessions),Le+=parseFloat(B[R][f].pageviews),ke+=parseFloat(B[R][f].exits),Ie+=parseFloat(B[R][f].timeOnPage);var Xe=Le/y,Je=Ie/(Le-ke),Se={sessions:Number(y),pageviewsPersession:isNaN(Xe)?0:Xe.toFixed(2),socialNetwork:qe,avgtimeOnPage:isNaN(Je)?0:Je.toFixed(2)};"Time spent on site from various sources"==String(e.charts[g].chartName)?"(none)"!=String(Se.socialNetwork)&&"organic"!=String(Se.socialNetwork)&&"referral"!=String(Se.socialNetwork)&&"ppc"!=String(Se.socialNetwork)&&"social"!=String(Se.socialNetwork)||L.push(Se):L.push(Se)}e.charts[g].chartData=L}break;case"pageTechnicalEfficiency":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Ve=$.isEmptyObject(e.charts[g].chartData[O].total);if(1!=Ve){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}}var Ae="pageTitle",L=[],B=_.groupBy(xe,"pagePath");for(var R in B){for(var Le=0,Re=0,Me=0,Oe=0,y=0,b=0,ze=0,f=0;f<B[R].length;f++){ze+=parseFloat(B[R][f].pageLoadTime),y+=parseFloat(B[R][f].sessions),b+=parseFloat(B[R][f].bounces),Le+=parseFloat(B[R][f].pageviews),Me+=parseFloat(B[R][f].pageLoadSample);var Ae=B[R][f].pageTitle}var Re=(ze/Me/1e3).toFixed(2);if(isNaN(Re)&&(Re=0),0===y)var v=b;else var v=b/y*100;Re=Math.ceil(Re);var Se={bounceRate:v.toFixed(2),pageTitle:Ae,PageLoadTime:Re.toFixed(2),pageviews:Le};L.push(Se)}L.sort(function(e,t){return parseFloat(e.pageviews)-parseFloat(t.pageviews)}),L.reverse();var Ue=[];if(L.length>10)for(var f=0;f<10;f++)Ue.push(L[f]);else for(var f=0;f<L.length;f++)Ue.push(L[f]);e.charts[g].chartData=Ue}break;case"visitorAcquisitionEfficiency":;if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Ve=$.isEmptyObject(e.charts[g].chartData[O].total);if(1!=Ve){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}}var L=[],B=_.groupBy(xe,"sourceMedium");for(var R in B){for(var $e=R,y=0,_e=0,He=0,Ge=0,Me=0,Ye=0,f=0;f<B[R].length;f++)y+=parseFloat(B[R][f].sessions),He+=parseFloat(B[R][f].newUsers),Ge+=parseFloat(B[R][f].goalConversionRateAll),Me+=parseFloat(B[R][f].pageLoadSample),Ye+=parseFloat(B[R][f].goalValuePerSession);var Se={newUsers:He.toFixed(2),sourceMedium:$e,goalValuePerSession:Ye.toFixed(2),goalConversionRateAll:Ge.toFixed(2),sessions:y};L.push(Se)}L.sort(function(e,t){return parseFloat(e.sessions)-parseFloat(t.sessions)}),L.reverse();var Ue=[];if(L.length>10)for(var f=0;f<10;f++)Ue.push(L[f]);else for(var f=0;f<L.length;f++)Ue.push(L[f]);e.charts[g].chartData=Ue}break;case"topReferringSites":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Ve=$.isEmptyObject(e.charts[g].chartData[O].total);if(1!=Ve){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}}var L=[],B=_.groupBy(xe,"source");for(var R in B){for(var Ke=R,y=0,Ze=0,Qe=0,f=0;f<B[R].length;f++)y+=parseFloat(B[R][f].sessions),Qe+=parseFloat(B[R][f].goalCompletionsAll);Ze=y/Qe;var Se={source:Ke,goalCompletions:Number(Qe.toFixed(2)),goalConversionRate:isNaN(Ge)?0:Ge,sessions:y};L.push(Se)}L.sort(function(e,t){return parseFloat(t.sessions)-parseFloat(e.sessions)});var Ue=[];if("Top referring sites(Table)"==String(e.charts[g].chartName))Ue=L;else if(L.length>10)for(var f=0;f<10;f++)Ue.push(L[f]);else for(var f=0;f<L.length;f++)Ue.push(L[f]);e.charts[g].chartData=Ue}break;case"fbReachByAge":var et={"13-17":{Female:0,Male:0,Unspecified:0},"18-24":{Female:0,Male:0,Unspecified:0},"25-34":{Female:0,Male:0,Unspecified:0},"35-44":{Female:0,Male:0,Unspecified:0},"45-54":{Female:0,Male:0,Unspecified:0},"55-64":{Female:0,Male:0,Unspecified:0},"65+":{Female:0,Male:0,Unspecified:0}};if("undefined"!=typeof e.charts[g].chartData[0]){if("object"==typeof e.charts[g].chartData[0].total)for(var U in e.charts[g].chartData)for(var N in e.charts[g].chartData[U].total){var tt=N.split("."),at=String(tt[0]),rt=String(tt[1]);"F"==at&&(at="Female"),"M"==at&&(at="Male"),"U"==at&&(at="Unspecified"),void 0!=et[rt]&&(et[rt]=et[rt]||0,et[rt][at]+=parseInt(e.charts[g].chartData[U].total[N]))}var ot=[],st=[];for(var R in et){ot.push(R);et[R].length}var it=ot[0];for(var nt in et[it]){var lt={};lt.name=nt;var ct=0;lt.data=[];for(var te in et)lt.data[ct]=et[te][nt],ct++;st.push(lt)}var dt=[et,ot,st]}e.charts[g].chartData=dt;break;case"fbStoreType":case"engagementDay":if("fbStoreType"==u&&"undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var ht=[];for(var U in e.charts[g].chartData){var Pe,G={"page post":0,Other:0};for(var N in e.charts[g].chartData[U].total)"page post"===N?G[N]=e.charts[g].chartData[U].total[N]:G.Other+=e.charts[g].chartData[U].total[N];ht.push({date:moment(e.charts[g].chartData[U].date),total:G})}e.charts[g].chartData=ht}if("engagementDay"==u){var pt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],gt={},ut={},mt={},ft={},bt={},yt={},vt={},wt=[gt,ut,mt,ft,bt,yt,vt];if("undefined"!=typeof e.charts[g].chartData[0]){for(var f=0;f<e.charts[g].chartData.length;f++)if("undefined"!=typeof e.charts[g].chartData[f].date){var Dt=new Date(e.charts[g].chartData[f].date),Ct=Dt.getDay();if(Ct<7)for(var N in e.charts[g].chartData[f].total)"comment"!==N&&"like"!==N&&"link"!==N||(wt[Ct].hasOwnProperty(N)?wt[Ct][N]+=e.charts[g].chartData[f].total[N]:(wt[Ct][N]=0,wt[Ct][N]+=e.charts[g].chartData[f].total[N]))}for(var xt=[],O=0;O<pt.length;O++)xt.push({date:pt[O],total:wt[O]})}e.charts[g].chartData=xt;
}if("object"==typeof e.charts[g].chartData[0].total){var A;for(ae in e.charts[g].metricDetails.objectTypes)e.charts[g].metricDetails.objectTypes[ae].objectTypeId==e.charts[g].chartObjectTypeId&&(A="fbStoreType"==u?["page post","Other"]:e.charts[g].metricDetails.objectTypes[ae].meta.endpoint);e.charts[g].metricDetails.objectTypes[ae].meta.endpoint=e.charts[g].metricDetails.objectTypes[ae].meta.endpointDisplay;var L=[];for(or in A){var I=A[or],k=[];for(U in e.charts[g].chartData){var F,j=0;if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)if(P.search("/")>-1){F=P.split("/");for(var E in F)F[E]==I&&(j+=parseFloat(e.charts[g].chartData[U].total[P]))}else P==I&&(j=e.charts[g].chartData[U].total[I]);(u="engagementDay")?k.push({x:e.charts[g].chartData[U].date,y:j}):k.push({x:moment(e.charts[g].chartData[U].date),y:j})}L.push(k)}e.charts[g].chartData=L}e.charts[g].chartType="line";break;case"fbReachByCountry":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++)xe.push(e.charts[g].chartData[O].total);for(var Tt={},f=0;f<xe.length;f++)for(var R in xe[f])Tt.hasOwnProperty(R)?Tt[R]+=xe[f][R]:(Tt[R]=0,Tt[R]+=xe[f][R]);var At=[];for(var St in Tt)At.push([St,Tt[St]]);At.sort(function(e,t){return t[1]-e[1]}),Tt={Others:0};for(var O=0;O<At.length;O++)O<5?Tt.hasOwnProperty(At[O][0])?Tt[At[O][0]]=At[O][1]:(Tt[At[O][0]]=0,Tt[At[O][0]]=At[O][1]):Tt.Others+=At[O][1]}e.charts[g].chartData=Tt;break;case"fbReachByCity":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++)xe.push(e.charts[g].chartData[O].total);for(var Tt={},f=0;f<xe.length;f++)for(var R in xe[f]){var Lt=R.split(","),It=Lt[0];Tt.hasOwnProperty(R)?Tt[It]+=xe[f][R]:(Tt[It]=0,Tt[It]+=xe[f][R])}var At=[];for(var St in Tt)At.push([St,Tt[St]]);At.sort(function(e,t){return t[1]-e[1]}),Tt={Others:0};for(var O=0;O<At.length;O++)O<5?Tt.hasOwnProperty(At[O][0])?Tt[At[O][0]]=At[O][1]:(Tt[At[O][0]]=0,Tt[At[O][0]]=At[O][1]):Tt.Others+=At[O][1]}e.charts[g].chartData=Tt;break;case"fanSource":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var kt={Others:0,page_profile:0,like_story:0,mobile:0,mobile_ads:0,external_connect:0,recommended_pages:0};for(var U in e.charts[g].chartData)for(var N in e.charts[g].chartData[U].total)"undefined"!=e.charts[g].chartData[U].total[N]&&("page_profile"===N||"like_story"===N||"mobile"===N||"mobile_ads"===N||"external_connect"===N||"recommended_pages"===N?kt[N]+=e.charts[g].chartData[U].total[N]:kt.Others+=e.charts[g].chartData[U].total[N]);var Ft={"Page Profile":kt.page_profile,"Like story ads":kt.like_story,Mobile:kt.mobile,"Mobile ads":kt.mobile_ads,External:kt.external_connect,"Recommended pages":kt.recommended_pages," Others":kt.Others};e.charts[g].chartData=Ft}e.charts[g].chartType="fbReachByCity";break;case"pinterestEngagementRate":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var se="likes",ie="comments",jt="repins",le="name",de="url",L=[];for(U in e.charts[g].chartData){var k={date:moment(e.charts[g].chartData[U].date).format("DD-MMM-YYYY"),postComment:null!=e.charts[g].chartData[U]&&Object.keys(0!=e.charts[g].chartData[U].length)&&null!=e.charts[g].chartData[U][le]&&"undefined"!=typeof e.charts[g].chartData[U][le]?e.charts[g].chartData[U][le]:"",likes:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[se]&&"undefined"!=typeof e.charts[g].chartData[U].total[se]?e.charts[g].chartData[U].total[se]:0,repins:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[jt]&&"undefined"!=typeof e.charts[g].chartData[U].total[jt]?e.charts[g].chartData[U].total[jt]:0,comments:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[ie]&&"undefined"!=typeof e.charts[g].chartData[U].total[ie]?e.charts[g].chartData[U].total[ie]:0,links:null!=e.charts[g].chartData[U]&&Object.keys(0!=e.charts[g].chartData[U].length)&&"undefined"!=typeof e.charts[g].chartData[U][de]?e.charts[g].chartData[U][de]:""};L.push(k)}e.charts[g].chartData=L}break;case"pinterestLeaderboard":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var Pt="collaborators",Et="followers",Wt="pins",le="name",de="url",L=[];for(U in e.charts[g].chartData){var k={date:moment(e.charts[g].chartData[U].date).format("DD-MMM-YYYY"),postComment:null!=e.charts[g].chartData[U]&&Object.keys(0!=e.charts[g].chartData[U].length)&&null!=e.charts[g].chartData[U][le]&&"undefined"!=typeof e.charts[g].chartData[U][le]?e.charts[g].chartData[U][le]:"",collaborators:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[Pt]&&"undefined"!=typeof e.charts[g].chartData[U].total[Pt]?e.charts[g].chartData[U].total[Pt]:0,pins:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[Wt]&&"undefined"!=typeof e.charts[g].chartData[U].total[Wt]?e.charts[g].chartData[U].total[Wt]:0,followers:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total[Et]&&"undefined"!=typeof e.charts[g].chartData[U].total[Et]?e.charts[g].chartData[U].total[Et]:0,links:null!=e.charts[g].chartData[U]&&Object.keys(0!=e.charts[g].chartData[U].length)&&"undefined"!=typeof e.charts[g].chartData[U][de]?e.charts[g].chartData[U][de]:""};L.push(k)}e.charts[g].chartData=L}break;case"vimeoTopVideos":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var se="likes",ie="comments",L=[];for(U in e.charts[g].chartData){var k={date:moment(e.charts[g].chartData[U].date).format("DD-MMM-YYYY"),link:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total.link&&"undefined"!=typeof e.charts[g].chartData[U].total.link?e.charts[g].chartData[U].total.link:"",Comment:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total.metadata.connections.comments.total&&"undefined"!=typeof e.charts[g].chartData[U].total.metadata.connections.comments.total?e.charts[g].chartData[U].total.metadata.connections.comments.total:"",likes:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total.metadata.connections.likes.total&&"undefined"!=typeof e.charts[g].chartData[U].total.metadata.connections.likes.total?e.charts[g].chartData[U].total.metadata.connections.likes.total:0,views:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total.stats.plays&&"undefined"!=typeof e.charts[g].chartData[U].total.stats.plays?e.charts[g].chartData[U].total.stats.plays:0,picture:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total.pictures.sizes[0].link&&"undefined"!=typeof e.charts[g].chartData[U].total.pictures.sizes[0].link?e.charts[g].chartData[U].total.pictures.sizes[0].link:0,title:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&null!=e.charts[g].chartData[U].total.name&&"undefined"!=typeof e.charts[g].chartData[U].total.name?e.charts[g].chartData[U].total.name:0};L.push(k)}e.charts[g].chartData=L}break;case"costPerActionType":var Ot=!1,Nt=[];if(e.meta){var k=[];for(var U in e.charts[g].chartData){var f,z=0;for(f in e.charts[g].chartData[U].total)e.charts[g].chartData[U].total.hasOwnProperty(f)&&z++;if(z){var Bt=0;for(var N in e.charts[g].chartData[U].total)e.meta==e.charts[g].chartData[U].total[N].action_type&&(Bt=1,k.push({x:moment(e.charts[g].chartData[U].date),y:null!=e.charts[g].chartData[U].total[N]?e.charts[g].chartData[U].total[N].value:0}));Bt||k.push({x:moment(e.charts[g].chartData[U].date),y:0})}else k.push({x:moment(e.charts[g].chartData[U].date),y:0})}e.charts[g].chartData=k}else{var k={};Ot=!0;for(var f=0;f<e.charts[g].chartData.length;f++)for(var N in e.charts[g].chartData[f].total)Nt.push(e.charts[g].chartData[f].total[N].action_type);var Rt=_.uniqBy(Nt);k.flag=Ot,k.action=Rt,e.charts[g].chartData=k}break;case"instagramHashtagLeaderBoard":if(null!=e.charts[g].chartData[0]){if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var Mt="tag",ie="comments",se="likes",L=[];for(U in e.charts[g].chartData){var k={tagLink:null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length)&&"undefined"!=typeof e.charts[g].chartData[U].total[Mt]?"https://www.instagram.com/explore/tags/"+e.charts[g].chartData[U].total[Mt]:"",tag:null!=e.charts[g].chartData[U].total&&null!=e.charts[g].chartData[U].total[Mt]&&"undefined"!=typeof e.charts[g].chartData[U].total[Mt]?e.charts[g].chartData[U].total[Mt]:0,likes:null!=e.charts[g].chartData[U].total&&null!=e.charts[g].chartData[U].total[se]&&"undefined"!=typeof e.charts[g].chartData[U].total[se]?e.charts[g].chartData[U].total[se]:0,comments:null!=e.charts[g].chartData[U].total&&null!=e.charts[g].chartData[U].total[ie]&&"undefined"!=typeof e.charts[g].chartData[U].total[ie]?e.charts[g].chartData[U].total[ie]:0};L.push(k)}e.charts[g].chartData=L}}else e.charts[g].chartData=[];break;case"gaTopCountriesToSocialVisits":case"gaTopCitiesToSocialVisits":if("undefined"!=typeof e.charts[g].chartData[0]&&"object"==typeof e.charts[g].chartData[0].total){var xe=[],L=[],zt={},$t=0;e.charts[g].chartData.forEach(function(t){for(var a in t.total)a.indexOf(e.charts[g].metricDetails.objectTypes[0].meta.endpoint[0]+"/")!=-1&&xe.push({country:a.split(e.charts[g].metricDetails.objectTypes[0].meta.endpoint[0]+"/").join(""),value:t.total[a]})});var B=_.groupBy(xe,"country");for(var R in B){for(var Tt=R,y=0,f=0;f<B[R].length;f++)y+=parseFloat(B[R][f].value);var Se={country:Tt,sessions:y};L.push(Se)}var _t=_.sortBy(L,"sessions").reverse();if(_t.length){for(var Ht=_t.length<5?_t.length:5,O=0;O<Ht;O++)zt[_t[O].country]=_t[O].sessions;if(_t.length>5){for(var V=5;V<_t.length;V++)$t+=_t[V].sessions;zt.Others=$t}else zt.Others=0}}e.charts[g].chartData=zt;break;case"audienceBehaviourbyDay":var pt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],gt={},ut={},mt={},ft={},bt={},yt={},vt={},wt=[gt,ut,mt,ft,bt,yt,vt];if("undefined"!=typeof e.charts[g].chartData[0])for(var f=0;f<e.charts[g].chartData.length;f++)if("undefined"!=typeof e.charts[g].chartData[f].date){var Dt=new Date(e.charts[g].chartData[f].date),Ct=Dt.getDay();if(Ct<7){for(var N in e.charts[g].chartData[f].total[0])"date"!=N&&"dayOfWeek"!=N&&"total"!=N&&(wt[Ct].hasOwnProperty(N)?wt[Ct][N]+=parseFloat(e.charts[g].chartData[f].total[0][N]):(wt[Ct][N]=0,wt[Ct][N]+=parseFloat(e.charts[g].chartData[f].total[0][N])));wt[Ct].bounceRate=0,0===wt[Ct].sessions?wt[Ct].bounceRate=wt[Ct].bounces:wt[Ct].bounceRate=wt[Ct].sessions/wt[Ct].bounces}}for(var xt=[],O=0;O<pt.length;O++)xt.push({date:pt[O],total:wt[O]});e.charts[g].chartData=xt;break;case"audienceBehaviourByTimeofday":if("object"==typeof e.charts[g].chartData[0].total){for(var xe=[],O=0;O<e.charts[g].chartData.length;O++){var Te=$.map(e.charts[g].chartData[O].total,function(e,t){return[e]});xe=xe.concat(Te)}var Pe=[],L=[],B=_.groupBy(xe,"hour");for(var R in B){for(var Gt=R,Le=0,b=0,y=0,Yt=0,Vt=0,f=0;f<B[R].length;f++)y+=parseFloat(B[R][f].sessions),Le+=parseFloat(B[R][f].pageviews),b+=parseFloat(B[R][f].bounces),Yt+=parseFloat(B[R][f].pageviewsPerSession),Vt+=parseFloat(B[R][f].percentNewSessions);if(0===y)var Oe=b;else var Oe=(b/y*100).toFixed(2);var Gt={hour:Gt,sessions:y,bounceRate:Oe,pageviews:Le,pageviewsPerSession:Yt,percentNewSessions:Vt};L.push(Gt)}var Ut=[];L.sort(function(e,t){return parseFloat(e.hour)-parseFloat(t.hour)});for(var O=0;O<L.length;O++)Ut.push({date:L[O].hour,total:L[O]});e.charts[g].chartType="audienceBehaviourbyDay",e.charts[g].chartData=Ut}break;case"socialContributionToSiteTraffic":if("object"==typeof e.charts[g].chartData[0].total){var A;for(ae in e.charts[g].metricDetails.objectTypes)e.charts[g].metricDetails.objectTypes[ae].objectTypeId==e.charts[g].chartObjectTypeId&&(A=e.charts[g].metricDetails.objectTypes[ae].meta.endpoint,e.charts[g].metricDetails.objectTypes[ae].meta.endpoint=void 0!=e.charts[g].metricDetails.objectTypes[ae].meta.endpointDisplay?e.charts[g].metricDetails.objectTypes[ae].meta.endpointDisplay:e.charts[g].metricDetails.objectTypes[ae].meta.endpoint);var L=[];if(0!=A.length)for(or in A){var I=A[or],k=[];for(U in e.charts[g].chartData){var F,j=0;if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)if(P.search("/")>-1){F=P.split("/");for(var E in F)F[E]==I&&(j+=parseFloat(e.charts[g].chartData[U].total[P]))}else P==I&&(j=e.charts[g].chartData[U].total[I]);k.push({x:moment(e.charts[g].chartData[U].date),y:j})}L.push(k)}else{var k=[];for(U in e.charts[g].chartData){var H,F,j=0,G=e.charts[g].chartData[U].total;if(null!=e.charts[g].chartData[U].total&&0!=Object.keys(e.charts[g].chartData[U].total).length){for(var P in e.charts[g].chartData[U].total){if(P.search("/")>-1){F=P.split("/");for(var E in F)j+=parseFloat(e.charts[g].chartData[U].total[P]),H=P}else j=e.charts[g].chartData[U].total[I];H=P}k.push({x:H,y:j})}}L.push(k)}e.charts[g].chartData=k,e.charts[g].metricCode=e.charts[g].metricDetails.code,e.charts[g].metricName=e.charts[g].metricDetails.name}else{var k=[];for(var U in e.charts[g].chartData)k.push({x:moment(e.charts[g].chartData[U].date),y:null!=e.charts[g].chartData[U].total?e.charts[g].chartData[U].total:0});e.charts[g].chartData=k,e.charts[g].metricCode=e.charts[g].metricDetails.code,e.charts[g].metricName=e.charts[g].metricDetails.name}break;case"percentageArea":for(var f=0;f<e.charts[g].chartData.length;f++)if("object"==typeof e.charts[g].chartData[f].total){var A;for(ae in e.charts[g].metricDetails.objectTypes)e.charts[g].metricDetails.objectTypes[ae].objectTypeId==e.charts[g].chartObjectTypeId&&(A=e.charts[g].metricDetails.objectTypes[ae].meta.endpoint,e.charts[g].metricDetails.objectTypes[ae].meta.endpoint=void 0!=e.charts[g].metricDetails.objectTypes[ae].meta.endpointDisplay?e.charts[g].metricDetails.objectTypes[ae].meta.endpointDisplay:e.charts[g].metricDetails.objectTypes[ae].meta.endpoint);var L=[];if(0!=A.length)for(or in A){var I=A[or],k=[];for(U in e.charts[g].chartData){var F,j=0;if(null!=e.charts[g].chartData[U].total&&Object.keys(0!=e.charts[g].chartData[U].total.length))for(var P in e.charts[g].chartData[U].total)if(P.search("/")>-1){F=P.split("/");for(var E in F)F[E]==I&&(j+=parseFloat(e.charts[g].chartData[U].total[P]))}else P==I&&(j=e.charts[g].chartData[U].total[P]);k.push({x:moment(e.charts[g].chartData[U].date),y:j})}L.push(k)}else{var k=[];for(U in e.charts[g].chartData){var H,F,j=[],G=e.charts[g].chartData[U].total;if(null!=e.charts[g].chartData[U].total&&0!=e.charts[g].chartData[U].total&&0!=Object.keys(e.charts[g].chartData[U].total).length){for(var P in e.charts[g].chartData[U].total){if(P.search("/")>-1){F=P.split("/");for(var E in F)j=e.charts[g].chartData[U].total[P],H=P}else j=e.charts[g].chartData[U].total[P];H=moment(e.charts[g].chartData[U].date)}k.push({x:H,y:j})}}L.push(k)}e.charts[g].chartData=k,e.charts[g].metricCode=e.charts[g].metricDetails.code,e.charts[g].metricName=e.charts[g].metricDetails.name}break;case"stackbar":if("object"==typeof e.charts[g].chartData[0].total){for(var ee=[{"(none)":0,organic:0,paid:0,others:0,social:0,ppc:0,referral:0}],O=0;O<e.charts[g].chartData.length;O++)for(N in e.charts[g].chartData[O].total){var qt=N.split("/");"(none)"!=qt[0]&&"organic"!=qt[0]&&"ppc"!=qt[0]&&"social"!=qt[0]&&"referral"!=qt[0]?ee[0].others+=parseFloat(e.charts[g].chartData[O].total[N]):"referral"===qt[0]&&"undefined"!=qt[1]&&"Yes"===qt[1]?ee[0].social+=parseFloat(e.charts[g].chartData[O].total[N]):ee[0][qt[0]]+=parseFloat(e.charts[g].chartData[O].total[N])}var st=[];st.push({date:e.charts[g].chartName,total:ee})}e.charts[g].chartData=st;break;case"gaUsers":if("undefined"!=typeof e.charts[g].chartData[0]){var Xt={};if("string"!=typeof e.charts[g].chartData)for(var f=0;f<e.charts[g].chartData.length;f++){var R=e.charts[g].chartData[f][0];Xt[R]=e.charts[g].chartData[f][1]}e.charts[g].chartData=Xt}break;case"youtubeVideosOverview":for(var Jt=[],R=0;R<e.charts[g].chartData.length;R++)if("undefined"!=typeof e.charts[g].chartData[R]&&"object"==typeof e.charts[g].chartData[R]){var it=0,ie=0,se=0,Ce=0,Kt={name:e.charts[g].chartData[R].title,views:e.charts[g].chartData[R].viewCount,comments:e.charts[g].chartData[R].commentCount,likes:e.charts[g].chartData[R].likeCount,dislikes:e.charts[g].chartData[R].dislikeCount,shares:e.charts[g].chartData[R].favoriteCount};Jt.push(Kt)}e.charts[g].chartData=Jt;break;case"twitterEngagements":switch(String(e.charts[g].chartSubType)){case"activityByDayOfTheWeek":if("undefined"!=typeof e.charts[g].chartData[0]){for(var W=[],O=0;O<e.charts[g].chartData.length;O++)"object"==typeof e.charts[g].chartData[O].total&&(e.charts[g].chartData[O].total.created_at=new Date(e.charts[g].chartData[O].total.created_at).getDay(),W.push(e.charts[g].chartData[O].total));var B=_.groupBy(W,"created_at"),L=[];for(var R in B){for(var se=0,Zt=0,fe=0,Qt=R,f=0;f<B[R].length;f++)se+=parseFloat(B[R][f].favorite_count),Zt+=parseFloat(B[R][f].retweet_count);fe=se+Zt;var ea=f,Se={day:Qt,tweets:ea,engagement:fe};L.push(Se)}L.sort(function(e,t){return parseFloat(e.day)-parseFloat(t.day)});for(var R in L)"0"===L[R].day&&(L[R].day="Sunday"),"1"===L[R].day&&(L[R].day="Monday"),"2"===L[R].day&&(L[R].day="Tuesday"),"3"===L[R].day&&(L[R].day="Wednesday"),"4"===L[R].day&&(L[R].day="Thursday"),"5"===L[R].day&&(L[R].day="Friday"),"6"===L[R].day&&(L[R].day="Saturday");e.charts[g].chartData=L}break;case"activityByTimeOfTheDay":var ta=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if("undefined"!=typeof e.charts[g].chartData[0]){for(var W=[],O=0;O<e.charts[g].chartData.length;O++)if("object"==typeof e.charts[g].chartData[O].total){var Pe=e.charts[g].chartData[O].total.created_at;e.charts[g].chartData[O].total.day=ta[new Date(Pe).getDay()],W.push(e.charts[g].chartData[O].total)}var B=_.groupBy(W,"day"),L=[];for(var R in B){for(var Qt=R,aa=[],f=0;f<B[R].length;f++)aa.push({time:new Date(B[R][f].created_at).getHours(),likes:B[R][f].favorite_count,reTweets:B[R][f].retweet_count});var ra=_.groupBy(aa,"time");for(var ee in ra){for(var se=0,Zt=0,fe=0,oa=ee,V=0;V<ra[ee].length;V++)se+=parseFloat(ra[ee][V].likes),Zt+=parseFloat(ra[ee][V].reTweets);fe=se+Zt;var Se={day:Qt,time:oa,engagement:fe};L.push(Se)}}e.charts[g].chartData=L}break;case"engagementByUsersTalkedAbout":for(var L=[],sa=[],R=0;R<e.charts[g].chartData.length;R++)if("undefined"!=typeof e.charts[g].chartData[R]&&"object"==typeof e.charts[g].chartData[R].total){var se=0,Zt=0,fe=0,ia=[],Qt=R;se=parseFloat(e.charts[g].chartData[R].total.favorite_count),Zt=parseFloat(e.charts[g].chartData[R].total.retweet_count),fe=se+Zt;for(var na=void 0!=e.charts[g].chartData[R].total.entities&&void 0!=e.charts[g].chartData[R].total.entities?e.charts[g].chartData[R].total.entities.user_mentions.length:0,la=void 0!=e.charts[g].chartData[R].total.entities&&void 0!=e.charts[g].chartData[R].total.entities?e.charts[g].chartData[R].total.entities.user_mentions:0,ca=0;ca<na;ca++){var Kt={tweet:e.charts[g].chartData[R].total.text,engagement:fe,userMentionedScreenName:la[ca].screen_name,userMentionedName:la[ca].name,url:void 0!=e.charts[g].chartData[R].total.media?e.charts[g].chartData[R].total.media[0].expanded_url:"https://twitter.com/"+la[ca].screen_name};ia.push(Kt)}for(var O=0;O<ia.length;O++)sa.push(ia[O])}var xe=[],Ut=_.groupBy(sa,"userMentionedScreenName");for(var N in Ut){for(var fe=0,da=0;da<Ut[N].length;da++)fe+=Ut[N][da].engagement;xe.push({userMentionedScreenName:N,engagement:fe})}xe.sort(function(e,t){return parseFloat(t.engagement)-parseFloat(e.engagement)}),e.charts[g].chartData=xe;break;case"topLinks":if("undefined"!=typeof e.charts[g].chartData[0]){var se="favorite_count",ve="retweet_count",ha=[];if("object"==typeof e.charts[g].chartData[0].total)for(var f=0;f<e.charts[g].chartData.length;f++)if("undefined"!=typeof e.charts[g].chartData[f].total.entities)for(var O=0;O<e.charts[g].chartData[f].total.entities.urls.length;O++){var ue=e.charts[g].chartData[f].total[se],Zt=e.charts[g].chartData[f].total[ve],fe=ue+Zt,de={url:e.charts[g].chartData[f].total.entities.urls[O].url,displayurl:e.charts[g].chartData[f].total.entities.urls[O].expanded_url,engagement:fe};ha.push(de)}var B=_.groupBy(ha,"displayurl"),xe=[];for(var N in B){for(var fe=0,da=0;da<B[N].length;da++)fe+=B[N][da].engagement;xe.push({url:N,engagement:fe})}xe.sort(function(e,t){return parseFloat(t.engagement)-parseFloat(e.engagement)}),e.charts[g].chartData=xe}break;case"instagramActivityByDayOfTheWeek":if("undefined"!=typeof e.charts[g].chartData[0]){for(var W=[],O=0;O<e.charts[g].chartData.length;O++)"object"==typeof e.charts[g].chartData[O].total&&(e.charts[g].chartData[O].total.created_time=moment.unix(e.charts[g].chartData[O].total.created_time).format("YYYY/MMM/DD"),e.charts[g].chartData[O].total.created_time=new Date(e.charts[g].chartData[O].total.created_time).getDay(),W.push(e.charts[g].chartData[O].total));var B=_.groupBy(W,"created_time"),L=[];for(var R in B){for(var se=0,ie=0,fe=0,Qt=R,f=0;f<B[R].length;f++)se+=parseFloat(B[R][f].likes.count),ie+=parseFloat(B[R][f].comments.count);fe=se+ie;var pa=f,Se={day:Qt,tweets:pa,engagement:fe};L.push(Se)}L.sort(function(e,t){return parseFloat(e.day)-parseFloat(t.day)});for(var R in L)"0"===L[R].day&&(L[R].day="Sunday"),"1"===L[R].day&&(L[R].day="Monday"),"2"===L[R].day&&(L[R].day="Tuesday"),"3"===L[R].day&&(L[R].day="Wednesday"),"4"===L[R].day&&(L[R].day="Thursday"),"5"===L[R].day&&(L[R].day="Friday"),"6"===L[R].day&&(L[R].day="Saturday");e.charts[g].chartData=L}break;case"instagramActivityByTimeOfTheDay":if("undefined"!=typeof e.charts[g].chartData[0]){for(var W=[],O=0;O<e.charts[g].chartData.length;O++)if("object"==typeof e.charts[g].chartData[O].total){var Pe=e.charts[g].chartData[O].total.created_time;e.charts[g].chartData[O].total.day=moment.unix(Pe).format("dddd"),W.push(e.charts[g].chartData[O].total)}var B=_.groupBy(W,"day"),L=[];for(var R in B){for(var Qt=R,aa=[],f=0;f<B[R].length;f++){var Y=moment.unix(B[R][f].created_time);aa.push({time:new Date(Y).getHours(),likes:B[R][f].likes.count,comments:B[R][f].comments.count})}var ra=_.groupBy(aa,"time");for(var ee in ra){for(var se=0,ie=0,fe=0,oa=ee,V=0;V<ra[ee].length;V++)se+=parseFloat(ra[ee][V].likes),ie+=parseFloat(ra[ee][V].comments);fe=se+ie;var Se={day:Qt,time:oa,engagement:fe};L.push(Se)}}e.charts[g].chartData=L}break;case"commentsAndLikes":if("undefined"!=typeof e.charts[g].chartData[0]){for(var L=[],O=0;O<e.charts[g].chartData.length;O++)"object"==typeof e.charts[g].chartData[O].total&&L.push({x:moment(e.charts[g].chartData[O].date).format("DD-MMM-YYYY"),y:parseFloat(e.charts[g].chartData[O].total.likes.count)+parseFloat(e.charts[g].chartData[O].total.comments.count),link:e.charts[g].chartData[O].total.link});e.charts[g].chartData=L}break;case"hashTag":if("undefined"!=typeof e.charts[g].chartData[0]){var se="favorite_count",ve="retweet_count",ha=[];if("object"==typeof e.charts[g].chartData[0].total)for(var f=0;f<e.charts[g].chartData.length;f++)if("undefined"!=typeof e.charts[g].chartData[f].total.entities)for(var O=0;O<e.charts[g].chartData[f].total.entities.hashtags.length;O++){var ue=e.charts[g].chartData[f].total[se],Zt=e.charts[g].chartData[f].total[ve],fe=ue+Zt,de={hashTag:e.charts[g].chartData[f].total.entities.hashtags[O].text,engagement:fe};ha.push(de)}var B=_.groupBy(ha,"hashTag"),xe=[];for(var N in B){for(var fe=0,da=0;da<B[N].length;da++)fe+=B[N][da].engagement;xe.push({text:N,engagement:fe})}xe.sort(function(e,t){return parseFloat(t.engagement)-parseFloat(e.engagement)}),e.charts[g].chartData=xe}}break;case"campaignOverview":if("undefined"!=e.charts[g].chartData[0]){L=[];for(var ga=[],O=0;O<e.charts[g].chartData.length;O++)for(var N in e.charts[g].chartData[O].total)ga.push(e.charts[g].chartData[O].total[N]);var ua=_.groupBy(ga,"Campaign ID");for(var R in ua){for(var ma,fa=R,ba="Campaign",ya="Campaign state",va=0,wa=0,Da=0,Ca="Currency",xa="Start date",Ta="End date",Aa=0,Sa="Budget",f=0;f<ua[R].length;f++)Da+=parseFloat(ua[R][f].Cost),Ca=ua[R][f][Ca],Aa+=parseFloat(ua[R][f].Impressions),ma=ua[R][f]["Unique cookies"],va+=parseFloat(ua[R][f].Clicks),wa+=parseFloat(ua[R][f].Conversions);if(0===Da)var Da=Da;else var Da=(Da/1e6).toFixed(2);if(0===Da)var La=Da;else var La=(Da/Aa*1e3).toFixed(2);if(0===va)var Ia=va;else var Ia=(va/Aa*100).toFixed(2);if(0===Da)var ka=Da;else var ka=(Da/va).toFixed(2);if(0===Da)var Fa=Da;else var Fa=(Da/wa*100).toFixed(2);var ja={Id:fa,Name:ua[R][0][ba],status:ua[R][0][ya],Currency:ua[R][0].Currency,startDate:ua[R][0][xa],endDate:ua[R][0][Ta],Budget:ua[R][0][Sa]/1e6,Impressions:Aa,CPM:"Infinity"===La?0:La,CTR:"Infinity"===Ia?0:Ia,CPC:"Infinity"===ka?0:ka,CostPerConv:"Infinity"===Fa?0:Fa,Spent:Da,Conversions:wa,Clicks:va,ImpressionReachValue:ma};L.push(ja)}}e.charts[g].chartData=L;break;case"adgroupOverview":if("undefined"!=e.charts[g].chartData[0]){L=[];for(var Pa=[],O=0;O<e.charts[g].chartData.length;O++)for(var N in e.charts[g].chartData[O].total)Pa.push(e.charts[g].chartData[O].total[N]);var ua=_.groupBy(Pa,"Ad group ID");for(var R in ua){for(var Ea=R,Wa="Ad group",ya="Ad group state",va=0,wa=0,Da=0,Ca="Currency",Oa=0,Aa=0,f=0;f<ua[R].length;f++)Da+=parseFloat(ua[R][f].Cost),Ca=ua[R][f][Ca],Aa+=parseFloat(ua[R][f].Impressions),Oa+=parseFloat(ua[R][f].Totalconvvalue),va+=parseFloat(ua[R][f].Clicks),wa+=parseFloat(ua[R][f].Conversions);if(0===Da)var Da=Da;else var Da=(Da/1e6).toFixed(2);if(0===Da)var La=Da;else var La=(Da/Aa*1e3).toFixed(2);if(0===va)var Ia=va;else var Ia=(va/Aa*100).toFixed(2);if(0===Da)var ka=Da;else var ka=(Da/va).toFixed(2);if(0===Da)var Fa=Da;else var Fa=(Da/wa*100).toFixed(2);var ja={Id:Ea,Name:ua[R][0][Wa],status:ua[R][0][ya],Currency:ua[R][0].Currency,Impressions:Aa,CPM:"Infinity"===La?0:La,CTR:"Infinity"===Ia?0:Ia,CPC:"Infinity"===ka?0:ka,CostPerConv:"Infinity"===Fa?0:Fa,Spent:Da,Conversions:wa,Totalconvvalue:Oa,Clicks:va,CPMCBid:" --"===ua[R][0].MaxCPM?0:parseFloat(ua[R][0].MaxCPM)/1e6,CPCBid:" --"===ua[R][0].MaxCPC?0:parseFloat(ua[R][0].MaxCPC)/1e6,CPVBid:" --"===ua[R][0].MaxCPV?0:parseFloat(ua[R][0].MaxCPV)/1e6};L.push(ja)}}e.charts[g].chartData=L;break;case"fbAdsAdgroupOverview":if("undefined"!=e.charts[g].chartData[0]){L=[];for(var Pa=[],O=0;O<e.charts[g].chartData.length;O++)for(var N in e.charts[g].chartData[O].total)Pa.push(e.charts[g].chartData[O].total[N]);var ua=_.groupBy(Pa,"adset_id");for(var R in ua){for(var Ea=R,Wa="adset_name",ya="status",Na="start_time",Ba="stop_time",va=0,Da=0,Ra="objective",Z=0,Aa=0,wa=0,f=0;f<ua[R].length;f++)Da+=parseFloat(ua[R][f].spend),Z+=parseFloat(ua[R][f].reach),Aa+=parseFloat(ua[R][f].impressions),va+=parseFloat(ua[R][f].clicks),wa+=o(ua[R][f].actions);if(0===Da)var La=Da;else var La=(Da/Aa*1e3).toFixed(2);if(0===va)var Ia=va;else var Ia=(va/Aa*100).toFixed(2);if(0===Da)var ka=Da;else var ka=(Da/va).toFixed(2);if(0===Da)var Fa=Da;else var Fa=(Da/wa*100).toFixed(2);var ja={Id:Ea,Name:ua[R][0][Wa],Objective:ua[R][0][Ra],status:ua[R][0][ya],reach:Z,Impressions:Aa,CPM:"Infinity"===La?0:La,CTR:"Infinity"===Ia?0:Ia,CPC:"Infinity"===ka?0:ka,CostPerConv:"Infinity"===Fa?0:Fa,Spent:Da,Conversions:wa,Clicks:va,StartDate:ua[R][0][Na],EndDate:ua[R][0][Ba]};L.push(ja)}}e.charts[g].chartData=L;break;case"adOverview":if("undefined"!=e.charts[g].chartData[0]){L=[];for(var Pa=[],O=0;O<e.charts[g].chartData.length;O++)for(var N in e.charts[g].chartData[O].total)Pa.push(e.charts[g].chartData[O].total[N]);var Ma=_.groupBy(Pa,"Ad ID");for(var R in Ma){for(var za=R,$a="Business Name",_a="Ad type",va=0,wa=0,Da=0,Oa=0,Ca="Currency",Aa=0,f=0;f<Ma[R].length;f++)Da+=parseFloat(Ma[R][f].Cost),Ca=Ma[R][f][Ca],Aa+=parseFloat(Ma[R][f].Impressions),Oa+=parseFloat(Ma[R][f].Totalconvvalue),va+=parseFloat(Ma[R][f].Clicks),wa+=parseFloat(Ma[R][f].Conversions);if(0===Da)var Da=Da;else var Da=(Da/1e6).toFixed(2);if(0===Da)var La=Da;else var La=(Da/Aa*1e3).toFixed(2);if(0===va)var Ia=va;else var Ia=(va/Aa*100).toFixed(2);if(0===Da)var ka=Da;else var ka=(Da/va).toFixed(2);if(0===wa)var Ha=wa;else var Ha=(wa/va*100).toFixed(2);var ja={Id:za,Name:Ma[R][0][$a],type:Ma[R][0][_a],Currency:Ma[R][0].Currency,clickType:Ma[R][0]["Click type"],Impressions:Aa,CPM:"Infinity"===La?0:La,CTR:"Infinity"===Ia?0:Ia,CPC:"Infinity"===ka?0:ka,Totalconvvalue:Oa,Spent:Da,Conversions:wa,ConversionRate:"Infinity"===Ha?0:Ha,Clicks:va};L.push(ja)}}e.charts[g].chartData=L;break;case"adwordsDemography":var he=e.charts[g].chartSubType;if("undefined"!=e.charts[g].chartData[0]){L=[];for(var ga=[],O=0;O<e.charts[g].chartData.length;O++)for(var N in e.charts[g].chartData[O].total)ga.push(e.charts[g].chartData[O].total[N]);if("pieAge"===he||"tableAge"===he)var ua=_.groupBy(ga,"Age Range");else if("pieGender"===he||"tableGender"===he)var ua=_.groupBy(ga,"Gender");else if("pieDevice"===he||"tableDevice"===he)var ua=_.groupBy(ga,"Device");for(var R in ua){for(var rt=R,va=0,wa=0,Da=0,Ca="Currency",Aa=0,Oa=0,f=0;f<ua[R].length;f++)Da+=parseFloat(ua[R][f].Cost),Aa+=parseFloat(ua[R][f].Impressions),va+=parseFloat(ua[R][f].Clicks),wa+=parseFloat(ua[R][f].Conversions),Oa+=parseFloat(ua[R][f].Totalconvvalue);if(0===Da)var Da=Da;else var Da=(Da/1e6).toFixed(2);if(0===Da)var La=Da;else var La=(Da/Aa*1e3).toFixed(2);if(0===va)var Ia=va;else var Ia=(va/Aa*100).toFixed(2);if(0===Da)var ka=Da;else var ka=(Da/va).toFixed(2);if(0===wa)var Ga=wa;else var Ga=(wa/va*100).toFixed(2);var ja={Currency:ua[R][0].Currency,age:rt,Impressions:Aa,CPM:"Infinity"===La?0:La,CTR:"Infinity"===Ia?0:Ia,CPC:"Infinity"===ka?0:ka,conversionRate:"Infinity"===Ga?0:Ga,Spent:Da,Conversions:wa,Clicks:va,Totalconvvalue:Oa};L.push(ja)}}if("pieAge"===he||"pieGender"===he||"pieDevice"===he){for(var Ya={},f=0;f<L.length;f++){var Va=L[f].age;Ya[Va]=L[f].Impressions}L=Ya}e.charts[g].chartData=L;break;case"fbAdsCampaignOverview":if("undefined"!=e.charts[g].chartData[0]){L=[];for(var ga=[],O=0;O<e.charts[g].chartData.length;O++)for(var N in e.charts[g].chartData[O].total)ga.push(e.charts[g].chartData[O].total[N]);var ua=_.groupBy(ga,"campaign_id");for(var R in ua){for(var ma,fa=R,Ua="campaign_name",ya="status",we=0,qa=0,Xa=0,Ja=0,Ka=0,Za=0,Qa=0,Z=0,er=0,xa="start_time",Ta="stop_time",De=0,f=0;f<ua[R].length;f++)De+=parseFloat(ua[R][f].impressions),we+=parseFloat(ua[R][f].clicks),qa+=o(ua[R][f].actions),Ja+=i(ua[R][f].cost_per_action_type),Xa+=s(ua[R][f].cost_per_unique_action_type),Ka+=parseFloat(ua[R][f].spend),Za+=parseFloat(ua[R][0].app_store_clicks),Qa+=parseFloat(ua[R][0].frequency),er+=parseFloat(ua[R][0].video_avg_percent_watched_actions),Z+=parseFloat(ua[R][0].reach);if(0===Ja)var La=Ja;else var La=(Ja/De*1e3).toFixed(2);if(0===we)var Ia=we;else var Ia=(we/De*100).toFixed(2);if(0===Ja)var ka=Ja;else var ka=(Ja/we).toFixed(2);if(0===Ja);else{(Ja/qa*100).toFixed(2)}var Ke={Id:fa,Name:ua[R][0][Ua],Objective:ua[R][0].objective,status:ua[R][0][ya],reach:Z,Impressions:De,cost:Ja.toFixed(2),CPM:"Infinity"===La?0:La,CTR:"Infinity"===Ia?0:Ia,CPC:"Infinity"===ka?0:ka,Actions:"Infinity"===qa?0:qa,Spent:Ka,Conversions:qa,Clicks:we,StartDate:ua[R][0][xa],EndDate:ua[R][0][Ta],AppStoreClicks:Za,CostPerUniqueActionByType:Xa.toFixed(2),
Frequency:Qa.toFixed(2),VideoAvgViewTime:isNaN(er)?0:er};L.push(Ke)}}e.charts[g].chartData=L;break;case"fbAdsAdOverview":if("undefined"!=e.charts[g].chartData[0]){L=[];for(var tr=[],O=0;O<e.charts[g].chartData.length;O++)for(var N in e.charts[g].chartData[O].total)tr.push(e.charts[g].chartData[O].total[N]);var ar=_.groupBy(tr,"ad_id");for(var R in ar){for(var we=0,rr=0,Xa=0,Ja=0,Ka=0,Za=0,Qa=0,Z=0,er=0,De=0,f=0;f<ar[R].length;f++)we+=parseFloat(ar[R][f].clicks),De+=parseFloat(ar[R][f].impressions),rr+=o(ar[R][f].actions),Xa+=s(ar[R][f].cost_per_unique_action_type),Ka+=parseFloat(ar[R][f].spend),Za+=parseFloat(ar[R][0].app_store_clicks),Qa+=parseFloat(ar[R][0].frequency),Z+=parseFloat(ar[R][0].reach);if(0===Ja)var Ja=Ja;else var Ja=(Ja/1e6).toFixed(2);if(0===Ja)var La=Ja;else var La=(Ja/De*1e3).toFixed(2);if(0===we)var Ia=we;else var Ia=(we/De*100).toFixed(2);if(0===Ja)var ka=Ja;else var ka=(Ja/we).toFixed(2);var Ke={Id:R,AdName:ar[R][0].ad_name,AdSetName:ar[R][0].adset_name,CampaignName:ar[R][0].campaign_name,Objective:ar[R][0].objective,Status:ar[R][0].status,Reach:Z,Impressions:De,CPM:"Infinity"===La?0:La,CTR:"Infinity"===Ia?0:Ia,Actions:"Infinity"===rr?0:rr,Spend:Ja,StartDate:ar[R][0].start_time,EndDate:ar[R][0].end_time,AppStoreClicks:Za,CostPerUniqueActionByType:Xa.toFixed(2),Frequency:Qa.toFixed(2)};L.push(Ke)}}e.charts[g].chartData=L}}for(var g in e.charts)if("undefined"!=typeof e.charts[g].chartData[0])if(e.charts[g].chartData[0].x)for(var U in e.charts[g].chartData)h+=parseFloat(e.charts[g].chartData[U].y),parseFloat(h)>0&&0!=parseFloat(h)&&++d;else for(var or in e.charts[g].chartData)for(var U in e.charts[g].chartData[or])"undefined"!=typeof e.charts[g].chartData[or][U]&&(h+=parseFloat(e.charts[g].chartData[or][U].y),Number(h)>0&&0!=Number(h)&&++d);for(var g in e.charts){var u=e.charts[g].chartType,he=e.charts[g].chartSubType;if("line"==u||"bar"==u||"column"==u||"stackcolumn"==u||"area"==u||"pie"==u||"reachVsImpressions"==u||"engagedUsersReach"==u||"mozoverview"==u||"trafficSourcesBrkdwnLine"==u||"bounceRateArea"==u||"negativeBar"==u||"trafficSourcesBrkdwnPie"==u||"costPerThosuandImpressions"==u||"clickThroughRate"==u||"costPerConversion"==u||"ConversionRate"==u||"costPerClick"==u||"costPerActionType"==u&&void 0!=e.meta){if("undefined"!=typeof e.charts[g].chartData[0])if(e.charts[g].chartData[0].x){var sr,ir=0,nr=!1,lr=0,cr=0,dr=e.charts[g].chartData.length,hr=0,pr=0,gr=0,ur=0,mr=0,fr=0;if(e.charts[g].chartData.length>=14){for(var z=0,f=dr-1;f>=0;f--)0===z||z<7?("reachVsImpressions"==u||"engagedUsersReach"==u)&&e.charts[g].chartData[f].imp&&e.charts[g].chartData[f].rea?(gr+=parseFloat(e.charts[g].chartData[f].imp),ur+=parseFloat(e.charts[g].chartData[f].rea)):hr+=parseFloat(e.charts[g].chartData[f].y):z>=7&&z<14&&(("reachVsImpressions"==u||"engagedUsersReach"==u)&&e.charts[g].chartData[f].imp&&e.charts[g].chartData[f].rea?(mr+=parseFloat(e.charts[g].chartData[f].imp),fr+=parseFloat(e.charts[g].chartData[f].rea)):pr+=parseFloat(e.charts[g].chartData[f].y)),z++;"Total Impressions"!=e.charts[g].chartName&&"Engaged Users"!=e.charts[g].chartName||"reachVsImpressions"!=u&&"engagedUsersReach"!=u||(hr=isNaN(gr/ur)?0:gr/ur,pr=isNaN(mr/fr)?0:mr/fr),sr="WK"}else if("object"!=typeof e.charts[g].chartData[0].x){var br=p(e.charts[g].chartData[0].x);if(br){var yr=_.last(e.charts[g].chartData),vr=moment(yr.x).subtract(1,"days").format("YYYY-DD-MM");hr="Total Impressions"!=e.charts[g].chartName&&"Engaged Users"!=e.charts[g].chartName||"reachVsImpressions"!=u&&"engagedUsersReach"!=u?parseFloat(yr.y):isNaN(parseFloat(yr.imp)/parseFloat(yr.rea))?0:parseFloat(yr.imp)/parseFloat(yr.rea);for(var f=dr-1;f>=0;f--){var wr=moment(e.charts[g].chartData[f].x).format("YYYY-DD-MM");vr===wr&&(pr="Total Impressions"!=e.charts[g].chartName&&"Engaged Users"!=e.charts[g].chartName||"reachVsImpressions"!=u&&"engagedUsersReach"!=u?parseFloat(e.charts[g].chartData[f].y):isNaN(parseFloat(e.charts[g].chartData[f].imp)/parseFloat(e.charts[g].chartData[f].rea))?0:parseFloat(e.charts[g].chartData[f].imp)/parseFloat(e.charts[g].chartData[f].rea))}sr="Day"}}else{var yr=_.last(e.charts[g].chartData),vr=moment(yr.x).subtract(1,"days").format("YYYY-DD-MM");hr=parseFloat(yr.y);for(var f=dr-1;f>=0;f--){var wr=moment(e.charts[g].chartData[f].x).format("YYYY-DD-MM");vr===wr&&(pr=parseFloat(e.charts[g].chartData[f].y))}sr="Day"}var Dr,Q,Cr;hr>pr?(Dr="up",Cr=hr-pr,Q=pr>0?parseFloat(Cr/pr*100).toFixed(2):hr):hr<pr?(Dr="down",Cr=pr-hr,Q=pr>0?parseFloat(Cr/pr*100).toFixed(2):0):(Cr=pr-hr,Q=0);var xr=0,Tr=0;for(var U in e.charts[g].chartData)("reachVsImpressions"==u||"engagedUsersReach"==u)&&e.charts[g].chartData[U].imp&&e.charts[g].chartData[U].rea?(xr+=parseFloat(e.charts[g].chartData[U].imp),Tr+=parseFloat(e.charts[g].chartData[U].rea)):(isNaN(e.charts[g].chartData[U].y)&&(e.charts[g].chartData[U].y=0),ir+=parseFloat(e.charts[g].chartData[U].y)),parseFloat(e.charts[g].chartData[U].y)>0&&cr++;if("Total Impressions"!=e.charts[g].chartName&&"Engaged Users"!=e.charts[g].chartName||"reachVsImpressions"!=u&&"engagedUsersReach"!=u||(ir=isNaN(xr/Tr)?0:xr/Tr*100),"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.summaryType)if("avg"==e.charts[g].metricDetails.objectTypes[0].meta.summaryType)ir=0==cr&&0==ir?0:parseFloat(ir/cr).toFixed(2);else if("snapshot"==e.charts[g].metricDetails.objectTypes[0].meta.summaryType){var Ar="";for(var ee in e.charts[g].chartData)Ar<moment(e.charts[g].chartData[ee].x)&&(Ar=moment(e.charts[g].chartData[ee].x),ir=e.charts[g].chartData[ee].y,0!=ir&&(lr+=1));nr=lr>=1}if("bounceRateArea"==u){var Sr=0,y=0;for(var U in e.charts[g].chartData)Sr+=parseFloat(e.charts[g].chartData[U].bounces),y+=parseFloat(e.charts[g].chartData[U].sessions);ir=Sr/y*100}if("costPerClick"==u||"costPerThosuandImpressions"==u||"clickThroughRate"==u||"ConversionRate"==u||"costPerConversion"==u){var C=0,x=0;for(var U in e.charts[g].chartData)C+=parseFloat(e.charts[g].chartData[U].dividend),x+=parseFloat(e.charts[g].chartData[U].divisor);ir=0===C?C:"costPerThosuandImpressions"==u?C/x*1e3:"clickThroughRate"==u||"ConversionRate"==u||"costPerConversion"==u?"Infinity"===(C/x*100).toFixed(2)?0:(C/x*100).toFixed(2):C/x}if("line"==u||"bar"==u||"column"==u||"mozoverview"==u)"FacebookAds"==e.channelName&&"Cost Per Unique Action Type"==e.charts[g].metricDetails.name?l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,key:e.charts[g].chartName,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],summaryDisplay:parseFloat(ir).toFixed(2)%Math.floor(parseFloat(ir).toFixed(2))>0?parseFloat(ir).toFixed(2):parseFloat(ir).toFixed(2)>1?parseInt(ir):parseFloat(ir)>0?parseFloat(ir).toFixed(2):parseInt(ir),hasSnapshotData:nr}):("bar"==u||"column"==u)&&d<0&&0==ir?l.push({type:"line",channelName:c[e.channelName],values:e.charts[g].chartData,key:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):l.push({subChartType:e.charts[g].subChartType,channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,key:"fbTopReferringDomain"===e.charts[g].chartSubType?void 0:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,chartSubType:e.charts[g].chartSubType,hasSnapshotData:nr});else if("area"==u||"Reach Vs Impressions"==u||"EngagedUsersReach"==u||"negativeBar"==u)if("negativeBar"==u){var Lr=[];for(var Ir in e.charts[g].chartData)Lr.push({x:e.charts[g].chartData[Ir].x,y:-Math.abs(e.charts[g].chartData[Ir].y)});e.charts[g].chartType="area",l.push({channelName:c[e.channelName],type:"area",values:Lr,key:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,area:!0,hasSnapshotData:nr})}else l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,key:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr});else if("area"==u||"reachVsImpressions"==u||"engagedUsersReach"==u){var kr=Math.round(100*ir)/100;l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,key:"Total Impressions"==e.charts[g].metricDetails.name?"Impressions/Reach (%)":e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:"Total Impressions"==e.charts[g].metricDetails.name||"Engaged users/Reach (%)"==e.charts[g].metricDetails.name?kr+"%":kr,area:!0,hasSnapshotData:nr})}else"bounceRateArea"==u?(e.charts[g].chartType="area",l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,key:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr})):"costPerClick"==u||"costPerThosuandImpressions"==u||"clickThroughRate"==u||"ConversionRate"==u||"costPerConversion"==u?(e.charts[g].chartType="area",l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,key:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr})):"costPerActionType"==u?l.push({channelName:c[e.channelName],type:"line",values:e.charts[g].chartData,key:e.meta.replace("_"," "),color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):"trafficSourcesBrkdwnLine"==u?l.push({type:"line",channelName:c[e.channelName],values:e.charts[g].chartData,key:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):"trafficSourcesBrkdwnPie"==u?l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:"pie",values:e.charts[g].chartData,key:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):"percentageArea"==u?l.push({channelName:c[e.channelName],type:e.charts[g].chartType,metricCode:e.charts[g].metricCode,metricName:e.charts[g].metricName,key:e.charts[g].metricName,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",values:e.charts[g].chartData,color:e.charts[g].chartColour,arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:e.charts[g].chartType,y:parseFloat(ir),key:e.charts[g].metricDetails.name,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,period:sr,variance:Q,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr})}else for(var or in e.charts[g].chartData){var sr,ir=0,cr=0,dr=e.charts[g].chartData[or].length,hr=0,pr=0;if(e.charts[g].chartData[or].length>=14){for(var z=0,f=dr-1;f>=0;f--)0===z||z<7?hr+=parseFloat(e.charts[g].chartData[or][f].y):z>=7&&z<14&&(pr+=parseFloat(e.charts[g].chartData[or][f].y)),z++;sr="WK"}else if(e.charts[g].chartData[or].length>0){var Fr=e.charts[g].chartData[or].length,yr=_.last(e.charts[g].chartData[or]);if("string"!=typeof yr.x){var vr=moment(yr.x).subtract(1,"days").format("YYYY-DD-MM");hr=parseFloat(yr.y)}else hr=parseFloat(e.charts[g].chartData[or][Fr-1].y);for(var f=dr-1;f>=0;f--)if("string"!=typeof yr.x){var wr=moment(e.charts[g].chartData[or][f].x).format("YYYY-DD-MM");vr===wr&&(pr=parseFloat(e.charts[g].chartData[or][f].y))}else pr=parseFloat(e.charts[g].chartData[or][Fr-2].y);sr="Day"}var Dr,Cr,Q;if(hr>pr)Dr="up",Cr=hr-pr,Q=pr>0?parseFloat(Cr/pr*100).toFixed(2):hr;else if(hr<pr)Dr="down",Cr=pr-hr,Q=pr>0?parseFloat(Cr/pr*100).toFixed(2):0;else var Cr=pr-hr,Q=0;for(var U in e.charts[g].chartData[or])if(ir+=parseFloat(e.charts[g].chartData[or][U].y),parseFloat(0!=e.charts[g].chartData[or][U].y)&&cr++,"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.summaryType)if("avg"==e.charts[g].metricDetails.objectTypes[0].meta.summaryType)ir=0==cr&&0==ir?0:parseFloat(ir/cr).toFixed(2);else if("snapshot"==e.charts[g].metricDetails.objectTypes[0].meta.summaryType){var Ar="";_.findIndex(e.charts[g].chartData[or].y,function(e){return 0!==e.date});for(var ee in e.charts[g].chartData[or])Ar<moment(e.charts[g].chartData[or][ee].x)&&(Ar=moment(e.charts[g].chartData[or][ee].x),ir=e.charts[g].chartData[or][ee].y)}"line"==u||"bar"==u||"column"==u||"mozoverview"==u||"stackcolumn"==u?("bar"==u||"column"==u)&&d<0&&0==ir?l.push({channelName:c[e.channelName],type:"line",values:e.charts[g].chartData[or],key:e.charts[g].metricDetails.objectTypes[0].meta.endpoint,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData[or],key:"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName&&"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]?e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]:e.charts[g].metricDetails.objectTypes[0].meta.endpoint[or],unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[or]:"",color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[or]?e.charts[g].chartColour[or]:"",arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):"trafficSourcesBrkdwnLine"==u?l.push({channelName:c[e.channelName],type:"line",values:e.charts[g].chartData[or],key:"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName&&"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]?e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]:e.charts[g].metricDetails.objectTypes[0].meta.endpoint[or],unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[or]:"",color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[or]?e.charts[g].chartColour[or]:"",arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):"trafficSourcesBrkdwnPie"==u?l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:"pie",y:parseFloat(ir),key:"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName&&"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]?e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]:e.charts[g].metricDetails.objectTypes[0].meta.endpoint[or],unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[or]:"",color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[or]?e.charts[g].chartColour[or]:"",arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):"area"==u||"negativebar"==u?l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData[or],key:"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName&&"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]?e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]:e.charts[g].metricDetails.objectTypes[0].meta.endpoint[or],unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[or]:"",color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[or]?e.charts[g].chartColour[or]:"",arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,area:!0,hasSnapshotData:nr}):"costPerActionType"==u?l.push({channelName:c[e.channelName],type:"line",values:e.charts[g].chartData,key:e.meta,color:e.charts[g].chartColour[0],arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}):l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:e.charts[g].chartType,y:parseFloat(ir),key:"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName&&"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]?e.charts[g].metricDetails.objectTypes[0].meta.endpointDisplayName[endpointDisplayCode]:e.charts[g].metricDetails.objectTypes[0].meta.endpoint[or].replace(/\_/g," "),unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[or]:"",color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[or]?e.charts[g].chartColour[or]:"",arrow:Dr,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr})}}else if("tableAge"==he||"tableGender"==he||"tableDevice"==he)l.push({type:"campaignOverViewbyAge",values:e.charts[g].chartData});else if("fbReachByCity"==u||"gaUsers"===u||"pieAge"==he||"pieGender"==he||"pieDevice"==he){var jr=0;for(var Pr in e.charts[g].chartData)l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:"fbReachByCity",y:parseFloat(e.charts[g].chartData[Pr]),key:Pr,unit:void 0!=e.charts[g].metricDetails.objectTypes[0].meta.unit?e.charts[g].metricDetails.objectTypes[0].meta.unit[0]:"",color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[jr]?e.charts[g].chartColour[jr]:"",summaryDisplay:Math.round(100*e.charts[g].chartData[Pr])/100,hasSnapshotData:nr}),++jr}else if("costPerActionType"==u&&void 0==e.meta)l.push({type:"costPerActionType",values:e.charts[g].chartData});else switch(u){case"instagramPosts":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"stackbar":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"highEngagementTweets":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"highestEngagementLinkedIn":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"vimeoTopVideos":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"gaTopPagesByVisit":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"campaignOverview":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"adgroupOverview":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"fbAdsAdgroupOverview":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"adOverview":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"gaPageContentEfficiencyTable":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"gaPageTechnicalEfficiencyTable":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"gaVisitorAcquisitionEfficiencyAnalysisTable":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"audienceBehaviourbyDay":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData,color:e.charts[g].chartColour});break;case"socialContributionToSiteTraffic":l.push({type:e.charts[g].chartType,metricCode:e.charts[g].metricCode,metricName:e.charts[g].metricName,values:e.charts[g].chartData,color:e.charts[g].chartColour});break;case"pageTechnicalEfficiency":for(var Sr=0,Er=0,f=0;f<e.charts[g].chartData.length;f++)Sr+=Number(e.charts[g].chartData[f].bounceRate),Er+=Number(e.charts[g].chartData[f].PageLoadTime);var Wr=[{key:"Page LoadTime",value:Er,unit:"s"},{key:"Bounce Rate",value:Sr,unit:"%"}];l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,summary:Wr,key:e.charts[g].chartName,color:e.charts[g].chartColour});break;case"pageContentEfficiency":for(var Sr=0,Ne=0,Ee=0,Le=0,f=0;f<e.charts[g].chartData.length;f++)Sr+=Number(e.charts[g].chartData[f].bounceRate),Ne+=Number(e.charts[g].chartData[f].entranceRate),Ee+=Number(e.charts[g].chartData[f].uniquePageviews),Le+=Number(e.charts[g].chartData[f].pageviews);var Wr=[{key:"Unique Page views",value:Ee},{key:"Page views",value:Le,unit:""},{key:"Bounce Rate",value:Sr,unit:"%"},{key:"Entrance rate",value:Ne,unit:"%"}];l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,summary:Wr,key:e.charts[g].chartName,color:e.charts[g].chartColour});break;case"visitorAcquisitionEfficiency":for(var He=0,Ye=0,Ge=0,f=0;f<e.charts[g].chartData.length;f++)Ge+=Number(e.charts[g].chartData[f].goalConversionRateAll),Ye+=Number(e.charts[g].chartData[f].goalValuePerSession),He+=Number(e.charts[g].chartData[f].newUsers);var Wr=[{key:"New users",value:He},{key:"Per session goal value",value:Ye,unit:""},{key:"Goal conversion rate",value:Ge,unit:"%"}];l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,summary:Wr,key:e.charts[g].chartName,color:e.charts[g].chartColour});break;case"gaSocialMediaOverview":l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,key:e.charts[g].chartName,color:e.charts[g].chartColour});break;case"topReferringSites":if("Top referring sites(Table)"==String(e.charts[g].chartName))l.push({type:"topReferringSitesTable",values:e.charts[g].chartData});else{for(var Ze=0,Qe=0,f=0;f<e.charts[g].chartData.length;f++)Ze+=Number(e.charts[g].chartData[f].goalConversionRate),y+=Number(e.charts[g].chartData[f].sessions),Qe+=Number(e.charts[g].chartData[f].goalCompletions);var Wr=[{key:"Sessions",value:y},{key:"Goal Completions",value:Qe,unit:""},{key:"Goal conversion rate",value:Ze,unit:"%"}];l.push({channelName:c[e.channelName],type:e.charts[g].chartType,values:e.charts[g].chartData,summary:Wr,key:e.charts[g].chartName,color:e.charts[g].chartColour})}break;case"fbReachByAge":l.push({type:"fbReachByAge",values:e.charts[g].chartData,channelName:c[e.channelName]});break;case"instagramEngagements":if("instagramPostTypes"===e.charts[g].chartSubType){var jr=0;for(var Pr in e.charts[g].chartData)l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:"pie",key:Pr,displaySummary:!1,y:parseFloat(e.charts[g].chartData[Pr]),color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[jr]?e.charts[g].chartColour[jr]:""}),++jr}else if("instagramPostEngagement"===e.charts[g].chartSubType){var jr=0;for(var Pr in e.charts[g].chartData)l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:"fbReachByCity",y:parseFloat(e.charts[g].chartData[Pr]),key:Pr,displaySummary:!1,color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[jr]?e.charts[g].chartColour[jr]:"",summaryDisplay:Math.round(100*e.charts[g].chartData[Pr])/100,hasSnapshotData:nr}),++jr}else if("instagramPostFrequency"===e.charts[g].chartSubType){var Or=new Date(a.startDate),Nr=new Date(a.endDate),Br=Math.abs(Nr.getTime()-Or.getTime()),Rr=Math.ceil(Br/864e5);l.push({channelName:c[e.channelName],key:"Post per day",type:"angularGauge",y:Math.round(e.charts[g].chartData/Rr*100)/100,displaySummary:!1,color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[jr]?e.charts[g].chartColour[jr]:"",summaryDisplay:Math.round(e.charts[g].chartData/Rr*100)/100,hasSnapshotData:nr})}break;case"fbReachByCountry":var jr=0;for(var Pr in e.charts[g].chartData)l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:"pie",y:parseFloat(e.charts[g].chartData[Pr]),key:Pr,color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[jr]?e.charts[g].chartColour[jr]:"",summaryDisplay:Math.round(100*e.charts[g].chartData[Pr])/100,hasSnapshotData:nr}),++jr;break;case"gaTopCountriesToSocialVisits":case"gaTopCitiesToSocialVisits":var jr=0;for(var Pr in e.charts[g].chartData)l.push({channelName:c[e.channelName],name:e.charts[g].chartName,type:"pie",y:parseFloat(e.charts[g].chartData[Pr]),key:Pr,color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[jr]?e.charts[g].chartColour[jr]:"",summaryDisplay:parseFloat(e.charts[g].chartData[Pr]).toFixed(2)%Math.floor(e.charts[g].chartData[Pr])>0?parseFloat(e.charts[g].chartData[Pr]).toFixed(2):parseInt(e.charts[g].chartData[Pr]),hasSnapshotData:nr}),++jr;break;case"pinterestEngagementRate":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"pinterestLeaderboard":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"instagramHashtagLeaderBoard":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"percentageArea":if("undefined"!=typeof e.charts[g].chartData[0].y){var Mr=_.groupBy(e.charts[g].chartData,"y.socialNetwork"),zr=0;for(var R in Mr){var sr,ir=0,lr=0,nr=!1,cr=0,dr=Mr[R].length,hr=0,pr=0;if(e.charts[g].chartData.length>=14){for(var z=0,f=dr-1;f>=0;f--)(0===z||z<7)&&"undefined"!=typeof Mr[R][f].y?hr+=parseFloat(Mr[R][f].y.total):z>=7&&z<14&&"undefined"!=typeof Mr[R][f].y&&(pr+=parseFloat(Mr[R][f].y.total)),z++;sr="WK"}else if(e.charts[g].chartData.length>0){var Fr=Mr[R].length,yr=_.last(Mr[R]);if("string"!=typeof yr.x){var vr=moment(yr.x).subtract(1,"days").format("YYYY-DD-MM");hr=parseFloat(yr.y)}else hr=parseFloat(Mr[R][Fr-1].y.total);for(var f=dr-1;f>=0;f--)if("string"!=typeof yr.x){var wr=moment(Mr[R][f].x).format("YYYY-DD-MM");vr===wr&&(pr=parseFloat(Mr[R][f].y))}else pr=parseFloat(Mr[R][Fr-2].y.total);sr="Day"}var Dr,Cr,Q;if(hr>pr)Dr="up",Cr=hr-pr,Q=pr>0?parseFloat(Cr/pr*100).toFixed(2):hr;else if(hr<pr)Dr="down",Cr=pr-hr,Q=pr>0?parseFloat(Cr/pr*100).toFixed(2):0;else var Cr=pr-hr,Q=0;for(var U in Mr[R])if("undefined"!=typeof Mr[R][U].y&&(ir+=parseFloat(Mr[R][U].y.total)),"undefined"!=typeof Mr[R][U].y&&parseFloat(0!=Mr[R][U].y.total)&&cr++,"undefined"!=typeof e.charts[g].metricDetails.objectTypes[0].meta.summaryType)if("avg"==e.charts[g].metricDetails.objectTypes[0].meta.summaryType)ir=0==cr&&0==ir?0:parseFloat(ir/cr).toFixed(2);else if("snapshot"==e.charts[g].metricDetails.objectTypes[0].meta.summaryType){var Ar="";for(var ee in Mr[or])Ar<moment(Mr[R][ee].x)&&(Ar=moment(Mr[R][ee].x),ir=Mr[R][ee].y.total,0!=ir&&(lr+=1));nr=lr>=1}l.push({channelName:c[e.channelName],type:e.charts[g].chartType,metricCode:e.charts[g].metricCode,metricName:e.charts[g].metricName,key:R,values:Mr[R],color:"undefined"!=typeof e.charts[g].chartColour&&"undefined"!=typeof e.charts[g].chartColour[zr]?e.charts[g].chartColour[zr]:"",arrow:Dr,totalChartLength:e.charts[g].chartData,variance:Q,period:sr,summaryDisplay:Math.round(100*ir)/100,hasSnapshotData:nr}),zr++}}break;case"youtubeVideosOverview":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"twitterEngagements":"engagementByUsersTalkedAbout"===e.charts[g].chartSubType||"topLinks"===e.charts[g].chartSubType||"hashTag"===e.charts[g].chartSubType?l.push({type:e.charts[g].chartType,chartSubType:e.charts[g].chartSubType,values:e.charts[g].chartData}):l.push({channelName:c[e.channelName],type:e.charts[g].chartType,chartSubType:e.charts[g].chartSubType,values:e.charts[g].chartData,key:e.charts[g].chartName,color:e.charts[g].chartColour});break;case"fbAdsCampaignOverview":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData});break;case"fbAdsAdOverview":l.push({type:e.charts[g].chartType,values:e.charts[g].chartData})}}}return n.resolve(l),n.promise}function h(e,a,r){function o(e,t){var a;for(var r in S){a=!1;for(var o in t)S[r]==t[o]&&(a=!0);if(0==a)return S[r]}}function s(e,t){return e+t}function s(e,t){return e+t}function s(e,t){return e+t}var i=t.defer(),n=[];n.twitterEngagements=[],n.youtubeVideosOverview=[],n.lineCharts=[],n.barCharts=[],n.pieCharts=[],n.percentageAreaOptions=[],n.instagramPosts=[],n.highEngagementTweets=[],n.highestEngagementLinkedIn=[],n.pinterestEngagementRate=[],n.pinterestLeaderboard=[],n.gaTopPagesByVisit=[],n.angularGauge=[],n.multicharts=[],n.campaignOverViewbyAge=[],n.campaignOverview=[],n.adOverview=[],n.adgroupOverview=[],n.fbAdsAdgroupOverview=[],n.fbReachByAge=[],n.mozoverview=[],n.fbReachByCity=[],n.vimeoTopVideos=[],n.costPerActionType=[],n.topReferringSites=[],n.instagramHashtagLeaderBoard=[],n.gaPageContentEfficiencyTable=[],n.gaPageTechnicalEfficiencyTable=[],n.gaVisitorAcquisitionEfficiencyAnalysisTable=[],n.pageTechnicalEfficiency=[],n.pageContentEfficiency=[],n.visitorAcquisitionEfficiency=[],n.percentageArea=[],n.topReferringSites=[],n.topReferringSitesTable=[],n.gaSocialMediaOverview=[],n.stackbar=[],n.fbAdsCampaignOverview=[],n.fbAdsAdOverview=[];var l,c,d,h,m,f={lineDataOptions:{chart:{type:"lineChart",noData:"No data for chosen date range",margin:{top:20,right:25,bottom:30,left:35},x:function(e){return e.x},y:function(e){return parseFloat(e.y)},useInteractiveGuideline:!0,xAxis:{tickFormat:function(e){return d3.time.format("%d/%m/%y")(new Date(e))},showMaxMin:!1},yAxis:{tickFormat:function(e){return d3.format("r")(e)},showMaxMin:!1},interpolate:"monotone",axisLabelDistance:-10,showLegend:!1,clipEdge:!1,legend:{rightAlign:!1,margin:{bottom:25}}}},barDataOptions:{chart:{type:"multiBarChart",noData:"No data for chosen date range",margin:{top:20,right:25,bottom:30,left:35},x:function(e){return e.x},y:function(e){return parseFloat(e.y)},useInteractiveGuideline:!0,xAxis:{tickFormat:function(e){return d3.time.format("%d/%m/%y")(new Date(e))},showMaxMin:!1},yAxis:{tickFormat:function(e){return d3.format("r")(e)},showMaxMin:!1},tooltip:{enabled:!1,headerEnabled:!0,headerFormatter:function(e){return d3.time.format("%d/%m/%y")(new Date(e))}},axisLabelDistance:-10,showLegend:!1,stacked:!0,showControls:!1,legend:{rightAlign:!1,margin:{bottom:25}}}},pieDataOptions:{chart:{type:"pieChart",noData:"No data for chosen date range",margin:{top:0,right:15,bottom:15,left:15},x:function(e){return e.key},y:function(e){return e.y},showLabels:!1,showLegend:!1,labelsOutside:!1,tooltips:!0,labelThreshold:.01,labelSunbeamLayout:!0,legend:{rightAlign:!1,margin:{bottom:25}}}},percentageAreaOptions:{chart:{type:"area",noData:"No data for chosen date range",margin:{top:20,right:25,bottom:30,left:35},x:function(e){return e.x},y:function(e){return parseFloat(e.y)},useInteractiveGuideline:!0,xAxis:{tickFormat:function(e){return d3.time.format("%d/%m/%y")(new Date(e));
},showMaxMin:!1},yAxis:{tickFormat:function(e){return d3.format("r")(e)},showMaxMin:!1},interpolate:"monotone",axisLabelDistance:-10,showLegend:!1,clipEdge:!1,legend:{rightAlign:!1,margin:{bottom:25}}}},instagramPosts:{chart:{type:"instagramPosts"}},campaignOverview:{chart:{type:"campaignOverview"}},adOverview:{chart:{type:"adOverview"}},adgroupOverview:{chart:{type:"adgroupOverview"}},fbAdsAdgroupOverview:{chart:{type:"fbAdsAdgroupOverview"}},highEngagementTweets:{chart:{type:"highEngagementTweets"}},mozoverview:{chart:{type:"mozoverview"}},highestEngagementLinkedIn:{chart:{type:"highestEngagementLinkedIn"}},vimeoTopVideos:{chart:{type:"vimeoTopVideos"}},campaignOverViewbyAge:{chart:{type:"campaignOverViewbyAge"}},gaTopPagesByVisit:{chart:{type:"gaTopPagesByVisit"}},gaPageContentEfficiencyTable:{chart:{type:"gaPageContentEfficiencyTable"}},gaPageTechnicalEfficiencyTable:{chart:{type:"gaPageTechnicalEfficiencyTable"}},gaVisitorAcquisitionEfficiencyAnalysisTable:{chart:{type:"gaVisitorAcquisitionEfficiencyAnalysisTable"}},topReferringSitesTable:{chart:{type:"topReferringSitesTable"}},visitorAcquisitionEfficiency:{chart:{type:"visitorAcquisitionEfficiency",margin:{top:20,right:30,bottom:30,left:35}}},engagementByUsersTalkedAbout:{chart:{type:"engagementByUsersTalkedAbout"}},youtubeVideosOverview:{chart:{type:"youtubeVideosOverview"}},pinterestEngagementRate:{chart:{type:"pinterestEngagementRate"}},pinterestLeaderboard:{chart:{type:"pinterestLeaderboard"}},costPerActionType:{chart:{type:"costPerActionType"}},fbAdsCampaignOverview:{chart:{type:"fbAdsCampaignOverview"}},fbAdsAdOverview:{chart:{type:"fbAdsAdOverview"}},emptyCharts:{chart:{type:"emptyCharts"}},multiDataOptions:{chart:{type:"multiChart",noData:"No data for chosen date range",margin:{top:20,right:30,bottom:30,left:35},x:function(e){return e.x},y:function(e){return parseFloat(e.y)},useInteractiveGuideline:!0,xAxis:{tickFormat:function(e){return d3.time.format("%d/%m/%y")(new Date(e))},showMaxMin:!1},yAxis1:{tickFormat:function(e){return d3.format("r")(e)},showMaxMin:!1},yAxis2:{tickFormat:function(e){return d3.format("r")(e)},showMaxMin:!1},interpolate:"monotone",axisLabelDistance:-10,showLegend:!1,legend:{rightAlign:!1,margin:{bottom:25}}}},instagramHashtagLeaderBoard:{chart:{type:"instagramHashtagLeaderBoard"}}},b=0,y=[],v=[{W:1,H:1,N:0,r:1,c:1},{W:1,H:1,N:1,r:1,c:1},{W:1,H:1,N:2,r:2,c:1},{W:1,H:1,N:3,r:3,c:1},{W:1,H:1,N:4,r:4,c:1},{W:1,H:1,N:5,r:5,c:1},{W:1,H:1,N:6,r:6,c:1},{W:1,H:1,N:7,r:7,c:1},{W:1,H:1,N:8,r:8,c:1},{W:2,H:1,N:0,r:1,c:1},{W:2,H:1,N:1,r:1,c:1},{W:2,H:1,N:2,r:1,c:2},{W:2,H:1,N:3,r:2,c:1},{W:2,H:1,N:4,r:2,c:2},{W:2,H:1,N:5,r:2,c:3},{W:2,H:1,N:6,r:2,c:3},{W:2,H:1,N:7,r:3,c:3},{W:2,H:1,N:8,r:3,c:3},{W:3,H:1,N:0,r:1,c:1},{W:3,H:1,N:1,r:1,c:1},{W:3,H:1,N:2,r:1,c:2},{W:3,H:1,N:3,r:1,c:3},{W:3,H:1,N:4,r:2,c:2},{W:3,H:1,N:5,r:2,c:3},{W:3,H:1,N:6,r:2,c:3},{W:3,H:1,N:7,r:3,c:3},{W:3,H:1,N:8,r:3,c:3},{W:4,H:1,N:0,r:1,c:1},{W:4,H:1,N:1,r:1,c:1},{W:4,H:1,N:2,r:1,c:2},{W:4,H:1,N:3,r:1,c:3},{W:4,H:1,N:4,r:1,c:4},{W:4,H:1,N:5,r:2,c:3},{W:4,H:1,N:6,r:2,c:3},{W:4,H:1,N:7,r:3,c:3},{W:4,H:1,N:8,r:3,c:3},{W:5,H:1,N:0,r:1,c:1},{W:5,H:1,N:1,r:1,c:1},{W:5,H:1,N:2,r:1,c:2},{W:5,H:1,N:3,r:1,c:3},{W:5,H:1,N:4,r:1,c:4},{W:5,H:1,N:5,r:1,c:5},{W:5,H:1,N:6,r:2,c:3},{W:5,H:1,N:7,r:2,c:4},{W:5,H:1,N:8,r:2,c:4},{W:6,H:1,N:0,r:1,c:1},{W:6,H:1,N:1,r:1,c:1},{W:6,H:1,N:2,r:1,c:2},{W:6,H:1,N:3,r:1,c:3},{W:6,H:1,N:4,r:1,c:4},{W:6,H:1,N:5,r:1,c:5},{W:6,H:1,N:6,r:2,c:3},{W:6,H:1,N:7,r:2,c:4},{W:6,H:1,N:8,r:2,c:4},{W:1,H:2,N:0,r:1,c:1},{W:1,H:2,N:1,r:1,c:1},{W:1,H:2,N:2,r:2,c:1},{W:1,H:2,N:3,r:3,c:1},{W:1,H:2,N:4,r:4,c:1},{W:1,H:2,N:5,r:5,c:1},{W:1,H:2,N:6,r:6,c:1},{W:1,H:2,N:7,r:7,c:1},{W:1,H:2,N:8,r:8,c:1},{W:2,H:2,N:0,r:1,c:1},{W:2,H:2,N:1,r:1,c:1},{W:2,H:2,N:2,r:1,c:2},{W:2,H:2,N:3,r:2,c:2},{W:2,H:2,N:4,r:2,c:2},{W:2,H:2,N:5,r:3,c:2},{W:2,H:2,N:6,r:3,c:2},{W:2,H:2,N:7,r:4,c:2},{W:2,H:2,N:8,r:4,c:2},{W:3,H:2,N:0,r:1,c:1},{W:3,H:2,N:1,r:1,c:1},{W:3,H:2,N:2,r:1,c:2},{W:3,H:2,N:3,r:2,c:2},{W:3,H:2,N:4,r:2,c:2},{W:3,H:2,N:5,r:2,c:3},{W:3,H:2,N:6,r:2,c:3},{W:3,H:2,N:7,r:2,c:4},{W:3,H:2,N:8,r:2,c:4},{W:4,H:2,N:0,r:1,c:1},{W:4,H:2,N:1,r:1,c:1},{W:4,H:2,N:2,r:1,c:2},{W:4,H:2,N:3,r:1,c:3},{W:4,H:2,N:4,r:2,c:2},{W:4,H:2,N:5,r:2,c:3},{W:4,H:2,N:6,r:2,c:3},{W:4,H:2,N:7,r:2,c:4},{W:4,H:2,N:8,r:2,c:4},{W:5,H:2,N:0,r:1,c:1},{W:5,H:2,N:1,r:1,c:1},{W:5,H:2,N:2,r:1,c:2},{W:5,H:2,N:3,r:1,c:3},{W:5,H:2,N:4,r:2,c:2},{W:5,H:2,N:5,r:2,c:3},{W:5,H:2,N:6,r:2,c:3},{W:5,H:2,N:7,r:2,c:4},{W:5,H:2,N:8,r:2,c:4},{W:6,H:2,N:0,r:1,c:1},{W:6,H:2,N:1,r:1,c:1},{W:6,H:2,N:2,r:1,c:2},{W:6,H:2,N:3,r:1,c:3},{W:6,H:2,N:4,r:2,c:2},{W:6,H:2,N:5,r:2,c:3},{W:6,H:2,N:6,r:2,c:3},{W:6,H:2,N:7,r:2,c:4},{W:6,H:2,N:8,r:2,c:4},{W:1,H:3,N:0,r:1,c:1},{W:1,H:3,N:1,r:1,c:1},{W:1,H:3,N:2,r:2,c:1},{W:1,H:3,N:3,r:3,c:1},{W:1,H:3,N:4,r:4,c:1},{W:1,H:3,N:5,r:5,c:1},{W:1,H:3,N:6,r:6,c:1},{W:1,H:3,N:7,r:7,c:1},{W:1,H:3,N:8,r:8,c:1},{W:2,H:3,N:0,r:1,c:1},{W:2,H:3,N:1,r:1,c:1},{W:2,H:3,N:2,r:2,c:1},{W:2,H:3,N:3,r:3,c:1},{W:2,H:3,N:4,r:2,c:2},{W:2,H:3,N:5,r:3,c:2},{W:2,H:3,N:6,r:3,c:2},{W:2,H:3,N:7,r:4,c:2},{W:2,H:3,N:8,r:4,c:2},{W:3,H:3,N:0,r:1,c:1},{W:3,H:3,N:1,r:1,c:1},{W:3,H:3,N:2,r:1,c:2},{W:3,H:3,N:3,r:2,c:2},{W:3,H:3,N:4,r:2,c:2},{W:3,H:3,N:5,r:2,c:3},{W:3,H:3,N:6,r:2,c:3},{W:3,H:3,N:7,r:2,c:4},{W:3,H:3,N:8,r:2,c:4},{W:4,H:3,N:0,r:1,c:1},{W:4,H:3,N:1,r:1,c:1},{W:4,H:3,N:2,r:1,c:2},{W:4,H:3,N:3,r:1,c:3},{W:4,H:3,N:4,r:2,c:2},{W:4,H:3,N:5,r:2,c:3},{W:4,H:3,N:6,r:2,c:3},{W:4,H:3,N:7,r:2,c:4},{W:4,H:3,N:8,r:2,c:4},{W:5,H:3,N:0,r:1,c:1},{W:5,H:3,N:1,r:1,c:1},{W:5,H:3,N:2,r:1,c:2},{W:5,H:3,N:3,r:1,c:3},{W:5,H:3,N:4,r:2,c:2},{W:5,H:3,N:5,r:2,c:3},{W:5,H:3,N:6,r:2,c:3},{W:5,H:3,N:7,r:2,c:4},{W:5,H:3,N:8,r:2,c:4},{W:6,H:3,N:0,r:1,c:1},{W:6,H:3,N:1,r:1,c:1},{W:6,H:3,N:2,r:1,c:2},{W:6,H:3,N:3,r:1,c:3},{W:6,H:3,N:4,r:2,c:2},{W:6,H:3,N:5,r:2,c:3},{W:6,H:3,N:6,r:2,c:3},{W:6,H:3,N:7,r:2,c:4},{W:6,H:3,N:8,r:2,c:4}];if("customFusion"==e.widgetType)for(var w in a)if("costPerActionType"!=a[w].type||e.meta)switch(a[w].type){case"line":case"area":case"bar":case"column":case"reachVsImpressions":case"engagedUsersReach":n.lineCharts.push(a[w]);break;case"stackcolumn":n.barCharts.push(a[w]);break;case"pie":n.pieCharts.push(a[w]);break;case"instagramPosts":n.instagramPosts.push(a[w]);break;case"highEngagementTweets":n.highEngagementTweets.push(a[w]);break;case"highestEngagementLinkedIn":n.highestEngagementLinkedIn.push(a[w]);break;case"gaTopPagesByVisit":n.gaTopPagesByVisit.push(a[w]);break;case"campaignOverViewbyAge":n.campaignOverViewbyAge.push(a[w]);break;case"pageContentEfficiency":n.pageContentEfficiency.push(a[w]);break;case"pageTechnicalEfficiency":n.pageTechnicalEfficiency.push(a[w]);break;case"visitorAcquisitionEfficiency":n.visitorAcquisitionEfficiency.push(a[w]);break;case"gaPageContentEfficiencyTable":n.gaPageContentEfficiencyTable.push(a[w]);break;case"gaPageTechnicalEfficiencyTable":n.gaPageTechnicalEfficiencyTable.push(a[w]);break;case"topReferringSites":n.topReferringSites.push(a[w]);break;case"topReferringSitesTable":n.topReferringSitesTable.push(a[w]);break;case"gaSocialMediaOverview":n.gaSocialMediaOverview.push(a[w]);break;case"gaVisitorAcquisitionEfficiencyAnalysisTable":n.gaVisitorAcquisitionEfficiencyAnalysisTable.push(a[w]);break;case"fbReachByCity":n.fbReachByCity.push(a[w]);break;case"fbReachByAge":n.fbReachByAge.push(a[w]);break;case"pinterestEngagementRate":n.pinterestEngagementRate.push(a[w]);break;case"pinterestLeaderboard":n.pinterestLeaderboard.push(a[w]);break;case"audienceBehaviourbyDay":case"socialContributionToSiteTraffic":n.multicharts.push(a[w]);break;case"vimeoTopVideos":n.vimeoTopVideos.push(a[w]);break;case"campaignOverview":n.campaignOverview.push(a[w]);break;case"adgroupOverview":n.adgroupOverview.push(a[w]);break;case"fbAdsAdgroupOverview":n.fbAdsAdgroupOverview.push(a[w]);break;case"adOverview":n.adOverview.push(a[w]);break;case"percentageArea":n.percentageArea.push(a[w]);break;case"mozoverview":for(var D=0;D<a[w].values.length;D++)a[w].values[D].x=moment(a[w].values[D].x).format("YYYY-DD-MM");n.mozoverview.push(a[w]);break;case"angularGauge":n.angularGauge.push(a[w]);break;case"stackbar":n.stackbar.push(a[w]);break;case"instagramHashtagLeaderBoard":n.instagramHashtagLeaderBoard.push(a[w]);break;case"twitterEngagements":n.twitterEngagements.push(a[w]);break;case"youtubeVideosOverview":n.youtubeVideosOverview.push(a[w]);break;case"fbAdsCampaignOverview":n.fbAdsCampaignOverview.push(a[w]);break;case"fbAdsAdOverview":n.fbAdsAdOverview.push(a[w])}else n.costPerActionType.push(a[w]);else for(var w in a)if("line"==a[w].type||"area"==a[w].type||"reachVsImpressions"==a[w].type||"engagedUsersReach"==a[w].type||"costPerActionType"==a[w].type&&void 0!=e.meta)n.lineCharts.push(a[w]);else if("costPerActionType"!=a[w].type||e.meta)switch(a[w].type){case"bar":case"column":case"stackcolumn":n.barCharts.push(a[w]);break;case"pie":n.pieCharts.push(a[w]);break;case"instagramPosts":n.instagramPosts.push(a[w]);break;case"highEngagementTweets":n.highEngagementTweets.push(a[w]);break;case"highestEngagementLinkedIn":n.highestEngagementLinkedIn.push(a[w]);break;case"gaTopPagesByVisit":n.gaTopPagesByVisit.push(a[w]);break;case"campaignOverViewbyAge":n.campaignOverViewbyAge.push(a[w]);break;case"pageContentEfficiency":n.pageContentEfficiency.push(a[w]);break;case"pageTechnicalEfficiency":n.pageTechnicalEfficiency.push(a[w]);break;case"visitorAcquisitionEfficiency":n.visitorAcquisitionEfficiency.push(a[w]);break;case"gaPageContentEfficiencyTable":n.gaPageContentEfficiencyTable.push(a[w]);break;case"gaPageTechnicalEfficiencyTable":n.gaPageTechnicalEfficiencyTable.push(a[w]);break;case"topReferringSites":n.topReferringSites.push(a[w]);break;case"topReferringSitesTable":n.topReferringSitesTable.push(a[w]);break;case"gaSocialMediaOverview":n.gaSocialMediaOverview.push(a[w]);break;case"gaVisitorAcquisitionEfficiencyAnalysisTable":n.gaVisitorAcquisitionEfficiencyAnalysisTable.push(a[w]);break;case"fbReachByCity":n.fbReachByCity.push(a[w]);break;case"fbReachByAge":n.fbReachByAge.push(a[w]);break;case"pinterestEngagementRate":n.pinterestEngagementRate.push(a[w]);break;case"pinterestLeaderboard":n.pinterestLeaderboard.push(a[w]);break;case"audienceBehaviourbyDay":case"socialContributionToSiteTraffic":n.multicharts.push(a[w]);break;case"vimeoTopVideos":n.vimeoTopVideos.push(a[w]);break;case"campaignOverview":n.campaignOverview.push(a[w]);break;case"adgroupOverview":n.adgroupOverview.push(a[w]);break;case"fbAdsAdgroupOverview":n.fbAdsAdgroupOverview.push(a[w]);break;case"adOverview":n.adOverview.push(a[w]);break;case"percentageArea":n.percentageArea.push(a[w]);break;case"mozoverview":for(var D=0;D<a[w].values.length;D++)a[w].values[D].x=moment(a[w].values[D].x).format("YYYY-DD-MM");n.mozoverview.push(a[w]);break;case"angularGauge":n.angularGauge.push(a[w]);break;case"stackbar":n.stackbar.push(a[w]);break;case"instagramHashtagLeaderBoard":n.instagramHashtagLeaderBoard.push(a[w]);break;case"twitterEngagements":n.twitterEngagements.push(a[w]);break;case"youtubeVideosOverview":n.youtubeVideosOverview.push(a[w]);break;case"fbAdsCampaignOverview":n.fbAdsCampaignOverview.push(a[w]);break;case"fbAdsAdOverview":n.fbAdsAdOverview.push(a[w])}else n.costPerActionType.push(a[w]);var C=[],x={},T={},A={},S=["#EF5350","#EC407A","#9C27B0","#42A5F5","#26A69A","#FFCA28","#FF7043","#8D6E63"];if(1==n.lineCharts.length){for(var L=[],I=[],D=0;D<n.lineCharts.length;D++){for(var k=[],F=[],j=0;j<n.lineCharts[D].values.length;j++){k.push("string"==typeof n.lineCharts[D].values[j].x?n.lineCharts[D].values[j].x:n.lineCharts[D].values[j].x.format("DD-MMM-YYYY"));var P=String(n.lineCharts[D].values[j].y).indexOf(".")?parseFloat(n.lineCharts[D].values[j].y):parseInt(n.lineCharts[D].values[j].y);F.push(P)}I.push({name:"(none)"===n.lineCharts[D].key?"Direct":"fbTopReferringDomain"===n.lineCharts[0].chartSubType?"Top Referring Domain":n.lineCharts[D].key,data:F,tooltip:{valueSuffix:n.lineCharts[D].unit},color:n.lineCharts[D].color})}x={chart:{type:n.lineCharts[0].type,reflow:!0,zoomType:"x"},exporting:{enabled:!1},tooltip:{shared:!0},credits:{enabled:!1},xAxis:{type:"datetime",categories:k,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}if("string"!=typeof this.value||p(this.value)){var e=this.value.split("-");return e[1]+" "+e[0]}return this.value}},tickInterval:"fbTopReferringDomain"===n.lineCharts[0].chartSubType?0:7,min:0},yAxis:[{title:{text:null}}],title:{text:"",style:{display:"none"}},series:I},L.push(x),b++,y.push({options:f.lineDataOptions,data:n.lineCharts,api:{},chartOptions:x});var E=0;for(var w in n.lineCharts)for(H in n.lineCharts[w].values)E+=parseFloat(n.lineCharts[w].values[H].y);0==E&&(y[y.length-1].options.chart.yDomain=[0,10])}if(n.lineCharts.length>1){var W,L=[],I=[];for(var w in n.lineCharts){var k=[],F=[];W=n.lineCharts[w].type;for(var O in C)if(n.lineCharts[w].color==C[O]){var N=o(n.lineCharts[w].color,C);n.lineCharts[w].color=N}for(var j=0;j<n.lineCharts[w].values.length;j++)if("object"!=typeof n.lineCharts[w].values[j].x){var B=p(n.lineCharts[w].values[j].x);if(B){k.push(n.lineCharts[w].values[j].x.format("DD-MMM-YYYY"));var P=String(n.lineCharts[w].values[j].y).indexOf(".")?parseFloat(n.lineCharts[w].values[j].y):parseInt(n.lineCharts[w].values[j].y);F.push(P)}else{k.push(n.lineCharts[w].values[j].x);var P=String(n.lineCharts[w].values[j].y).indexOf(".")?parseFloat(n.lineCharts[w].values[j].y):parseInt(n.lineCharts[w].values[j].y);F.push(P)}}else{k.push(n.lineCharts[w].values[j].x.format("DD-MMM-YYYY"));var P=String(n.lineCharts[w].values[j].y).indexOf(".")?parseFloat(n.lineCharts[w].values[j].y):parseInt(n.lineCharts[w].values[j].y);F.push(P)}if("string"==typeof n.lineCharts[w].values[0].x){var R=_.findIndex(u,function(e){return e==n.lineCharts[w].values[0].x});if(R==-1)var M="string";else var M="dayOfWeek"}else if("number"==typeof n.lineCharts[w].values[0].x)var M="number";else var M="date";"reachVsImpressions"==W||"engagedUsersReach"==W?I.push({name:n.lineCharts[w].key,yAxis:"string"==typeof w?parseInt(w):w,tooltip:{valueSuffix:"Impressions/Reach (%)"===n.lineCharts[w].key||"Engaged users/Reach (%)"===n.lineCharts[w].key?"%":n.lineCharts[w].unit},xAxisData:k,xAxisType:M,data:F,type:"area",color:n.lineCharts[w].color}):I.push({name:"(none)"===n.lineCharts[w].key?"Direct":"fbTopReferringDomain"===n.lineCharts[w].chartSubType?"Top Referring Domain":n.lineCharts[w].key,tooltip:{valueSuffix:n.lineCharts[w].unit},xAxisData:k,xAxisType:M,data:F,type:n.lineCharts[w].type,color:n.lineCharts[w].color}),C.push(n.lineCharts[w].color)}if("object"!=typeof n.lineCharts[w].values[0].x){var B=p(n.lineCharts[w].values[0].x);x=B?{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:k,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},title:{text:"",style:{display:"none"}},series:I}:{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:k},title:{text:"",style:{display:"none"}},series:I}}else x="reachVsImpressions"==W||"engagedUsersReach"==W?{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:k,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},yAxis:[{title:{text:"reachVsImpressions"==W?"Impressions/Reach (%)":"Engaged users/Reach (%)"}},{title:{text:"Total Reach"},opposite:!0}],title:{text:"",style:{display:"none"}},series:I}:{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:k,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:"fbTopReferringDomain"===n.lineCharts[0].chartSubType?0:7,min:0},title:{text:"",style:{display:"none"}},series:I};C=[];var z=[];for(var w in n.lineCharts){var $=0;for(var H in n.lineCharts[w].values)$+=parseFloat(n.lineCharts[w].values[H].y);z[w]={summaryTotal:$}}var G=0,Y=0;for(O in z)G=parseInt(z[O].summaryTotal),0==G&&(Y=1);var V=G/z.length;for(var w in n.lineCharts){var $=0;for(H in n.lineCharts[w].values)$+=parseFloat(n.lineCharts[w].values[H].y);$>V?n.lineCharts[w].yAxis=2:n.lineCharts[w].yAxis=1}var U=_.groupBy(I,"xAxisType");for(var q in U){b++;var X=[];if(U[q].length>1){for(var J=U[q][0].xAxisData,K=[],D=0;D<U[q].length;D++){var R=_.findIndex(n.lineCharts,function(e){return e.key==U[q][D].name&&void 0!=e.key});R!=-1&&K.push(n.lineCharts[R]),X.push({name:U[q][D].name,tooltip:U[q][D].tooltip,data:U[q][D].data,type:U[q][D].type,color:U[q][D].color})}if("object"!=typeof U[q][0].data[0]){var B=p(U[q][0].xAxisData[0]);x=B?{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:J,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},title:{text:"",style:{display:"none"}},series:X}:{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:J},title:{text:"",style:{display:"none"}},series:X}}else x="reachVsImpressions"==W||"engagedUsersReach"==W?{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:J,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},yAxis:[{title:{text:"reachVsImpressions"==W?"Impressions/Reach (%)":"Engaged users/Reach (%)"}},{title:{text:"Total Reach"},opposite:!0}],title:{text:"",style:{display:"none"}},series:X}:{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:J,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},title:{text:"",style:{display:"none"}},series:X};y.push({options:f.multiDataOptions,data:K,api:{},chartOptions:x})}else{var J=U[q][0].xAxisData,K=[],R=_.findIndex(n.lineCharts,function(e){return e.key==U[q][0].name&&void 0!=e.key});if(R!=-1&&K.push(n.lineCharts[R]),X.push({name:U[q][0].name,tooltip:U[q][0].tooltip,data:U[q][0].data,type:U[q][0].type,color:U[q][0].color}),"object"!=typeof U[q][0].data[0]){var B=p(U[q][0].xAxisData[0]);x=B?{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:J,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},title:{text:"",style:{display:"none"}},series:X}:{chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:J},title:{text:"",style:{display:"none"}},series:X}}else x={chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:J,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},title:{text:"",style:{display:"none"}},series:X};y.push({options:f.multiDataOptions,data:K,api:{},chartOptions:x})}}1==Y&&(y[y.length-1].options.chart.yDomain1=[0,10])}if(n.barCharts.length>0){var L=[],I=[];b++;for(var w in n.barCharts){var k=[],F=[];for(var O in C)if(n.barCharts[w].color==C[O]){var N=o(n.barCharts[w].color,C);n.barCharts[w].color=N}for(var j=0;j<n.barCharts[w].values.length;j++){var Z;"string"==typeof n.barCharts[w].values[j].x?(Z="string",k.push(n.barCharts[w].values[j].x)):(Z="date",k.push(n.barCharts[w].values[j].x.format("DD-MMM-YYYY")));var P=String(n.barCharts[w].values[j].y).indexOf(".")?parseFloat(n.barCharts[w].values[j].y):parseInt(n.barCharts[w].values[j].y);F.push(P)}I.push({name:"(none)"===n.barCharts[w].key?"Direct":n.barCharts[w].key,data:F,tooltip:{valueSuffix:n.barCharts[w].unit},color:n.barCharts[w].color}),C.push(n.barCharts[w].color)}"string"===Z?x={chart:{type:n.barCharts[w].type,reflow:!0,zoomType:"x"},credits:{enabled:!1},legend:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:k},tooltip:{formatter:function(){return this.x+":</br>"+this.y}},title:{text:"",style:{display:"none"}},yAxis:[{title:{text:null}}],series:I}:"stackcolumn"===n.barCharts[w].type?(n.barCharts[w].type="column",x={chart:{type:"column",reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{type:"datetime",categories:k,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},plotOptions:{column:{stacking:"normal"}},title:{text:"",style:{display:"none"}},yAxis:[{title:{text:null}}],series:I}):x={chart:{type:n.barCharts[w].type,reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0,valueSuffix:"Session Duration"==n.barCharts[w].key?"sec":""},xAxis:{type:"datetime",categories:k,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0},title:{text:"",style:{display:"none"}},yAxis:[{title:{text:null}}],series:I},C=[];var z=[];for(var w in n.barCharts){var $=0;for(var H in n.barCharts[w].values)$+=parseFloat(n.barCharts[w].values[H].y);z[w]={summaryTotal:$}}var G=0;for(O in z)G+=parseInt(z[O].summaryTotal);y.push({options:f.pieDataOptions,data:n.barCharts,api:{},chartOptions:x}),0==G&&(y[y.length-1].options.chart.yDomain=[0,10])}if(n.stackbar.length>0){var L=[],I=[];b++;for(keys in n.stackbar[w].values[0].total[0]){var F=[],k=[];for(var w in n.stackbar)if(k.push(n.stackbar[w].values[0].date),"organic"==keys){var Q=-Math.abs(n.stackbar[w].values[0].total[0][keys]);F.push(Q)}else F.push(n.stackbar[w].values[0].total[0][keys]);I.push({name:"(none)"===keys?"Direct":keys,data:F})}x={chart:{type:"bar",reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:[{categories:k,reversed:!1,labels:{step:1}},{opposite:!0,reversed:!1,categories:k,linkedTo:0,labels:{step:1}}],title:{text:"",style:{display:"none"}},yAxis:[{title:{text:null},labels:{formatter:function(){return""}}}],plotOptions:{series:{stacking:"normal",pointPadding:0,groupPadding:0}},tooltip:{formatter:function(){return"<b>"+this.series.name+this.point.category+"</b><br/>visit: "+Highcharts.numberFormat(Math.abs(this.point.y),0)}},series:I},y.push({options:f.barDataOptions,data:n.stackbar,api:{},chartOptions:x})}if(n.multicharts.length>0){var L=[],k=[],I=[],ee=[];for(var w in n.multicharts){var te=w;if("socialContributionToSiteTraffic"===n.multicharts[te].type){for(var j=0;j<n.multicharts[te].values.length;j++)k.push(n.multicharts[te].values[j].x);for(var ae=[],re=0;re<n.multicharts[te].values.length;re++)ae.push(String(n.multicharts[te].values[re].y).indexOf(".")?parseFloat(n.multicharts[te].values[re].y):parseInt(multicharts[te].values[re].y));I.push({type:"sessions"==n.multicharts[te].metricCode?"column":"line",name:n.multicharts[te].metricName,data:ae,yAxis:("sessions"==n.multicharts[te].metricCode,0),color:n.multicharts[te].color[te]});var oe=ae.reduce(s),se={summaryDisplay:Math.round(100*oe)/100,key:void 0,showComparision:!1,variance:0,color:n.multicharts[te].color[te]};ee.push(se);var ie=[{title:{text:"Total sessions"}},{title:{text:"Sessions from social sources"},opposite:!0}],ne={type:"datetime",categories:k,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0}}else{for(var ie=[{title:{text:null}},{title:{text:null},opposite:!0}],ne={type:"datetime",categories:k},j=0;j<n.multicharts[w].values.length;j++)k.push(n.multicharts[w].values[j].date);var D=0;for(var q in n.multicharts[w].values[0].total){for(var le=[],j=0;j<n.multicharts[w].values.length;j++){var Q=Math.round(100*n.multicharts[w].values[j].total[q])/100;le.push(Q)}if("pageviews"==q){I.push({type:"column",name:"Page views",data:le,yAxis:0,tooltip:{valueSuffix:""},color:n.multicharts[w].color[D]});var oe=le.reduce(s),se={summaryDisplay:Math.round(100*oe)/100,key:void 0,showComparision:!1,variance:0,color:n.multicharts[w].color[D]};ee.push(se)}else if("total"!=q&&"sessions"!=q&&"hour"!=q&&"bounces"!=q){var ce,de;"pageviewsPerSession"==q?(ce="Pages / Session",de="pages"):"bounceRate"==q?(ce="Bounce rate",de="%"):"percentNewSessions"==q&&(ce="% New sessions",de="%"),I.push({type:"line",data:le,name:ce,tooltip:{valueSuffix:de},yAxis:1,color:n.multicharts[w].color[D]});var oe=le.reduce(s),se={summaryDisplay:Math.round(100*oe)/100,key:void 0,showComparision:!1,variance:0,color:n.multicharts[w].color[D]};ee.push(se)}D++}}}x={chart:{zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:ne,title:{text:"",style:{display:"none"}},yAxis:ie,series:I},b++,y.push({options:f.multiDataOptions,data:ee,api:{},chartOptions:x}),0==G&&(y[y.length-1].options.chart.yDomain=[0,10])}if(n.percentageArea.length>0){b++;for(var L=[],k=[],I=[],ee=[],j=0;j<n.percentageArea[0].totalChartLength.length;j++)k.push(moment(n.percentageArea[0].totalChartLength[j].x).format("DD-MMM-YYYY"));var he=0;for(var te in n.percentageArea){var pe=_.groupBy(n.percentageArea[te].values,"y.socialNetwork");for(var q in pe){for(var ge=[],j=0;j<n.percentageArea[te].totalChartLength.length;j++)ge.push({y:0});for(var ue=0;ue<pe[q].length;ue++)for(var D=0;D<n.percentageArea[te].totalChartLength.length;D++){var me=moment(pe[q][ue].x).format("YYYY-DD-MM")==moment(n.percentageArea[te].totalChartLength[D].x).format("YYYY-DD-MM");me===!0&&"undefined"!=typeof pe[q][ue].y&&(ge[D].y=parseInt(pe[q][ue].y.total))}I.push({type:"area",color:n.percentageArea[te].color,name:q,data:ge}),he++}var se={summaryDisplay:Math.round(100*oe)/100,key:n.percentageArea[te].metricName,showComparision:!1,variance:0,color:n.percentageArea[te].color[te]};ee.push(se)}var ne={type:"datetime",categories:k,labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}var e=this.value.split("-");return e[1]+" "+e[0]}},tickInterval:7,min:0};x={chart:{zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:ne,title:{text:"",style:{display:"none"}},yAxis:{title:{text:"value"}},plotOptions:{area:{stacking:"normal",lineColor:"#ffffff",lineWidth:1,marker:{lineWidth:1,lineColor:"#ffffff"}}},series:I},y.push({options:f.percentageAreaOptions,data:n.percentageArea,api:{},chartOptions:x}),0==G&&(y[y.length-1].options.chart.yDomain=[0,10])}if(n.pieCharts.length>0){var L=[],I=[];b++;var k=[],F=[];for(var w in n.pieCharts){for(var O in C)if(n.pieCharts[w].color==C[O]){var N=o(n.pieCharts[w].color,C);n.pieCharts[w].color=N}C.push(n.pieCharts[w].color);var fe=String(n.pieCharts[w].y).indexOf(".")?parseFloat(n.pieCharts[w].y):parseInt(n.pieCharts[w].y),ce=n.pieCharts[w].key;F.push({y:fe,name:"(none)"===ce?"Direct":ce,color:n.pieCharts[w].color})}I.push({data:F,name:n.pieCharts[w].name}),x={chart:{type:n.pieCharts[0].type,reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},title:{text:"",style:{display:"none"}},yAxis:[{title:{text:null}}],tooltip:{formatter:function(){return this.key+":"+this.y+"</b>"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer"}},series:I},C=[],y.push({options:f.pieDataOptions,data:n.pieCharts,api:{},chartOptions:x})}if(n.fbReachByCity.length>0){var L=[],I=[];b++;var k=[],F=[];for(var w in n.fbReachByCity){for(var O in C)if(n.fbReachByCity[w].color==C[O]){var N=o(n.fbReachByCity[w].color,C);n.fbReachByCity[w].color=N}C.push(n.fbReachByCity[w].color);var fe=String(n.fbReachByCity[w].y).indexOf(".")?parseFloat(n.fbReachByCity[w].y):parseInt(n.fbReachByCity[w].y),ce=n.fbReachByCity[w].key;F.push({y:fe,name:ce,color:n.fbReachByCity[w].color})}var ce=n.fbReachByCity[w].name;I.push({data:F,name:ce}),x={chart:{type:"pie",reflow:!0,zoomType:"x"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:35,dataLabels:{enabled:!0}}},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{formatter:function(){return this.key+":"+this.y+"</b>"}},title:{text:"",style:{display:"none"}},series:I},C=[],y.push({options:f.pieDataOptions,data:n.fbReachByCity,api:{},chartOptions:x})}if(n.fbReachByAge.length>0){var L=[],I=[];b++,x={chart:{type:"column",reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:n.fbReachByAge[0].values[1]},yAxis:[{title:{text:null},min:0}],title:{text:"",style:{display:"none"}},plotOptions:{column:{stacking:"normal"}},series:n.fbReachByAge[0].values[2]},colorarray=["#b2aee8","#aee8b2","#e8b2ae","#98DF8A","#756BB1","#FFBB78","#0F9D58","#20bfaf","#bb24d1","#dcdf41"];for(var be=[],oe=0,D=0;D<n.fbReachByAge[0].values[1].length;D++){for(var te=0;te<n.fbReachByAge[0].values[2].length;te++)oe+=n.fbReachByAge[0].values[2][te].data[D];var se={channelName:n.fbReachByAge[0].channelName,summaryDisplay:oe,type:"pie",key:n.fbReachByAge[0].values[1][D],showComparision:"false",variance:0,color:colorarray[D]};be.push(se)}C=[];var z=[];for(var w in be){var $=0;$+=parseFloat(be.summaryDisplay),z[w]={summaryTotal:$}}var G=0;for(O in z)G+=parseInt(z[O].summaryTotal);y.push({options:f.pieDataOptions,data:be,api:{},chartOptions:x})}if(n.instagramPosts.length>0&&n.instagramPosts[0].values.length>0&&(b++,y.push({options:f.instagramPosts,data:n.instagramPosts[0].values})),n.vimeoTopVideos.length>0&&n.vimeoTopVideos[0].values.length>0&&(b++,y.push({options:f.vimeoTopVideos,data:n.vimeoTopVideos[0].values})),n.highEngagementTweets.length>0&&n.highEngagementTweets[0].values.length>0&&(b++,y.push({options:f.highEngagementTweets,data:n.highEngagementTweets[0].values})),n.highestEngagementLinkedIn.length>0&&n.highestEngagementLinkedIn[0].values.length>0&&(b++,y.push({options:f.highestEngagementLinkedIn,data:n.highestEngagementLinkedIn[0].values})),n.gaTopPagesByVisit.length>0&&n.gaTopPagesByVisit[0].values.length>0&&(b++,y.push({options:f.gaTopPagesByVisit,data:n.gaTopPagesByVisit[0].values})),n.campaignOverViewbyAge.length>0&&n.campaignOverViewbyAge[0].values.length>0&&(b++,y.push({options:f.campaignOverViewbyAge,data:n.campaignOverViewbyAge[0].values})),n.campaignOverview.length>0&&n.campaignOverview[0].values.length>0&&(b++,y.push({options:f.campaignOverview,data:n.campaignOverview[0].values})),n.adgroupOverview.length>0&&n.adgroupOverview[0].values.length>0&&(b++,
y.push({options:f.adgroupOverview,data:n.adgroupOverview[0].values})),n.fbAdsAdgroupOverview.length>0&&n.fbAdsAdgroupOverview[0].values.length>0&&(b++,y.push({options:f.fbAdsAdgroupOverview,data:n.fbAdsAdgroupOverview[0].values})),n.adOverview.length>0&&n.adOverview[0].values.length>0&&(b++,y.push({options:f.adOverview,data:n.adOverview[0].values})),n.gaPageContentEfficiencyTable.length>0&&n.gaPageContentEfficiencyTable[0].values.length>0&&(b++,y.push({options:f.gaPageContentEfficiencyTable,data:n.gaPageContentEfficiencyTable[0].values})),n.topReferringSitesTable.length>0&&n.topReferringSitesTable[0].values.length>0&&(b++,y.push({options:f.topReferringSitesTable,data:n.topReferringSitesTable[0].values})),n.gaPageTechnicalEfficiencyTable.length>0&&n.gaPageTechnicalEfficiencyTable[0].values.length>0&&(b++,y.push({options:f.gaPageTechnicalEfficiencyTable,data:n.gaPageTechnicalEfficiencyTable[0].values})),n.gaVisitorAcquisitionEfficiencyAnalysisTable.length>0&&n.gaVisitorAcquisitionEfficiencyAnalysisTable[0].values.length>0&&(b++,y.push({options:f.gaVisitorAcquisitionEfficiencyAnalysisTable,data:n.gaVisitorAcquisitionEfficiencyAnalysisTable[0].values})),n.pageTechnicalEfficiency.length>0){var L=[],I=[];b++;for(var w in n.pageTechnicalEfficiency){var ye=[],F=[];F[0]=[],F[1]=[];for(var j=0;j<n.pageTechnicalEfficiency[w].values.length;j++)ye.push(String(n.pageTechnicalEfficiency[w].values[j].pageTitle)),F[0].push(Number(n.pageTechnicalEfficiency[w].values[j].PageLoadTime)),F[1].push(Number(n.pageTechnicalEfficiency[w].values[j].bounceRate));for(var D=0;D<n.pageTechnicalEfficiency[w].summary.length;D++)I.push({name:n.pageTechnicalEfficiency[w].summary[D].key,yAxis:D,tooltip:{valueSuffix:n.pageTechnicalEfficiency[w].summary[D].unit},data:F[D],type:0==D?"column":"line",color:n.pageTechnicalEfficiency[w].color[D]})}x={chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:ye,labels:{formatter:function(){return this.value}},tickInterval:1,min:0,max:ye.length-1},yAxis:[{title:{text:"Page LoadTime"}},{title:{text:"Bounce Rate"},opposite:!0}],title:{text:"",style:{display:"none"}},series:I},y.push({options:f.visitorAcquisitionEfficiency,data:n.pageTechnicalEfficiency,api:{},chartOptions:x})}if(n.visitorAcquisitionEfficiency.length>0){var L=[],I=[];b++;for(var w in n.visitorAcquisitionEfficiency){var ye=[],F=[];F[0]=[],F[1]=[],F[2]=[];for(var j=0;j<n.visitorAcquisitionEfficiency[w].values.length;j++)ye.push(String(n.visitorAcquisitionEfficiency[w].values[j].sourceMedium)),F[0].push(Number(n.visitorAcquisitionEfficiency[w].values[j].newUsers)),F[1].push(Number(n.visitorAcquisitionEfficiency[w].values[j].goalValuePerSession)),F[2].push(Number(n.visitorAcquisitionEfficiency[w].values[j].goalConversionRateAll));for(var D=0;D<n.visitorAcquisitionEfficiency[w].summary.length;D++)I.push({name:n.visitorAcquisitionEfficiency[w].summary[D].key,yAxis:D<1?0:1,tooltip:{valueSuffix:n.visitorAcquisitionEfficiency[w].summary[D].unit},data:F[D],type:D<1?"column":"line",color:n.visitorAcquisitionEfficiency[w].color[D]})}x={chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:ye,labels:{formatter:function(){return this.value}},tickInterval:1,min:0,max:ye.length-1},yAxis:[{title:{text:"New users"}},{title:{text:"Goal value & Goal conversion rate"},opposite:!0}],title:{text:"",style:{display:"none"}},series:I},y.push({options:f.visitorAcquisitionEfficiency,data:n.visitorAcquisitionEfficiency,api:{},chartOptions:x})}if(n.gaSocialMediaOverview.length>0){var L=[],I=[];b++;for(var w in n.gaSocialMediaOverview)for(var j=0;j<n.gaSocialMediaOverview[w].values.length;j++)I.push({x:Number(n.gaSocialMediaOverview[w].values[j].pageviewsPersession),y:Number(n.gaSocialMediaOverview[w].values[j].sessions),z:Number(n.gaSocialMediaOverview[w].values[j].avgtimeOnPage),name:"(none)"===String(n.gaSocialMediaOverview[w].values[j].socialNetwork)?"Direct":String(n.gaSocialMediaOverview[w].values[j].socialNetwork)});x={chart:{reflow:!0,type:"bubble",zoomType:"xy"},legend:{enabled:!1},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{useHTML:!0,headerFormat:"<table>",pointFormat:'<tr><th colspan="2"><h3>{point.name}</h3></th></tr><tr><th>Page Views Per Session:</th><td>{point.x}pages</td></tr><tr><th>Sessions:</th><td>{point.y}</td></tr><tr><th>Time on Page:</th><td>{point.z}s</td></tr>',footerFormat:"</table>",enabled:!0,shared:!0},xAxis:{labels:{formatter:function(){return this.value}},title:{text:"Page Views Per Session"}},yAxis:{title:{text:"Sessions"}},title:{text:"",style:{display:"none"}},plotOptions:{series:{dataLabels:{enabled:!0,format:"{point.name}"}}},series:[{data:I}]},y.push({options:f.visitorAcquisitionEfficiency,data:n.gaSocialMediaOverview,api:{},chartOptions:x})}if(n.topReferringSites.length>0){var L=[],I=[];b++;for(var w in n.topReferringSites){var ye=[],F=[];F[0]=[],F[1]=[],F[2]=[];for(var j=0;j<n.topReferringSites[w].values.length;j++)ye.push(String(n.topReferringSites[w].values[j].source)),F[0].push(Number(n.topReferringSites[w].values[j].sessions)),F[1].push(Number(n.topReferringSites[w].values[j].goalCompletions)),F[2].push(Number(n.topReferringSites[w].values[j].goalConversionRate));for(var D=0;D<n.topReferringSites[w].summary.length;D++)I.push({name:n.topReferringSites[w].summary[D].key,yAxis:D<=1?0:1,tooltip:{valueSuffix:n.topReferringSites[w].summary[D].unit},data:F[D],type:D<1?"column":"line",color:n.topReferringSites[w].color[D]})}x={chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:ye,labels:{formatter:function(){return this.value}},tickInterval:1,min:0,max:ye.length-1},yAxis:[{title:{text:"Sessions & Goal completions"}},{title:{text:"Goal conversion rate"},opposite:!0}],title:{text:"",style:{display:"none"}},series:I},y.push({options:f.visitorAcquisitionEfficiency,data:n.topReferringSites,api:{},chartOptions:x})}if(n.pageContentEfficiency.length>0){var I=[];b++;for(var w in n.pageContentEfficiency){var ye=[],F=[];F[0]=[],F[1]=[],F[2]=[],F[3]=[];for(var j=0;j<n.pageContentEfficiency[w].values.length;j++)ye.push(String(n.pageContentEfficiency[w].values[j].pageTitle)),F[0].push(Number(n.pageContentEfficiency[w].values[j].uniquePageviews)),F[1].push(Number(n.pageContentEfficiency[w].values[j].pageviews)),F[2].push(Number(n.pageContentEfficiency[w].values[j].bounceRate)),F[3].push(Number(n.pageContentEfficiency[w].values[j].entranceRate));for(var D=0;D<n.pageContentEfficiency[w].summary.length;D++)I.push({name:n.pageContentEfficiency[w].summary[D].key,yAxis:D<2?0:1,tooltip:{valueSuffix:n.pageContentEfficiency[w].summary[D].unit},data:F[D],type:D<2?"column":"line",color:n.pageContentEfficiency[w].color[D]})}x={chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:ye,labels:{formatter:function(){return this.value}},tickInterval:1,min:0,max:ye.length-1},yAxis:[{title:{text:"Unique Page views & Page views"}},{title:{text:"Entrance Rate & Bounce Rate"},opposite:!0}],title:{text:"",style:{display:"none"}},series:I},y.push({options:f.visitorAcquisitionEfficiency,data:n.pageContentEfficiency,api:{},chartOptions:x})}if(n.pinterestEngagementRate.length>0&&n.pinterestEngagementRate[0].values.length>0&&(b++,y.push({options:f.pinterestEngagementRate,data:n.pinterestEngagementRate[0].values})),n.pinterestLeaderboard.length>0&&n.pinterestLeaderboard[0].values.length>0&&(b++,y.push({options:f.pinterestLeaderboard,data:n.pinterestLeaderboard[0].values})),n.costPerActionType.length>0&&y.push({options:f.costPerActionType,data:n.costPerActionType}),n.mozoverview.length>0){for(var ae=[],D=0;D<n.mozoverview.length;D++){var ve=n.mozoverview[D].values.length-1;switch(n.mozoverview[D].key){case"Links":var we=parseInt(n.mozoverview[D].values[ve].y);break;case"External equity links":var De=parseInt(n.mozoverview[D].values[ve].y);break;case"Domain Authority (/100)":var Ce=n.mozoverview[D].values[ve].y;break;case"Page Authority (/100)":var xe=n.mozoverview[D].values[ve].y;break;case"Moz Rank (/10)":var Te=n.mozoverview[D].values[ve].y}}var Ae={mozRankURL:Te,externalEquityLinks:De,domainageAuthority:Ce,links:we,pageAuthority:xe};y.push({options:f.mozoverview,data:n.mozoverview,displayData:Ae})}if(n.angularGauge.length>0&&(0!=n.angularGauge[0].y&&(b++,x={chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:!1},credits:{enabled:!1},exporting:{enabled:!1},yAxis:{min:0,max:100,minorTickInterval:"auto",minorTickWidth:1,minorTickLength:10,minorTickPosition:"inside",minorTickColor:"#666",tickPixelInterval:30,tickWidth:2,tickPosition:"inside",tickLength:10,tickColor:"#666",title:{text:"Post/day"},plotBands:[{from:0,to:20,color:"#55BF3B"},{from:20,to:60,color:"#DDDF0D"},{from:60,to:100,color:"#DF5353"}]},title:{text:"",style:{display:"none"}},series:[{name:"Post Per Day",data:[n.angularGauge[0].y],tooltip:{valueSuffix:" post/day"}}]}),y.push({options:f.pieDataOptions,data:n.angularGauge,chartOptions:x})),n.instagramHashtagLeaderBoard.length>0&&n.instagramHashtagLeaderBoard[0].values.length>0&&(b++,y.push({options:f.instagramHashtagLeaderBoard,data:n.instagramHashtagLeaderBoard[0].values})),n.twitterEngagements.length>0){var Se=[],Le=[],Ie=0,ke=0,Fe=[];for(var w in n.twitterEngagements)if("activityByDayOfTheWeek"==n.twitterEngagements[w].chartSubType||"instagramActivityByDayOfTheWeek"==n.twitterEngagements[w].chartSubType)Ie=1,Se.push(n.twitterEngagements[w]);else if("activityByTimeOfTheDay"==n.twitterEngagements[w].chartSubType||"instagramActivityByTimeOfTheDay"==n.twitterEngagements[w].chartSubType){ke=1;var I=[];Le.push(n.twitterEngagements[w])}else if(n.twitterEngagements[w].values.length>0&&"commentsAndLikes"==n.twitterEngagements[w].chartSubType){b++;for(var I=[],je=[],Pe=[],j=0;j<n.twitterEngagements[w].values.length;j++)Pe.push(n.twitterEngagements[w].values[j].x);je=_.uniqBy(Pe);for(var j=0;j<n.twitterEngagements[w].values.length;j++){var Ee=_.indexOf(je,n.twitterEngagements[w].values[j].x);I.push({x:Ee,y:Number(n.twitterEngagements[w].values[j].y),z:Number(n.twitterEngagements[w].values[j].y),color:n.twitterEngagements[w].color[Ee],link:n.twitterEngagements[w].values[j].link,date:je[Ee]})}x={chart:{reflow:!0,type:"bubble",zoomType:"xy"},legend:{enabled:!1},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{useHTML:!0,headerFormat:"<table>",pointFormat:"<tr><th>Date:</th><td>{point.date}</td></tr><tr><th>Engagement:</th><td>{point.y}</td></tr><tr><th>Link:</th><td>{point.link}</td></tr>",footerFormat:"</table>",enabled:!0,shared:!0},xAxis:{labels:{},categories:je,title:{text:null},labels:{formatter:function(){if("object"==typeof this.value||"number"==typeof this.value){var e=new Date(this.value);return g[e.getMonth()]+" "+e.getDate()}if("string"!=typeof this.value||p(this.value)){var e=this.value.split("-");return e[1]+" "+e[0]}return this.value}},tickInterval:7,max:je.length-1},yAxis:{title:{text:"Engagements"}},title:{text:"",style:{display:"none"}},plotOptions:{series:{dataLabels:{enabled:!1}}},series:[{data:I}]},y.push({options:f.visitorAcquisitionEfficiency,data:n.twitterEngagements[w],api:{},chartOptions:x})}else if(n.twitterEngagements[w].values.length>0&&("topLinks"===n.twitterEngagements[w].chartSubType||"hashTag"===n.twitterEngagements[w].chartSubType)){b++;var We={chart:{type:n.twitterEngagements[w].chartSubType}};y.push({options:We,data:n.twitterEngagements[0].values})}else if(n.twitterEngagements[w].values.length>0&&("engagementByUsersTalkedAbout"===n.twitterEngagements[w].chartSubType||"hashTag"===n.twitterEngagements[w].chartSubType)){b++;var We={chart:{type:n.twitterEngagements[w].chartSubType}};y.push({options:We,data:n.twitterEngagements[w].values})}if(ke>0){var I=[];b++;for(var w in Le)for(var j=0;j<Le[w].values.length;j++){if("Sunday"==String(Le[w].values[j].day))var Ee=0;else if("Monday"==String(Le[w].values[j].day))var Ee=1;else if("Tuesday"==String(Le[w].values[j].day))var Ee=2;else if("Wednesday"==String(Le[w].values[j].day))var Ee=3;else if("Thursday"==String(Le[w].values[j].day))var Ee=4;else if("Friday"==String(Le[w].values[j].day))var Ee=5;else if("Saturday"==String(Le[w].values[j].day))var Ee=6;I.push({x:Ee,y:Number(Le[w].values[j].time),z:Number(Le[w].values[j].engagement),color:Le[w].color[Ee]})}T={chart:{reflow:!0,type:"bubble",zoomType:"xy"},legend:{enabled:!1},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{useHTML:!0,headerFormat:"<table>",pointFormat:"<tr><th>Time:</th><td>{point.y}</td></tr><tr><th>Engagement:</th><td>{point.z}</td></tr>",footerFormat:"</table>",enabled:!0,shared:!0},xAxis:{labels:{},categories:u,title:{text:null},max:u.length-1},yAxis:{title:{text:"Time"},min:0,max:28,tickInterval:7},title:{text:"",style:{display:"none"}},plotOptions:{series:{dataLabels:{enabled:!1}}},series:[{data:I}]},y.push({options:f.visitorAcquisitionEfficiency,data:Le,api:{},chartOptions:T})}if(Ie>0){var I=[],ye=[];Fe[0]=[],Fe[1]=[];var Oe=[];b++;for(var We=0;We<Se.length;We++){ye.length<Se[We].values.length&&(ye.length=0);for(var j=0;j<Se[We].values.length;j++)if(ye.length<Se[We].values.length&&ye.push(String(Se[We].values[j].day)),"activityByDayOfTheWeek"==Se[We].chartSubType){var Ne="Tweets count";Fe[0].push({tweet:Number(Se[We].values[j].tweets)}),Fe[1].push({tweetEngage:Number(Se[We].values[j].engagement)})}else{var Ne="Posts count";Fe[0].push({instaTweet:Number(Se[We].values[j].tweets)}),Fe[1].push({instaEngage:Number(Se[We].values[j].engagement)})}}for(var D=0;D<Fe.length;D++)for(var q=0;q<Fe[D].length;q++)for(var Be in Fe[D][q])Oe.push(Fe[D][q]);for(var Re=[],ue=0;ue<Oe.length;ue++)Re.push(Oe[ue]);var Me=[],ze=[],$e=[],_e=[];for(var ue in Re)for(var Be in Re[ue])switch(Be){case"tweet":Me.push(Re[ue][Be]);break;case"tweetEngage":_e.push(Re[ue][Be]);break;case"instaTweet":ze.push(Re[ue][Be]);break;case"instaEngage":$e.push(Re[ue][Be]);break;default:console.log("err")}Me.length&&I.push({name:"Tweet",yAxis:0,tooltip:{valueSuffix:""},data:Me,type:"column",color:n.twitterEngagements[w].color[0]}),ze.length&&I.push({name:"Post",yAxis:0,tooltip:{valueSuffix:""},data:ze,type:"column",color:n.twitterEngagements[w].color[1]}),$e.length&&I.push({name:"Engagement",yAxis:1,tooltip:{valueSuffix:""},data:$e,type:"line",color:n.twitterEngagements[w].color[2]}),_e.length&&I.push({name:"Engagement",yAxis:1,tooltip:{valueSuffix:""},data:_e,type:"line",color:n.twitterEngagements[w].color[3]}),A={chart:{reflow:!0,zoomType:"x"},credits:{enabled:!1},exporting:{enabled:!1},tooltip:{enabled:!0,shared:!0},xAxis:{categories:ye,labels:{formatter:function(){return this.value}},tickInterval:1,min:0,max:ye.length-1},yAxis:[{title:{text:Ne}},{title:{text:"Engagement count"},opposite:!0}],title:{text:"",style:{display:"none"}},series:I},y.push({options:f.visitorAcquisitionEfficiency,data:Se,api:{},chartOptions:A})}}if(n.youtubeVideosOverview.length>0){b++;for(var w in n.youtubeVideosOverview){var We={chart:{type:n.youtubeVideosOverview[w].type}};n.youtubeVideosOverview[0].values.length>0&&y.push({options:We,data:n.youtubeVideosOverview[0].values})}}if(n.fbAdsCampaignOverview.length>0&&n.fbAdsCampaignOverview[0].values.length>0&&(b++,y.push({options:f.fbAdsCampaignOverview,data:n.fbAdsCampaignOverview[0].values})),n.fbAdsAdOverview.length>0&&n.fbAdsAdOverview[0].values.length>0&&(b++,y.push({options:f.fbAdsAdOverview,data:n.fbAdsAdOverview[0].values})),0==y.length)if("custom"==e.widgetType){var He="";He="localhost"==window.location.hostname?"http://localhost:8080/api/v1/create/customdata/"+e._id:window.location.hostname+"/api/v1/create/customdata/"+e._id,y.push({options:f.emptyCharts,data:[{message:"No data for chosen date range. Please send your data to: "+He}]})}else y.push({options:f.emptyCharts,data:[{message:"No data for chosen date range"}]});var Ge=function(){l="undefined"!=typeof e.size?e.size.h:3,c="undefined"!=typeof e.size?e.size.w:3;for(var t=0;t<v.length;t++)v[t].W==c&&v[t].H==l&&v[t].N==b&&(d=v[t].c,h=v[t].r)};if(Ge(),m="custom"==e.widgetType?"Custom Data":"undefined"!=typeof e.name?e.name:"","undefined"!=typeof y[0].data[0]&&"undefined"!=y[0].data[0].displaySummary&&y[0].data[0].displaySummary===!1)var Ye={showSummary:!1,name:m,visibility:!0,id:e._id,color:e.color,chart:y,layoutOptionsX:d,layoutOptionsY:h};else if("undefined"!=typeof y[0].data[0]&&"undefined"!=typeof y[0].data[0].key)var Ye={name:m,visibility:!0,id:e._id,color:e.color,chart:y,layoutOptionsX:d,layoutOptionsY:h};else var Ye={showSummary:!1,name:m,visibility:!0,id:e._id,color:e.color,chart:y,layoutOptionsX:d,layoutOptionsY:h};return i.resolve(Ye),i.promise}function p(e){var t=new Date(e);return!isNaN(t.getDate())}var g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],m=t.defer(),f=t.defer(),b=JSON.parse(JSON.stringify(a));switch(a.widgetType){case"customFusion":var y=[],v=[],w=[];y.push(s(a,o)),t.all(y).then(function(e){var a=e[0];for(var s in a)"basic"==a[s].widgetType||"adv"==a[s].widgetType||"fusion"==a[s].widgetType?v.push(l(a[s],r,o)):"custom"==a[s].widgetType&&v.push(i(a[s],r));t.all(v).then(function(e){for(var a in e)"basic"==e[a].widgetType||"adv"==e[a].widgetType||"fusion"==e[a].widgetType?w.push(d(e[a])):"custom"==e[a].widgetType&&w.push(n(e[a]));t.all(w).then(function(e){var t=[];for(var a in e)for(var r in e[a])t.push(e[a][r]);var o=h(b,t);o.then(function(e){m.resolve(e)},function(e){m.reject(e)})},function(e){m.reject(e)})},function(e){m.reject(e)})},function(e){m.reject(e)});break;case"basic":case"adv":case"fusion":var D=l(b,r,o);D.then(function(e){var t=d(e,r);t.then(function(e){var t=h(a,e);t.then(function(e){m.resolve(e)},function(e){m.reject(e)})},function(e){m.reject(e)})},function(e){m.reject(e)});break;case"custom":var D=i(b,r);D.then(function(e){var t=n(e);t.then(function(e){var t=h(a,e,r);t.then(function(e){m.resolve(e)},function(e){m.reject(e)})},function(e){m.reject(e)})},function(e){m.reject(e)})}return m.promise}}]),showMetricApp.service("generateChartColours",function(){this.fetchRandomColors=function(e){for(var t,a=["#EF5350","#EC407A","#9C27B0","#42A5F5","#26A69A","#FFCA28","#FF7043","#8D6E63"],r=[];r.length<e;)t=a[Math.floor(Math.random()*(a.length-1))+1],r.indexOf(t)==-1?r.push(t):r.length>a.length&&r.indexOf(t,a.length-1)==-1&&r.push(t);return r},this.fetchWidgetColor=function(e){var t;switch(e){case"Facebook":t="#3B5998";break;case"Google Analytics":t="#F26630";break;case"Twitter":t="#5EA9DD";break;case"FacebookAds":t="#4E5664";break;case"GoogleAdwords":t="#1A925A";break;case"Instagram":t="#895A4D";break;case"YouTube":t="#CC181E";break;default:t="#04509B"}return t}}),showMetricApp.controller("AccountManagementController",AccountManagementController),showMetricApp.controller("addNewUserController",addNewUserController),showMetricApp.controller("AlertController",AlertController),showMetricApp.controller("AppController",AppController),showMetricApp.controller("BasicWidgetController",BasicWidgetController),showMetricApp.controller("buildReportController",buildReportController),showMetricApp.controller("ChangePasswordController",ChangePasswordController),showMetricApp.controller("ChooseDashboardController",ChooseDashboardController),showMetricApp.controller("customReportController",customReportController),showMetricApp.controller("CustomWidgetController",CustomWidgetController),showMetricApp.controller("DashboardController",DashboardController),showMetricApp.controller("ExportController",ExportController),showMetricApp.controller("FusionSettingsController",FusionSettingsController),showMetricApp.controller("FusionWidgetController",FusionWidgetController),showMetricApp.controller("GridviewController",GridviewController),showMetricApp.controller("LightBoxController",LightBoxController),showMetricApp.controller("MainCtrl",MainCtrl),showMetricApp.controller("ModalInstanceController",ModalInstanceController),showMetricApp.controller("NavigationController",NavigationController),showMetricApp.controller("ProfileListController",ProfileListController),showMetricApp.controller("RecommendedDashboardController",RecommendedDashboardController),showMetricApp.controller("SharedDashboardController",SharedDashboardController),showMetricApp.controller("SwitchController",SwitchController),showMetricApp.controller("TopNavbarController",TopNavbarController),showMetricApp.controller("UpgradeController",UpgradeController),showMetricApp.controller("UserManagementController",UserManagementController),showMetricApp.controller("WidgetSettingsController",WidgetSettingsController);